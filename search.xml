<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Build and Deploy Your Personal Blog Using Hexo, NexT, and GitHub</title>
    <url>/2019/12/01/Build-and-Deploy-Your-Personal-Blog-Using-Hexo-NexT-and-GitHub/</url>
    <content><![CDATA[<html><head></head><body><p>A personal blog is a useful tool that could help us to record and share our ideas, research work, coding experiences, learning notes, and so on. Nowadays, there are many open source frameworks and online platforms that provide blog service, which could help people build and deploy personal blog easily and quickly either free or not. In this article, I will introduce a popular method to build and deploy our personal blog using <a href="https://hexo.io/">Hexo</a>, <a href="https://theme-next.org/">NexT</a>, and <a href="https://github.com/hexojs/hexo">GitHub</a> step by step. If you follow the succeeding instructions step by step, you will build a well-designed personal blog and deploy it on the Internet as well. Let's start right now. <span id="more"></span> ## Build Your Using Hexo <a href="https://hexo.io/">Hexo</a> is a fast and powerful static blog generating framework, it is based on <a href="https://nodejs.org/en/">Node.js</a>. By using Hexo, we can write articles easily using with Markdown. Besides the grammer of Markdown, Hexo also provide <a href="https://hexo.io/docs/tag-plugins">tag plugins</a> that we can use to further customize the format of article content. Please visit the <a href="https://hexo.io">official website</a> for more information. ### Installation Installing Hexo is quite easy and only requires the following beforehand: * <a href="https://nodejs.org/en/">Node.js</a> * <a href="https://git-scm.com/">Git</a></p>
<h4 id="install-git">Install Git</h4>
<figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install git-core</span><br><span class="line">git <span class="comment">--version</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="install-pandoc">Install pandoc</h4>
<p>Use pandoc to make mathjax work. </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install pandoc </span><br></pre></td></tr></tbody></table></figure><p></p>
<p>If the git version is printed, it means that we have installed git successfully. Then we can go to next step. #### Install Node.js Node.js is an asynchronous event-driven JavaScript runtime that can build scalable network applications. We can install it from source. </p><figure class="highlight armasm"><table><tbody><tr><td class="code"><pre><span class="line"><span class="symbol">curl</span> -<span class="built_in">sL</span> https:<span class="comment">//deb.nodesource.com/setup_18.x | sudo -E bash -</span></span><br><span class="line"><span class="symbol">sudo</span> apt-<span class="meta">get</span> install -y nodejs</span><br></pre></td></tr></tbody></table></figure> The above two steps can install nodejs and npm. We can verify the installation by printing the version of nodejs and npm. <figure class="highlight coffeescript"><table><tbody><tr><td class="code"><pre><span class="line">nodejs -v</span><br><span class="line"><span class="built_in">npm</span> -v</span><br></pre></td></tr></tbody></table></figure> If you come from China as me, you had better change the package source from the original one to the one maintained by taobao. <figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line">sudo npm install -<span class="keyword">g</span> nrm</span><br><span class="line">nrm <span class="keyword">ls</span></span><br><span class="line">nrm <span class="keyword">use</span> taobao</span><br></pre></td></tr></tbody></table></figure> ##### Errors * Error If you use <em>nrm ls</em>, you may get the following error. The main reason of the error is that the nodejs version is too low, thus we just update nodejs to fix this error. <figure class="highlight roboconf"><table><tbody><tr><td class="code"><pre><span class="line">/usr/local/lib/node_modules/nrm/cli.js:138</span><br><span class="line">function config(attrArray, registry, index = 0) {</span><br><span class="line">                                           ^</span><br><span class="line"></span><br><span class="line"><span class="attribute">SyntaxError</span>: Unexpected token =</span><br><span class="line">    at exports<span class="variable">.runInThisContext</span> (vm<span class="variable">.js</span>:53:16)</span><br><span class="line">    at Module<span class="variable">._compile</span> (module<span class="variable">.js</span>:374:25)</span><br><span class="line">    at Object<span class="variable">.Module</span><span class="variable">._extensions</span>.<span class="variable">.js</span> (module<span class="variable">.js</span>:417:10)</span><br><span class="line">    at Module<span class="variable">.load</span> (module<span class="variable">.js</span>:344:32)</span><br><span class="line">    at Function<span class="variable">.Module</span><span class="variable">._load</span> (module<span class="variable">.js</span>:301:12)</span><br><span class="line">    at Function<span class="variable">.Module</span><span class="variable">.runMain</span> (module<span class="variable">.js</span>:442:10)</span><br><span class="line">    at startup (node<span class="variable">.js</span>:136:18)</span><br><span class="line">    at node<span class="variable">.js</span>:966:3</span><br></pre></td></tr></tbody></table></figure> * Solution <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo npm cache clean -f</span><br><span class="line">sudo npm install -g n</span><br><span class="line">sudo n stable</span><br><span class="line">sudo ln -sf <span class="regexp">/usr/</span>local<span class="regexp">/n/</span>versions<span class="regexp">/node/</span><span class="number">12.13</span>.<span class="number">1</span><span class="regexp">/bin/</span>node <span class="regexp">/usr/</span>bin/nodejs</span><br><span class="line">node -v</span><br><span class="line">nrm ls</span><br></pre></td></tr></tbody></table></figure> ##### Warnings * deprecated fsevents@1.2.9: fsevents 1 will break on node v14+ and could be using insecure binaries. Upgrade to fsevents 2. <figure class="highlight coffeescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> upgrade fsevents</span><br></pre></td></tr></tbody></table></figure> * Warning: Accessing non-existent property 'lineno' of module exports inside circular dependency <figure class="highlight coffeescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> install stylus</span><br><span class="line"><span class="built_in">npm</span> install lineno</span><br><span class="line"><span class="built_in">npm</span> install column</span><br><span class="line"><span class="built_in">npm</span> install filename</span><br><span class="line"><span class="built_in">npm</span> update</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="install-hexo">Install Hexo</h4>
<p>After Git and Node.js are installed, we can install Hexo right now. </p><figure class="highlight avrasm"><table><tbody><tr><td class="code"><pre><span class="line">sudo npm install hexo-<span class="keyword">cli</span> -g</span><br><span class="line">hexo -v</span><br></pre></td></tr></tbody></table></figure> If the Hexo version is printed, it means that we have installed Hexo successfully. Then we can go to next step to build our personal blog. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">hexo</span>-cli: <span class="number">4</span>.<span class="number">3</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">os</span>: linux <span class="number">4</span>.<span class="number">15</span>.<span class="number">0</span>-<span class="number">200</span>-generic Ubuntu <span class="number">18</span>.<span class="number">04</span>.<span class="number">6</span> LTS (Bionic Beaver)</span><br><span class="line"><span class="attribute">node</span>: <span class="number">14</span>.<span class="number">21</span>.<span class="number">3</span></span><br><span class="line"><span class="attribute">v8</span>: <span class="number">8.4.371.23</span>-node.<span class="number">88</span></span><br><span class="line"><span class="attribute">uv</span>: <span class="number">1</span>.<span class="number">42</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">zlib</span>: <span class="number">1</span>.<span class="number">2</span>.<span class="number">11</span></span><br><span class="line"><span class="attribute">brotli</span>: <span class="number">1</span>.<span class="number">0</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">ares</span>: <span class="number">1</span>.<span class="number">18</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">modules</span>: <span class="number">83</span></span><br><span class="line"><span class="attribute">nghttp2</span>: <span class="number">1</span>.<span class="number">42</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">napi</span>: <span class="number">8</span></span><br><span class="line"><span class="attribute">llhttp</span>: <span class="number">2</span>.<span class="number">1</span>.<span class="number">6</span></span><br><span class="line"><span class="attribute">openssl</span>: <span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>t</span><br><span class="line"><span class="attribute">cldr</span>: <span class="number">40</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">icu</span>: <span class="number">70</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">tz</span>: <span class="number">2022</span>f</span><br><span class="line"><span class="attribute">unicode</span>: <span class="number">14</span>.<span class="number">0</span></span><br></pre></td></tr></tbody></table></figure> ### Building Hexo allows us to maintain and write our blog in a directory, thus we first make a directory at any path as we like. <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> blog</span><br><span class="line"><span class="built_in">cd</span> blog</span><br></pre></td></tr></tbody></table></figure> Then we initialize our blog, generate static blog webpage and serve it on our computer locally using just the following three steps. <figure class="highlight verilog"><table><tbody><tr><td class="code"><pre><span class="line">hexo init</span><br><span class="line">hexo <span class="keyword">generate</span></span><br><span class="line">hexo server</span><br></pre></td></tr></tbody></table></figure> We can visit the blog we built by <a href="http://localhost:4000">http://localhost:4000</a>. ## Customization There are many plugins that could help us customize our blog easily, such as automatically build sitemap, rss, generate archives and categories. We install them before we go to further steps. <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">npm install hexo-generator-<span class="keyword">index</span> <span class="comment">--save</span></span><br><span class="line">npm install hexo-generator-archive <span class="comment">--save</span></span><br><span class="line">npm install hexo-generator-category <span class="comment">--save</span></span><br><span class="line">npm install hexo-generator-tag <span class="comment">--save</span></span><br><span class="line">npm install hexo-<span class="keyword">server</span> <span class="comment">--save</span></span><br><span class="line">npm install hexo-deployer-git <span class="comment">--save</span></span><br><span class="line">npm install hexo-deployer-heroku <span class="comment">--save</span></span><br><span class="line">npm install hexo-deployer-rsync <span class="comment">--save</span></span><br><span class="line">npm install hexo-deployer-openshift <span class="comment">--save</span></span><br><span class="line">npm install hexo-renderer-marked <span class="comment">--save</span></span><br><span class="line">npm install hexo-renderer-stylus <span class="comment">--save</span></span><br><span class="line">npm install hexo-generator-feed <span class="comment">--save</span></span><br><span class="line">npm install hexo-generator-sitemap <span class="comment">--save</span></span><br><span class="line">npm install hexo-wordcount <span class="comment">--save</span></span><br><span class="line">npm install hexo-symbols-count-<span class="type">time</span> <span class="comment">--save</span></span><br><span class="line">npm install hexo-asset-image <span class="comment">--save</span></span><br><span class="line">npm install hexo-leancloud-counter-<span class="keyword">security</span> <span class="comment">--save</span></span><br><span class="line">npm install babel-runtime <span class="comment">--save</span></span><br><span class="line">npm install hexo-renderer-marked <span class="comment">--save</span></span><br><span class="line">npm install hexo-renderer-kramed <span class="comment">--save</span></span><br><span class="line">npm install hexo-renderer-pandoc <span class="comment">--save</span></span><br><span class="line">npm install hexo-renderer-markdown-it-plus <span class="comment">--save</span></span><br><span class="line">npm install hexo-generator-searchdb <span class="comment">--save</span></span><br></pre></td></tr></tbody></table></figure> Hexo provides an uniformed customization interface file named **_config.yml** in the root directory of our blog. We can customize our blog by modifying **_config.yml<strong>. For more information, please visit the official <a href="https://hexo.io/docs/configuration">configuration</a> docs. ### Add Pages When we initialize a hexo project, only the home page and archive page are added by default. It is recommended to add pages, such as tags, categories, and about, which could make the hierarchy of our blog more clear. #### Add tags Page We can add tags to every post we write, and the added tags would help us or readers to quickly the posts that having same tags. The tags page will show the results. We can add tags page by creating a new page named tags with page layout. <figure class="highlight haxe"><table><tbody><tr><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> <span class="type">page</span> tags</span><br></pre></td></tr></tbody></table></figure> We can specify its type and close comments by revising the <a href="https://hexo.io/docs/front-matter">front-matter</a> in tags.md <figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">data:</span> <span class="number">2019-12-02 16:49:04</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"tags"</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure> #### Add categories Page Similar with tags, categories allows us to maintain our posts using categories and we can add categories page using the same method. <figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">hexo</span> <span class="string">new</span> <span class="string">page</span> <span class="string">categories</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">data:</span> <span class="number">2019-12-02 16:50:07</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"categories"</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure> #### Add about Page Usually, a well-designed blog has a page to introduce author and the page is called about page. <figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">hexo</span> <span class="string">new</span> <span class="string">page</span> <span class="string">about</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">about</span></span><br><span class="line"><span class="attr">data:</span> <span class="number">2019-12-02 16:55:02</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure> ### Add Post After finishing the above steps, we can start to write posts. #### Create a Draft Drafts are the same as posts. More specifically, drafts are just unpublished posts that we are still working on. Those are just files that contain the article of our future post in the Markdown format. <figure class="highlight actionscript"><table><tbody><tr><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> <span class="string">"Post Title"</span></span><br></pre></td></tr></tbody></table></figure> If the draft is finished, we can publish this draft as a post, then readers will see the post on the website. <figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">hexo</span> publish <span class="string">"Post Title"</span></span><br></pre></td></tr></tbody></table></figure> #### Create a Post Besides creating and publishing a draft, we can also create a post directly. <figure class="highlight haxe"><table><tbody><tr><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> <span class="type">post</span> <span class="string">"Post Title"</span></span><br></pre></td></tr></tbody></table></figure> ### Use NexT theme There are many free themes that help us to customize our blog pages easily and quickly, even without worry about the front-end coding. NexT is a popular theme for hexo, which has beautiful layout. We can download the source code from github and put it in </strong>themes** directory. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/theme-next/</span>hexo-theme-<span class="keyword">next</span> themes/<span class="keyword">next</span></span><br></pre></td></tr></tbody></table></figure> Then we use NextT theme in our blog by modifying hexo's **_config.yml<strong>. Assign the theme keyword as next. <figure class="highlight vbnet"><table><tbody><tr><td class="code"><pre><span class="line"><span class="symbol">theme:</span> <span class="keyword">next</span></span><br></pre></td></tr></tbody></table></figure> Similar with Hexo, we can further customize the layout in NexT's </strong>_config.yml<strong>. The <a href="https://theme-next.org/docs/">official docs</a> has detailed information about how to customize the NexT theme. ## Deployment We must deploy our blog on the Internet, thus others can visit our blog via Internet. GitHub offers a webpage service that we can used to deploy our blog. Thanks to GitHub, we can publish our posts for free. Hexo has a command that we can easily push our blogs to github account. ### GitHub Webpage Service The way to use github webpage service is to create a special repository named </strong>accountname.github.io<strong>. For example, if your github account name is JackMa, the repository name must be JackMa.github.io. ### Deployment Configure for Hexo The configuration interface is in </strong>_config.yml** with <strong>deploy</strong> keyword. <figure class="highlight dts"><table><tbody><tr><td class="code"><pre><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git</span><br><span class="line"><span class="symbol">  repository:</span> git@github.com:JackMa/JackMa.github.io.git</span><br><span class="line"><span class="symbol">  branch:</span> master</span><br></pre></td></tr></tbody></table></figure> Then we can push our static blog to the created repository. And the github webpage service will automatically show the pushed contents. <figure class="highlight verilog"><table><tbody><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo <span class="keyword">generate</span></span><br><span class="line">hexo deploy</span><br></pre></td></tr></tbody></table></figure> Congratulations, you have successfully build and deploy your blog. Now every body can visit your blog via <a href="http://JackMa.github.io">JackMa.github.io</a>. #### Errors ##### TypeError [ERR_INVALID_ARG_TYPE]: The "mode" argument must be of type number. Received an instance of Object You may meet the following error when deploy your blog to git using 'hexo deploy'. <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">FATAL Something's wrong. Maybe you can find the solution here: https:<span class="comment">//hexo.io/docs/troubleshooting.html</span></span><br><span class="line">TypeError <span class="literal">[ERR<span class="identifier">_INVALID_ARG_TYPE</span>]</span>: The <span class="string">"mode"</span> argument must be <span class="keyword">of</span> <span class="keyword">type</span> number. Received an instance <span class="keyword">of</span> Object</span><br><span class="line">    at copyFile (node:fs:<span class="number">2858</span>:<span class="number">10</span>)</span><br><span class="line">    at tryCatcher (/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    at ret (eval at makeNodePromisifiedEval (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/promisify.js:<span class="number">184</span>:<span class="number">12</span>), &lt;anonymous&gt;:<span class="number">13</span>:<span class="number">39</span>)</span><br><span class="line">    at /Users/zhaoyongsheng/Gits/blog-github/node_modules/hexo-fs/lib/fs.js:<span class="number">144</span>:<span class="number">39</span></span><br><span class="line">    at tryCatcher (/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromiseFromHandler</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">547</span>:<span class="number">31</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromise</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">604</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromise0</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">649</span>:<span class="number">10</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromises</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">729</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_fulfill</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">673</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_resolveCallback</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">466</span>:<span class="number">57</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromiseFromHandler</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">559</span>:<span class="number">17</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromise</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">604</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromise0</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">649</span>:<span class="number">10</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromises</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">729</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_fulfill</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">673</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_resolveCallback</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">466</span>:<span class="number">57</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromiseFromHandler</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">559</span>:<span class="number">17</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromise</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">604</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromise0</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">649</span>:<span class="number">10</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_settlePromises</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">729</span>:<span class="number">18</span>)</span><br><span class="line">    at <span class="module-access"><span class="module"><span class="identifier">Promise</span>.</span><span class="module"><span class="identifier">_fulfill</span> </span></span>(/Users/zhaoyongsheng/Gits/blog-github/node_modules/bluebird/js/release/promise.js:<span class="number">673</span>:<span class="number">18</span>)</span><br></pre></td></tr></tbody></table></figure> * Solution The reason of this error is that the version of the installed hexo is not compatible with Node 14. We have to upgrade the hexo's version at least to 4.2.1. First, check the current version of Hexo using <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">hexo -v</span></span><br></pre></td></tr></tbody></table></figure> Second, if the current version of Hexo is lower than 4.2.1 then upgrade Hexo using <figure class="highlight coffeescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> upgrade hexo</span><br></pre></td></tr></tbody></table></figure> ##### Error: Cannot find module 'cheerio' After upgrade Hexo, we may meet the following error when using 'hexo generate'. <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">Error: Cannot <span class="keyword">find</span> module <span class="string">'cheerio'</span></span><br><span class="line">Require stack:</span><br><span class="line">- <span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/themes/</span><span class="keyword">next</span><span class="regexp">/scripts/</span>filters/post.js</span><br><span class="line">    at Module._resolveFilename (node:internal<span class="regexp">/modules/</span>cjs/loader:<span class="number">1060</span>:<span class="number">15</span>)</span><br><span class="line">    at Module._load (node:internal<span class="regexp">/modules/</span>cjs/loader:<span class="number">905</span>:<span class="number">27</span>)</span><br><span class="line">    at Module.require (node:internal<span class="regexp">/modules/</span>cjs/loader:<span class="number">1127</span>:<span class="number">19</span>)</span><br><span class="line">    at require (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>hexo<span class="regexp">/lib/</span>hexo/index.js:<span class="number">280</span>:<span class="number">23</span>)</span><br><span class="line">    at Hexo.&lt;anonymous&gt; (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/themes/</span><span class="keyword">next</span><span class="regexp">/scripts/</span>filters/post.js:<span class="number">13</span>:<span class="number">19</span>)</span><br><span class="line">    at Hexo.tryCatcher (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    at Hexo.&lt;anonymous&gt; (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/method.js:<span class="number">15</span>:<span class="number">34</span>)</span><br><span class="line">    at <span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>hexo<span class="regexp">/lib/</span>extend/filter.js:<span class="number">62</span>:<span class="number">52</span></span><br><span class="line">    at tryCatcher (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    at Object.gotValue (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/reduce.js:<span class="number">166</span>:<span class="number">18</span>)</span><br><span class="line">    at Object.gotAccum (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/reduce.js:<span class="number">155</span>:<span class="number">25</span>)</span><br><span class="line">    at Object.tryCatcher (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/util.js:<span class="number">16</span>:<span class="number">23</span>)</span><br><span class="line">    at Promise._settlePromiseFromHandler (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/promise.js:<span class="number">547</span>:<span class="number">31</span>)</span><br><span class="line">    at Promise._settlePromise (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/promise.js:<span class="number">604</span>:<span class="number">18</span>)</span><br><span class="line">    at Promise._settlePromise0 (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/promise.js:<span class="number">649</span>:<span class="number">10</span>)</span><br><span class="line">    at Promise._settlePromises (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/promise.js:<span class="number">729</span>:<span class="number">18</span>)</span><br><span class="line">    at _drainQueueStep (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/async.js:<span class="number">93</span>:<span class="number">12</span>)</span><br><span class="line">    at _drainQueue (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/async.js:<span class="number">86</span>:<span class="number">9</span>)</span><br><span class="line">    at Async._drainQueues (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/async.js:<span class="number">102</span>:<span class="number">5</span>)</span><br><span class="line">    at Async.drainQueues [as _onImmediate] (<span class="regexp">/Users/</span>zhaoyongsheng<span class="regexp">/Gits/</span>blog-github<span class="regexp">/node_modules/</span>bluebird<span class="regexp">/js/</span>release/async.js:<span class="number">15</span>:<span class="number">14</span>)</span><br><span class="line">    at process.processImmediate (node:internal/timers:<span class="number">475</span>:<span class="number">21</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> * Solution This is because cheerio is removed from mode_module, we have to install it manually. <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span> cheerio</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>Concepts, Properties, and Usage of Homogeneous Coordinates</title>
    <url>/2019/12/02/Concepts-Usage-and-Advantages-of-Homogeneous-Coordinates/</url>
    <content><![CDATA[<html><head></head><body><p>In mathematics history, homogeneous coordinates or projective coordinates were first introduced by August Ferdinand MÃ¶bius in 1827. They are a common system of coordinates used in projective geometry, as Cartesian coordinates are used in Euclidean geometry. Nowadays, with the development of computer vision and computer graphics, projective geometry is widely used, and homogeneous coordinates is widely used in many algorithms. In this article, I will present you a brief introduction of homogeneous coordinates about its definitions, properties, usages, and advantages. <span id="more"></span> ## Motivation In projective geometry, a 3D Euclidean coordinates space can be projected into a 2D projective coordinates space. This is what happens when we take a photo using a RGB camera. The projection is a kind of space compression or transformation that compresses a geometry structure in 3D space alongside the projective direction into a 2D space. For example, all the points in a line in 3D Euclidean geometry can be projected to a single point in projective geometry if the projective direction is alongside the line. In the scenario, using 2D Euclidean coordinates to express the point in projective geometry is not appropriate. Because we can not tell whether it is a 2D point or 3D line, it will confusing us. Homogeneous coordinates were proposed to effectively address this issue.</p>
<p>For a finite 2D point <span class="math display">\[P = {\left[ {\begin{array}{*{20}{c}}x&amp;y\end{array}} \right]^T}\]</span> in projective geometry, there must exist an infinite set of 3D points in Euclidean geometry that can project at the point <span class="math display">\[P\]</span>. To be exact, all the 3D points in the line parallel to the projective direction and passing through the projected 2D point satisfy the above condition. Therefore, if we use a 2D coordinate <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}x&amp;y\end{array}} \right]^T}\]</span> to represent a infinite set of 3D points, the information of the third dimension is compressed alongside the projection direction. From the point view of mathematics, 2D coordinates is not a suitable tool to describe the projection of 3D points in projection geometry. However, if we add an extra dimension to <span class="math display">\[P\]</span>, then no information is lost during projection. Maybe, this is the main motivation of homogeneous coordinates. ## Definition For a finite 2D point <span class="math display">\[P = {\left[ {\begin{array}{*{20}{c}}X&amp;Y\end{array}} \right]^T}\]</span>, its homogeneous coordinates is defined as <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}{x}&amp;{y}&amp;{w}\end{array}} \right]^T}\]</span> that satisfies Eq. <span class="math inline">\(\eqref{eq1}\)</span> for any <span class="math display">\[w \ne 0\]</span>. Since <span class="math display">\[w\]</span> could be any none zero value in real space <span class="math display">\[R\]</span>, homogeneous coordinates keeps all the 3D information in Cartesian coordinates and can be used to describe the 3D-2D projection. <span class="math display">\[\begin{equation}
\left\{ {\begin{array}{*{20}{c}}
{X = \frac{x}{w}}\\
{Y = \frac{y}{w}}
\end{array}} \right.
\end{equation}\label{eq1}\]</span> According to the definition of homogeneous coordinates, we can get the homogeneous coordinates of a point <span class="math display">\[P={\left[ {\begin{array}{*{20}{c}}X&amp;Y\end{array}} \right]^T}\]</span> in projective geometry, as shown in Eq. <span class="math inline">\(\eqref{eq2}\)</span>. <span class="math display">\[\begin{equation}
{\left[ {\begin{array}{*{20}{c}}X&amp;Y\end{array}} \right]^T} \mapsto {w}\left[ {\begin{array}{*{20}{c}}
{X}&amp;{Y}&amp;1
\end{array}} \right]^T
\end{equation}\label{eq2}\]</span> Similarly, we can derive the definition of homogeneous coordinates of a 3D point in projective geometry as Eq. <span class="math inline">\(\eqref{eq3}\)</span>. <span class="math display">\[\begin{equation}
{\left[ {\begin{array}{*{20}{c}}X&amp;Y&amp;Z\end{array}} \right]^T} \mapsto {w}\left[ {\begin{array}{*{20}{c}}
{X}&amp;{Y}&amp;{Z}&amp;1
\end{array}} \right]^T
\end{equation}\label{eq3}\]</span> ## Properties and Usage ### Scale takes no effect in homogeneous coordinates According to Eq. <span class="math inline">\(\eqref{eq2}\)</span>, for a homogeneous coordinates <span class="math display">\[{w}\left[ {\begin{array}{*{20}{c}}{X}&amp;{Y}&amp;1\end{array}} \right]\]</span> when the <span class="math display">\[w\]</span> changes its value, the corresponding Cartesian coordinates keeps constant <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}X&amp;Y\end{array}} \right]^T}\]</span>. That is to say, scale takes no effects in homogeneous coordinates. For simplicity, we can set <span class="math display">\[w = 1\]</span> and ignore it in the mathematical expression. Equation <span class="math inline">\(\eqref{eq2}\)</span> can be formulated as Eq. <span class="math inline">\(\eqref{eq4}\)</span>. <span class="math display">\[\begin{equation}
{\left[ {\begin{array}{*{20}{c}}X&amp;Y\end{array}} \right]^T} \mapsto \left[ {\begin{array}{*{20}{c}}
{X}&amp;{Y}&amp;1
\end{array}} \right]^T
\end{equation}\label{eq4}\]</span> Equation <span class="math inline">\(\eqref{eq3}\)</span> can be formulated as Eq. <span class="math inline">\(\eqref{eq5}\)</span>. <span class="math display">\[\begin{equation}
{\left[ {\begin{array}{*{20}{c}}X&amp;Y&amp;Z\end{array}} \right]^T} \mapsto \left[ {\begin{array}{*{20}{c}}
{X}&amp;{Y}&amp;{Z}&amp;1
\end{array}} \right]^T
\end{equation}\label{eq5}\]</span></p>
<h3 id="express-infinite-point-without-using-infty">Express infinite point without using <span class="math display">\[\infty\]</span></h3>
<p>In Cartesian coordinates, we use <span class="math display">\[\infty\]</span> to express a real value at infinity and use <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}\infty&amp;\infty\end{array}} \right]^T}\]</span> to express a real 2D point at infinity. According to Eq. <span class="math inline">\(\eqref{eq1}\)</span>, when <span class="math display">\[w = 0\]</span>, <span class="math display">\[X\]</span> becomes <span class="math display">\[\infty\]</span> and <span class="math display">\[Y\]</span> also becomes <span class="math display">\[\infty\]</span>. That is to say, we can use <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}{x}&amp;{y}&amp;{0}\end{array}} \right]^T}\]</span> to express a point at infinity in homogeneous coordinates. Noting that the original definition of homogeneous coordinates is <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}{x}&amp;{y}&amp;{w}\end{array}} \right]^T}\]</span>.</p>
<p>Once a point reaches infinity, we immediately loss the direction information in Cartesian coordinates. It means that we don't know from what direction the point reaches infinity. However, the homogeneous coordinates keeps the direction information at infinity because we still know the values of <span class="math display">\[x\]</span> and <span class="math display">\[y\]</span>. In my opinion, this is the most magical property of homogeneous coordinates compared to Cartesian coordinates.</p>
<h3 id="a-homogeneous-coordinates-represents-a-line">A homogeneous coordinates represents a line</h3>
<p>Besides the magical property at infinity, another property is that a point and a line have a uniform mathematical expression in projective space, which is also different with Cartesian coordinates. An intuitive explanation is that there exists a scalable variable in the definition of homogeneous coordinates, which makes <strong>a homogeneous coordinates have the ability to express a infinite set of points</strong>. The infinite set of points are all in one line. We can easily verify the above property by mathematical derivation. Equation <span class="math inline">\(\eqref{eq6}\)</span> defines a line in 2D space. <span class="math display">\[\begin{equation}
ax+by+c=0
\end{equation}\label{eq6}\]</span></p>
<p>Define the coefficients of line <span class="math inline">\(\eqref{eq6}\)</span> as <span class="math display">\[l = {\left[ {\begin{array}{*{20}{c}}a&amp;b&amp;c\end{array}} \right]^T}\]</span>, then we can factorizing Eq. <span class="math inline">\(\eqref{eq6}\)</span> as: <span class="math display">\[\begin{equation}
{l^T}p = {p^T}l = 0
\end{equation}\label{eq7}\]</span> where <span class="math display">\[p = {\left[ {\begin{array}{*{20}{c}}x&amp;y&amp;1\end{array}} \right]^T}\]</span> denotes all the points passing through the line defined by <span class="math display">\[l\]</span>. Obviously, <span class="math display">\[p\]</span> is similar to the right part of Eq. <span class="math inline">\(\eqref{eq4}\)</span>, which is is a homogeneous coordinates. In other words, <strong>a homogeneous coordinates represents a infinite set of points in a line</strong>. Moreover, Eq. <span class="math inline">\(\eqref{eq7}\)</span> shows that the line <span class="math display">\[l\]</span> and the point <span class="math display">\[p\]</span> are in accord with commutative law, which means that <strong>a line and a homogeneous coordinates have uniform mathematical representation</strong>.</p>
<h3 id="line-can-be-computed-by-the-cross-product-of-homogeneous-coordinates-of-two-different-points-in-it">Line can be computed by the cross product of homogeneous coordinates of two different points in it</h3>
<p>According to the preceding conclusion and Eq. <span class="math inline">\(\eqref{eq2}\)</span>, we substitute two points <span class="math display">\[p_1 = {\left[ {\begin{array}{*{20}{c}}X_1&amp;Y_1&amp;s_1\end{array}} \right]^T}\]</span> and <span class="math display">\[p_2 = {\left[ {\begin{array}{*{20}{c}}X_2&amp;Y_2&amp;s_2\end{array}} \right]^T}\]</span> into Eq. <span class="math inline">\(\eqref{eq7}\)</span> and get Eq. <span class="math inline">\(\eqref{eq8}\)</span>. <span class="math display">\[\begin{equation}
\begin{array}{*{20}{c}}
{l^T{p_1} = {p_1}^Tl = 0}\\
{l^T{p_2} = {p_2}^Tl = 0}
\end{array}
\end{equation}\label{eq8}\]</span></p>
<p>We can easily obtain the solution of Eq. <span class="math inline">\(\eqref{eq8}\)</span> by computing the cross product of <span class="math display">\[p_1\]</span> and <span class="math display">\[p_2\]</span>. Note that both <span class="math display">\[p_1\]</span> and <span class="math display">\[p_2\]</span> are homogeneous coordinates of different 2D points. <span class="math display">\[\begin{equation}
l=p_1 \times p_2\
\end{equation}\label{eq9}\]</span></p>
<h3 id="homogeneous-coordinates-of-the-intersection-point-of-two-non-parallel-lines-also-can-be-computed-by-two-lines-cross-product">Homogeneous coordinates of the intersection point of two non-parallel lines also can be computed by two line's cross product</h3>
<p>Swap <span class="math display">\[l\]</span> and <span class="math display">\[p\]</span>, we can get Eq. <span class="math inline">\(\eqref{eq10}\)</span> from Eq. <span class="math inline">\(\eqref{eq9}\)</span>. <span class="math display">\[\begin{equation}
p=l_1 \times l_2\
\end{equation}\label{eq10}\]</span></p>
<p>Note that <span class="math display">\[p\]</span> is the homogeneous coordinates of the intersection point not the Cartesian coordinates.</p>
<h3 id="there-exists-intersection-point-between-parallel-lines">There exists intersection point between parallel lines</h3>
<p>As far as we know, there is no intersection point for two parallel lines in Cartesian coordinates. However, there exists a intersection point for two parallel lines in projective coordinates. Suppose the two parallel lines are <span class="math display">\[l_1 = {\left[ {\begin{array}{*{20}{c}}a&amp;b&amp;c_1\end{array}} \right]^T}\]</span> and <span class="math display">\[l_2 = {\left[ {\begin{array}{*{20}{c}}a&amp;b&amp;c_2\end{array}} \right]^T}\]</span>, <span class="math display">\[c_1 \neq c_2\]</span>, and there exist two points passing through the two parallel lines correspondingly. We define the two points as <span class="math display">\[p_1 = {\left[ {\begin{array}{*{20}{c}}X_1&amp;Y_1&amp;w_1\end{array}} \right]^T}\]</span> and <span class="math display">\[p_2 = {\left[ {\begin{array}{*{20}{c}}X_2&amp;Y_2&amp;w_2\end{array}} \right]^T}\]</span> according to the original definition of homogeneous coordinates. Then we can get: <span class="math display">\[\begin{equation}
\begin{array}{*{20}{c}}
{a{X_1} + b{Y_1} + {c_1}{w_1} = 0}\\
{a{X_2} + b{Y_2} + {c_2}{w_2} = 0}
\end{array}
\end{equation}\label{eq11}\]</span></p>
<p>If there exist an intersection point between <span class="math display">\[l_1\]</span> and <span class="math display">\[l_2\]</span>, it means that <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}X_1&amp;Y_1&amp;w_1\end{array}} \right]^T} = {\left[ {\begin{array}{*{20}{c}}X_2&amp;Y_2&amp;w_2\end{array}} \right]^T}\]</span>. Substitute <span class="math display">\[w_1=0\]</span> and <span class="math display">\[w_2=0\]</span> into Eq. <span class="math inline">\(\eqref{eq11}\)</span>, and suppose <span class="math display">\[X_1 = X_2 =X\]</span> and <span class="math display">\[Y_1 = Y_2 = Y\]</span>, we can get: <span class="math display">\[\begin{equation}
\begin{array}{*{20}{c}}
{a{X} + b{Y} = 0}\\
{a{X} + b{Y} = 0}
\end{array}
\end{equation}\label{eq12}\]</span></p>
<p>The solution of Eq. <span class="math inline">\(\eqref{eq12}\)</span> is <span class="math display">\[X = b\]</span> and <span class="math display">\[Y = -a\]</span>, which indicates that <span class="math display">\[{\left[ {\begin{array}{*{20}{c}}b&amp;{ - a}&amp;0\end{array}} \right]^T}\]</span> is the solution of Eq. <span class="math inline">\(\eqref{eq11}\)</span>. That is to say, two parallel lines have an intersection point in projective coordinates and the intersection point is at infinity. Fig. 1 gives us an intuitive explanation regarding the intersection point of two parallel lines in projective coordinates. <img alt="Fig. 1 Railway to infinity" data-src="/2019/12/02/Concepts-Usage-and-Advantages-of-Homogeneous-Coordinates/train.png"></p>
</body></html>]]></content>
      <categories>
        <category>Mathematics</category>
        <category>Projective Geometry</category>
        <category>Computer Vision</category>
      </categories>
      <tags>
        <tag>Maths</tag>
        <tag>Homogeneous</tag>
      </tags>
  </entry>
  <entry>
    <title>An Intuitive Understanding of Entropy, Cross Entropy and Kullback Leibler Divergence</title>
    <url>/2019/12/04/An-Intuitive-Understanding-of-Kullback-Leibler-Divergence-and-Cross-Entropy/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://en.wikipedia.org/wiki/Information_theory">Information Theory</a> is initially proposed in a landmark paper <a href="https://en.wikipedia.org/wiki/A_Mathematical_Theory_of_Communication">A Mathematical Theory of Communication</a> published by <a href="https://en.wikipedia.org/wiki/Claude_Shannon">Claude Shannon</a>. One of the most important concepts in information theory is <a href="https://en.wikipedia.org/wiki/Entropy">Entropy</a>. It is used to describe the degree of disorder or uncertainty, which is analogous to the definition used in statistical thermodynamics. From the point view of probability, entropy evaluates how much information a probability distribution can carry. Based on the definition of entropy, people further proposed <a href="https://en.wikipedia.org/wiki/Cross_entropy">Cross Entropy</a> and <a href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence">Kullback Leibler (KL) Divergence</a> to address the issues of information analysis between two different probability distributions. They are good metric that could measure the similarity or distance between two probability distributions, therefore they are widely used in machine learning and deep learning. In this article, I want to provide you an intuitive understanding of entropy, cross entropy and kullback-leibler divergence.</p>
<span id="more"></span>
<h2 id="entropy">Entropy</h2>
<p>In the context of Information Theory, how to understand the definition of entropy, the degree of disorder or uncertainty? I try to present an intuitive explanation from the following several aspects. ### Probability, Certainty and Uncertainty In mathematics, a probability is defined to describe the chance an event will happen. The larger a probability is, the more chance an event will happen. And the more chance an event will happen, the more certainty an event is, correspondingly, the less uncertainty an event is. Define the probability of an event is <span class="math display">\[p\]</span>, then the certainty is <span class="math display">\[p\]</span> and the uncertainty is <span class="math display">\[\frac{1}{p}\]</span>. Note that <span class="math display">\[p=0\]</span> means that the uncertainty is infinity. A probability distribution describe the chances of a series of events will happen, which is more general in real world.</p>
<h3 id="information">Information</h3>
<p>What's the definition of information? There must be different definitions of information from different point of view. However, in my opinion, information is what we do not know or do not expect. For example, if we don't know how to use an device, then its instruction manual will give us the right information. What's the relationship between information and certainty from the point of view of probability? The more certainty an event is, the more information the event contains and the less extra information we need to clear the event's uncertainty. For example, assuming we live in a world that the probability of rainy day is 1, then we have all the information regarding to rainy probability and the weather forecast is useless in this scenario because we do not need extra information to clear the uncertainty of the rainy event. It is the same when we live in a world that the probability of rainy day is 0. As far as we can see, certainty is positively related to information. The larger the certainty of an event is, the more information that the event has and the less extra information we need to make it clear.</p>
<h3 id="uncertainty-and-entropy">Uncertainty and Entropy</h3>
<p>I believe you already understand the basic concepts of probability, certainty, uncertainty, information and their correlations with each other. Let's take another example to further explain their relationships with respect to uncertainty and entropy. If Jack tells us he lives in China. We can say that the probability he lives in South China is 0.5, North China is 0.5. The message Jack tells us has more uncertainty, and we need extra information to know whether he lives in South China or not. If Jack tells us he lives in Shanghai, the message Jack tells us has less uncertainty because we already know he lives in South China without extra information.</p>
<p>The extra information is what we called uncertainty. Information theory is proposed by Claude Shannon to address the issues how to efficiently communicate the extra information with others. In modern digital world, information theory address the issues of how many bits we need to clear the uncertainty when we communicate with others. As far as we know, one bit has two states 0 or 1. Therefore, we can use one bit to reduce the uncertainty by dividing 2. That is to say we can use the bits to measure the uncertainty. The more bits we need, the larger the uncertainty is.</p>
<p>For example, if the weather has two equal-probability events, rainy and sunny, each one has 0.5 probability to happen, then we can use 1 bit to clear the rainy event's uncertainty or sunny event's uncertainty. The value of the one bit is 1 means that the weather is rainy and 0 means that the weather is not rainy. The same is for sunny event. We can formulate the above conclusion as Eq. <span class="math inline">\(\eqref{eq1}\)</span>. <span class="math display">\[
\begin{equation}
\frac{1}{0.5}=2^1
\label{eq1}
\end{equation}
\]</span> The expected uncertainty (bit count) of the weather with two equal-probability events is <span class="math display">\[0.5*1 + 0.5*1 = 1\]</span>.</p>
<p>Similarly, if the weather has eight equal-probability events, each one has 0.125 probability to happen, then we can use 3 bit to clear the each event's uncertainty. We can formulate it as Eq. <span class="math inline">\(\eqref{eq2}\)</span>. <span class="math display">\[
\begin{equation}
\frac{1}{0.125}=2^3
\label{eq2}
\end{equation}
\]</span> The expected uncertainty (bits count) of the weather with eight equal-probability events is <span class="math display">\[\sum_{i=1}^{8}{0.125*3} = 3\]</span>.</p>
<p>In conclusion, if the probability of one event is <span class="math display">\[p\]</span>, then we can use Eg. <span class="math inline">\(\eqref{eq3}\)</span> compute the bits we need to clear the event's uncertainty. <span class="math display">\[
\begin{equation}
\frac{1}{p}=2^n
\label{eq3}
\end{equation}
\]</span> where <span class="math display">\[n=\log_{2}{\frac{1}{p}}\]</span> denotes the bit count.</p>
<p>If the weather has two nonequal-probability events, rainy event has 0.25 probability to happen and sunny event has 0.75 probability to happen, how many bits we need to clear the weather's uncertainty? We first compute the needed bits to clear the rainy event's uncertainty, as shown in Eg. <span class="math inline">\(\eqref{eq4}\)</span> <span class="math display">\[
\begin{equation}
n_{rainy}=\log_{2}{\frac{1}{0.25}}
\label{eq4}
\end{equation}
\]</span> Then we compute the needed bits to clear the sunny event's uncertainty, as shown in Eg. <span class="math inline">\(\eqref{eq5}\)</span> <span class="math display">\[
\begin{equation}
n_{sunny}=\log_{2}{\frac{1}{0.75}}
\label{eq5}
\end{equation}
\]</span> The expected uncertainty (bits count) of the weather is <span class="math display">\[0.25*n_{rainy} + 0.75*n_{sunny} \approx 0.81\]</span>.</p>
<p>In the context of Information Theory, Entropy is defined to evaluate the amount of extra information we need to clear the uncertainty of a series of events given its probability distribution. According to Eq. <span class="math inline">\(\eqref{eq3}\)</span>, <span class="math inline">\(\eqref{eq4}\)</span>, <span class="math inline">\(\eqref{eq5}\)</span>, we derive the mathematical formulation of entropy as Eg. <span class="math inline">\(\eqref{6}\)</span> <span class="math display">\[
\begin{equation}
H(P)=-\sum_{i}{p_{i}log_{2}{p_{i}}}
\label{eq6}
\end{equation}
\]</span> where <span class="math display">\[H(P)\]</span> denotes the entropy given <span class="math display">\[P\]</span> probability distribution.</p>
<p>Generally, we use <span class="math display">\[log\]</span> to replace <span class="math display">\[log_{2}\]</span>, we derive the general formulation of entropy as Eq. <span class="math inline">\(\eqref{eq7}\)</span>. <span class="math display">\[
\begin{equation}
H(P)=-\sum_{i}{p_{i}\log{p_{i}}}
\label{eq7}
\end{equation}
\]</span></p>
<h2 id="cross-entropy">Cross Entropy</h2>
<p>According to the preceding sections, we understand that entropy <span class="math display">\[H(P)\]</span> evaluates the degree of uncertainty of a probability distribution <span class="math display">\[P\]</span>. That is to say, it evaluates the distance in bits between the uncertain state formulated by a probability distribution and the corresponding certain state. Analogically, cross entropy evaluates the distance in bits between the uncertain state formulated by a probability distribution <span class="math display">\[Q\]</span> and the corresponding certain state, given a target probability distribution <span class="math display">\[P\]</span>. Eq. <span class="math inline">\(\eqref{eq8}\)</span> defines the cross entropy. <span class="math display">\[
\begin{equation}
H({P,\,Q}) =  - \sum_{i}{p_{i} \log{q_{i}}}
\label{eq8}
\end{equation}
\]</span> where <span class="math display">\[\log{q_{i}}\]</span> denotes the uncertainty (bits count) of each events formulated by the probability distribution <span class="math display">\[Q\]</span> and <span class="math display">\[p_{i}\]</span> denotes the target real probability distribution. Note that the cross entropy is an absolute entropy of probability distribution <span class="math display">\[Q\]</span> given probability distribution <span class="math display">\[P\]</span> because we use the absolute uncertainty <span class="math display">\[\log{q_{i}}\]</span> for each event. To some extent, it is similar to the conditional probability distribution. It measures the total bits we need to clear the uncertainty of probability distribution <span class="math display">\[Q\]</span>, given <span class="math display">\[P\]</span>.</p>
<h2 id="kullback-leibler-divergence">Kullback-Leibler Divergence</h2>
<p>Both entropy and cross entropy evaluate the total bits needed to clear the total uncertainty of a probability distribution. How much bits we need in order to make a probability distribution <span class="math display">\[Q\]</span> identical to the target one <span class="math display">\[P\]</span>. KullbackâLeibler Divergence is proposed to address this issue. It is a measurement of how one probability distribution <span class="math display">\[Q\]</span> is similar with a target probability distribution <span class="math display">\[P\]</span>. <span class="math display">\[
\begin{equation}
{D_{kl}}({p \| q }) = -\sum_{i = 0} {p_{i}[ {\log {q_{i}} - \log{p_{i}}}]}
\label{eq9}
\end{equation}
\]</span> Eq. <span class="math inline">\(\eqref{eq9}\)</span> defines the Kullback-Leibler Divergence.</p>
<p>The more common way to see Kullback-Leibler divergence written is as follows: <span class="math display">\[
\begin{equation}
{D_{kl}}({p \| q }) = -\sum_{i = 0} {p_{i}[ {\log\frac{q_{i}}{p_{i}}}]}
\label{eq10}
\end{equation}
\]</span></p>
<p>Kullback-Leibler divergence is a relative entropy of a probability distribution <span class="math display">\[Q\]</span> with respect to <span class="math display">\[P\]</span>. If <span class="math display">\[{D_{kl}}({p \| q })\]</span> is equal to <span class="math display">\[0\]</span>, then we can say that the probability distribution <span class="math display">\[Q\]</span> is identical to <span class="math display">\[P\]</span>.</p>
<p>Compare Eq. <span class="math inline">\(\eqref{eq9}\)</span>, <span class="math inline">\(\eqref{eq7}\)</span>, and <span class="math inline">\(\eqref{eq8}\)</span>, we can derive: <span class="math display">\[
\begin{equation}
{D_{kl}}( {P \| Q}) = H({P,\,Q}) - H(P)
\label{eq11}
\end{equation}
\]</span> From Eq. <span class="math inline">\(\eqref{eq11}\)</span>, we draw a conclusion that the cross entropy of <span class="math display">\[Q\]</span> and <span class="math display">\[P\]</span> is same with the entropy <span class="math display">\[P\]</span> when <span class="math display">\[{D_{kl}}({p \| q })\]</span> is equal to <span class="math display">\[0\]</span>.</p>
<p>In the context of machine learning and deep learning, cross entropy loss is a famous loss in solving classification problems, which we want the predicted probability distribution same as the real one. Eq. <span class="math inline">\(\eqref{eq11}\)</span> gives us a clear explanation why we can obtain the optimal solution by minimizing the cross entropy.</p>
<h3 id="properties">Properties</h3>
<ul>
<li>The KullbackâLeibler divergence is always non-negative. <span class="math display">\[
\begin{equation}
{D_{kl}}\left( {P\left\| Q \right.} \right) \ge 0
\end{equation}
\]</span></li>
<li>The KullbackâLeibler divergence does not conform to commutative law. <span class="math display">\[
\begin{equation}
{D_{kl}}\left( {P\left\| Q \right.} \right) \ne {D_{kl}}\left( {Q\left\| P \right.} \right)
\end{equation}
\]</span></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://eranraviv.com/intuitive-explanation-of-entropy/">https://eranraviv.com/intuitive-explanation-of-entropy/</a></li>
<li><a href="https://math.stackexchange.com/questions/331103/intuitive-explanation-of-entropy">https://math.stackexchange.com/questions/331103/intuitive-explanation-of-entropy</a></li>
<li><a href="http://hanj.cs.illinois.edu/cs412/bk3/KL-divergence.pdf">http://hanj.cs.illinois.edu/cs412/bk3/KL-divergence.pdf</a></li>
<li><span class="citation" data-cites="cotra.marko/making-sense-of-the-kullback-leibler-kl-divergence-b0d57ee10e0a">[https://medium.com/@cotra.marko/making-sense-of-the-kullback-leibler-kl-divergence-b0d57ee10e0a]</span>(https://medium.com/<span class="citation" data-cites="cotra.marko/making-sense-of-the-kullback-leibler-kl-divergence-b0d57ee10e0a">@cotra.marko/making-sense-of-the-kullback-leibler-kl-divergence-b0d57ee10e0a</span>)</li>
</ul>
</body></html>]]></content>
      <categories>
        <category>Mathematics</category>
        <category>Probability</category>
        <category>Deep Learning</category>
        <category>Information Theory</category>
      </categories>
      <tags>
        <tag>Maths</tag>
        <tag>Probability</tag>
        <tag>Deep Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Usage Experiences and Skills of Ubuntu</title>
    <url>/2019/12/04/Usage-Experiences-and-Skills-of-Ubuntu/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://ubuntu.com/">Ubuntu</a> is a popular version of <a href="https://www.linux.org/">Linux</a> with a desktop. It is easy to use and widely used in software and algorithm development. There are tens of thousands of open source softwares that support Ubuntu. As a researcher and algorithm engineer, I am using Ubuntu 16.04 and 18.04 to do research and development work. This post contains many useful experiences and skills in using Ubuntu that I want to share with you and make a documentation for myself at the same time. <span id="more"></span></p>
<h2 id="command-line">Command Line</h2>
<h3 id="command-line-history">Command Line History</h3>
<p><strong>history</strong> command is used to list the commands we used in the terminal. </p><figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">history</span> #Show <span class="keyword">all</span> the <span class="keyword">history</span> commands</span><br><span class="line"><span class="keyword">history</span> | <span class="keyword">grep</span> <span class="string">"apt-get"</span> #Show <span class="keyword">all</span> the <span class="keyword">history</span> commands that contains apt-<span class="built_in">get</span></span><br><span class="line"><span class="keyword">history</span> | tee &gt; <span class="keyword">history</span>.hist #Show <span class="keyword">all</span> the <span class="keyword">history</span> commands <span class="built_in">and</span> output <span class="keyword">to</span> <span class="keyword">a</span> <span class="keyword">file</span></span><br></pre></td></tr></tbody></table></figure> Note that the symbol <strong>&gt;</strong> means output the stream to a file. It will create a new file or erase the existing contents if the file is already exits and write the stream to the beginning of the file. While the symbol <strong>&gt;&gt;</strong> will keep the existing contents and write the stream to the end of the file.<p></p>
<h3 id="word-count">Word Count</h3>
<p>Ubuntu provides a command to count the word or line of a text content. The command is <strong>wc</strong>. For example, we can use this command to count the items of a directory. </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></tbody></table></figure> ### Show &amp; Kill Process #### Show We can check all the running process using <strong>ps</strong> command <figure class="highlight dos"><table><tbody><tr><td class="code"><pre><span class="line">ps -<span class="built_in">aux</span></span><br></pre></td></tr></tbody></table></figure> #### Kill <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">kill</span> -<span class="number">9</span><span class="meta"> [pid]</span></span><br></pre></td></tr></tbody></table></figure> #### Set Default Editor <figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line">sudo <span class="keyword">update</span><span class="operator">-</span>alternatives <span class="comment">--config editor</span></span><br></pre></td></tr></tbody></table></figure> Run the above command, and you will see a list of editors as follows. <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">There are <span class="number">4</span> choices <span class="keyword">for</span> the alternative editor (providing /usr/bin/editor). And <span class="built_in">input</span> the <span class="keyword">number</span> <span class="keyword">to</span> <span class="keyword">set</span> the default editor.</span><br><span class="line"></span><br><span class="line">  Selection    Path                Priority   Status</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">* <span class="number">0</span>            /bin/nano            <span class="number">40</span>        auto <span class="keyword">mode</span></span><br><span class="line">  <span class="number">1</span>            /bin/ed             -<span class="number">100</span>       manual <span class="keyword">mode</span></span><br><span class="line">  <span class="number">2</span>            /bin/nano            <span class="number">40</span>        manual <span class="keyword">mode</span></span><br><span class="line">  <span class="number">3</span>            /usr/bin/<span class="keyword">vim</span>.basic   <span class="number">30</span>        manual <span class="keyword">mode</span></span><br><span class="line">  <span class="number">4</span>            /usr/bin/<span class="keyword">vim</span>.tiny    <span class="number">15</span>        manual <span class="keyword">mode</span></span><br><span class="line"></span><br><span class="line">Press <span class="symbol">&lt;enter&gt;</span> <span class="keyword">to</span> keep the current choice[*], <span class="built_in">or</span> <span class="built_in">type</span> selection <span class="keyword">number</span>:</span><br></pre></td></tr></tbody></table></figure> ### Kernel Information <strong>uname</strong> can be used to print the kernel information. <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r <span class="comment">#print kernel release</span></span><br><span class="line"><span class="built_in">uname</span> -v <span class="comment">#print kernel version</span></span><br></pre></td></tr></tbody></table></figure> ### ssh If we meet ssh command not found error, then we can fix it by installing openssh-server <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install openssh-<span class="keyword">server</span></span><br></pre></td></tr></tbody></table></figure> The default port for ssh is <strong>22</strong>. Please make sure this port is authorized by firewall. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> ufw <span class="literal">allow</span> <span class="number">22</span></span><br></pre></td></tr></tbody></table></figure> #### Solution for disconnect frequently When we connect a machine via ssh and don't input any commands for a while, the ssh connection will be disconnected because the pipe is broken. We have to reconnect it via ssh command, which is quite annoying and wasting time. There are method to make ssh connection keep longer time.<p></p>
<p>First, open the ssh config file using vim. </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>ssh/sshd_config</span><br></pre></td></tr></tbody></table></figure> And find the two lines: <figure class="highlight 1c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#ClientAliveInterval 0</span></span><br><span class="line"><span class="meta">#ClientAliveCountMax 3</span></span><br></pre></td></tr></tbody></table></figure> Second, uncomment the two lines and set them as follows: <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">ClientAliveInterval</span> <span class="number">30</span> </span><br><span class="line"><span class="attribute">ClientAliveCountMax</span> <span class="number">86400</span></span><br></pre></td></tr></tbody></table></figure> <strong>ClientAliveInterval 30</strong> -- The client will send heartbeat data to the server every 30 seconds. <strong>ClientAliveCountMax 86400</strong> -- The server will broken the connection automatically after 86400 seconds that not received heartbeat signals from client. Third, restart the sshd service. <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">service sshd restart</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="scan-lan-ips">Scan LAN IPs</h3>
<p><em>nmap</em> is a tool scanning all the ips in a local network. </p><figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install <span class="keyword">nmap</span></span><br><span class="line"><span class="keyword">nmap</span> -sP <span class="number">192.168</span>.<span class="number">1.0</span>/<span class="number">24</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="module-operation">Module Operation</h3>
<p><a href="https://wiki.archlinux.org/index.php/Kernel_module">Kernel modules</a> are pieces of code that can be loaded and unloaded into the kernel upon demand. They extend the functionality of the kernel without the need to reboot the system.</p>
<p>To create a kernel module, you can read <a href="http://tldp.org/LDP/lkmpg/2.6/html/index.html">The Linux Kernel Module Programming Guide</a>. A module can be configured as built-in or loadable. To dynamically load or remove a module, it has to be configured as a loadable module in the kernel configuration. * Load A Module </p><figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo modprobe usbmon</span></span><br></pre></td></tr></tbody></table></figure> * Unload A Module <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo rmmod usbmon</span></span><br><span class="line"><span class="attribute">sudo modprobe -r usbmon</span></span><br></pre></td></tr></tbody></table></figure> * List Modules <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo lsmod</span></span><br></pre></td></tr></tbody></table></figure> * Print A Module's Information <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo modinfo usbmon</span></span><br></pre></td></tr></tbody></table></figure> ## Python ### pip #### Change Source Using the original source to install packages is usually slow and sometime it is unable to visit for users in China. We can change the source to speed the installation. * Create a configuration file <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.pip/</span><br><span class="line"><span class="built_in">cd</span> .pip</span><br><span class="line"><span class="built_in">touch</span> pip.conf</span><br></pre></td></tr></tbody></table></figure> * Change source Adding the target source url to the created configuration file. <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">sudo <span class="keyword">vi</span> pip.<span class="keyword">conf</span></span><br><span class="line">[<span class="keyword">global</span>]</span><br><span class="line"><span class="built_in">index</span>-url = https://pypi.tuna.tsinghua.edu.<span class="keyword">cn</span>/simple</span><br></pre></td></tr></tbody></table></figure> #### Install Package Using A Specified Source <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">pip install -i https:<span class="regexp">//</span>pypi.tuna.tsinghua.edu.cn/simple matplotlib</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="others">Others</h2>
<h3 id="list-contents-of-directories-in-a-tree-like-format.">List Contents of Directories in A Tree-Like Format.</h3>
<p><strong>Tree</strong> is a recursive directory listing program that produces a depth indented listing of files, which is colorized ala dircolors if the LS_COLORS environment variable is set and output is to tty. </p><figure class="highlight dos"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install <span class="built_in">tree</span></span><br><span class="line"><span class="built_in">tree</span></span><br><span class="line"><span class="built_in">tree</span> -d</span><br><span class="line"><span class="built_in">tree</span> -L <span class="number">1</span></span><br><span class="line"><span class="built_in">tree</span> -u</span><br></pre></td></tr></tbody></table></figure> ### DEP 2 RPM or RPM 2 DEP <strong>alien</strong> is a program that converts between Red Hat rpm, Debian deb, Stampede slp, Slackware tgz, and Solaris pkg file formats. If you want to use a package from another linux distribution than the one you have installed on your system, you can use alien to convert it to your preferred package format and install it. It also supports LSB packages. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> apt-get install alien</span><br><span class="line"><span class="attribute">sudo</span> alien toec-oep102d-<span class="number">1</span>.<span class="number">4</span>-<span class="number">4</span>.nd7.x86_64.rpm</span><br><span class="line"><span class="attribute">sudo</span> alien -r toec-oep102d_1.<span class="number">4</span>-<span class="number">5</span>_amd64.deb</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Ubuntu</category>
        <category>Commands</category>
        <category>Ubuntu</category>
        <category>SSH</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>tree</tag>
        <tag>alien</tag>
        <tag>history</tag>
        <tag>wc</tag>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>Repair Grub and Restore Ubuntu</title>
    <url>/2019/12/07/Repair-Grub-and-Restore-Ubuntu/</url>
    <content><![CDATA[<html><head></head><body><p>For convenient, we sometimes install multiple operation systems on one computer, such as Windows 10, Ubuntu 16.04, and Ubuntu 18.04. These operation systems can be installed into different hard disks at different time. The existing Ubuntu's grub file will be overwritten during the installation of new operation system. When the installation failed or the new installed operation system broken, the grub file may be broken, which results in that the existing Ubuntu can not boot. Fortunately, there are methods to repair the broken grub file and restore the existing Ubuntu system. In this article, I will briefly introduce one useful method, which helps me to save my Ubuntu 16.04.</p>
<span id="more"></span>
<h2 id="problem">Problem</h2>
<p>When the grub file is broken, the following message will be prompted in terminal during booting. </p><figure class="highlight subunit"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">error </span>: unknow filesystem</span><br><span class="line">grub &gt;</span><br></pre></td></tr></tbody></table></figure> <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">If you see a similar message when you boot a ubuntu system, <span class="keyword">it</span> indicates <span class="keyword">that</span> <span class="keyword">the</span> operation system's grub <span class="built_in">file</span> was broken. You can use <span class="keyword">the</span> following method <span class="keyword">to</span> repair <span class="keyword">the</span> grub <span class="built_in">file</span>. I have tested <span class="keyword">that</span> this method <span class="keyword">is</span> valid.</span><br><span class="line"></span><br><span class="line"><span class="comment">## Solution </span></span><br><span class="line"></span><br><span class="line">* Check partition</span><br></pre></td></tr></tbody></table></figure> grub &gt; ls <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">We</span> will see <span class="literal">all</span> the partitions <span class="literal">on</span> disk.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> (hd0) (hd0,gpt0) (hd0,gpt1) (hd0,gpt2) ... <figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">* Find <span class="keyword">the</span> root <span class="built_in">directory</span> <span class="keyword">of</span> Ubuntu </span><br><span class="line">List contents <span class="keyword">of</span> every partition <span class="keyword">until</span> we find <span class="keyword">the</span> root <span class="built_in">directory</span> <span class="keyword">of</span> <span class="keyword">the</span> Ubuntu <span class="keyword">system</span> we want <span class="built_in">to</span> restore.</span><br></pre></td></tr></tbody></table></figure> grub &gt; ls (hd0,gpt1)/ grub &gt; ls (hd0,gpt2)/ grub &gt; ls (hd0,gpt3)/ <figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line">If we see <span class="keyword">the</span> following message, we find where <span class="keyword">the</span> root <span class="built_in">directory</span> is.</span><br></pre></td></tr></tbody></table></figure> grub &gt; ./ ../ tmp/ bin/ lib/ proc/ boot/ lib32/ root/ lib64/ run/ lost+found/ sbin/ usr/ media/ srv/ var/ dev/ mnt/ vmlinuz/ etc/ vmlinuz.old sys/ opt/ <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">* <span class="keyword">Set</span> booting <span class="keyword">partition</span></span><br></pre></td></tr></tbody></table></figure> grub &gt; set root=(hd0,gpt3) grub &gt; set prefix=(hd0,gpt3)/boot/grub grub &gt; insmod normal grub &gt; normal <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">The Ubuntu <span class="keyword">system</span> would booting successfully <span class="keyword">and</span> we can <span class="keyword">login</span> now.</span><br><span class="line"></span><br><span class="line">* <span class="keyword">Update</span> grub file</span><br></pre></td></tr></tbody></table></figure> sudo update-grub sudo grub-install /dev/sda reboot ``` If you could not repair the grub file and restore the Ubuntu operation system, please do not hesitate to leave a comment. Thank you very much.<p></p>
</body></html>]]></content>
      <categories>
        <category>Ubuntu</category>
        <category>Boot</category>
        <category>Grub</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Grub</tag>
        <tag>Boot</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 18.04 Installation and Development Environment Setups</title>
    <url>/2019/12/07/Ubuntu-19-04-Installation-and-Development-Environment-Setups/</url>
    <content><![CDATA[<html><head></head><body><p>In this article, I will show the detailed installation and configuration of Ubuntu 18.04 step by step using command lines. The development environment contains OpenCV, PCL, CUDA, Tensorflow, and so on, which is suitable for computer vision and deep learning scientific researchers and engineers. <span id="more"></span> ## Installation</p>
<h3 id="make-installation-image">Make Installation Image</h3>
<ul>
<li>Download ISO file First, download the original Ubuntu 18.04 ISO file from Internet. If you come from China, I recommend you to visit the famous <a href="https://mirrors.163.com/">open source mirror</a> maintained by NetEase, which is fast and stable. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">https</span>://mirrors.<span class="number">163</span>.com/ubuntu-releases/<span class="number">18</span>.<span class="number">04</span>.<span class="number">3</span>/ubuntu-<span class="number">18</span>.<span class="number">04</span>.<span class="number">3</span>-desktop-amd64.iso</span><br></pre></td></tr></tbody></table></figure></li>
<li>Make USB installation image UltraISO is a good tool to make an installation image using a USB Storage. We can do this job on Windows.</li>
</ul>
<h3 id="install">Install</h3>
<ul>
<li><p>Choose boot from USB in BIOS</p></li>
<li><p>Install</p></li>
<li><p>Disk Partition Generally, <strong>default partition configuration</strong> is recommended, but we can still do partition by ourselves. I prefer to use the following partition configuration according to my experience, which could manage and use the storage space efficiently. Primary partitions hold the operating system files and can be made âActiveâ partition to boot the computer from. For a Linux operation system, a maximum of 4 primary partitions can be created, or 3 primary and an extended partitions. Logical partitions are created under the extended partition. Logical partitions can be resized or repartitioned by mounting/unmounting it within Linux. </p><figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1.</span> efi   <span class="number">200</span>Mb, <span class="keyword">primary</span> <span class="keyword">partition</span></span><br><span class="line"><span class="number">2.</span> boot  <span class="number">500</span>Mb, <span class="keyword">primary</span> <span class="keyword">partition</span>, store the <span class="keyword">system</span> kernels <span class="keyword">and</span> boot files</span><br><span class="line"><span class="number">3.</span> SWAP  <span class="number">16</span>Gb,  swap area, virtual memory, the size <span class="keyword">is</span> usually same <span class="keyword">with</span> memory</span><br><span class="line"><span class="number">4.</span> /     <span class="number">64</span>Gb,  <span class="keyword">primary</span> <span class="keyword">partition</span></span><br><span class="line"><span class="number">5.</span> /home rest,  logical <span class="keyword">partition</span> </span><br></pre></td></tr></tbody></table></figure> ## Setups ### Change apt source<p></p></li>
<li><p>Using shortcuts <strong>super+a</strong> to open <strong>Show Applications</strong></p></li>
<li><p>Open <strong>Software &amp; Updates</strong></p></li>
<li><p>Set <strong>Download from</strong> as <strong>http://mirrors.cn99.com/ubuntu</strong> ### Update &amp; Upgrade </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> update</span><br><span class="line">sudo apt-<span class="built_in">get</span> upgrade</span><br></pre></td></tr></tbody></table></figure> It would takes several minutes for first update &amp; upgrade. The time depends on your network bandwidth. ### Setup Chinese Input Method<p></p></li>
<li><p>Using shortcuts <strong>super+a</strong> to open <strong>Language Support</strong> If you open <strong>Language Support</strong> for first time, it will prompt "The language support is not installed completely". We choose the <strong>install</strong> option.</p></li>
<li><p>Click <strong>Install/Remove Languages</strong> and make sure <em>Chinese (simplified)</em> is selected.</p></li>
<li><p>Install ibus </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ibus ibus-clutter ibus-gtk ibus-gtk3</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Install pinyin and setup </p><figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ibus-pinyin</span><br><span class="line">sudo reboot (optional, we can <span class="built_in">do</span> <span class="keyword">it</span> latter)</span><br><span class="line">ibus-setup</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Choose intelligent pinyin </p><figure class="highlight pf"><table><tbody><tr><td class="code"><pre><span class="line">System Settings &gt; Region &amp; Language &gt; Input Sources</span><br><span class="line">Pinyin Preferences &gt; Initial <span class="keyword">state</span> &gt; English</span><br></pre></td></tr></tbody></table></figure> ### Install Mendeley <a href="https://www.mendeley.com/?interaction_required=true">Mendeley</a> is a cross-platform paper management tool. It offers free cloud service that could synchronize papers between different devices in one account. <a href="https://www.mendeley.com/guides/download-mendeley-desktop/ubuntu/instructions">Download Mendeley</a> <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> chmod +x mendeleydesktop_1.<span class="number">19</span>.<span class="number">4</span>-stable_amd64.deb</span><br><span class="line"><span class="attribute">sudo</span> dpkg -i mendeleydesktop_1.<span class="number">19</span>.<span class="number">4</span>-stable_amd64.deb</span><br></pre></td></tr></tbody></table></figure> ### Install ZSH<p></p></li>
<li><p>Install git, curl and zsh </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install git</span><br><span class="line">sudo apt-<span class="built_in">get</span> install curl</span><br><span class="line">sudo apt-<span class="built_in">get</span> install zsh</span><br><span class="line">zsh --version</span><br><span class="line">sudo reboot</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Config your global email and name for git </p><figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">git config <span class="attr">--global</span> user<span class="selector-class">.email</span> <span class="string">"zhaoyongsheng@zju.edu.cn"</span></span><br><span class="line">git config <span class="attr">--global</span> user<span class="selector-class">.name</span> <span class="string">"Alex"</span></span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Install oh-my-zsh </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sh -c <span class="string">"<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>"</span></span><br></pre></td></tr></tbody></table></figure><p></p></li>
</ul>
<h3 id="install-tmux">Install tmux</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install tmux</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-ssh">Install ssh</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ssh</span><br><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-zeal">Install zeal</h3>
<figure class="highlight smali"><table><tbody><tr><td class="code"><pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:zeal-developers/ppa (deprecated)</span><br><span class="line">sudo apt-get update (deprecated)</span><br><span class="line">sudo apt-get install zeal</span><br></pre></td></tr></tbody></table></figure>
<p>Visit <a href="http://zealusercontributions.herokuapp.com">Offline Docsets</a> and add more docsets such as tensorflow, zsh, and so on. ### Install Java Runtime Environment When we using <strong>LibreOffice</strong> from terminal, we will see the following warnings. </p><figure class="highlight mipsasm"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">javaldx: </span>Could not find a <span class="keyword">Java </span>Runtime Environment!</span><br><span class="line">Please ensure that a <span class="keyword">JVM </span><span class="keyword">and </span>the package libreoffice-<span class="keyword">java-common</span></span><br><span class="line"><span class="keyword"></span>is <span class="keyword">installed.</span></span><br></pre></td></tr></tbody></table></figure> We can fix it by installing java runtime environment. <figure class="highlight actionscript"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install <span class="keyword">default</span>-jre libreoffice-java-common</span><br></pre></td></tr></tbody></table></figure> ### Install gcc and cmake <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install gcc</span><br><span class="line">sudo apt-<span class="built_in">get</span> install cmake</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="install-vscode-and-sync">Install vscode and sync</h3>
<ul>
<li>Install vscode <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">curl https:<span class="regexp">//</span>packages.microsoft.com<span class="regexp">/keys/mi</span>crosoft.asc | gpg --dearmor &gt; packages.microsoft.gpg</span><br><span class="line">sudo install -o root -g root -m <span class="number">644</span> packages.microsoft.gpg <span class="regexp">/usr/</span>share<span class="regexp">/keyrings/</span></span><br><span class="line">sudo sh -c <span class="string">'echo "deb [arch=amd64 signed-by=/usr/share/keyrings/packages.microsoft.gpg] https://packages.microsoft.com/repos/vscode stable main" &gt; /etc/apt/sources.list.d/vscode.list'</span></span><br><span class="line">sudo apt-get install apt-transport-https</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install code</span><br></pre></td></tr></tbody></table></figure></li>
<li>Synchronize setups First, add ssh-key to Github and make sure ssh connection from your pc to your github account is valid. <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">From</span> the <span class="string">'Command Palette'</span> (Ctrl+Shift+P), <span class="keyword">type</span> Extensions: Install Extensions, <span class="keyword">and</span> install <span class="string">'Settings Sync'</span></span><br><span class="line"><span class="keyword">Login</span> <span class="keyword">With</span> Github</span><br><span class="line"><span class="keyword">From</span> the <span class="string">'Command Palette'</span> (Ctrl+Shift+P), <span class="keyword">input</span> Command: sync: Download Settings</span><br></pre></td></tr></tbody></table></figure></li>
<li>Set font size <figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">"editor.fontSize"</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"window.zoomLevel"</span><span class="punctuation">:</span> <span class="number">2.0</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="setup-terminals">Setup terminals</h3>
<figure class="highlight maxima"><table><tbody><tr><td class="code"><pre><span class="line">Preferences &gt; unamed &gt; Colors &gt; Choose Green on black theme &gt; Change Background <span class="built_in">color</span> to #<span class="number">1B7491</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="hide-top-bar-caffeine">Hide top bar &amp; Caffeine</h3>
<figure class="highlight mipsasm"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get <span class="keyword">install </span>chrome-gnome-<span class="keyword">shell</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">Preferences </span>(Open Menu) -&gt; <span class="keyword">Add-ons </span>(Ctrl+<span class="keyword">Shift+A), </span><span class="keyword">and </span><span class="keyword">install </span><span class="string">'GNOME Shell integration'</span> <span class="keyword">extension </span>in Firefox</span><br><span class="line">Open <span class="string">'GNOME Shell integration'</span> website <span class="keyword">extension </span>in Firefox</span><br><span class="line">Search hide top <span class="keyword">bar </span><span class="keyword">and </span>choose ON</span><br><span class="line">Search caffeine <span class="keyword">and </span>choose ON</span><br></pre></td></tr></tbody></table></figure>
<h3 id="setup-screenshot-shortcut">Setup Screenshot Shortcut</h3>
<p><strong>gnome-screenshot</strong> is a build-in screenshot tool for Ubuntu 18.04. </p><figure class="highlight xl"><table><tbody><tr><td class="code"><pre><span class="line">S<span class="function"><span class="title">ettings</span> -&gt;</span> D<span class="function"><span class="title">evices</span> -&gt;</span> K<span class="function"><span class="title">eyboard</span> -&gt;</span> Add custom shortcut</span><br></pre></td></tr></tbody></table></figure> <img data-src="/2019/12/07/Ubuntu-19-04-Installation-and-Development-Environment-Setups/gnome-screenshot.png"><p></p>
<h3 id="install-tensorflow-gpu-2.0">Install tensorflow-gpu 2.0</h3>
<ul>
<li><p>Install GPU driver </p><figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">Open</span> <span class="string">'Softwares &amp; Updates'</span> -&gt; Additional Drivers</span><br><span class="line">Choose suitable driver <span class="keyword">version</span> <span class="keyword">and</span> install</span><br></pre></td></tr></tbody></table></figure> <img data-src="/2019/12/07/Ubuntu-19-04-Installation-and-Development-Environment-Setups/nvidia-driver.png"><p></p></li>
<li><p>Check Driver Version and CUDA version </p><figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">nvidia-smi</span></span><br></pre></td></tr></tbody></table></figure> <img data-src="/2019/12/07/Ubuntu-19-04-Installation-and-Development-Environment-Setups/nvidia-smi.png"><p></p></li>
<li><p>Install CUDA</p></li>
</ul>
<p>Go to Nvidia Developer <a href="https://developer.nvidia.com/cuda-toolkit-archive">CUDA Toolkit Archive</a> download <strong>cuda_11.0.3_450.51.06_linux.run</strong> and go to <a href="https://developer.nvidia.com/rdp/cudnn-archive">cuDNN Archive</a> <strong>cudnn-11.0-linux-x64-v8.0.5.39.tgz</strong> </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo ./cuda_11.0.3_450.51.06_linux.run <span class="comment">## install without driver option</span></span><br><span class="line">tar -xzf cudnn-*</span><br><span class="line"><span class="built_in">cd</span> cuda/lib64</span><br><span class="line">sudo <span class="built_in">cp</span> ** /usr/local/cuda-11.0/lib64</span><br><span class="line"><span class="built_in">cd</span> ../include</span><br><span class="line">sudo <span class="built_in">cp</span> cudnn.h /usr/local/cuda-10.0/include</span><br><span class="line">sudo apt-get install nvidia-driver-418 (deprecated)</span><br><span class="line">sudo modprobe nvidia (deprecated)</span><br><span class="line"><span class="built_in">export</span> PATH=/usr/local/cuda-11.0/bin<span class="variable">${PATH:+:<span class="variable">${PATH}</span>}</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-11.0/lib64<span class="variable">${LD_LIBRARY_PATH:+:<span class="variable">${LD_LIBRARY_PATH}</span>}</span></span><br><span class="line">nvidia-smi</span><br><span class="line">nvcc -V</span><br></pre></td></tr></tbody></table></figure><p></p>
<ul>
<li><p>Install pip Using Python 3.6.9 as default python </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo rm <span class="regexp">/usr/</span>bin/python</span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>bin<span class="regexp">/python3 /u</span>sr<span class="regexp">/bin/</span>python</span><br><span class="line">sudo apt-get install python3-pip</span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>bin<span class="regexp">/pip3 /u</span>sr<span class="regexp">/bin/</span>pip</span><br><span class="line">pip install --upgrade pip</span><br><span class="line">pip list</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>Set pip source</p>
<ul>
<li>æ¸åæº https://pypi.tuna.tsinghua.edu.cn/simple</li>
<li>é¿éæº https://mirrors.aliyun.com/pypi/simple/</li>
<li>è¾è®¯æº http://mirrors.cloud.tencent.com/pypi/simple</li>
<li>è±ç£æº http://pypi.douban.com/simple/</li>
</ul></li>
</ul>
<figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.pip</span><br><span class="line"><span class="keyword">cd</span> ~/.pip</span><br><span class="line">touch pip.<span class="keyword">conf</span></span><br><span class="line">sudo gedit pip.<span class="keyword">conf</span></span><br><span class="line">[<span class="keyword">global</span>]</span><br><span class="line"><span class="built_in">index</span>-url = https://pypi.tuna.tsinghua.edu.<span class="keyword">cn</span>/simple</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>Install tensorflow-gpu Tensorflow 2.0 package requires pip version &gt; 19.0. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">pip install tensorflow-gpu==<span class="number">2.2</span></span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/cuda-11.0/</span>lib64<span class="regexp">/libcudnn.so /u</span>sr<span class="regexp">/local/</span>cuda-<span class="number">11.0</span><span class="regexp">/lib64/</span>libcudnn.so.<span class="number">7</span></span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/cuda-11.0/</span>lib64<span class="regexp">/libcudart.so /u</span>sr<span class="regexp">/local/</span>cuda-<span class="number">11.0</span><span class="regexp">/lib64/</span>libcudart.so.<span class="number">10.1</span></span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/cuda-11.0/</span>lib64<span class="regexp">/libcublas.so /u</span>sr<span class="regexp">/local/</span>cuda-<span class="number">11.0</span><span class="regexp">/lib64/</span>libcublas.so.<span class="number">10</span></span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/cuda-11.0/</span>lib64<span class="regexp">/libcusparse.so /u</span>sr<span class="regexp">/local/</span>cuda-<span class="number">11.0</span><span class="regexp">/lib64/</span>libcusparse.so.<span class="number">10</span></span><br></pre></td></tr></tbody></table></figure> Test is GPU available <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">python</span></span><br><span class="line">import tensorflow <span class="keyword">as</span> <span class="keyword">tf</span></span><br><span class="line"><span class="keyword">tf</span>.test.is_gpu_available()</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="install-teamviewer">Install Teamviewer</h3>
<p>Go to Teamviewer official website and download <strong>teamviewer_xx_amd64.deb</strong>. </p><figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">sudo dpkg -<span class="selector-tag">i</span> teamviewer_xx_amd64<span class="selector-class">.deb</span></span><br><span class="line">sudo apt-get <span class="attr">--fix-broken</span> install</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="install-x2goclient">Install x2goclient</h3>
<figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">add</span>-repository <span class="keyword">pp</span><span class="variable">a:x2go</span>/stable</span><br><span class="line">sudo apt-<span class="built_in">get</span> <span class="keyword">update</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install x2goclient</span><br></pre></td></tr></tbody></table></figure>
<h3 id="setup-vim">Setup vim</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">touch .vimrc</span><br><span class="line">vi .vimrc</span><br><span class="line"><span class="built_in">set</span> nocompatible</span><br><span class="line"><span class="built_in">set</span> <span class="attribute">backspace</span>=2</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-pcl">Install pcl</h3>
<p>Ubuntu 18.04 supports installation of pcl using apt-get, which is different with Ubuntu 16.04. </p><figure class="highlight q"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libpcl-<span class="built_in">dev</span></span><br></pre></td></tr></tbody></table></figure> Eigen 3.3.4, vtk 6.3, boost 1.65.1, libopenni 1.5.4.0, libopenni2 2.2.0.3 are installed at the same time.<p></p>
<h3 id="install-glog">Install glog</h3>
<p><a href="FindGlog.cmake">Download FindGlog.cmake</a> </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install libgoogle-glog-dev</span><br><span class="line">sudo cp FindGlog.cmake <span class="regexp">/usr/</span>share<span class="regexp">/cmake-3.10/</span>Modules</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="install-tinyxml-1-2">Install tinyxml 1 &amp; 2</h3>
<figure class="highlight q"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libtinyxml2-<span class="built_in">dev</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install libtinyxml-<span class="built_in">dev</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-ceres">Install ceres</h3>
<figure class="highlight q"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libceres-<span class="built_in">dev</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-opencv">Install opencv</h3>
<figure class="highlight q"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libopencv-<span class="built_in">dev</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-gtest">Install gtest</h3>
<figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libgtest-dev</span><br><span class="line"><span class="keyword">cd</span> /usr/src/gtest</span><br><span class="line">sudo <span class="built_in">mkdir</span> build</span><br><span class="line"><span class="keyword">cd</span> build</span><br><span class="line">sudo cmake ..</span><br><span class="line">sudo <span class="keyword">make</span> install</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-zbar">Install Zbar</h3>
<p><a href="FindZbar.cmake">Download FindZbar.cmake</a> </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install libzbar-dev</span><br><span class="line">sudo cp FindZbar.cmake <span class="regexp">/usr/</span>share<span class="regexp">/cmake-3.10/</span>Modules</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="fix-system-program-problem-detected.">Fix "System program problem detected."</h3>
<figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo rm <span class="regexp">/var/</span>crash/*</span><br><span class="line">sudo vi <span class="regexp">/etc/</span>default/apport</span><br><span class="line">enable=<span class="number">0</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-spinnaker">Install Spinnaker</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libusb-dev</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libgtkmm-2.4-dev</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libavcodec57</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libavformat57</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libswscale4</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libswresample2</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libavutil55</span><br><span class="line">sudo sh install_spinnaker.s</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libudev-dev</span><br><span class="line">sudo apt-<span class="built_in">get</span> install libssl-dev</span><br></pre></td></tr></tbody></table></figure>
<h4 id="fix-warning-libcrypto.so.1.1">Fix Warning: libcrypto.so.1.1</h4>
<p>Due to the version of openssl, we may meet a warning when compile as follows: </p><figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">/usr/bin/ld: <span class="built_in">warning</span>: libcrypto.so<span class="number">.1</span><span class="number">.1</span>, needed <span class="keyword">by</span> //usr/lib/x86_64-linux-gnu/libgdcmCommon.so<span class="number">.2</span><span class="number">.8</span>, may <span class="keyword">conflict</span> <span class="keyword">with</span> libcrypto.so<span class="number">.1</span><span class="number">.0</span><span class="number">.0</span></span><br></pre></td></tr></tbody></table></figure> We can fix it using the following command. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install libssl1.<span class="number">1</span></span><br><span class="line">sudo rm <span class="regexp">/usr/</span>lib<span class="regexp">/x86_64-linux-gnu/</span>libcrypto.so</span><br><span class="line">sudo ln -s <span class="regexp">/usr/</span>lib<span class="regexp">/x86_64-linux-gnu/</span>libcrypto.so.<span class="number">1.1</span> <span class="regexp">/usr/</span>lib<span class="regexp">/x86_64-linux-gnu/</span>libcrypto.so</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="manage-boot-options">Manage Boot Options</h3>
<p>If there are multiple operations, we can delete other operation systems booting options in the current Ubuntu 18.04. </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo vi <span class="regexp">/boot/g</span>rub/grub.cfg</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="install-qt">Install QT</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install qt5-default</span><br><span class="line">sudo apt-<span class="built_in">get</span> install qtcreator</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-websocketpp">Install websocketpp</h3>
<figure class="highlight q"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install libwebsocketpp-<span class="built_in">dev</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-unrar">Install unrar</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install unrar</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-wireshark">Install wireshark</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install wireshark</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-vlc">Install vlc</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install vlc</span><br></pre></td></tr></tbody></table></figure>
<h3 id="install-meld">Install meld</h3>
<p><em>meld</em> is a useful file and directory compare tool in Linux, similar with <em>beyondcompare</em> in Windows. </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install meld</span><br></pre></td></tr></tbody></table></figure> ### Install python3-tk <em>python3-tk</em> fix the bug of none-GUI backend of matplotlib <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install python3-tk</span><br></pre></td></tr></tbody></table></figure> ### Install xchm <em>xchm</em> can view chm files in Ubuntu. <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install xchm</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Ubuntu</category>
        <category>Installation</category>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Installation</tag>
        <tag>Setups</tag>
      </tags>
  </entry>
  <entry>
    <title>PCL Tutorials - From Mathematics to Code Snippets</title>
    <url>/2019/12/10/PCL-Tutorials/</url>
    <content><![CDATA[<html><head></head><body><p>The <a href="http://www.pointclouds.org/">Point Cloud Library</a> (<a href="http://www.pointclouds.org/">PCL</a>) is a large scale, open project for point cloud processing. The PCL framework contains numerous state-of-the-art algorithms including filtering, feature estimation, surface reconstruction, registration, model fitting and segmentation. PCL is cross-platform, and has been successfully compiled and deployed on Linux, MacOS, Windows, and Android/iOS. To simplify development, PCL is split into a series of smaller code libraries, that can be compiled separately. This modularity is important for distributing PCL on platforms with reduced computational or size constraints. In this article, I will provide a series of tutorials of how to use a variety of PCL modules to process point cloud data, which could help you to quickly build, verify, and deploy new 3D perception algorithms.</p>
<span id="more"></span>
<h2 id="io">IO</h2>
<h3 id="load-pcd-files">Load PCD Files</h3>
<h3 id="save-pcd-files">Save PCD Files</h3>
<h2 id="visualization">Visualization</h2>
<p>There are multiple visualization tools in PCL, of which <a href="http://docs.pointclouds.org/trunk/classpcl_1_1visualization_1_1_p_c_l_visualizer.html">PCLVisualizer</a> is a powerful one. It is developed based on VTK and it provides many useful customization interfaces, which is the main reason I prefer to use it. ### Basic Usage </p><figure class="highlight zephir"><table><tbody><tr><td class="code"><pre><span class="line">#include &lt;pcl/io/pcd_io.h&gt;</span><br><span class="line">#include &lt;pcl/point_types.h&gt;</span><br><span class="line">#include &lt;pcl/visualization/pcl_visualizer.h&gt;</span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span><br><span class="line">{</span><br><span class="line">    std::string file_path(<span class="string">"../data/demo.pcd"</span>);</span><br><span class="line"></span><br><span class="line">    pcl::PointCloud&lt;pcl::PointXYZ&gt;::Ptr cloud(<span class="keyword">new</span> pcl::PointCloud&lt;pcl::PointXYZ&gt;);</span><br><span class="line">    <span class="keyword">if</span>(pcl::io::loadPCDFile&lt;pcl::PointXYZ&gt;(file_path, *cloud) == <span class="number">-1</span>)</span><br><span class="line">    {</span><br><span class="line">        std::cout &lt;&lt; <span class="string">"Could not load the PCD file: "</span> &lt;&lt; file_path &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    boost::shared_ptr&lt;pcl::visualization::PCLVisualizer&gt; viewer(<span class="keyword">new</span> pcl::visualization::PCLVisualizer(<span class="string">"PCD Viewer"</span>));</span><br><span class="line">    viewer-&gt;setBackgroundColor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    viewer-&gt;addCoordinateSystem(<span class="number">1.0</span>);</span><br><span class="line">    viewer-&gt;initCameraParameters();</span><br><span class="line">    viewer-&gt;addPointCloud&lt;pcl::PointXYZ&gt;(cloud, file_path);</span><br><span class="line">    viewer-&gt;setPointCloudRenderingProperties(pcl::visualization::PCL_VISUALIZER_POINT_SIZE, <span class="number">2</span>, file_path);</span><br><span class="line">    viewer-&gt;setPointCloudRenderingProperties(pcl::visualization::PCL_VISUALIZER_OPACITY, <span class="number">1.0</span>, file_path);</span><br><span class="line">    viewer-&gt;spin();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> ### Customization #### Add &amp; Remove PointCloud <figure class="highlight xl"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">viewer</span>-&gt;</span>addPointCloud&lt;pcl::PointXYZ&gt;(cloud, file_path);</span><br><span class="line"><span class="function"><span class="title">viewer</span>-&gt;</span>removePointCloud(file_path)</span><br></pre></td></tr></tbody></table></figure> #### Add Coordinate <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">viewer</span>-&gt;addCoordinateSystem(<span class="number">1</span>.<span class="number">0</span>);</span><br></pre></td></tr></tbody></table></figure> Note that the color of the added coordinate system is red, green, and blue. Red axis represents x direction. Green axis represents y direction. And Blue axis represents z direction.<p></p>
<h4 id="set-point-size">Set Point Size</h4>
<figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">viewer-&gt;set<span class="constructor">PointCloudRenderingProperties(<span class="params">pcl</span>::<span class="params">visualization</span>::PCL_VISUALIZER_POINT_SIZE, 2, <span class="params">file_path</span>)</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="set-opacity">Set Opacity</h4>
<figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">viewer-&gt;set<span class="constructor">PointCloudRenderingProperties(<span class="params">pcl</span>::<span class="params">visualization</span>::PCL_VISUALIZER_OPACITY, 1.0, <span class="params">file_path</span>)</span>;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="set-point-color">Set Point Color</h4>
<figure class="highlight rust"><table><tbody><tr><td class="code"><pre><span class="line">pcl::visualization::PointCloudColorHandlerCustom&lt;pcl::PointXYZ&gt; <span class="title function_ invoke__">x_color</span>(cloud_x, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">viewer_x<span class="punctuation">-&gt;</span>addPointCloud&lt;pcl::PointXYZ&gt;(cloud_x, x_color, <span class="string">"cloud_x"</span>);</span><br></pre></td></tr></tbody></table></figure>
<h3 id="mouse-event">Mouse Event</h3>
<h3 id="keyboard-event">Keyboard Event</h3>
<h2 id="filters">Filters</h2>
<h3 id="passthrough">PassThrough</h3>
<p><a href="http://docs.pointclouds.org/1.8.0/classpcl_1_1_pass_through.html#details">PassThrough</a> is a simple but useful filter that select points in a point cloud based on the limit intervals on one dimensional axis. It iterates through the entire input point cloud, automatically filtering non-finite points and the points outside the interval specified by <strong>setFilterLimits()</strong>, which applies only to the field specified by <strong>setFilterFieldName()</strong>. </p><figure class="highlight lasso"><table><tbody><tr><td class="code"><pre><span class="line">pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;<span class="type">::Ptr</span> cloud (<span class="literal">new</span> pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;);</span><br><span class="line">pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;<span class="type">::Ptr</span> cloud_x (<span class="literal">new</span> pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;);</span><br><span class="line">pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;<span class="type">::Ptr</span> cloud_xy (<span class="literal">new</span> pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;);</span><br><span class="line">pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;<span class="type">::Ptr</span> cloud_xyz (<span class="literal">new</span> pcl<span class="type">::PointCloud</span>&lt;pcl<span class="type">::PointXYZ</span>&gt;);</span><br><span class="line"><span class="comment">// code to load pcd</span></span><br><span class="line"></span><br><span class="line">pcl<span class="type">::PassThrough</span>&lt;pcl<span class="type">::PointXYZ</span>&gt; pass;</span><br><span class="line"><span class="comment">// select points in x direction</span></span><br><span class="line">pass.setInputCloud (cloud);</span><br><span class="line">pass.setFilterFieldName(<span class="string">"x"</span>);</span><br><span class="line">pass.setFilterLimits(<span class="number">-1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">pass.filter (*cloud_x);</span><br><span class="line"></span><br><span class="line"><span class="comment">// select points in y direction</span></span><br><span class="line">pass.setInputCloud(cloud_x);</span><br><span class="line">pass.setFilterFieldName(<span class="string">"y"</span>);</span><br><span class="line">pass.setFilterLimits(<span class="number">0</span>, <span class="number">0.5</span>);</span><br><span class="line">pass.filter (*cloud_xy);</span><br><span class="line"></span><br><span class="line"><span class="comment">// select points in z direction</span></span><br><span class="line">pass.setInputCloud(cloud_xy);</span><br><span class="line">pass.setFilterFieldName(<span class="string">"z"</span>);</span><br><span class="line">pass.setFilterLimits(<span class="number">-1.5</span>, <span class="number">-0.5</span>);</span><br><span class="line">pass.filter (*cloud_xyz);</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="segmentation">Segmentation</h2>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Point Cloud Library</category>
        <category>Perception</category>
        <category>3D</category>
      </categories>
      <tags>
        <tag>Point Cloud Library</tag>
        <tag>Tutorials</tag>
        <tag>PCL</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Tutorials - Debug Experience</title>
    <url>/2019/12/24/C-Coding-Debug-Log/</url>
    <content><![CDATA[<html><head></head><body><p>This article records the representative bugs I met when in c++ coding. The bugs are categorized as C++ standard library and the third-party open source libraries, such as OpenCV, PCL, QT. For each bug, I offer the corresponding solution. Therefore, this article is a debug reference and could help me to fix the bugs when I meet them again. <span id="more"></span></p>
<h2 id="c-standard-library">C++ Standard Library</h2>
<h3 id="linking-error-1">Linking Error 1</h3>
<h4 id="bug">Bug</h4>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">undefined reference <span class="keyword">to</span> symbol <span class="string">'pthread_create@@GLIBC_2.2.5'</span></span><br><span class="line">/lib/x86_64-linux-gnu/libpthread.so.0: <span class="built_in">error</span> adding symbols: DSO missing <span class="keyword">from</span> command line</span><br></pre></td></tr></tbody></table></figure>
<h4 id="solution">Solution</h4>
<figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Threads)</span><br><span class="line"><span class="keyword">target_link_libraries</span> (<span class="variable">${PROJECT_NAME}</span> <span class="variable">${CMAKE_THREAD_LIBS_INIT}</span>)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="bug-1">Bug</h4>
<figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">invalid <span class="keyword">use</span> <span class="keyword">of</span> incomplete <span class="keyword">type</span> <span class="type">âclass </span>QDesktopWidgetâ</span><br></pre></td></tr></tbody></table></figure>
<h4 id="solution-1">Solution</h4>
<p>It means that the compiler could not understand QDesktopWidget due to not including its definition file. </p><figure class="highlight arduino"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDesktopWidget&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> #### Bug <figure class="highlight subunit"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">error: </span>default argument given for parameter</span><br></pre></td></tr></tbody></table></figure> #### Solution You can declare default arguments in the class declaration or in the function definition, but not both. <figure class="highlight kotlin"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">fun</span><span class="params">(int x <span class="comment">/*= 10*/</span>)</span></span></span><br></pre></td></tr></tbody></table></figure> #### Bug <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line">segmentation.<span class="symbol">cpp:</span><span class="number">1604</span><span class="symbol">:</span><span class="number">8</span>: <span class="symbol">error:</span> prototype <span class="keyword">for</span> âdouble <span class="title class_">BoxSegment</span><span class="symbol">:</span><span class="symbol">:computeWeightedCovarianceMatrix</span>(const <span class="title class_">Ptr</span>&amp;, const <span class="title class_">Eigen</span><span class="symbol">:</span><span class="symbol">:Matrix&lt;float</span>, <span class="number">4</span>, <span class="number">1</span>&gt;&amp;, const std::vector&lt;float&gt;&amp;, <span class="title class_">Eigen</span><span class="symbol">:</span><span class="symbol">:Matrix&lt;float</span>, <span class="number">3</span>, <span class="number">3</span>&gt;&amp;)â does <span class="keyword">not</span> match any <span class="keyword">in</span> <span class="keyword">class</span> â<span class="title class_">BoxSegment</span>â</span><br><span class="line"> double <span class="title class_">BoxSegment</span><span class="symbol">:</span><span class="symbol">:compute</span>(const pcl::<span class="title class_">PointCloud</span>&lt;pcl::<span class="title class_">Point</span>XYZ&gt;<span class="symbol">:</span><span class="symbol">:Ptr&amp;</span> src_cloud,</span><br><span class="line">        ^~~~~~~~~~</span><br><span class="line"><span class="title class_">In</span> file included from segmentation.<span class="symbol">cpp:</span><span class="number">1</span><span class="symbol">:</span><span class="number">0</span>:</span><br><span class="line">segmentation.<span class="symbol">h:</span><span class="number">120</span><span class="symbol">:</span><span class="number">11</span>: <span class="symbol">error:</span> candidate <span class="symbol">is:</span> float <span class="title class_">BoxSegment</span><span class="symbol">:</span><span class="symbol">:computeWeightedCovarianceMatrix</span>(const <span class="title class_">Ptr</span>&amp;, const <span class="title class_">Eigen</span><span class="symbol">:</span><span class="symbol">:Matrix&lt;float</span>, <span class="number">4</span>, <span class="number">1</span>&gt;&amp;, const std::vector&lt;float&gt;&amp;, <span class="title class_">Eigen</span><span class="symbol">:</span><span class="symbol">:Matrix&lt;float</span>, <span class="number">3</span>, <span class="number">3</span>&gt;&amp;)</span><br><span class="line">     float compute(const pcl::<span class="title class_">PointCloud</span>&lt;pcl::<span class="title class_">Point</span>XYZ&gt;<span class="symbol">:</span><span class="symbol">:Ptr&amp;</span> src_cloud,</span><br></pre></td></tr></tbody></table></figure> #### Solution The declaration and definition of a function in a class have to match with each other. <figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> <span class="title class_">BoxSegment</span>::<span class="title function_ invoke__">compute</span>(<span class="keyword">const</span> pcl::<span class="variable constant_">PointCloud</span>&lt;pcl::<span class="variable constant_">PointXYZ</span>&gt;::<span class="variable constant_">Ptr</span>&amp; src_cloud,</span><br></pre></td></tr></tbody></table></figure> ## OpenCV ## PCL ## QT<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>C++</category>
        <category>Programming</category>
        <category>C++</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>C++</tag>
        <tag>Debug</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Tutorials - Learning Notes for Beginners</title>
    <url>/2020/02/25/Python-Learning-Notes/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://www.python.org/">Python</a> is an interpreted, high-level, general-purpose programming language. Created by Guido van Rossum and first released in 1991, Python's design philosophy emphasizes code readability with its notable use of significant whitespace. Its language constructs and object-oriented approach aim to help programmers write clear, logical code for small and large-scale projects. There are many third-party open-source packages and modules, such as numpy, keras, tensorflow, pytorch, which makes it widely used in scientific computing, data mining, deep learning. This article is used to record the key points of python that are useful for Python learning, especially for beginners. <span id="more"></span></p>
<h3 id="basic">Basic</h3>
<h4 id="import">Import</h4>
<p>Module is compact way to manage code in separate files in Python. In one module, we can use code defined in other modules by importing them, which is named import machinery. The <em>import</em> statement is the most common way of invoking the importing machinery, but it is not the only one. The module <em>importlib</em> and the build-in function <em><strong>import</strong>()</em> can also be used to import modules.</p>
<p>When one module is imported using import statement, the importing machinery will first search the module in paths listed in <em>sys.path</em>, if found, Python interpreted will create a module object and initialize it. <em>sys.path</em> contains the directory path that contains the current running python script file and all the environment values in <em>PYTHONPATH</em>. Using the following code, we can add extra directories to <em>sys.path</em>. </p><figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"># <span class="keyword">Get</span> the directory <span class="type">path</span> <span class="keyword">of</span> the <span class="keyword">current</span> running module</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">sys.path.append(BASE_DIR)</span><br><span class="line"># <span class="keyword">Add</span> other directory paths </span><br><span class="line">sys.path.append(os.path.<span class="keyword">join</span>(BASE_DIR, <span class="string">'models'</span>))</span><br><span class="line">sys.path.append(os.path.<span class="keyword">join</span>(BASE_DIR, <span class="string">'utils'</span>))</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>Function <em><strong>import</strong>()</em> is c implementation of import, while <em>importlib</em> is a pure python implemented module that provide rich APIs interacting with import machinery. The main difference between using <em>importlib</em> and <em>import</em> statement is that <em>importlib</em> can programmatically import modules, given the modules' name as a string variable.</p>
<p>There are several importing related module attributes that will be assigned during importing before execute code, such as <em><strong>name</strong></em> and <em><strong>file</strong></em>.</p>
<h4 id="memory-address">Memory Address</h4>
<ul>
<li>id(object)</li>
</ul>
<p>This function returns the identity of an object, that is an integer keeps constant and unique during the lifetime of the object. We can treat it as the address in memory.</p>
<h4 id="assignment">Assignment</h4>
<p>Python is an object-centered language, which is different memory-centered language, such as C and C++. Therefore, assignment in python behaves differently also. Assignment a variable is binding the variable to an object as an alias name. Then we can use the bind variable to reference the object.</p>
<p>When an assignment invoked, Python interpreter first search whether the object exits in memory. If the object exists, then a new alias name is bind to the object. If the object does not exist, then Python interpreter creates a new object and bind the variable to the newly created object. Note that one object can be bind with multiple variables.</p>
<p>When an object is mutable, we can change the value of this object by any variable assigned to it. We can retrieve the updated value of this object by other variable referenced to it. When an object is immutable, any variable referenced to it can not change its value. In this case, change the value is a new assignment operation, that creates a new object and assigns the variable to it.</p>
<h4 id="arguments-passing">Arguments Passing</h4>
<p>For C family language, there are two ways to pass arguments to function, call by value and call by reference. But Python is different. We can treat argument passing as an assignment operation, which binding the argument variable to object.</p>
<h3 id="modules">Modules</h3>
<h4 id="future"><strong>future</strong></h4>
<figure class="highlight angelscript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import, division, print_function, unicode_literals</span><br></pre></td></tr></tbody></table></figure>
<p>A <a href="https://docs.python.org/3/reference/simple_stmts.html#future">future statement</a> is a directive to the compiler that a particular module should be compiled using syntax or semantics that will be available in a specified future release of Python where the feature becomes standard.</p>
<p>The future statement is intended to ease migration to future versions of Python that introduce incompatible changes to the language. It allows use of the new features on a per-module basis before the release in which the feature becomes standard.</p>
<p>The future statement will provide support for running your code on Python 2.6, 2.7, and 3.3+ mostly unchanged. It means that we can write standard Python 3 code without worry about its compatibility on Python 2 by putting future statement at the beginning of the code.</p>
<figure class="highlight coffeescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># division_demo.py</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="built_in">print</span> <span class="number">11</span>/<span class="number">4</span></span><br></pre></td></tr></tbody></table></figure>
<p>Run division_demo.py in python 2, the output will be 2.75. However, if without <em>from <strong>future</strong> import division</em>, the output will be 2. Because without <em>from <strong>future</strong> import division</em>, <em>/</em> is mapped to the <strong>div()</strong> build-in method by Python 2 interpreter, while with it, <em>/</em> is mapped to the <strong>truediv()</strong> method, which is a build-in method in Python 3.</p>
<figure class="highlight coffeescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># print_demo.py</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> <span class="built_in">print</span></span><br><span class="line"><span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure>
<p><em>print</em> becomes a build-in method in Python 3, losing its special properties as a keyword in Python 2. Similarly, <em>from <strong>future</strong> import print</em> makes <em>print</em> as a build-in method when running on Python 2. The print_demo.py will output:</p>
<figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">&lt;built-<span class="keyword">in</span> <span class="keyword">function</span> <span class="title">print&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>In order to use <em>with</em> as a Python keyword in Python 2.5 or older, we will need to use <em>from <strong>future</strong> import with_statement</em>.</p>
<h4 id="argparse">argparse</h4>
<p><em>argparse</em> is the recommended module for command line parsing in Python standard library. We can use this module to let the users to pass argument parameters to the code in command line. The basic usage of <em>argparse</em> is: </p><figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">import argparse</span><br><span class="line"><span class="attribute">parser</span> <span class="operator">=</span> argparse.ArgumentParser()</span><br><span class="line">parser.add_argument()</span><br><span class="line"><span class="attribute">args</span> <span class="operator">=</span> parser.parse_args()</span><br></pre></td></tr></tbody></table></figure> <em>argparse</em> can automatically generate help descriptions using the string we assigned to help argument. <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line"># We can add a summary description <span class="keyword">of</span> the <span class="keyword">module</span>.</span><br><span class="line">parser = argparse.<span class="constructor">ArgumentParser(<span class="params">description</span>='Describe <span class="params">the</span> <span class="params">function</span> <span class="params">and</span> <span class="params">purpose</span> <span class="params">of</span> <span class="params">this</span> <span class="params">module</span>.')</span></span><br></pre></td></tr></tbody></table></figure> * Positional Argument<p></p>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">import argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"square"</span>, <span class="attribute">help</span>=<span class="string">"display a square of a given number"</span>, <span class="attribute">type</span>=int)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"><span class="built_in">print</span>(args.square*<span class="number">*2</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>The identification of positional argument is determined by its position sequence. And the positional arguments are mandatory. If not providing positional arguments in command line, the Python interpreter will invoke exceptions.</p>
<ul>
<li>Optional Argument</li>
</ul>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">import argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"square"</span>, <span class="attribute">type</span>=int, <span class="attribute">help</span>=<span class="string">"display a square of a given number"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-v"</span>, <span class="string">"--verbose"</span>, <span class="attribute">action</span>=<span class="string">"store_true"</span>, <span class="attribute">help</span>=<span class="string">"increase output verbosity"</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line">answer = args.square*<span class="number">*2</span></span><br><span class="line"><span class="keyword">if</span> args.verbose:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"the square of {} equals {}"</span>.format(args.square, answer))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(answer)</span><br></pre></td></tr></tbody></table></figure>
<p>Difference between positional argument and optional argument is that optional argument has "-" or "--" before argument name. Action <em>store_true</em> indicates that the default value of the argument is false, once the argument is invoked in command line, its value becomes true.</p>
<p>We can also add default value for other types. </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">import argparse</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">"--kernel_size"</span>, <span class="attribute">type</span>=int, <span class="attribute">default</span>=3, <span class="attribute">help</span>=<span class="string">"convolutional kernel size"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--learning_rate"</span>, <span class="attribute">type</span>=float, <span class="attribute">default</span>=0.01, <span class="attribute">help</span>=<span class="string">"convolutional kernel size"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--log_dir"</span>, <span class="attribute">default</span>=<span class="string">"log"</span>, <span class="attribute">help</span>=<span class="string">"log directory"</span>)</span><br></pre></td></tr></tbody></table></figure> ### Advance #### if <strong>name</strong> == "<strong>main</strong>" For a program written by a complied language, such as C++, there must exist an entry, the main() function, from which the program start to execute. However, Python as an interpreted language, has no entry function main(). When executing the code, all the code at level 0 indentation (no indentation) gets executed, including the definitions of functions and classes. Note that the code in functions or classes are level 1 or larger indentation, which will not execute.<p></p>
<p>As far as we all know, we can directly execute the code using <em>Python code.py</em> or execute the code in other code files by <em>import code.py</em>. How to make the two ways execute different code? <em>if <strong>name</strong> == "<strong>main</strong>"</em> provides us a solution. When we run the code using <em>Python code.py</em>, the interpreter will set the value of the special variable <em><strong>name</strong></em> as <em>"<strong>main</strong>"</em> before execute level 0 indentation code. Then the interpreter execute the level 0 indentation code as well as the level 1 indentation code in <em>if <strong>name</strong> == "<strong>main</strong>"</em>.</p>
<p>When we import the code into other module using <em>import code.py</em>, the interpreter will set the value of the special variable as <em>"code"</em> that is the name of the module. In this case, the level 1 indentation code in <em>if <strong>name</strong> == "<strong>main</strong>"</em> will not be executed.</p>
<h4 id="module-vs.-package">Module VS. Package</h4>
<p>A module is one python file. Its name is the file's base name without the .py extension. A module can be execute directly or be imported by other modules.</p>
<p>A package is a directory of a collection of python modules with an extra <strong>init</strong>.py. Its name is the name of the directory. Packages can be nested to any depth similar with directories, as long as each directory contains a <strong>init</strong>.py.</p>
<h4 id="context-manager-and-with-statement">Context Manager and With Statement</h4>
<p>Context Manager is an easy way that Python offers to safely manage resources. Usually, with statement is the right way to invoke a context manager. There are two ways to build a context manager. * Class: <strong>enter</strong>() and <strong>exit</strong>() If we define <em><strong>enter</strong>()</em> and <em><strong>exit</strong>()</em> in a class, then the class could be a context manager. Usually, we return the object as the resource we intend to safely released in <em><strong>enter</strong>()</em>, then we can do operations in the body of with statement. And we have to manually release the object in <em><strong>exit</strong>()</em>. When the body of with statement is executed, <em><strong>exit</strong>()</em> is automatically invoked, thus the resource is released. </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Python program showing </span></span><br><span class="line"><span class="comment"># file management using  </span></span><br><span class="line"><span class="comment"># context manager </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileManager</span>(): </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename, mode</span>): </span><br><span class="line">        self.filename = filename </span><br><span class="line">        self.mode = mode </span><br><span class="line">        self.file = <span class="literal">None</span></span><br><span class="line">          </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>): </span><br><span class="line">        self.file = <span class="built_in">open</span>(self.filename, self.mode) </span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_value, exc_traceback</span>): </span><br><span class="line">        self.file.close() </span><br><span class="line">  </span><br><span class="line"><span class="comment"># loading a file  </span></span><br><span class="line"><span class="keyword">with</span> FileManager(<span class="string">'test.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f: </span><br><span class="line">    f.write(<span class="string">'Test'</span>) </span><br></pre></td></tr></tbody></table></figure><p></p>
<ul>
<li>Function: <span class="citation" data-cites="contextmanager">@contextmanager</span> and yield The <em>contextmanager</em> decorator will make a function as a context manager. <em>yield</em> works like the return in <em><strong>enter</strong>()</em> and all the code after <em>yield</em> is like in <em><strong>exit</strong>()</em>. <figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">open_file</span>(<span class="params">name</span>):</span><br><span class="line">    f = <span class="built_in">open</span>(name, <span class="string">'w'</span>)</span><br><span class="line">    <span class="keyword">yield</span> f</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open_file(<span class="string">'some_file'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">'hola!'</span>)</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="virtualenv">virtualenv</h4>
<p><a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a> is a useful tool for creating isolated virtual python environment. We can setup a special version of python environment to run some code without polluting the operation system's python environment. When we do not need the environment, we can directly delete the folder.</p>
<ul>
<li>Install <figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">virtualenv <span class="comment">--version</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>Usage <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> project_dir</span><br><span class="line">virtualenv venv</span><br><span class="line"><span class="comment"># start</span></span><br><span class="line"><span class="built_in">source</span> venv/bin/activate</span><br><span class="line"><span class="comment"># Install packages</span></span><br><span class="line">pip install numpy</span><br><span class="line">pip install tensorflow</span><br><span class="line"><span class="comment"># end</span></span><br><span class="line">deactivate</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="debug">Debug</h3>
<h4 id="matplotlib-non-gui-backend">Matplotlib non-GUI backend</h4>
<p>Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure. </p><figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt <span class="keyword">install</span> python3-tk</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Python</category>
        <category>Programming</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>Python</tag>
        <tag>Notes</tag>
      </tags>
  </entry>
  <entry>
    <title>Tensorflow Tutorials - Learning Notes for Beginners</title>
    <url>/2020/02/26/Tensorflow-Learning-Notes/</url>
    <content><![CDATA[<html><head></head><body><p>Tensorflow is a popular end to end deep learning platform developed and maintained by google. It has a whole ecosystem from prototype verification to model deployment. It integrates high level Keras API which could let us build and train models quickly and easily. Besides, it also has low level APIs, which enable us to custom model conveniently. Tensorflow is welcome to researchers and engineers since it is released and thus is widely used in both scientific research and industrial applications. Many state-of-the-art works had published open sources in Tensorflow. In this article, I will write down the key notes during learning Tensorflow.</p>
<span id="more"></span>
<h3 id="basic-usage">Basic Usage</h3>
<h4 id="tf.name_scope">tf.name_scope</h4>
<p>This context manager pushes a name scope, which will make the name of all operations added within it have a prefix. </p><figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">def my<span class="constructor">_op(<span class="params">a</span>, <span class="params">b</span>, <span class="params">c</span>, <span class="params">name</span>=None)</span>:</span><br><span class="line">  <span class="keyword">with</span> tf.name<span class="constructor">_scope(<span class="string">"MyOp"</span>)</span> <span class="keyword">as</span> scope:</span><br><span class="line">    a = tf.convert<span class="constructor">_to_tensor(<span class="params">a</span>, <span class="params">name</span>=<span class="string">"a"</span>)</span></span><br><span class="line">    b = tf.convert<span class="constructor">_to_tensor(<span class="params">b</span>, <span class="params">name</span>=<span class="string">"b"</span>)</span></span><br><span class="line">    c = tf.convert<span class="constructor">_to_tensor(<span class="params">c</span>, <span class="params">name</span>=<span class="string">"c"</span>)</span></span><br><span class="line">    # Define some computation that uses `a`, `b`, <span class="keyword">and</span> `c`.</span><br><span class="line">    return foo<span class="constructor">_op(<span class="operator">...</span>, <span class="params">name</span>=<span class="params">scope</span>)</span></span><br></pre></td></tr></tbody></table></figure> #### tf.expand_dims Returns a tensor with an additional dimension inserted at index axis. <figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">t = <span class="string">[[1, 2, 3],[4, 5, 6]]</span> # shape [<span class="number">2</span>, <span class="number">3</span>] </span><br><span class="line">tf.expand_dims(t, <span class="number">0</span>) </span><br><span class="line">tf.expand_dims(t, <span class="number">-1</span>) # Last dimension index. In this case, same as <span class="number">2.</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="tf.squeeze">tf.squeeze</h4>
<p>Removes dimensions of size 1 from the shape of a tensor. </p><figure class="highlight mipsasm"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 't' is a tensor of shape [1, 2, 1, 3, 1, 1]</span></span><br><span class="line">tf.<span class="keyword">shape(tf.squeeze(t)) </span> <span class="comment"># [2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 't' is a tensor of shape [1, 2, 1, 3, 1, 1]</span></span><br><span class="line">tf.<span class="keyword">shape(tf.squeeze(t, </span>[<span class="number">2</span>, <span class="number">4</span>]))  <span class="comment"># [1, 2, 3, 1]</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="tf.repeat">tf.repeat</h4>
<p>The operation repeats the elements in a tensor along a specified axis. </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">x</span> = tf.Variable(tf.random_normal(shape=(<span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)))</span><br><span class="line"><span class="attribute">repeats</span> =<span class="meta"> [2, 3]</span></span><br><span class="line"><span class="attribute">y</span> = tf.repeat(x, repeats=repeats, axis=<span class="number">0</span>) # y.shape=(<span class="number">5</span>(<span class="number">2</span>+<span class="number">3</span>), <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line"><span class="attribute">repeats</span> =<span class="meta"> [2, 3, 4]</span></span><br><span class="line"><span class="attribute">y</span> = tf.repeat(x, repeats=repeats, axis=<span class="number">2</span>) # y.shape=(<span class="number">2</span>, <span class="number">6</span>, <span class="number">9</span>(<span class="number">2</span>+<span class="number">3</span>+<span class="number">4</span>))</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="tf.matmul">tf.matmul</h4>
<p>In math, matrix multiplication are defined for 2-D matrix. The tf.matmul also follows this law in Tensorflow. Moreover, tf.matmul supports matrix multiplication for matrix which rank &gt; 2. In this case, tf.matmul just slice the most inner 2 dimension of the matrix to do normal matrix multiplication operation and treat other outer dimensions as batch dimensions. For example, C's shape is (a, b, n, k) in the following operation. </p><figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">A = tf.<span class="constructor">Variable(<span class="params">tf</span>.<span class="params">random_normal</span>(<span class="params">shape</span>=(<span class="params">a</span>, <span class="params">b</span>, <span class="params">n</span>, <span class="params">m</span>)</span>))</span><br><span class="line">B = tf.<span class="constructor">Variable(<span class="params">tf</span>.<span class="params">random_normal</span>(<span class="params">shape</span>=(<span class="params">a</span>, <span class="params">b</span>, <span class="params">m</span>, <span class="params">k</span>)</span>))</span><br><span class="line">C = tf.matmul(A, B) # <span class="module-access"><span class="module"><span class="identifier">C</span>.</span></span>shape=(a, b, n, k)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="tf.transpose">tf.transpose</h4>
<p>In mathematics, transpose is a general matrix operation. For example, transpose will exchange the row elements with column elements for a 2-D matrix. In tensorflow, transpose is a similar operation for a tensor. Moreover, it has an extra parameter perm to specify the dimensions to transpose with each other. That is to say, the i-th dimension will transpose with perm[i]-th dimension. </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># x.shape=(2, 6)</span></span><br><span class="line"><span class="attribute">x_t</span> = tf.transpose(x) # default perm=[<span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"><span class="comment"># y.shape=(2, 6, 3)</span></span><br><span class="line"><span class="attribute">y_t</span> = tf.transpose(y, perm=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>]) # <span class="number">0</span>-th dimension do not transpose, <span class="number">1</span>-th dimension transposes with <span class="number">2</span>-th (perm[<span class="number">1</span>]) dimension and <span class="number">2</span>-th dimension transposes with <span class="number">1</span>-th (perm[<span class="number">2</span>]) dimension</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="keras-api">Keras API</h3>
<p>Keras is a high level API in Tensorflow 2.0, which can be used to build, custom and train deep learning models easily and quickly. #### Build-In Layers</p>
<h4 id="custom-layers">Custom Layers</h4>
<p>Based on the object-oriented feature of Python, Keras in Tensorflow offers a sub-classing method to custom a Layer. </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Custom Layer</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomLayer</span>(tf.keras.layers.Layer):</span><br><span class="line">    <span class="comment"># __init__ function is called when we make one object of this layer, and parameters can be passed. Usually, operations are defined in it.</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, param, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(CustomLayer, self).__init(**kwargs)</span><br><span class="line">        self.param = param</span><br><span class="line"></span><br><span class="line">    <span class="comment"># build function will be called when the call function first be called and the input_shape will be assigned as the shape of inputs automatically. This layer is used to define the operations that depends on the inputs' shape.</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self, input_shape</span>):</span><br><span class="line">        self.batch_size = input_shape[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># call function will do the forward computing operations and it will be invoked when given inputs</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self, inputs, training=<span class="literal">None</span></span>):</span><br><span class="line">        x = self.conv(inputs)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="comment"># get_config function will update the configuration information of this layer</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_config</span>(<span class="params">self</span>):</span><br><span class="line">        config=<span class="built_in">super</span>(CustomLayer, self).get_config()</span><br><span class="line">        config.update({</span><br><span class="line">          <span class="string">'param'</span>: self.param</span><br><span class="line">        })</span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">from_config</span>(<span class="params">cls, config</span>):</span><br><span class="line">        <span class="keyword">return</span> cls(**config)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="build-models">Build Models</h4>
<p>There are three ways to build a model, that is the sequential API, functional API, and the sub-classing API. * Sequential API</p>
<p><em>keras.Sequntial()</em> will create a model and then we can add layers to this model using its API. </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras import layers</span><br><span class="line"></span><br><span class="line">model = tf.keras.Sequential()</span><br><span class="line"><span class="comment"># Adds a densely-connected layer with 64 units to the model:</span></span><br><span class="line">model.<span class="built_in">add</span>(layers.Dense(64, <span class="attribute">activation</span>=<span class="string">'relu'</span>))</span><br><span class="line"><span class="comment"># Add another:</span></span><br><span class="line">model.<span class="built_in">add</span>(layers.Dense(64, <span class="attribute">activation</span>=<span class="string">'relu'</span>))</span><br><span class="line"><span class="comment"># Add an output layer with 10 output units:</span></span><br><span class="line">model.<span class="built_in">add</span>(layers.Dense(10))</span><br></pre></td></tr></tbody></table></figure> Sequential API is easy to use but it can only define model of stacking architecture, which limits the ability of customization.<p></p>
<ul>
<li>Functional API Compared with Sequential API, Functional API has more power to customize models. Besides the stacking architecture, using functional API we can define modes with multiple inputs or outputs, multiple branches, and sharing layers. <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># There are three steps to define a model using functional api.</span></span><br><span class="line"><span class="comment"># The first step is to define the inputs using keras.Input(shape=shape), given the input's shape of the defined model. Note that we shall not give the batch size.</span></span><br><span class="line">inputs = keras.Input(shape=(784,), <span class="attribute">name</span>=<span class="string">'img'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The second step is to define the operations using keras build-in layers or customized layers to obtain the final ouputs</span></span><br><span class="line">x = layers.Dense(64, <span class="attribute">activation</span>=<span class="string">'relu'</span>)(inputs)</span><br><span class="line">x = layers.Dense(64, <span class="attribute">activation</span>=<span class="string">'relu'</span>)(x)</span><br><span class="line">outputs = layers.Dense(10)(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The third step is to create the model using keras.Model(), given the inputs and outputs</span></span><br><span class="line">model = keras.Model(<span class="attribute">inputs</span>=inputs, <span class="attribute">outputs</span>=outputs, <span class="attribute">name</span>=<span class="string">'mnist_model'</span>)</span><br></pre></td></tr></tbody></table></figure></li>
<li>Sub-classing API Similarly with customize a layer, we can use the sub-classing feature of Python to define a model.</li>
</ul>
<h4 id="train-save-models">Train &amp; Save Models</h4>
<h3 id="papers">Papers</h3>
<h4 id="pointnet-deep-learning-on-point-sets-for-3d-classification-and-segmentation">PointNet: Deep Learning on Point Sets for 3D Classification and Segmentation</h4>
<h3 id="debug">Debug</h3>
<h4 id="attributeerror-int-object-has-no-attribute-value">AttributeError: 'int' object has no attribute 'value'</h4>
<figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Bug Code</span></span><br><span class="line"><span class="attr">batch_size</span> = point_cloud.get_shape()[<span class="number">0</span>].value</span><br></pre></td></tr></tbody></table></figure>
<p>The issue is the usage of point_cloud.get_shape()[0].value. In TF 1.x get_shape() works in non-eager mode and returns a list of Dimensions which does have the value. In TF 2.0 get_shape() works in eager mode and returns list of ints so value is not applicable any more. </p><figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Fixed Code</span></span><br><span class="line"><span class="attr">batch_size</span> = point_cloud.get_shape()[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure> #### AttributeError: module 'tensorflow' has no attribute 'contrib' In Tensorflow 2.0, contrib attribute was deprecated.<p></p>
<h4 id="valueerror-cant-convert-python-sequence-with-mixed-types-to-tensor.">ValueError: Can't convert Python sequence with mixed types to Tensor.</h4>
<p>In python, a list can store elements of different types. If a list stores elements of int and of float, Tensorflow could not treat it as an array, thus shall not be used to initialize a Tensor.</p>
<h4 id="importerror-failed-to-import-pydot.-you-must-install-pydot-and-graphviz-for-pydotprint-to-work.">ImportError: Failed to import pydot. You must install pydot and graphviz for <code>pydotprint</code> to work.</h4>
<figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">tf.keras.utils.plot<span class="constructor">_model(<span class="params">model</span>, <span class="params">to_file</span>=<span class="params">os</span>.<span class="params">path</span>.<span class="params">join</span>(BASE_DIR, '<span class="params">corint_net</span>.<span class="params">png</span>')</span>, show_shapes=True)</span><br></pre></td></tr></tbody></table></figure>
<p>The error usually happens when we use <em>tf.keras.utils.plot_model</em> to draw the architecture of the model. The main reason is that we do not install pydot and graphviz, therefore the solution is: </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">pip install -i https:<span class="regexp">//</span>pypi.tuna.tsinghua.edu.cn/simple pydot</span><br><span class="line">pip install -i https:<span class="regexp">//</span>pypi.tuna.tsinghua.edu.cn/simple graphviz</span><br><span class="line">sudo apt-get install graphviz</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Tensorflow</category>
        <category>Deep Learning</category>
        <category>Tensorflow</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>Python</tag>
        <tag>Notes</tag>
        <tag>Tensorflow</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Tutorials - Learning Notes for Beginners</title>
    <url>/2020/03/12/CPlusPlus-Learning-Notes/</url>
    <content><![CDATA[<html><head></head><body><p>Add it latter <span id="more"></span> ### System APIs</p>
<h4 id="signal">signal</h4>
<h4 id="system">system</h4>
<h4 id="getcwd">getcwd</h4>
<h4 id="gettimeoftoday">gettimeoftoday</h4>
<h3 id="build-in-apis">Build-In APIs</h3>
<h4 id="undef">undef</h4>
<h3 id="third-party">Third-Party</h3>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>C++</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>Usage of ASUS RT-AC86U - Firmware Upgrade and Plugin Installation</title>
    <url>/2020/12/11/Usage-of-ASUS-RT-AC86U-Firmware-Upgrade-and-Plugin-Installation/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://www.asus.com/us/Networking/RT-AC86U/">Asus RT-AC86U</a> is a professional dual band gigabit WiFi router, which has arm structure. Moreover, it has officially supported open source firmware, which has much more powerful functions, such like running official and third-part plugins on it. In this article, I will show you how to upgrade its firmware to highly customized version, install shadowsocks plugin and config v2ray service. <span id="more"></span> NOTEï¼ There is a reset button on the back of Asus RT-AC86U, if there is anything wrong when upgrading the firmware, we can hold the button for seconds (maybe 30s) to reset the router.</p>
<p>The recommended firmware is developed based on <a href="https://github.com/RMerl/asuswrt-merlin.ng">asuswrt-merlin</a>, and we can download it at <a href="https://koolshare.cn/thread-127878-1-1.html">koolshare</a>. * Firmware Upgrade </p><figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">Login ASUS RT-AC86U</span><br><span class="line">ç³»ç»ç®¡ç -&gt; åºä»¶åçº§ -&gt; ä¸ä¼ </span><br></pre></td></tr></tbody></table></figure> Choose the downloaded firmware and upload, it will automatically upgrade to the uploaded version. The process takes about 1-2 mins. * Install Shadowsocks Plugin All the plugins are managed in software center. For some reason, we can not download and install shadowsocks from the software center directly and we have to download the <a href="https://github.com/hq450/fancyss_history_package/tree/master/fancyss_hnd">source code</a> and install it manually. <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">è½¯ä»¶ä¸­å¿ -&gt; ç¦»çº¿å®è£ -&gt; ä¸ä¼ å¹¶å®è£</span><br></pre></td></tr></tbody></table></figure> <img data-src="/2020/12/11/Usage-of-ASUS-RT-AC86U-Firmware-Upgrade-and-Plugin-Installation/shadowsocks.png"> Probably, it could prompt that "illegal keywords is detected and could not install". In this scenario, we have to login the router through ssh and install it using command line. First, we have to open the ssh function. <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">ç³»ç»ç®¡ç -&gt; ç³»ç»è®¾ç½® -&gt; å¯ç¨SSH (LAN only)</span><br></pre></td></tr></tbody></table></figure> Second, login using a computer in lan and install. <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh admin@10.10.10.1</span><br><span class="line">sed -i <span class="string">'s/\tdetect_package/\t# detect_package/g'</span> /koolshare/scripts/ks_tar_install.sh</span><br><span class="line"><span class="built_in">cd</span> /tmp/upload</span><br><span class="line">tar -xzf shadowsocks_1.9.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> shadowsocks</span><br><span class="line"><span class="built_in">chmod</span> +x install.sh</span><br><span class="line">./install.sh</span><br></pre></td></tr></tbody></table></figure> After running the above command line, we will sea the shadowsocks plugin in software center. If we want to use the v2ray function, we have to config virtual memory for a better performance. Prepare an USB storage (USB 3.0 is recommended) and format it as ext4. Then download and install the virtual memory plugin directly from software center.<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Shadowsocks</category>
      </categories>
      <tags>
        <tag>Setups</tag>
        <tag>RT-AC86U</tag>
        <tag>Shadowsocks</tag>
        <tag>V2Ray</tag>
      </tags>
  </entry>
  <entry>
    <title>Click-Through Rate Prediction Using GBDT and Linear Regression with Avazu Dataset</title>
    <url>/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/</url>
    <content><![CDATA[<html><head></head><body><p>In online advertising and online shopping, Click-Through Rate (CTR) is a good metric to evaluate the quality of advertisement recommendation and goods recommendation. CTR prediction is one of the main challenges in building an intelligent recommendation system. It aims to predict the probability of an customer clicking the recommended items, which helps us to explore the interests of customers and to choose items for an customer from the massive amount of items effectively and usefully. In this article, I will show you how to build a CTR prediction model using machine learning methods and avazu dataset. Python, pandas,matplotlib, seaborn, xgboost, scikit-learning are used in this article.<br>
<span id="more"></span> ### Definition of Click-Through Rate When we visit a shopping application or a news application, we will see lots of commodities or news that those applications recommend to us and we will click some of the presented commodities or news that we are interested to see the detailed information. In the field of recommendation system, the commodities and news are called item and the presented items are defined as exposed items. When a customer visit a application such as amazon, the application will recommend items that the customer may be interested and hope the customer will click more exposed items. More clicked items means the application knows better about the customer's interests and therefore recommends higher quality items.</p>
<p>Usually, we use Click-Through Rate (CTR) to evaluate the performance of a recommendation system. CTR is defined as the ratio between the number of clicked items and exposed items, formulated as Eq. <span class="math inline">\(\eqref{eq1}\)</span> <span class="math display">\[
\begin{equation}
ctr=\frac{n_{clk}}{n_{exp}}
\label{eq1}
\end{equation}
\]</span> ### Introduction of Avazu Dataset <a href="https://www.kaggle.com/c/avazu-ctr-prediction/overview">Avazu Dataset</a> is a click-through rate prediction competition sponsored by Avazu. * Train Set 10 days of click-through data, ordered chronologically. Non-clicks and clicks are subsampled according to different strategies. * Test Set 1 day of ads to for testing your model predictions. ### Exploratory Data Analysis In this section, I will analyze the correlation of each column of the raw data with respect to the label and visualize the result using pandas, matplotlib and seaborn. * Split Train Set</p>
<p>The train set contains 10 days of click-through data and is a csv file with size as 6.3 Gb. It takes more than 24.0 Gb's memory to load the whole train set using pandas, which requires a higher performance hardware. Therefore, it is better to split the large train set csv file as small ones. </p><figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">#! /usr/bin/Python</span><br><span class="line">import pandas <span class="keyword">as</span> pd</span><br><span class="line">import numpy <span class="keyword">as</span>  np</span><br><span class="line">from matplotlib import pyplot <span class="keyword">as</span> plt</span><br><span class="line">from collections import Counter</span><br><span class="line">import seaborn <span class="keyword">as</span> sns</span><br><span class="line">import json</span><br><span class="line">import datetime</span><br><span class="line">from sklearn import preprocessing</span><br><span class="line">from sklearn.model_selection import StratifiedShuffleSplit</span><br><span class="line">sns.set<span class="literal">()</span></span><br><span class="line"></span><br><span class="line">avazu = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train</span>.<span class="params">csv</span>', <span class="params">nrows</span>=10000000)</span></span><br><span class="line">avazu.<span class="keyword">to</span><span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_01</span>.<span class="params">csv</span>', <span class="params">header</span>=True, <span class="params">index</span>=False)</span></span><br><span class="line">avazu = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train</span>.<span class="params">csv</span>', <span class="params">skiprows</span>=<span class="params">range</span>(1, 10000000)</span>, nrows=<span class="number">10000000</span>)</span><br><span class="line">avazu.<span class="keyword">to</span><span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_02</span>.<span class="params">csv</span>', <span class="params">header</span>=True, <span class="params">index</span>=False)</span></span><br><span class="line">avazu = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train</span>.<span class="params">csv</span>', <span class="params">skiprows</span>=<span class="params">range</span>(1, 20000000)</span>, nrows=<span class="number">10000000</span>)</span><br><span class="line">avazu.<span class="keyword">to</span><span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_03</span>.<span class="params">csv</span>', <span class="params">header</span>=True, <span class="params">index</span>=False)</span></span><br><span class="line">avazu = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train</span>.<span class="params">csv</span>', <span class="params">skiprows</span>=<span class="params">range</span>(1, 30000000)</span>, nrows=<span class="number">10000000</span>)</span><br><span class="line">avazu.<span class="keyword">to</span><span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_04</span>.<span class="params">csv</span>', <span class="params">header</span>=True, <span class="params">index</span>=False)</span></span><br><span class="line">avazu = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train</span>.<span class="params">csv</span>', <span class="params">skiprows</span>=<span class="params">range</span>(1, 40000000)</span>, nrows=<span class="number">10000000</span>)</span><br><span class="line">avazu.<span class="keyword">to</span><span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_05</span>.<span class="params">csv</span>', <span class="params">header</span>=True, <span class="params">index</span>=False)</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<pre><code>* skiprows - the index of skip rows, supports scalar or array input
* nrows - the number of rows to load</code></pre>
<ul>
<li>Random Sampling</li>
</ul>
<p>It is more efficient to do exploratory data analysis using a smaller dataset that has same distribution with the raw dataset. We can randomly sample from the raw dataset using <strong>StratifiedShuffleSplit</strong> imported form <strong>sklearn.model_selection</strong>. </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">avazu = pd.read_csv(<span class="string">'../data/avazu/train_01.csv'</span>)</span><br><span class="line">split = StratifiedShuffleSplit(<span class="attribute">n_splits</span>=1, <span class="attribute">train_size</span>=0.05, <span class="attribute">test_size</span>=0.05, <span class="attribute">random_state</span>=42)</span><br><span class="line"><span class="keyword">for</span> train_index, test_index <span class="keyword">in</span> split.split(avazu, avazu[<span class="string">"click"</span>]):</span><br><span class="line">    strat_train_set = avazu.loc[train_index]</span><br><span class="line">    <span class="built_in">print</span>(strat_train_set.<span class="built_in">info</span>())</span><br><span class="line">    strat_test_set = avazu.loc[test_index]</span><br><span class="line">    <span class="built_in">print</span>(strat_test_set.<span class="built_in">info</span>())</span><br><span class="line">    strat_train_set.to_csv(<span class="string">"../data/train_sample_01.csv"</span>, header = <span class="literal">True</span>, <span class="attribute">index</span>=<span class="literal">False</span>)</span><br></pre></td></tr></tbody></table></figure> * Merge Sampling Merge the sampled data into one file. <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">avazu_01 = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_sample_01</span>.<span class="params">csv</span>')</span></span><br><span class="line">avazu_02 = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_sample_02</span>.<span class="params">csv</span>')</span></span><br><span class="line">avazu_03 = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_sample_03</span>.<span class="params">csv</span>')</span></span><br><span class="line">avazu_04 = pd.read<span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">avazu</span><span class="operator">/</span><span class="params">train_sample_04</span>.<span class="params">csv</span>')</span></span><br><span class="line">avazu = avazu_01.append(<span class="literal">[<span class="identifier">avazu_02</span>, <span class="identifier">avazu_03</span>, <span class="identifier">avazu_04</span>]</span>)</span><br><span class="line">avazu.<span class="keyword">to</span><span class="constructor">_csv('..<span class="operator">/</span><span class="params">data</span><span class="operator">/</span><span class="params">train_sample</span>.<span class="params">csv</span>', <span class="params">header</span>=True, <span class="params">index</span>=False)</span></span><br></pre></td></tr></tbody></table></figure> * Basic Info Load the sampled data and print the basic information. <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">avazu = pd<span class="selector-class">.read_csv</span>(<span class="string">'../data/avazu/train_sample.csv'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(avazu.head()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(avazu.info()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(list(avazu.columns)</span></span>)</span><br></pre></td></tr></tbody></table></figure> <img alt="Head data of the train sample" data-src="/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/head.png"> The info of the train sample is shown as follows. <figure class="highlight tap"><table><tbody><tr><td class="code"><pre><span class="line">&lt;class 'pandas.core.frame.DataFrame'&gt;</span><br><span class="line">RangeIndex:<span class="number"> 2000000 </span>entries,<span class="number"> 0 </span>to 1999999</span><br><span class="line">Data columns (total<span class="number"> 24 </span>columns):</span><br><span class="line"> <span class="comment">#   Column            Dtype  </span></span><br><span class="line">---  ------            -----  </span><br><span class="line"><span class="number"> 0 </span>  id                float64</span><br><span class="line"><span class="number"> 1 </span>  click             int64  </span><br><span class="line"><span class="number"> 2 </span>  hour              int64  </span><br><span class="line"><span class="number"> 3 </span>  C1                int64  </span><br><span class="line"><span class="number"> 4 </span>  banner_pos        int64  </span><br><span class="line"><span class="number"> 5 </span>  site_id           object </span><br><span class="line"><span class="number"> 6 </span>  site_domain       object </span><br><span class="line"><span class="number"> 7 </span>  site_category     object </span><br><span class="line"><span class="number"> 8 </span>  app_id            object </span><br><span class="line"><span class="number"> 9 </span>  app_domain        object </span><br><span class="line"><span class="number"> 10 </span> app_category      object </span><br><span class="line"><span class="number"> 11 </span> device_id         object </span><br><span class="line"><span class="number"> 12 </span> device_ip         object </span><br><span class="line"><span class="number"> 13 </span> device_model      object </span><br><span class="line"><span class="number"> 14 </span> device_type       int64  </span><br><span class="line"><span class="number"> 15 </span> device_conn_type  int64  </span><br><span class="line"><span class="number"> 16 </span> C14               int64  </span><br><span class="line"><span class="number"> 17 </span> C15               int64  </span><br><span class="line"><span class="number"> 18 </span> C16               int64  </span><br><span class="line"><span class="number"> 19 </span> C17               int64  </span><br><span class="line"><span class="number"> 20 </span> C18               int64  </span><br><span class="line"><span class="number"> 21 </span> C19               int64  </span><br><span class="line"><span class="number"> 22 </span> C20               int64  </span><br><span class="line"><span class="number"> 23 </span> C21               int64  </span><br><span class="line">dtypes: float64(1), int64(14), object(9)</span><br><span class="line">memory usage: 366.2+ MB</span><br><span class="line">None</span><br></pre></td></tr></tbody></table></figure> The columns are shown as follows. <figure class="highlight scheme"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="symbol">'id</span>', <span class="symbol">'click</span>', <span class="symbol">'hour</span>', <span class="symbol">'C1</span>', <span class="symbol">'banner_pos</span>', <span class="symbol">'site_id</span>', <span class="symbol">'site_domain</span>', <span class="symbol">'site_category</span>', <span class="symbol">'app_id</span>', <span class="symbol">'app_domain</span>', <span class="symbol">'app_category</span>', <span class="symbol">'device_id</span>', <span class="symbol">'device_ip</span>', <span class="symbol">'device_model</span>', <span class="symbol">'device_type</span>', <span class="symbol">'device_conn_type</span>', <span class="symbol">'C14</span>', <span class="symbol">'C15</span>', <span class="symbol">'C16</span>', <span class="symbol">'C17</span>', <span class="symbol">'C18</span>', <span class="symbol">'C19</span>', <span class="symbol">'C20</span>', <span class="symbol">'C21</span>']</span><br></pre></td></tr></tbody></table></figure> The first column is the index, the second column is the label, the third row the time when the record happened, column 3 and 16-23 are categorical features with dtype as int64, column 5-7 are site features, column 8-10 are app features, column 11-15 are device features. * Label Encode of Categorical Features <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> column <span class="keyword">in</span> <span class="selector-attr">[<span class="string">'C1'</span>, <span class="string">'site_id'</span>, <span class="string">'site_domain'</span>, <span class="string">'site_category'</span>, <span class="string">'app_id'</span>, <span class="string">'app_domain'</span>, <span class="string">'app_category'</span>, <span class="string">'device_id'</span>, <span class="string">'device_ip'</span>, <span class="string">'device_model'</span>]</span>:</span><br><span class="line">    enc = preprocessing<span class="selector-class">.LabelEncoder</span>()</span><br><span class="line">    avazu<span class="selector-attr">[column]</span> = enc<span class="selector-class">.fit_transform</span>(avazu<span class="selector-attr">[column]</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(avazu.info()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(avazu.head()</span></span>)</span><br></pre></td></tr></tbody></table></figure> * Feature Visualization * Distribution of positive and negative labels <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">sns<span class="selector-class">.countplot</span>(x=avazu<span class="selector-attr">[<span class="string">'click'</span>]</span>)</span><br><span class="line">plt<span class="selector-class">.show</span>()</span><br></pre></td></tr></tbody></table></figure> <img alt="Distribution of positive and negative labels" data-src="/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/click-distribution.png"> * Distribution of Banner Position and Label <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sns.countplot(<span class="attribute">x</span>=<span class="string">'banner_pos'</span>, <span class="attribute">hue</span>=<span class="string">'click'</span>, <span class="attribute">data</span>=avazu) #å¹¿åä½ç½®</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure> <img alt="Distribution of banner position with respect to labels" data-src="/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/banner-pos.png"> * Distribution of Site Category and Label <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sns.countplot(<span class="attribute">x</span>=<span class="string">'site_category'</span>, <span class="attribute">hue</span>=<span class="string">'click'</span>, <span class="attribute">data</span>=avazu)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure> <img alt="Distribution of site category with respect to labels" data-src="/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/site-cate.png"> * Distribution of Application Category and Label <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sns.countplot(<span class="attribute">x</span>=<span class="string">'app_category'</span>, <span class="attribute">hue</span>=<span class="string">'click'</span>, <span class="attribute">data</span>=avazu)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure> <img alt="Distribution of application category with respect to labels" data-src="/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/app-cate.png"> * Distribution of Device Type and Label <figure class="highlight haskell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="title">sns</span>.countplot(x = <span class="string">"device_type"</span>, hue = <span class="string">"click"</span>, <span class="class"><span class="keyword">data</span> = avazu)</span></span><br><span class="line"><span class="title">plt</span>.show()</span><br></pre></td></tr></tbody></table></figure> <img alt="Distribution of device type with respect to labels" data-src="/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/device-type.png"> * Covariance of Features <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">avazu_drop = avazu<span class="selector-class">.drop</span>(<span class="attribute">columns</span>=[<span class="string">'id'</span>])</span><br><span class="line">avazu_corr = avazu_drop<span class="selector-class">.corr</span>()</span><br><span class="line">plt<span class="selector-class">.figure</span>(figsize=(<span class="number">20</span>, <span class="number">18</span>))</span><br><span class="line">sns<span class="selector-class">.heatmap</span>(avazu_corr<span class="selector-class">.abs</span>(), annot=True)</span><br><span class="line">plt<span class="selector-class">.show</span>()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(avazu_corr[<span class="string">'click'</span>].sort_values(ascending=False)</span></span>)</span><br></pre></td></tr></tbody></table></figure> <img alt="Covariance of Features" data-src="/2020/12/20/Click-Through-Rate-Prediction-Using-GBDT-With-Avazu-Dataset/corr.png"> As we can see, C1 and devece_type have high correlation with each other, C14 and C17 have high correlation with each other<p></p>
<h3 id="data-preprocess">Data Preprocess</h3>
<h3 id="hyper-parameters-search">Hyper Parameters Search</h3>
<h3 id="feature-selection-using-gbdt">Feature Selection Using GBDT</h3>
<h3 id="linear-regression-model">Linear Regression Model</h3>
</body></html>]]></content>
      <categories>
        <category>Deep Learning</category>
        <category>Click-Through Rate Prediction</category>
      </categories>
      <tags>
        <tag>Deep Learning</tag>
        <tag>Python</tag>
        <tag>Click-Through Rate(CTR)</tag>
        <tag>Machine Learning</tag>
        <tag>Pandas</tag>
        <tag>Matplotlib</tag>
        <tag>Seaborn</tag>
        <tag>XGBoost</tag>
      </tags>
  </entry>
  <entry>
    <title>Deploy A Django Application on Ubuntu Using Apache and PostgreSQL</title>
    <url>/2023/02/08/Deploy-A-Django-Application-on-Ubuntu-Using-Apache-and-PostgreSQL/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://www.djangoproject.com/">Django</a> is a high-level Python web framework that encourages rapid development and clean, pragmatic design. Built by experienced developers, it takes care of much of the hassle of web development, so you can focus on writing your app without needing to reinvent the wheel. In this tutorial, I will teach you to install, develop and deploy a web application step by step using Django, Apache and PostgreSQL on Ubuntu 18.04. <span id="more"></span> ## Prerequire Installation ### Install and Use Python3 and Pip3 The default python on Ubuntu 18.04 is python2, which will be deprecated in future. Django recommend us to use python3 which we have a better compatibility and performance. ##### Install Python3 </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> update</span><br><span class="line">sudo apt-<span class="built_in">get</span> install python3 libexpat1</span><br></pre></td></tr></tbody></table></figure> ##### Set Python3 as Default Python <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo rm -rf <span class="regexp">/usr/</span>bin/python</span><br><span class="line">ln -s <span class="regexp">/usr/</span>bin<span class="regexp">/python3 /u</span>sr<span class="regexp">/bin/</span>python</span><br></pre></td></tr></tbody></table></figure> ##### Install Pip3 <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> install python3-pip</span><br></pre></td></tr></tbody></table></figure> ##### Set Pip3 as Default Pip <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>bin<span class="regexp">/pip3 /u</span>sr<span class="regexp">/bin/</span>pip</span><br><span class="line">pip install --upgrade pip</span><br></pre></td></tr></tbody></table></figure> ### Install Apache with mod_wsgi Module Deploying Django with <a href="https://httpd.apache.org/">Apache</a> and <a href="https://modwsgi.readthedocs.io/en/develop/">mod_wsgi</a> is a tried and tested way to get Django into production. mod_wsgi is an Apache module which can host any Python WSGI application, including Django. Django will work with any version of Apache which supports mod_wsgi. #### Install <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install apache2 apache2-utils ssl-cert libapache2-<span class="keyword">mod</span>-wsgi-<span class="keyword">py3</span></span><br></pre></td></tr></tbody></table></figure> #### Restart <figure class="highlight maxima"><table><tbody><tr><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">restart</span> apache2</span><br></pre></td></tr></tbody></table></figure> ### Install PostgreSQL <a href="https://www.postgresql.org/">PostgreSQL</a> is an advanced open source relational database. It has a better performance than django's default database SQLite, therefore here I use PostgreSQL as Django's database. #### Install <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> update</span><br><span class="line">sudo apt-<span class="built_in">get</span> install postgresql postgresql-contrib</span><br><span class="line">pip install psycopg2</span><br></pre></td></tr></tbody></table></figure> #### Check Status <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">service postgresql status</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="django-installation">Django Installation</h2>
<p>After finish the installation of python3, pip3, apache and postgresql, we can install django now. The latest version of Django is 4.1, however I install 3.2.13 to avoid compatibility problems and other unpredictable bugs. ### <a href="https://docs.djangoproject.com/en/4.1/intro/install/">Install Django</a> #### Install </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pip</span> install django==<span class="number">3</span>.<span class="number">2</span>.<span class="number">13</span></span><br></pre></td></tr></tbody></table></figure> #### Verify Installation <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">python -m django <span class="attr">--version</span></span><br><span class="line">python</span><br><span class="line">import django</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(django.get_version()</span></span>)</span><br></pre></td></tr></tbody></table></figure> #### Install Required Packages (Optional, you can skip this step) ##### Install REST Framework <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> djangorestframework</span><br></pre></td></tr></tbody></table></figure> ##### Install PhoneNumberField <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> django-phonenumber-field</span><br><span class="line">pip <span class="keyword">install</span> phonenumbers</span><br></pre></td></tr></tbody></table></figure> ##### Install Image API <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> pillow</span><br><span class="line">pip <span class="keyword">install</span> drf-extra-fields</span><br></pre></td></tr></tbody></table></figure> ##### Install cleanup <figure class="highlight mipsasm"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install </span>django-cleanup</span><br><span class="line"><span class="keyword">INSTALLED_APPS </span>= (</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'django_cleanup.apps.CleanupConfig'</span>, <span class="comment"># should be placed after your apps</span></span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure> ## Develop Django Application ### Create Project From the command line, cd into a directory where youâd like to store your project, then run the following command: <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">django-admin startproject mysite</span></span><br></pre></td></tr></tbody></table></figure> This will create a mysite directory in your current directory. <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">mysite/</span><br><span class="line">    manage.<span class="keyword">py</span></span><br><span class="line">    mysite/</span><br><span class="line">        __init__.<span class="keyword">py</span></span><br><span class="line">        settings.<span class="keyword">py</span></span><br><span class="line">        urls.<span class="keyword">py</span></span><br><span class="line">        asgi.<span class="keyword">py</span></span><br><span class="line">        wsgi.<span class="keyword">py</span></span><br></pre></td></tr></tbody></table></figure> ### Deploy Project #### Run Server By default, the runserver command starts the development server on the internal IP at port 8000. If you want to change the serverâs port, pass it as a command-line argument. For instance, this command starts the server on port 8080: <figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">python</span> manage.py runserver <span class="number">0.0.0.0:8080</span></span><br></pre></td></tr></tbody></table></figure> Then we can visit mysite application via http://127.0.0.1:8080. Note that runserver is only used for django developing and debug. #### Open Port For safety, the port we used may not open by default on Ubuntu 18.04. We can manually open it. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> ufw <span class="literal">allow</span> <span class="number">8080</span></span><br></pre></td></tr></tbody></table></figure> If the port is already in user, we have to kill it before runserver. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> fuser -k <span class="number">8080</span>/tcp</span><br></pre></td></tr></tbody></table></figure> ### Create App Now that your environment â a âprojectâ â is set up, youâre set to start doing work. Each application you write in Django consists of a Python package that follows a certain convention. Django comes with a utility that automatically generates the basic directory structure of an app, so you can focus on writing code rather than creating directories.<p></p>
<p>To create your app, make sure youâre in the same directory as manage.py and type this command: </p><figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">django-admin startapp api</span></span><br></pre></td></tr></tbody></table></figure> Thatâll create a directory api, which is laid out like this: <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">api/</span><br><span class="line">    __init__.<span class="keyword">py</span></span><br><span class="line">    admin.<span class="keyword">py</span></span><br><span class="line">    apps.<span class="keyword">py</span></span><br><span class="line">    migrations/</span><br><span class="line">        __init__.<span class="keyword">py</span></span><br><span class="line">    models.<span class="keyword">py</span></span><br><span class="line">    tests.<span class="keyword">py</span></span><br><span class="line">    views.<span class="keyword">py</span></span><br></pre></td></tr></tbody></table></figure> This directory structure will house the api application. #### Install App After create the api app, we need to install api app to mysite project. Edit the mysite/settings.py file again, and change the INSTALLED_APPS setting to include the string 'api'. So itâll look like this: <figure class="highlight sml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">INSTALLED_APPS</span> = (</span><br><span class="line">    <span class="symbol">'django</span>.contrib.admin',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.auth',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.contenttypes',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.sessions',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.messages',</span><br><span class="line">    <span class="symbol">'django</span>.contrib.staticfiles',</span><br><span class="line">    <span class="symbol">'api'</span>,</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure> * Difference between project and application in Django An app is a web application that does something â e.g., a blog system, a database of public records or a small poll app. A project is a collection of configuration and apps for a particular website. A project can contain multiple apps. An app can be in multiple projects. #### Create Super User and Login Weâll need to create a user who can login to the admin site. Run the following command: <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> createsuperuser</span><br></pre></td></tr></tbody></table></figure> Input the user name, email address and password, the above command will create a super user for mysite. Then we can login http://127.0.0.1:8080/admin/ as an administrator and manipulate the data defined by Django's model.<p></p>
<h4 id="make-migrations">Make Migrations</h4>
<p>When we define new models or change the defined models, we need let django known the definitions and changes by the following commands. </p><figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> makemigrations</span><br><span class="line"><span class="keyword">python</span> manage.<span class="keyword">py</span> migrate</span><br></pre></td></tr></tbody></table></figure> ## Deploy Django Application Using Apache2 Although we can serve the django application using the command 'python manage.py runserver 0.0.0.0:8080', it is not recommended to use this command to deploy Django's application. Because this command is designed for developing and debug. It's performance is poor and it will runout the server's memory when the application is visited in high concurrency. <a href="https://httpd.apache.org/">Apache</a> is a famous open-source HTTP server for modern operating systems Unix and Windows. The official documents of Django recommends us to use Apache to deploy Django's application.<p></p>
<p>There are two points we need to know before we take further steps into apache configuration. * configuration files' path </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">cd <span class="regexp">/etc/</span>apache2/</span><br><span class="line">tree -L <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure> We should see the following contents: <figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line">âââ apache2.<span class="keyword">conf</span></span><br><span class="line">âââ <span class="keyword">conf</span>-available</span><br><span class="line">âââ <span class="keyword">conf</span>-enabled</span><br><span class="line">âââ envvars</span><br><span class="line">âââ magic</span><br><span class="line">âââ mods-available</span><br><span class="line">âââ mods-enabled</span><br><span class="line">âââ ports.<span class="keyword">conf</span></span><br><span class="line">âââ sites-available</span><br><span class="line">âââ sites-enabled</span><br></pre></td></tr></tbody></table></figure> The <strong>apache2.conf</strong> is the apache's configuration file and the <strong>ports.conf</strong> defines the port that apache listens. The directory <strong>sites-available</strong> contains configurations of sites that apache can serve and the directory <strong>sites-enabled</strong> contains configurations of sites that apache is serving. * log's path <figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> /<span class="keyword">var</span>/<span class="keyword">log</span>/apache2</span><br><span class="line">tree</span><br></pre></td></tr></tbody></table></figure> And we will see the following files: <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">âââ access.<span class="built_in">log</span></span><br><span class="line">âââ <span class="keyword">error</span>.<span class="built_in">log</span></span><br><span class="line">âââ other_vhosts_access.<span class="built_in">log</span></span><br></pre></td></tr></tbody></table></figure> Logs can offer us useful information when there is something wrong during configure apache. ### Set Port The default port is <strong>80</strong> for http, but we can use other ports if port <strong>80</strong> is reserved. Open <strong>ports.conf</strong> and listen the port we want to use for Django application. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>apache2/ports.conf</span><br></pre></td></tr></tbody></table></figure> And add the following configuration to let apache listen <strong>8080</strong> port. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">Listen</span> <span class="number">8080</span></span><br></pre></td></tr></tbody></table></figure> ### Enable Rewrite Module <a href="https://httpd.apache.org/docs/current/mod/mod_rewrite.html">Rewrite Module</a> is a rule-based rewrite engine and it rewrites the requested URLs by the defined rules using regular-expression parser. Usually, it is used to redirect one URL to another URL. Here will use it to redirect http request to https request, which is more secure. <figure class="highlight coq"><table><tbody><tr><td class="code"><pre><span class="line">a2enmod <span class="built_in">rewrite</span></span><br></pre></td></tr></tbody></table></figure> ### Configure Site There is a default enabled site defined in <strong>000-default.conf</strong>. Here we edit this site configuration to deploy Django application. <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">cp <span class="regexp">/etc/</span>apache2<span class="regexp">/sites-available/</span><span class="number">000</span>-<span class="keyword">default</span>.conf <span class="regexp">/etc/</span>apache2<span class="regexp">/sites-available/</span><span class="number">000</span>-<span class="keyword">default</span>.conf.cp</span><br><span class="line">vi <span class="regexp">/etc/</span>apache2<span class="regexp">/sites-available/</span><span class="number">000</span>-<span class="keyword">default</span>.conf</span><br></pre></td></tr></tbody></table></figure> And replace the default configuration with the following one: <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">&lt;VirtualHost *:<span class="number">8080</span>&gt;</span><br><span class="line">    # ServerName <span class="number">172.30</span>.<span class="number">92.118</span></span><br><span class="line">    # ServerAlias zhaoyongsheng.com</span><br><span class="line">    # ServerAdmin yongsheng.zhao.csc@gmail.com</span><br><span class="line"></span><br><span class="line">    WSGIScriptAlias <span class="regexp">/ /</span>django<span class="regexp">/servo/</span>servo/wsgi.py</span><br><span class="line"></span><br><span class="line">    ProxyPass <span class="regexp">/media/</span> !</span><br><span class="line">    Alias <span class="regexp">/media/</span> <span class="regexp">/django/m</span>edia/</span><br><span class="line">    ProxyPass <span class="regexp">/static/</span> !</span><br><span class="line">    Alias <span class="regexp">/static/</span> <span class="regexp">/django/</span>servo<span class="regexp">/static/</span></span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/m</span>edia&gt;</span><br><span class="line">         Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/</span>servo/<span class="keyword">static</span>&gt;</span><br><span class="line">         Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    # WSGIDaemonProcess blog python-home=<span class="regexp">/home/</span>sammy<span class="regexp">/myproject/my</span>projectenv python-path=<span class="regexp">/home/</span>sammy/myproject</span><br><span class="line">    # WSGIProcessGroup %{GLOBAL}</span><br><span class="line">    # WSGIDaemonProcess ziqiangxuetang.com python-path=<span class="regexp">/home/</span>tu<span class="regexp">/blog:/</span>home<span class="regexp">/tu/</span>.virtualenvs<span class="regexp">/blog/</span>lib<span class="regexp">/python2.7/</span>site-packages</span><br><span class="line">    # WSGIProcessGroup ziqiangxuetang.com</span><br><span class="line">    # WSGIApplicationGroup %{GLOBAL}</span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/</span>servo/servo&gt;</span><br><span class="line">            &lt;Files wsgi.py&gt;</span><br><span class="line">                Require all granted</span><br><span class="line">            &lt;/Files&gt;</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">    ErrorLog ${APACHE_LOG_DIR}/error.log</span><br><span class="line">    CustomLog ${APACHE_LOG_DIR}/access.log combined</span><br><span class="line">    # RewriteEngine on</span><br><span class="line">    # RewriteCond   %{HTTPS} !=on </span><br><span class="line">    # RewriteRule   ^(.*)  https:<span class="comment">//%{SERVER_NAME}$1 [L,R]</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></tbody></table></figure> The first bit in the WSGIScriptAlias line is the base URL path you want to serve your application at (/ indicates the root url), and the second is the location of a âWSGI fileâ . And the <directory> piece ensures that Apache can access your wsgi.py file. * ** ProxyPass /static/ !** -- Do not deal with <strong>/static/</strong> urls, otherwise it will add a <strong>static/</strong> prefix to the url, such as make "static/admin/base.html" as "static/static/admin/base.html", for more details please visit the <a href="https://djangodeployment.readthedocs.io/en/latest/05-static-files.html">Static and media files</a> * <strong>Alias /media/ /django/media/</strong> -- Let apache know where the media directory is. * <strong>Alias /static/ /django/servo/static/</strong> -- Let apache know where the static directory is. The <a href="https://docs.djangoproject.com/en/4.1/howto/deployment/wsgi/modwsgi/">official documents</a> provides more details about how to deploy Django using apache. ### Config Apache The apache's configuration file is in <strong>/etc/apache2/apache2.conf</strong>. Similarly, we had better make a copy of the default <strong>apache2.conf</strong> before modified it. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">cp <span class="regexp">/etc/</span>apache2<span class="regexp">/apache2.conf /</span>etc<span class="regexp">/apache2/</span>apache2.conf.cp</span><br><span class="line">vi <span class="regexp">/etc/</span>apache2/apache2.conf</span><br></pre></td></tr></tbody></table></figure> Find and edit the following lines: <figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">&lt;<span class="literal">Directory</span> /&gt;</span><br><span class="line"><span class="number">160</span>         Options FollowSymLinks</span><br><span class="line"><span class="number">161</span>         AllowOverride <span class="literal">None</span></span><br><span class="line"><span class="number">162</span>         Require <span class="literal">all</span> granted</span><br><span class="line"><span class="number">163</span> &lt;/<span class="literal">Directory</span>&gt;</span><br><span class="line"><span class="number">164</span> </span><br><span class="line"><span class="number">165</span> &lt;<span class="literal">Directory</span> /usr/share&gt;</span><br><span class="line"><span class="number">166</span>         AllowOverride <span class="literal">None</span></span><br><span class="line"><span class="number">167</span>         Require <span class="literal">all</span> granted</span><br><span class="line"><span class="number">168</span> &lt;/<span class="literal">Directory</span>&gt;</span><br><span class="line"><span class="number">169</span> </span><br><span class="line"><span class="number">170</span> <span class="comment"># &lt;Directory /var/www/&gt;</span></span><br><span class="line"><span class="number">171</span> <span class="comment">#       Options Indexes FollowSymLinks</span></span><br><span class="line"><span class="number">172</span> <span class="comment">#       AllowOverride None</span></span><br><span class="line"><span class="number">173</span> <span class="comment">#       Require all granted</span></span><br><span class="line"><span class="number">174</span> <span class="comment"># &lt;/Directory&gt;</span></span><br><span class="line"><span class="number">175</span> </span><br><span class="line"><span class="number">176</span> <span class="comment">#&lt;Directory /srv/&gt;</span></span><br><span class="line"><span class="number">177</span> <span class="comment">#       Options Indexes FollowSymLinks</span></span><br><span class="line"><span class="number">178</span> <span class="comment">#       AllowOverride None</span></span><br><span class="line"><span class="number">179</span> <span class="comment">#       Require all granted</span></span><br><span class="line"><span class="number">180</span> <span class="comment">#&lt;/Directory&gt;</span></span><br></pre></td></tr></tbody></table></figure> Add the following line at the end of the file. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">WSGIPythonPath <span class="regexp">/django/</span>servo</span><br></pre></td></tr></tbody></table></figure> <strong>WSGIPythonPath</strong> ensures that your project package is available for import on the Python path; in other words, that import servo works. ### Close Debug Mode in Django Django's debug mode can print logs which is useful for debug, but its performance is poor. Thus we had better close the debug mode before serving it to web. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">vi <span class="regexp">/django/</span>servo<span class="regexp">/servo/</span>settings.py</span><br></pre></td></tr></tbody></table></figure> Find the line <strong>DEBUG = True</strong>, and set it as False. <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">DEBUG</span> = <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure> ### Change Owner of Django Directory Generally, the owner of django's directory is the admin user of the operation system. We must change the owner to apache to let it have full access to Django's directory. <figure class="highlight haskell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="title">cd</span> /</span><br><span class="line"><span class="title">chown</span> -<span class="type">R</span> www-<span class="class"><span class="keyword">data</span>:www-<span class="keyword">data</span> django</span></span><br></pre></td></tr></tbody></table></figure> ### Restart Apache Finishing the above steps, restart apache to deploy Django's application. <figure class="highlight maxima"><table><tbody><tr><td class="code"><pre><span class="line">service apache2 <span class="built_in">restart</span></span><br></pre></td></tr></tbody></table></figure> Now we can visit the Django's application via http:xxx.xxx.xxx.xxx:8080/admin/. <strong>Congratulations!</strong> If there are any problems, feel free to contact me.</directory><p></p>
<h3 id="warnings-errors-and-solutions">Warnings, Errors And Solutions</h3>
<h4 id="ah00558-apache2-could-not-reliably-determine-the-servers-fully-qualified-domain-name-using-172.30.92.119.-set-the-servername-directive-globally-to-suppress-this-message">AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 172.30.92.119. Set the 'ServerName' directive globally to suppress this message</h4>
<p>Apache uses the ServerName directive to map incoming HTTP requests to an IP address or DNS hostname using VirtualHost directives in order to handle requests for multiple sites using a single server. The error message notes that a global ServerName directive should also be set. Doing so will ensure that Apache can gracefully handle incoming requests that do not map to a VirtualHost without generating additional errors.</p>
<p>For maximum compatibility with various Apache configurations, use the value of 127.0.0.1 for your global ServerName directive. You can use a different IP address or DNS name that corresponds to your serverâs configuration if you need to, but it is safest to use 127.0.0.1.</p>
<p>Open the <strong>/etc/apache2/apache2.conf</strong> file using vim. </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>apache2/apache2.conf</span><br></pre></td></tr></tbody></table></figure> And add the following line to the end of the file. <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">. . .</span><br><span class="line"># Include the virtual host configurations:</span><br><span class="line">IncludeOptional sites-enabled/*.<span class="keyword">conf</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">vim</span>: <span class="keyword">syntax</span>=apache <span class="keyword">ts</span>=<span class="number">4</span> <span class="keyword">sw</span>=<span class="number">4</span> <span class="keyword">sts</span>=<span class="number">4</span> sr noet</span><br><span class="line">ServerName <span class="number">127.0</span>.<span class="number">0.1</span></span><br></pre></td></tr></tbody></table></figure> Then restart apache and the <strong>AH00558</strong> error will disappear.<p></p>
<h4 id="authentication-credentials-were-not-provided.">Authentication credentials were not provided.</h4>
<p>The token authentication works well when I run django project using <strong>python manage.py runserver 0.0.0.0:8080</strong>. I met this error when running django project using apache2. Obviously, this error is a privilege problem. Since I deploy django using wsgi module, I can enable <strong>WSGIPassAuthorization</strong> to solve this problem. Open the site configuration file using vim. </p><figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>apache2<span class="regexp">/sites-enabled/</span><span class="number">000</span>-<span class="keyword">default</span>.conf</span><br></pre></td></tr></tbody></table></figure> And put the following line to the file. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">WSGIPassAuthorization</span> <span class="literal">On</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Ubuntu</category>
        <category>PostgreSQL</category>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Django</tag>
        <tag>Apache</tag>
        <tag>PostgreSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Basic Usage of PostgreSQL</title>
    <url>/2023/02/11/Basic-Usage-of-PostgreSQL/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://www.postgresql.org/">PostgreSQL</a> is a powerful, open source object-relational database system with over 35 years of active development that has earned it a strong reputation for reliability, feature robustness, and performance. Here I will introduce some basic commands of PostgreSQL <span id="more"></span> ## Default User PostgreSQL creates a default user named <strong>postgres</strong> for you after installation. The default user has full access to PostgreSQL's database, including creating a new database, reading data from a database, and updating data into a database. ### Reset Password If we want to use PostgreSQL in Django applications, the password is required. However, the default user <strong>postgres</strong> doesn't have a password and we must set password for <strong>postgres</strong>. </p><figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">sudo -u postgres psql</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> postgres <span class="keyword">WITH</span> <span class="keyword">PASSWORD</span> <span class="string">'12345678'</span>;</span><br><span class="line">\q</span><br><span class="line">service postgresql <span class="keyword">restart</span> / systemctl <span class="keyword">restart</span> postgresql</span><br></pre></td></tr></tbody></table></figure> ## Basic Command * Check status <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">service postgresql status</span></span><br></pre></td></tr></tbody></table></figure> * Start psql with user postgres <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo -u postgres psql</span></span><br></pre></td></tr></tbody></table></figure> * Create Database <figure class="highlight n1ql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> servo;</span><br></pre></td></tr></tbody></table></figure> * List Databases <figure class="highlight livescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">\l</span></span><br></pre></td></tr></tbody></table></figure> * List Users <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">\<span class="built_in">du</span></span><br></pre></td></tr></tbody></table></figure> * Connect to database <figure class="highlight livescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">\c</span> servo</span><br></pre></td></tr></tbody></table></figure> * List tables <figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">\<span class="selector-tag">dt</span></span><br></pre></td></tr></tbody></table></figure> * Quit <figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">\<span class="selector-tag">q</span></span><br></pre></td></tr></tbody></table></figure> * Show data <figure class="highlight axapta"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> xxx_table</span><br></pre></td></tr></tbody></table></figure> * Show data directory <figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">show data_directory<span class="comment">;</span></span><br></pre></td></tr></tbody></table></figure> ## Backup &amp; Restore ### Backup <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">sudo -u postgres pg_dump -Fc servo &gt; servo.bak</span><br></pre></td></tr></tbody></table></figure> ### Restore <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">sudo -u postgres pg_restore -Fc -d servo &lt; /var/lib/postgresql/servo.bak</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>PostgreSQL</category>
        <category>Django</category>
      </categories>
      <tags>
        <tag>PostgreSQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Expose Local Devices Behind A NAT To The Internet Using frp</title>
    <url>/2023/02/15/Expose-Local-Devices-Behind-A-NAT-To-The-Internet-Using-FRP/</url>
    <content><![CDATA[<html><head></head><body><p>Nowadays, there are lots of intelligent devices at home, such as a personal web server or a NAS. It is quite convenient if we can visit these devices anywhere and anytime. However, the home network provides by broadband providers is usually in a local network and doesn't have a public IP. Therefore, it is difficult to visit the device at home. <a href="https://github.com/fatedier/frp"><strong>frp</strong></a> is a reverse proxy that can penetrate the broadband providers' local network and make the devices at home available on the Internet. I will teach you how to deploy a reverse proxy using <strong>frp</strong> step by step. Note that you must have a server with a public IP available on the Internet. <span id="more"></span> ### Installation #### Confirm Machine Architecture Open a terminal and check the machine architecture of your server using <strong>arch</strong> command. </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">arch</span></span><br></pre></td></tr></tbody></table></figure> If the result is <strong>x86_64</strong>, we can download <strong>amd64</strong> version of <strong>frp</strong>. #### Download Go the release page of <strong>frp</strong> on GitHub and download the latest release. The os of my server is Ubuntu 18.04, thus I download <strong>frp_0.47.0_linux_amd64.tar.gz </strong> using the following command. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/fatedier/</span>frp<span class="regexp">/releases/</span>download<span class="regexp">/v0.47.0/</span>frp_0.<span class="number">47.0</span>_linux_amd64.tar.gz</span><br></pre></td></tr></tbody></table></figure> After download, mv the file to the root dir <strong>"/"</strong>, which is more convenient to run it. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">mv</span> frp_0.<span class="number">47</span>.<span class="number">0</span>_linux_amd64.tar.gz ~/..</span><br></pre></td></tr></tbody></table></figure> #### Installation The files we download contains the execution and configuration files of <strong>frp</strong> well complied and built using the source code. Unzip them using the following command. <figure class="highlight jboss-cli"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span></span><br><span class="line"><span class="keyword">cd</span> <span class="string">..</span></span><br><span class="line">tar -zxvf frp_0.47.0_linux_amd64.tar.gz</span><br></pre></td></tr></tbody></table></figure> And delete the compressed file. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">rm</span> frp_0.<span class="number">47</span>.<span class="number">0</span>_linux_amd64.tar.gz</span><br></pre></td></tr></tbody></table></figure> ### Server Configuration Go to the directory and show the files. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">cd</span> frp_0.<span class="number">47</span>.<span class="number">0</span>_linux_amd64</span><br><span class="line"><span class="attribute">ls</span></span><br></pre></td></tr></tbody></table></figure> You will see the following files. <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">âââ frpc</span><br><span class="line">âââ frpc_full<span class="selector-class">.ini</span></span><br><span class="line">âââ frpc<span class="selector-class">.ini</span></span><br><span class="line">âââ frps</span><br><span class="line">âââ frps_full<span class="selector-class">.ini</span></span><br><span class="line">âââ frps<span class="selector-class">.ini</span></span><br><span class="line">âââ LICENSE</span><br></pre></td></tr></tbody></table></figure> <strong>frps</strong> and <strong>frps.ini</strong> are the execution and configuration files for server and <strong>frpc</strong> and <strong>frpc.ini</strong> are the files for client. Open <strong>frps.ini</strong> using vim and modify it as follows. <figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">vi</span> frps.ini</span><br></pre></td></tr></tbody></table></figure><p></p>
<figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">token</span> = <span class="number">12345678</span></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin</span><br><span class="line"><span class="attr">dashboard_pwd</span> = <span class="number">12345678</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">10080</span></span><br><span class="line"><span class="attr">vhost_https_port</span> = <span class="number">10443</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><strong>bind_port</strong> set the port used by frps on the server</li>
<li><strong>token</strong> is used by frpc to verify the connection</li>
<li><strong>dashboard</strong> let us check the status of the frps using port 7500.</li>
</ul>
<p>Run the server and test the configuration by the following command. </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">./frps -c frps.ini</span><br></pre></td></tr></tbody></table></figure> If we see the following log, congratulations, the <strong>frps</strong> is deployed successfully. <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">2023</span><span class="regexp">/02/</span><span class="number">13</span> <span class="number">23</span>:<span class="number">54</span>:<span class="number">24</span> [I] [root.go:<span class="number">206</span>] frps uses config <span class="keyword">file</span>: frps.ini</span><br><span class="line"><span class="number">2023</span><span class="regexp">/02/</span><span class="number">13</span> <span class="number">23</span>:<span class="number">54</span>:<span class="number">24</span> [I] [service.go:<span class="number">200</span>] frps tcp listen on <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">7000</span></span><br><span class="line"><span class="number">2023</span><span class="regexp">/02/</span><span class="number">13</span> <span class="number">23</span>:<span class="number">54</span>:<span class="number">24</span> [I] [service.go:<span class="number">261</span>] http service listen on <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">10080</span></span><br><span class="line"><span class="number">2023</span><span class="regexp">/02/</span><span class="number">13</span> <span class="number">23</span>:<span class="number">54</span>:<span class="number">24</span> [I] [service.go:<span class="number">276</span>] https service listen on <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">10443</span></span><br><span class="line"><span class="number">2023</span><span class="regexp">/02/</span><span class="number">13</span> <span class="number">23</span>:<span class="number">54</span>:<span class="number">24</span> [I] [service.go:<span class="number">317</span>] Dashboard listen on <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">7500</span></span><br><span class="line"><span class="number">2023</span><span class="regexp">/02/</span><span class="number">13</span> <span class="number">23</span>:<span class="number">54</span>:<span class="number">24</span> [I] [root.go:<span class="number">215</span>] frps started successfully</span><br></pre></td></tr></tbody></table></figure> You can check the status of <strong>frps</strong> via "http://127.0.0.1:7500". If we close the ssh connection or terminal, <strong>frps</strong> will stop. <strong>nohup</strong> command can help to make frps run continually in the background ignoring hangup signals. <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">nohup</span> ./frps -c frps.ini &amp;</span><br></pre></td></tr></tbody></table></figure> ### Client Configuration Put <strong>frpc</strong> and <strong>frpc.ini</strong> on the client. Edit <strong>frpc.ini</strong> as follows. <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">token</span> = <span class="number">11232035</span></span><br><span class="line"><span class="attr">log_file</span> = /dev/null</span><br><span class="line"><span class="attr">log_level</span> = info</span><br><span class="line"><span class="attr">log_max_days</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">tcp_mux</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">protocol</span> = tcp</span><br><span class="line"><span class="attr">login_fail_exit</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">user</span> = RT-AC86U</span><br></pre></td></tr></tbody></table></figure> * <strong>server_addr</strong> is the public IP of your server * <strong>server_port</strong> is bind_port we set in frps.ini, the client will send data to the server's bind port. * <strong>token</strong> is the token we set in frps.ini, which is used for authentication * <strong>log</strong> lines configure the log directory and log level and days to keep. * <strong>tcp</strong> lines configure the connection between the server and client is tcp. After the general <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">[router]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">7080</span></span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[git]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">10.10</span>.<span class="number">10.10</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">30000</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">30000</span></span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[git-ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">10.10</span>.<span class="number">10.10</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">30001</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">30001</span></span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>frp</category>
      </categories>
      <tags>
        <tag>frp</tag>
      </tags>
  </entry>
  <entry>
    <title>Set Up Jupyter Lab on Ubuntu 22.04</title>
    <url>/2023/02/19/Set-Up-Jupyter-Notebook-on-Ubuntu-18-04/</url>
    <content><![CDATA[<html><head></head><body><p><a href="http://jupyter.org/">Jupyter Lab</a> is an open-source web application that lets you create and share interactive code, visualizations, and more. This tool can be used with several programming languages, including Python, Julia, R, Haskell, and Ruby. It is often used for working with data, statistical modeling, and machine learning.</p>
<p>This tutorial will walk you through setting up Jupyter Notebook to run from an Ubuntu 18.04 server, as well as teach you how to connect to and use the Notebook. Jupyter Notebooks (or simply Notebooks) are documents produced by the Jupyter Notebook app which contain both computer code and rich text elements (paragraph, equations, figures, links, etc.) which aid in presenting and sharing reproducible research. In the final step of this guide, you will run Python 3 code using a Jupyter Notebook running on a remote server. <span id="more"></span> ### Installation Please make sure python3 and pip3 are installed. If not, install them using the following command. </p><figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt <span class="keyword">update</span></span><br><span class="line">sudo apt install <span class="keyword">python3</span>-pip <span class="keyword">python3</span>-dev</span><br></pre></td></tr></tbody></table></figure> <del>Then install jupyter notebook using pip3.</del> <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> notebook</span><br></pre></td></tr></tbody></table></figure> Then install jupyter lab using pip3. <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> jupyterlab</span><br></pre></td></tr></tbody></table></figure> Update PATH environment variable. <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=/home/robot/.local/bin${PATH:+:${PATH}}'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></tbody></table></figure> After installation, check the version of jupyter. <figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">jupyter <span class="comment">--version</span></span><br></pre></td></tr></tbody></table></figure> If you see the following result, the jupyter notebook is installed successfully. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">Selected</span> Jupyter core packages...</span><br><span class="line"><span class="attribute">IPython</span>          : <span class="number">7</span>.<span class="number">16</span>.<span class="number">3</span></span><br><span class="line"><span class="attribute">ipykernel</span>        : <span class="number">5</span>.<span class="number">5</span>.<span class="number">6</span></span><br><span class="line"><span class="attribute">ipywidgets</span>       : not installed</span><br><span class="line"><span class="attribute">jupyter_client</span>   : <span class="number">7</span>.<span class="number">1</span>.<span class="number">2</span></span><br><span class="line"><span class="attribute">jupyter_core</span>     : <span class="number">4</span>.<span class="number">9</span>.<span class="number">2</span></span><br><span class="line"><span class="attribute">jupyter_server</span>   : not installed</span><br><span class="line"><span class="attribute">jupyterlab</span>       : not installed</span><br><span class="line"><span class="attribute">nbclient</span>         : <span class="number">0</span>.<span class="number">5</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">nbconvert</span>        : <span class="number">6</span>.<span class="number">0</span>.<span class="number">7</span></span><br><span class="line"><span class="attribute">nbformat</span>         : <span class="number">5</span>.<span class="number">1</span>.<span class="number">3</span></span><br><span class="line"><span class="attribute">notebook</span>         : <span class="number">6</span>.<span class="number">4</span>.<span class="number">10</span></span><br><span class="line"><span class="attribute">qtconsole</span>        : not installed</span><br><span class="line"><span class="attribute">traitlets</span>        : <span class="number">4</span>.<span class="number">3</span>.<span class="number">3</span></span><br></pre></td></tr></tbody></table></figure> ### Set Password jupyter notebook needs a password to login before use it. We can generate a password using the <strong>passwd()</strong> function jupyter provide. First, open a python shell by <strong>python</strong> command in terminal. Then generate a password by the following command. <figure class="highlight angelscript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> notebook.auth <span class="keyword">import</span> passwd;</span><br><span class="line">passwd()</span><br></pre></td></tr></tbody></table></figure> Input a password and it will generate a token for this password. Please keep this token and we will use it later to configure jupyter. ### Configuration Before using jupyter notebook, we had better set some configurations for it. Using the following command to generate a configuration file. <figure class="highlight verilog"><table><tbody><tr><td class="code"><pre><span class="line">jupyter notebook --<span class="keyword">generate</span>-<span class="keyword">config</span></span><br></pre></td></tr></tbody></table></figure> A configuration file named <strong>jupyter_notebook_config.py</strong> is created in directory <strong>~/.jupyter</strong>. Open and edit this file. <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">vi</span> .jupyter/jupyter_notebook_config.<span class="keyword">py</span></span><br></pre></td></tr></tbody></table></figure> There are lots of configurations and what I set is as follows: <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">## Whether to allow the user to run the notebook as root. If you do not install jupyter in a virtual env, please set this option as True.</span></span><br><span class="line"><span class="attr">c.NotebookApp.allow_root</span> = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## The IP address the notebook server will listen on. '*' means any IP.</span></span><br><span class="line"><span class="attr">c.NotebookApp.ip</span> = <span class="string">'*'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## The directory to use for notebooks and kernels. Please do not use full path, jupyter will add the default path prefix automatically.</span></span><br><span class="line"><span class="attr">c.NotebookApp.notebook_dir</span> = <span class="string">'gits/jupyter/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Whether to open in a browser after starting. The specific browser used is</span></span><br><span class="line"><span class="comment">#  platform dependent and determined by the python standard library `webbrowser`</span></span><br><span class="line"><span class="comment">#  module, unless it is overridden using the --browser (NotebookApp.browser)</span></span><br><span class="line"><span class="comment">#  configuration option.</span></span><br><span class="line"><span class="attr">c.NotebookApp.open_browser</span> = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##  The string should be of the form type:salt:hashed-password. Copy the token generated by passwd().</span></span><br><span class="line"><span class="attr">c.NotebookApp.password</span> = <span class="string">'argon2:$argon2id$v=19$m=10240,t=10,p=8$x/wZxj7yQsoUagjuidgnaiudgiu9adniaunaneianngda'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## The port the notebook server will listen on (env: JUPYTER_PORT).</span></span><br><span class="line"><span class="attr">c.NotebookApp.port</span> = <span class="number">8888</span></span><br></pre></td></tr></tbody></table></figure> Then we can run jupyter notebook by executing the following command: <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">jupyter notebook</span></span><br></pre></td></tr></tbody></table></figure> The port number used in jupyter is 8888, then we can visit jupyter notebook via http://127.0.0.1:8888. Password is required when visit the page for first time, and we can input the password created by the former step. Please make sure the 8888 port is allowed by firewall. If not allowed, use the following command to set it. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> ufw <span class="literal">allow</span> <span class="number">8888</span></span><br></pre></td></tr></tbody></table></figure> ### Run Service If we start jupyter notebook by command <strong>jupyter notebook</strong>, it will close when the terminal is close. Usually, we want jupyter notebook to keep running, thus we can use it whenever we need. We can make jupyter as a system service. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo vi <span class="regexp">/lib/</span>systemd<span class="regexp">/system/</span>jupyter.service</span><br></pre></td></tr></tbody></table></figure> Edit this file as follows. <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="comment"># A short description about the service</span></span><br><span class="line"><span class="attr">Description</span>=Juyper-NoteBook</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="comment"># Use simple run type and define the PIDFile</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">PIDFile</span>=/run/jupyter.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># The start command</span></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/jupyter-notebook</span><br><span class="line"><span class="comment"># The stop command</span></span><br><span class="line"><span class="attr">ExecStop</span>=/usr/bin/pkill jupyter-notebook</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set always restart when fail.</span></span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="comment"># The time wait for before restart</span></span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">30</span>s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set user name</span></span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="comment"># Set group name</span></span><br><span class="line"><span class="attr">Group</span>=root</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/root</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="comment"># Set Target</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></tbody></table></figure> Start jupyter service by the following commands. <figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">sudo <span class="params">system</span>ctl daemon-reload</span><br><span class="line">sudo <span class="params">system</span>ctl enable jupyter</span><br><span class="line">sudo <span class="params">system</span>ctl start jupyter</span><br></pre></td></tr></tbody></table></figure> We can also check the running status of jupyter service if there is anything wrong during start. <figure class="highlight fortran"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="keyword">status</span> jupyter.service</span><br></pre></td></tr></tbody></table></figure> ### Extensions <a href="https://github.com/ipython-contrib/jupyter_contrib_nbextensions"><strong>jupyter_contrib_nbextensions</strong></a> helps to manage a collect of extensions that can add functionality to jupyter notebook, which make it easier to use. <figure class="highlight mipsasm"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install </span><span class="keyword">jupyter_contrib_nbextensions</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">jupyter </span>contrib nbextension <span class="keyword">install </span>--user</span><br><span class="line">pip <span class="keyword">install </span><span class="keyword">jupyter_nbextensions_configurator</span></span><br><span class="line"><span class="keyword"></span><span class="keyword">jupyter </span>nbextensions_configurator enable --user</span><br><span class="line">systemctl restart <span class="keyword">jupyter</span></span><br></pre></td></tr></tbody></table></figure> Then we can configure notebooks's functions via the web page. Install autopep8, if we want use it in notebook. <figure class="highlight angelscript"><table><tbody><tr><td class="code"><pre><span class="line">pip install <span class="built_in">auto</span>pep8</span><br></pre></td></tr></tbody></table></figure> ### Problems &amp; Solutions #### Content Security Policy: Refused to frame 'http://www.zhaoyongsheng.com:8888/' because an ancestor violates the following Content Security Policy directive: "frame-ancestors 'self'". Domain masking also knows as URL Masking. It is the act of hiding the actual domain name of a website from the userâs web browser and showing another domain name. We can user url masking to allocate a domain name for jupyter notebook instead of visiting it via a specific port. For example, if we deploy jupyter notebook on http://www.somesite.com:8888, then we can allocate a second class domain name, such as http://jupyter.somesite.com. For secure reasons, jupyter notebook refuse this kind of url masking by default. Thus we will meet this error because the url masked frame ancestor is unknown. Here is the solution. Open jupyter notebook's config file using vim. <figure class="highlight arcade"><table><tbody><tr><td class="code"><pre><span class="line">vi ~<span class="regexp">/.jupyter/</span>jupyter_notebook_config.py</span><br></pre></td></tr></tbody></table></figure> And edit tornado settings as follows, which <strong>http://jupoyter.somesite.com</strong> is the url we used to mask the original url. <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">c.NotebookApp.tornado_settings</span> = { <span class="string">'headers'</span>: { <span class="string">'Content-Security-Policy'</span>: <span class="string">"frame-ancestors 'self' http://jupyter.somesite.com"</span> } }</span><br></pre></td></tr></tbody></table></figure> After configuration, restart jupyter service.<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Jupyter Notebook</category>
        <category>Jupyter Lab</category>
      </categories>
      <tags>
        <tag>Jupyter Notebook</tag>
        <tag>Jupyter Lab</tag>
      </tags>
  </entry>
  <entry>
    <title>Solution For node&#39;s Warning: Accessing non-existent property &#39;column&#39; of module exports inside circular dependency</title>
    <url>/2023/02/19/Solution-For-npm-s-Warning-Accessing-non-existent-property-column-of-module-exports-inside-circular-dependency/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://docs.npmjs.com/about-npm"><strong>npm</strong></a> is the world's largest software registry, which can help to share and manage packages. <a href="https://blog.zhaoyongsheng.com/2019/12/01/Build-and-Deploy-Your-Personal-Blog-Using-Hexo-NexT-and-GitHub/">Hexo</a> uses <strong>npm</strong> to install and upgrade its dependency packages. When the version of <strong>node</strong> is 14 or latter, you probably meets this annoying warning "Warning: Accessing non-existent property 'column' of module exports inside circular dependency". Here I will show you how to solve this problem using the method that verified by myself. <span id="more"></span> ## Problem When we use <strong>Hexo</strong> command lines, there are some annoying warnings. </p><figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">(<span class="keyword">node</span><span class="title">:82677</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'lineno' of module exports inside circular dependency</span><br><span class="line">(Use `<span class="keyword">node</span> <span class="title">--trace-warnings</span> ...` to show where the warning was created)</span><br><span class="line">(<span class="keyword">node</span><span class="title">:82677</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'column' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:82677</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'filename' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:82677</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'lineno' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:82677</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'column' of module exports inside circular dependency</span><br><span class="line">(<span class="keyword">node</span><span class="title">:82677</span>) Warning: Accessing non-existent <span class="keyword">property</span><span class="title"> </span>'filename' of module exports inside circular dependency</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> As said by <a href="https://github.com/hexojs/hexo/issues/4257">Hexo Issue 4257</a>, these warnings are because the <strong>node</strong>'s version is 14 and there are compatible issues in package <strong>stylus</strong>. There is one recommend solution is that downgrade your node to 12 to avoid this annoying warning. Since I don't want to use the lower version of <strong>Node</strong>, I didn't try this method.<p></p>
<p>Some posts in <a href="https://github.com/stylus/stylus/issues/2534">Stylus Issue 2534</a> said that this problem is fixed by stylus@0.54.8. I have installed <strong>stylus 0.54.8</strong> or even <strong>0.59.0</strong> by force, but these warnings still exit. It seems that the problem I met is different and can't solved by upgrade <strong>stylus</strong> to <strong>0.54.8</strong> or latter. ## Solution With <strong>trace-warnings</strong> option, we can trace the detail info about these warnings. </p><figure class="highlight verilog"><table><tbody><tr><td class="code"><pre><span class="line">npx <span class="keyword">cross</span>-env NODE_OPTIONS=<span class="string">"--trace-warnings"</span> hexo <span class="keyword">generate</span></span><br></pre></td></tr></tbody></table></figure> The log shows that these warnings is generate by <strong>stylus</strong>. ### Dependency of <strong>stylus</strong> Using the following command to show the dependency of <strong>stylus</strong>. <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm <span class="built_in">ls</span> stylus </span><br></pre></td></tr></tbody></table></figure> We will see the result. <figure class="highlight mel"><table><tbody><tr><td class="code"><pre><span class="line">hexo-site@0<span class="number">.0</span><span class="number">.0</span> /Gits/blog-github</span><br><span class="line">âââ¬ hexo-<span class="keyword">renderer</span>-stylus@0<span class="number">.2</span><span class="number">.3</span></span><br><span class="line">â âââ¬ nib@1<span class="number">.2</span><span class="number">.0</span></span><br><span class="line">â â âââ stylus@0<span class="number">.59</span><span class="number">.0</span> deduped</span><br><span class="line">â âââ stylus@0<span class="number">.50</span><span class="number">.0</span></span><br><span class="line">âââ¬ stylus-native-loader@1<span class="number">.4</span><span class="number">.9</span></span><br><span class="line">â âââ stylus@0<span class="number">.59</span><span class="number">.0</span> deduped</span><br><span class="line">âââ stylus@0<span class="number">.59</span><span class="number">.0</span></span><br></pre></td></tr></tbody></table></figure> As we can see, the <strong>hexo-site@0.0.0</strong> depends on <strong>hexo-renderer-stylus@0.2.3</strong> and <strong>hexo-renderer-stylus@0.2.3</strong> depends on <strong>stylus@0.50.0</strong>. These warnings are fixed by <strong>stylus@0.54.8</strong> or later. ### Update package.json of <strong>hexo-renderer-stylus</strong> Let <strong>hexo-renderer-stylus</strong> use <strong>stylus@0.54.8</strong> or later may fix this issue. Open package.json. <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">vi node_modules<span class="regexp">/hexo-renderer-stylus/</span><span class="keyword">package</span>.json</span><br></pre></td></tr></tbody></table></figure> And update the dependency of stylus. <figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">"dependencies"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"minimatch"</span><span class="punctuation">:</span> <span class="string">"^3.0.2"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"nib"</span><span class="punctuation">:</span> <span class="string">"^1.1.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"stylus"</span><span class="punctuation">:</span> <span class="string">"^0.54.8"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br></pre></td></tr></tbody></table></figure> Finally, install the dependency. <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span></span><br></pre></td></tr></tbody></table></figure> After installation, we try <strong>Hexo</strong> command line to test these warnings are shown or not. If they are not shown anymore, congratulations, you fix this issue successfully.<p></p>
<h3 id="another-solution">Another Solution</h3>
<p>The reason that <strong>hexo-renderer-stylus</strong> depends <strong>stylus@0.50.0</strong> is <strong>hexo-renderer-stylus</strong>'s version is too low to use higher version of <strong>stylus</strong>. Thus the solution is to upgrade <strong>hexo-renderer-stylus</strong> to latest version. First, check the latest version using the following command. </p><figure class="highlight coffeescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> view hexo-renderer-stylus versions</span><br></pre></td></tr></tbody></table></figure> All the available versions will be printed. <figure class="highlight scheme"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="symbol">'0.0.1</span>', <span class="symbol">'0.0.2</span>',</span><br><span class="line">  <span class="symbol">'0.1.0</span>', <span class="symbol">'0.2.1</span>',</span><br><span class="line">  <span class="symbol">'0.2.2</span>', <span class="symbol">'0.2.3</span>',</span><br><span class="line">  <span class="symbol">'0.3.0</span>', <span class="symbol">'0.3.1</span>',</span><br><span class="line">  <span class="symbol">'0.3.3</span>', <span class="symbol">'1.0.0</span>',</span><br><span class="line">  <span class="symbol">'1.1.0</span>', <span class="symbol">'2.0.0</span>',</span><br><span class="line">  <span class="symbol">'2.0.1</span>', <span class="symbol">'2.1.0</span>'</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure> Second, install the latest version using the following command. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">npm</span> install hexo-renderer-stylus@<span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span></span><br></pre></td></tr></tbody></table></figure> Then check the dependency of <strong>stylus</strong>. <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm <span class="built_in">ls</span> stylus</span><br></pre></td></tr></tbody></table></figure> And version of <em>stylus</em> is update to <strong>0.57.0</strong> from <strong>0.50.0</strong> <figure class="highlight mel"><table><tbody><tr><td class="code"><pre><span class="line">hexo-site@0<span class="number">.0</span><span class="number">.0</span> Gits/blog-github</span><br><span class="line">âââ¬ hexo-<span class="keyword">renderer</span>-stylus@2<span class="number">.1</span><span class="number">.0</span></span><br><span class="line">â âââ¬ nib@1<span class="number">.2</span><span class="number">.0</span></span><br><span class="line">â â âââ stylus@0<span class="number">.59</span><span class="number">.0</span> deduped</span><br><span class="line">â âââ stylus@0<span class="number">.57</span><span class="number">.0</span></span><br><span class="line">âââ¬ stylus-native-loader@1<span class="number">.4</span><span class="number">.9</span></span><br><span class="line">â âââ stylus@0<span class="number">.59</span><span class="number">.0</span> deduped</span><br><span class="line">âââ stylus@0<span class="number">.59</span><span class="number">.0</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Hexo</category>
        <category>npm</category>
      </categories>
      <tags>
        <tag>-- Hexo -- npm</tag>
      </tags>
  </entry>
  <entry>
    <title>A Method To Make Git Ignore Take Effect</title>
    <url>/2023/02/20/A-Method-To-Make-Git-Ignore-Take-Effect/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://git-scm.com/">Git</a> is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency. In a git repository, if there are some files or folders that we don't want to handle by git, we can ignore them by setup a <strong>.gitignore</strong> config file. Sometime, git ignore doesn't take effect after we add some files or folders to <strong>.gitignore</strong>, especially when the files or folders we add have already been tracked by git. In this tutorial, I will show you how to fix the problem of git ignore not working. <span id="more"></span> Adding files or folders to <strong>.gitignore</strong> doesn't remove them from git cache. We have to remove them from git cache manually. ### files First, add and commit every changed files. Second, remove the ignore files from git cache using the following command. </p><figure class="highlight delphi"><table><tbody><tr><td class="code"><pre><span class="line">git rm --cached <span class="keyword">file</span>.<span class="keyword">name</span></span><br></pre></td></tr></tbody></table></figure> Third, commit the delete. <figure class="highlight maxima"><table><tbody><tr><td class="code"><pre><span class="line">git commit -m <span class="string">"ignore file.name"</span></span><br><span class="line">git <span class="built_in">push</span> <span class="built_in">origin</span> master</span><br></pre></td></tr></tbody></table></figure> ### folders Steps are similar with ignoring files. But the command that removes folders from git cache is different. <figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">git rm -rf <span class="comment">--cached folder_name</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Git</category>
      </categories>
      <tags>
        <tag>GitÃ</tag>
      </tags>
  </entry>
  <entry>
    <title>Configure Host for SSH</title>
    <url>/2023/02/20/Configure-Host-for-SSH/</url>
    <content><![CDATA[<html><head></head><body><p><strong>SSH</strong> is secure way to login a server. It is difficult to remember the IPs of several servers. In this tutorials, I will teach to setup host of <strong>SSH</strong> to login using hostname instead of IP. <span id="more"></span> ### Create Config File Create a custom ssh config file by the following command. </p><figure class="highlight arcade"><table><tbody><tr><td class="code"><pre><span class="line">vi ~<span class="regexp">/.ssh/</span>config</span><br></pre></td></tr></tbody></table></figure> ### Add Host <figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">Host gitlab.com</span><br><span class="line">    HostName <span class="number">10.10</span>.<span class="number">10.10</span></span><br><span class="line">    <span class="keyword">User</span> <span class="title">git</span></span><br><span class="line">    Port <span class="number">30001</span></span><br><span class="line">    IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></tbody></table></figure> The above host is a ssh connect for git. With this host, we can use <strong>ssh://git@gitlab.com:30001/</strong> to clone and push.<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Git</category>
        <category>SSH</category>
      </categories>
      <tags>
        <tag>SSH</tag>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Basic Usage of Git</title>
    <url>/2023/02/23/Basic-Usage-of-Git/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://git-scm.com/">Git</a> is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency. In this article, I will introduce some useful skills of using git to manage version control. <span id="more"></span> ### Manage Remote Repository #### Add </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">git remote add origin ssh:<span class="regexp">//gi</span>t@gitlab.com:<span class="number">30001</span><span class="regexp">/yongsheng/</span>jupyter.git</span><br></pre></td></tr></tbody></table></figure> The above command will add a remote repository to a git project named <strong>origin</strong>. We can add multiple remote repositories using different names, such <strong>backup</strong>, <strong>test</strong> and so on. #### Change URL <figure class="highlight dsconfig"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">git</span> <span class="string">remote</span> <span class="built_in">set-url</span> <span class="string">origin</span> <span class="string">ssh</span>://<span class="string">git</span>@<span class="string">gitlab</span>.<span class="string">com:30001/</span><span class="string">yongsheng</span>/<span class="string">jupyter</span>.<span class="string">git</span></span><br></pre></td></tr></tbody></table></figure> The <strong>set-url</strong> option can change the url of an existing repository. It takes two parameters, one is the repository's name and the other one is the new url of remote repository. #### Delete <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">git remote <span class="built_in">rm</span> origin</span><br></pre></td></tr></tbody></table></figure> The <strong>rm</strong> option can remove an repository using its name.<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Coding Skills Of SwiftUI For Beginners</title>
    <url>/2023/02/23/Coding-Skills-Of-SwiftUI-For-Beginners/</url>
    <content><![CDATA[<html><head></head><body><p>This article records the problems I met when developing an ios app as a beginner and the corresponding solutions. Besides, there are some useful coding skills that deserve to share with you. If you are a beginner of SwiftUI, I hope this article will help you to learning SwiftUI quickly and easily. <span id="more"></span> ### Errors &amp; Solutions #### [UICalendarView] UICalendarView's height is smaller than it can render its content in; defaulting to the minimum height. This warning seems to be a bug of swiftui. It is because the width of <strong>DatePicker</strong> is larger than the device's width. Therefore solve this warning by the following modifier. </p><figure class="highlight arduino"><table><tbody><tr><td class="code"><pre><span class="line">.<span class="built_in">frame</span>(width: UIScreen.main.bounds.width - <span class="number">20</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>SwiftUI</category>
      </categories>
      <tags>
        <tag>SwiftUI</tag>
        <tag>ios app</tag>
      </tags>
  </entry>
  <entry>
    <title>Basic Usage Of Apache</title>
    <url>/2023/02/25/Basic-Usage-Of-Apache/</url>
    <content><![CDATA[<html><head></head><body><p>This article contains the configuration and command lines of <strong>Apache2</strong>. <span id="more"></span> ### Apache Configuration The config file of apache is <strong>/etc/apache2/apache2.conf</strong>. </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">WSGIPythonPath</span> /django/servo</span><br><span class="line"><span class="attribute">ServerName</span> <span class="number">127.0.0.1</span></span><br><span class="line"><span class="attribute">Header</span> set X-Frame-Options <span class="string">"allow from http://www.demo.com/"</span></span><br></pre></td></tr></tbody></table></figure> * WSGIPythonPath /django/servo -- let apache knows where to load the django project. * ServerName 127.0.0.1 -- local ip is recommended. * Header set X-Frame-Options "allow from http://www.demo.com/" -- allow the page can be embedded in a <strong>frame</strong> from <strong>http://www.demo.com</strong>, undefined frames are forbidden. For more detail information, please visit <a href="https://cloud.tencent.com/developer/section/1190032">X-Frame-Options</a> or <a href="https://help.aliyun.com/document_detail/118166.html">URL Masking</a>. The ports that apache is listening are defined in <strong>/etc/apache2/ports.conf</strong> ### Site Configuration The site configurations are in <strong>/etc/apache2/site-available</strong> and one file is for one site. * Http Site The default port for http host is <strong>80</strong>. <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    # ServerName www.demo.com</span><br><span class="line">    # ServerAlias demo.com</span><br><span class="line">    # ServerAdmin demo.csc@gmail.com</span><br><span class="line"></span><br><span class="line">    WSGIScriptAlias <span class="regexp">/ /</span>django<span class="regexp">/servo/</span>servo/wsgi.py</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line"></span><br><span class="line">    Alias <span class="regexp">/media/</span> <span class="regexp">/django/m</span>edia/</span><br><span class="line">    Alias <span class="regexp">/static/</span> <span class="regexp">/django/</span>servo<span class="regexp">/static/</span></span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/m</span>edia&gt;</span><br><span class="line">         Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/</span>servo/<span class="keyword">static</span>&gt;</span><br><span class="line">         Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    # WSGIDaemonProcess blog python-home=<span class="regexp">/home/</span>sammy<span class="regexp">/myproject/my</span>projectenv python-path=<span class="regexp">/home/</span>sammy/myproject</span><br><span class="line">    # WSGIProcessGroup %{GLOBAL}</span><br><span class="line">    # WSGIDaemonProcess ziqiangxuetang.com python-path=<span class="regexp">/home/</span>tu<span class="regexp">/blog:/</span>home<span class="regexp">/tu/</span>.virtualenvs<span class="regexp">/blog/</span>lib<span class="regexp">/python2.7/</span>site-packages</span><br><span class="line">    # WSGIProcessGroup ziqiangxuetang.com</span><br><span class="line">    # WSGIApplicationGroup %{GLOBAL}</span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/</span>servo/servo&gt;</span><br><span class="line">        &lt;Files wsgi.py&gt;</span><br><span class="line">            Require all granted</span><br><span class="line">        &lt;/Files&gt;</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    ErrorLog ${APACHE_LOG_DIR}/error.log</span><br><span class="line">    CustomLog ${APACHE_LOG_DIR}/access.log combined</span><br><span class="line"></span><br><span class="line">    RewriteEngine on</span><br><span class="line">    RewriteCond   %{HTTPS} !=on </span><br><span class="line">    # Rewrite all urls</span><br><span class="line">    RewriteRule ^(.*)?$ https:<span class="comment">//%{SERVER_NAME}/$1 [R,L]</span></span><br><span class="line"> &lt;/VirtualHost&gt;</span><br></pre></td></tr></tbody></table></figure> * WSGIPassAuthorization On -- make sure token is passed for authorization. * RewriteEngine On -- make sure all http request is rewritten to https request. * <span class="math inline">\(1 -- the content that the regression rule **^(.*)?\)</span>** extracts. * ^(.<em>)?$ -- ignore the http prefix and the domain name </em> SERVER_NAME -- the domain name * Https Site <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">&lt;VirtualHost *:<span class="number">443</span>&gt;</span><br><span class="line">    # ServerName www.demo.com</span><br><span class="line">    # ServerAlias demo.com</span><br><span class="line">    # ServerAdmin demo.csc@gmail.com</span><br><span class="line"></span><br><span class="line">    WSGIScriptAlias <span class="regexp">/ /</span>django<span class="regexp">/servo/</span>servo/wsgi.py</span><br><span class="line">    WSGIPassAuthorization On</span><br><span class="line"></span><br><span class="line">    Alias <span class="regexp">/media/</span> <span class="regexp">/django/m</span>edia/</span><br><span class="line">    Alias <span class="regexp">/static/</span> <span class="regexp">/django/</span>servo<span class="regexp">/static/</span></span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/m</span>edia&gt;</span><br><span class="line">         Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/</span>servo/<span class="keyword">static</span>&gt;</span><br><span class="line">         Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">    # WSGIDaemonProcess blog python-home=<span class="regexp">/home/</span>sammy<span class="regexp">/myproject/my</span>projectenv python-path=<span class="regexp">/home/</span>sammy/myproject</span><br><span class="line">    # WSGIProcessGroup %{GLOBAL}</span><br><span class="line">    # WSGIDaemonProcess ziqiangxuetang.com python-path=<span class="regexp">/home/</span>tu<span class="regexp">/blog:/</span>home<span class="regexp">/tu/</span>.virtualenvs<span class="regexp">/blog/</span>lib<span class="regexp">/python2.7/</span>site-packages</span><br><span class="line">    # WSGIProcessGroup ziqiangxuetang.com</span><br><span class="line">    # WSGIApplicationGroup %{GLOBAL}</span><br><span class="line"></span><br><span class="line">    &lt;Directory <span class="regexp">/django/</span>servo/servo&gt;</span><br><span class="line">            &lt;Files wsgi.py&gt;</span><br><span class="line">                Require all granted</span><br><span class="line">            &lt;/Files&gt;</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">    ErrorLog ${APACHE_LOG_DIR}/error.log</span><br><span class="line">    CustomLog ${APACHE_LOG_DIR}/access.log combined</span><br><span class="line">    SSLEngine on</span><br><span class="line">    # SSLCertificateFile directive is needed.</span><br><span class="line">    SSLCertificateFile    <span class="regexp">/path/</span>to<span class="regexp">/ssl/</span><span class="number">1234567</span>_www.demo.com_public.crt</span><br><span class="line">    SSLCertificateKeyFile <span class="regexp">/path/</span>to<span class="regexp">/ssl/</span><span class="number">1234567</span>_www.demo.com.key</span><br><span class="line"> &lt;/VirtualHost&gt;</span><br></pre></td></tr></tbody></table></figure> * SSLEngine on -- Open SSL for Https, all we need is providing the <strong>SSLCertificateFile</strong> and the <strong>SSLCertificateKeyFile</strong> ### Command Lines #### Enable Module <figure class="highlight coq"><table><tbody><tr><td class="code"><pre><span class="line">a2enmod <span class="built_in">rewrite</span></span><br><span class="line">a2enmod header</span><br><span class="line">a2enmod ssl</span><br></pre></td></tr></tbody></table></figure> #### Enable Site <figure class="highlight actionscript"><table><tbody><tr><td class="code"><pre><span class="line">a2ensite <span class="number">001</span>-<span class="keyword">default</span></span><br></pre></td></tr></tbody></table></figure> The site is defined in <strong>/etc/apache2/site_available</strong> with name <strong>001-default.conf</strong>. ### Problems &amp; Solutions #### Invalid command 'Header', perhaps misspelled or defined by a module not included in the server configuration The solution is enable <strong>header</strong> module. <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line"># Enabling <span class="keyword">module</span> headers.</span><br><span class="line">a2enmod headers</span><br><span class="line">service apache2 restart</span><br></pre></td></tr></tbody></table></figure> Test <strong>header</strong> module. <figure class="highlight 1c"><table><tbody><tr><td class="code"><pre><span class="line">apachectl -M <span class="string">| grep head</span></span><br><span class="line">headers_module (shared)</span><br><span class="line">Syntax OK</span><br></pre></td></tr></tbody></table></figure> #### Invalid command 'ProxyPass', perhaps misspelled or defined by a module not included in the server configuration <strong>ProxyPass</strong> directive is defined in module <strong>proxy_http</strong>. We have to enable this module before using <strong>ProxyPass</strong> <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line"># Enabling <span class="keyword">module</span> headers.</span><br><span class="line">a2enmod proxy_http</span><br></pre></td></tr></tbody></table></figure> #### SSL Certificate Not Trusted If the certificate is indeed signed by a trusted certificate authority (CA) and is not expired then such warning indicates the possibility that one of the intermediate/chain certificates is not installed on the web server in between the primary and root certificate. Add the following configuration to solve this problem. <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">SSLCertificateChainFile <span class="regexp">/django/</span>servo<span class="regexp">/ssl/</span><span class="number">9123456</span>_www.example.com_chain.crt</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Apache</category>
      </categories>
      <tags>
        <tag>Apache</tag>
      </tags>
  </entry>
  <entry>
    <title>Deploy Gitlab Using Docker On Synology DS218+</title>
    <url>/2023/02/25/Deploy-Gitlab-Using-Docker-On-Synology-DS218/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://about.gitlab.com/">Gitlab</a> is a perfect software that we can use to build a personal git repository manage system on local servers. In this article, I will deploy a gitlab using docker on synology DS218+ step by step. <span id="more"></span> ### Install Gitlab #### Install Docker Docker is supported by a series of synology nas hardwares. We can install docker in suite center. #### Download Gitlab Image Open docker and search <strong>gitlab</strong> in registration tab page. You can download the latest release or the release that has the most downloads. I choose <em>gitlab-ce</em> that has the most downloads, which is more stable. #### Install &amp; Config Gitlab Double click the downloaded image to install it. Input the name of the docker, for example, <strong>gitlab-ce</strong>. And click the button <strong>Advanced Settings</strong>. ##### Directory In the volume tab, we build and configure three directories for gitlab to store logs, configurations and data correspondingly. </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">docker<span class="regexp">/gitlab/</span>logs -&gt; <span class="regexp">/var/</span>log/gitlab</span><br><span class="line">docker<span class="regexp">/gitlab/</span>config -&gt; <span class="regexp">/etc/gi</span>tlab</span><br><span class="line">docker<span class="regexp">/gitlab/</span>data -&gt; <span class="regexp">/var/</span>opt/gitlab</span><br></pre></td></tr></tbody></table></figure> ##### Port We need set the http, https and ssh port map for serving gitlab. The default ports of http, https on docker are 80, 443 and 22. These three ports are reserved in synology nas and we had better use other ports instead. Here I use 30000 to map 80, 30001 to map 22. Finish the above steps, we can run this docker. A few minutes latter, we can visit gitlab via "http://192.168.1.2:30000", where "192.168.1.2" is the ip of synology nas. ### Customize Gitlab We can further customize gitlab for better performance. #### external_url <strong>external_url</strong> defines the http url of gitlab. <figure class="highlight 1c"><table><tbody><tr><td class="code"><pre><span class="line">external_url 'http://192.168.1.2:<span class="number">3000</span>0'</span><br></pre></td></tr></tbody></table></figure> #### ssh host name and port The default ssh host name is the ip address, which is difficult to use. We can custom the ssh host name using a domain name such as <strong>gitlab.com</strong> <figure class="highlight prolog"><table><tbody><tr><td class="code"><pre><span class="line">gitlab_rails[<span class="string">'gitlab_ssh_host'</span>] = <span class="string">'gitlab.com'</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_shell_ssh_port'</span>] = <span class="number">30001</span></span><br></pre></td></tr></tbody></table></figure> The remote url of a repository become "ssh://git@gitlab.com:30001/yongsheng/jupyter.git", which is more readable. #### close email service It is better to close email function if the gitlab is a personal one to achieve a better performance. <figure class="highlight actionscript"><table><tbody><tr><td class="code"><pre><span class="line">gitlab_rails[<span class="string">'smtp_enable'</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_rails[<span class="string">'gitlab_email_enabled'</span>] = <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure> #### content_security_policy Set frame ancestors for url masking. Thus we can visit gitlab by the masked url, for example, "http://gitlab.demo.com" <figure class="highlight sml"><table><tbody><tr><td class="code"><pre><span class="line">gitlab_rails[<span class="symbol">'content_security_policy'</span>] = {</span><br><span class="line"> <span class="symbol">'enabled'</span> =&gt; <span class="literal">true</span>,</span><br><span class="line"> <span class="symbol">'report_only'</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"># <span class="type">Each</span> directive is a <span class="type">String</span> (e.g. <span class="string">"'self'"</span>).</span><br><span class="line"> <span class="symbol">'directives'</span> =&gt; {</span><br><span class="line">   <span class="symbol">'base_uri'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'child_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'connect_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'default_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'font_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'form_action'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'frame_ancestors'</span> =&gt; <span class="string">"gitlab.demo.com"</span>,</span><br><span class="line">   <span class="symbol">'frame_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'img_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'manifest_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'media_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'object_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'script_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'style_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'worker_src'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line">   <span class="symbol">'report_uri'</span> =&gt; <span class="literal">nil</span>,</span><br><span class="line"> }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> #### better performance Close the functions that are rarely use. <figure class="highlight prolog"><table><tbody><tr><td class="code"><pre><span class="line">gitlab_rails[<span class="string">'terraform_state_enabled'</span>] = false</span><br><span class="line">gitlab_rails[<span class="string">'usage_ping_enabled'</span>] = false</span><br><span class="line">gitlab_rails[<span class="string">'registry_enabled'</span>] = false</span><br><span class="line">registry[<span class="string">'enable'</span>] = false</span><br><span class="line">sidekiq[<span class="string">'metrics_enabled'</span>] = false</span><br><span class="line">gitlab_ci[<span class="string">'gitlab_ci_all_broken_builds'</span>] = false</span><br><span class="line">gitlab_rails[<span class="string">'gitlab_kas_enabled'</span>] = false</span><br><span class="line">gitlab_kas[<span class="string">'enable'</span>] = false</span><br><span class="line">mattermost[<span class="string">'enable'</span>] = false</span><br><span class="line">prometheus[<span class="string">'enable'</span>] = false</span><br><span class="line">alertmanager[<span class="string">'enable'</span>] = false</span><br><span class="line">node_exporter[<span class="string">'enable'</span>] = false</span><br><span class="line">redis_exporter[<span class="string">'enable'</span>] = false</span><br><span class="line">postgres_exporter[<span class="string">'enable'</span>] = false</span><br><span class="line">gitlab_exporter[<span class="string">'enable'</span>] = false</span><br><span class="line">prometheus_monitoring[<span class="string">'enable'</span>] = false</span><br><span class="line">grafana[<span class="string">'enable'</span>] = false</span><br><span class="line">grafana[<span class="string">'reporting_enabled'</span>] = false</span><br><span class="line">gitlab_rails[<span class="string">'kerberos_enabled'</span>] = false</span><br><span class="line">sentinel[<span class="string">'enable'</span>] = false</span><br></pre></td></tr></tbody></table></figure> This is my <a href="gitlab.rb">gitlab.rb</a>. Feel free to download and use it. ### Commands #### start <figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">gitlab-ctl <span class="literal">start</span></span><br></pre></td></tr></tbody></table></figure> #### stop <figure class="highlight arduino"><table><tbody><tr><td class="code"><pre><span class="line">gitlab-ctl stop</span><br></pre></td></tr></tbody></table></figure> #### reconfigure <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">gitlab-ctl reconfigure</span></span><br></pre></td></tr></tbody></table></figure> This command will make the configuration take effect and restart gitlab. #### restart <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">gitlab-ctl restart</span></span><br></pre></td></tr></tbody></table></figure> #### status <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">gitlab-ctl status</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Gitlab</category>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Gitlab</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Coding Skills of Django</title>
    <url>/2023/03/03/Coding-Skills-of-Django/</url>
    <content><![CDATA[<html><head></head><body><p>In this article, I will share some useful coding skills of Django. Hope it helps you. <span id="more"></span> ### Errors &amp; Solutions #### Related Field has invalid lookup: icontains ##### Error Condition When using search function in <strong>admin</strong> module, we may meet this error. * The search configuration </p><figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">class <span class="built_in">RecItemAdmin</span>(admin.ModelAdmin):</span><br><span class="line">    <span class="selector-tag">form</span> = RecItemAdminForm</span><br><span class="line">    search_fields = <span class="selector-attr">[<span class="string">'category'</span>, <span class="string">'brand'</span>, <span class="string">'title'</span>,]</span></span><br></pre></td></tr></tbody></table></figure> * The model definition * RecItem <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">class RecItem(models.Model):</span><br><span class="line">    category = models.ForeignKey(Category, <span class="attribute">on_delete</span>=models.CASCADE, <span class="attribute">related_name</span>=<span class="string">'rec_items'</span>)</span><br><span class="line">    title = models.CharField(<span class="attribute">max_length</span>=64, <span class="attribute">null</span>=<span class="literal">True</span>, <span class="attribute">blank</span>=<span class="literal">True</span>)</span><br><span class="line">    brand = models.ForeignKey(Brand, <span class="attribute">on_delete</span>=models.CASCADE, <span class="attribute">related_name</span>=<span class="string">'rec_items'</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<pre><code>* Category</code></pre>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">class Category(models.Model):</span><br><span class="line">    card = models.ForeignKey(CardInfo, <span class="attribute">on_delete</span>=models.CASCADE, <span class="attribute">related_name</span>=<span class="string">'cates'</span>)</span><br><span class="line">    name = models.CharField(<span class="attribute">max_length</span>=32, <span class="attribute">null</span>=<span class="literal">True</span>, <span class="attribute">blank</span>=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>* Brand</code></pre>
<figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="constructor">Brand(<span class="params">models</span>.Model)</span>:</span><br><span class="line">    name = models.<span class="constructor">CharField(<span class="params">max_length</span>=64, <span class="params">unique</span> = True, <span class="params">verbose_name</span>='ä¸­æåç§°')</span></span><br></pre></td></tr></tbody></table></figure>
<h5 id="solution">Solution</h5>
<p>The search fields category and brand are foreign keys. Django does not support search on foreign key and manytomany field. We have to search on string field. Thus we can use the double under score symbol to get the model's string properties. </p><figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">class <span class="built_in">RecItemAdmin</span>(admin.ModelAdmin):</span><br><span class="line">    <span class="selector-tag">form</span> = RecItemAdminForm</span><br><span class="line">    search_fields = <span class="selector-attr">[<span class="string">'category__name'</span>, <span class="string">'brand__name'</span>, <span class="string">'title'</span>,]</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Setup Source Of pip On MacBook</title>
    <url>/2023/05/07/Setup-Source-Of-pip-On-MacBook/</url>
    <content><![CDATA[<html><head></head><body><p>The default index url of <strong>pip</strong> is <a href="https://pypi.org/simple">https://pypi.org/simple</a>, which is slow for Chinese users. In this article, I will show you how to configure the index url to sources in China globally. <span id="more"></span> ### Sources In China There are several sources managed by organized by institutions in China. * æ¸åï¼&nbsp;https://pypi.tuna.tsinghua.edu.cn/simple * é¿éäºï¼&nbsp;http://mirrors.aliyun.com/pypi/simple/ * ä¸­å½ç§æå¤§å­¦ &nbsp;https://pypi.mirrors.ustc.edu.cn/simple/ * åä¸­çå·¥å¤§å­¦ï¼&nbsp;http://pypi.hustunique.com/ * å±±ä¸çå·¥å¤§å­¦ï¼&nbsp;http://pypi.sdutlinux.org/ * è±ç£ï¼&nbsp;http://pypi.douban.com/simple/ </p><figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">### Use Temporarily</span><br></pre></td></tr></tbody></table></figure> pip install package -i https://pypi.tuna.tsinghua.edu.cn/simple <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">### Configuration</span><br><span class="line">#### Create Configure File</span><br></pre></td></tr></tbody></table></figure> cd mkdir .pip cd .pip touch pip.conf <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">#### Configure</span><br></pre></td></tr></tbody></table></figure> vi pip.conf [global] index-url = https://pypi.tuna.tsinghua.edu.cn/simple [install] trusted-host = https://pypi.tuna.tsinghua.edu.cn/ ```<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Python</category>
        <category>pip</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>pip</tag>
      </tags>
  </entry>
  <entry>
    <title>Using scipy and numpy in Django</title>
    <url>/2023/05/08/Using-scipy-in-Django/</url>
    <content><![CDATA[<html><head></head><body><p>When <strong>import scipy</strong> or <strong>import numpy as np</strong> in a Django project, it works very well in development mode. However, it will get stuck when deploy Django project using apache. In this article, I will show you how to solve this problem. <span id="more"></span> Some third party packages for Python which use C extension modules, and this includes scipy and numpy, will only work in the Python main interpreter and cannot be used in sub interpreters as mod_wsgi by default uses. The result can be thread deadlock, incorrect behavior or processes crashes. These is detailed in:<a href="http://code.google.com/p/modwsgi/wiki/ApplicationIssues#Python_Simplified_GIL_State_API">http://code.google.com/p/modwsgi/wiki/ApplicationIssues#Python_Simplified_GIL_State_API</a></p>
<p>The workaround is to force the WSGI application to run in the main interpreter of the process using: </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">WSGIApplicationGroup</span> <span class="variable">%{GLOBAL}</span></span><br></pre></td></tr></tbody></table></figure> Add the above line to the apache's configure file, which is probably locate in <strong>/etc/apache/sites-available</strong>. And then reload apache service using: <figure class="highlight jboss-cli"><table><tbody><tr><td class="code"><pre><span class="line">systemctl <span class="keyword">reload</span> apache2.service</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>ROS2 Learning Notes - ROS2 Humble For Beginners</title>
    <url>/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸º<strong>ROS 2</strong>åå­¦èçå­¦ä¹ ç¬è®°ï¼ä¸»è¦è®°å½äºæå­¦ä¹ ROS 2è¿ç¨ä¸­çéè¦ä¿¡æ¯ï¼é²æ­¢éæ¼ãä¸»è¦åèèµæä¸º<a href="https://docs.ros.org/en/humble/index.html">ROS 2: Humble</a>çå®æ¹ææ¡£å<a href="https://www.youtube.com/watch?v=0aPbWsyENA8&amp;list=PLLSegLrePWgJudpPUof4-nVFHGkB62Izy">ROS 2 Tutorials - ROS2 Humble For Beginners</a>ã <span id="more"></span> ## ROS2 VS. ROS1 * éç¨ä¸å¯é çæ çº¿ç½ç» * éç¨äºæºå¨äººéç¾¤ * éä¿¡å®å¨ * éç¨äºåµå¥å¼ç³»ç» * æ¯æå®æ¶ç³»ç» ## ROS2çç»æ åºå±çéä¿¡åè®®ä½¿ç¨çæ¯<strong>DDS</strong> * Cyclone DDS * Fast DDS * Connext DDS ä¸é¢æ¯ä¸­é´ä»¶ï¼ <strong>ROS 2 Middleeare</strong> åä¸é¢æ¯<strong>rcl</strong>ï¼ <strong>ROS 2 Client Library</strong> åä¸é¢æ¯åç§è¯­è¨æ¥å£ï¼ä¾å¦<strong>C++</strong>, <strong>Python</strong>, <strong>Java</strong> é¡¶å±çæ¯è¿äºè¯­è¨å¼åç<strong>Applications</strong></p>
<p><strong>ROS2</strong>å¯ä»¥å¸®å©æä»¬å®ç°ç¡¬ä»¶æ½è±¡ï¼è®¾å¤åºå±æ§å¶ï¼ éä¿¡ååç®¡ççåè½ã ## å®è£ROS2 Humble <strong>ROS</strong>çå¨ç§°æ¯<strong>Robot Operation System</strong>ï¼ä¸»è¦ç¹ç¹æ¯åå¸å¼çç»æï¼èç¹ä¹é´éè¿éä¿¡å®ç°æ°æ®äº¤æ¢ãROSè¿æä¾äºä¸ç³»åå³æå³ç¨çåºã ### æç§å®ç½æç¨å®è£ ROS2 Humbleæ¯æå¨Ubuntu22.04ä¸åå®è£ï¼æä»¥ç´æ¥æç§<a href="https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html">å®ç½æç¨</a>å®è£å³å¯ã ### å¶ä»è®¾ç½® * å®è£ROSå·¥å·å </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-gazebo-ros2-control</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-gazebo-ros-pkgs</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-moveit</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-urdf-tutorial</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-tf2-tools</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-navigation2</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-nav2-bringup</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-turtlebot3</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-turtlebot3-gazebo</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-tf-transformations</span><br><span class="line">sudo apt-<span class="built_in">get</span> install python3-transforms3d</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-joint-trajectory-controller</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-joint-state-broadcaster</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-forward-command-controller</span><br></pre></td></tr></tbody></table></figure> * å®è£Pythonç¼è¯å·¥å·--colcon <figure class="highlight vim"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install <span class="keyword">python3</span>-colcon-common-extensions</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"source /usr/share/colcon_argcomplete/hook/colcon-argcomplete.zsh"</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></tbody></table></figure> * è§£å³setuptoolsçæ¬é®é¢å¯¼è´çwarning <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>lib<span class="regexp">/python3/</span>dist-packages<span class="regexp">/setuptools/</span>command/install.py:<span class="number">34</span>: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.</span><br><span class="line">  warnings.warn(</span><br></pre></td></tr></tbody></table></figure> setuptoolsé»è®¤å®è£ççæ¬ä¸º59.6.0ï¼éè¦éçº§ä¸º58.2.0ã <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pip</span> install setuptools==<span class="number">58</span>.<span class="number">2</span>.<span class="number">0</span></span><br></pre></td></tr></tbody></table></figure> * è§£å³rosçæä»¤å¨terminalä¸­èªå¨è¡¥å¨ å°ä»¥ä¸åå®¹æ·»å å°zshrcéç½®æä»¶ä¸­ï¼ <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># argcomplete for ros2 &amp; colcon</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="subst">$(register-python-argcomplete3 ros2)</span>"</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="subst">$(register-python-argcomplete3 colcon)</span>"</span></span><br></pre></td></tr></tbody></table></figure> éè¦å°<strong>rosidl-argcomplete.zsh</strong>æä»¶ä¸­çä¸è¡ä»£ç æ³¨éæã <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo vi <span class="regexp">/opt/</span>ros<span class="regexp">/humble/</span>share<span class="regexp">/rosidl_cli/</span>environment/rosidl-argcomplete.zsh</span><br></pre></td></tr></tbody></table></figure> æ³¨é <figure class="highlight 1c"><table><tbody><tr><td class="code"><pre><span class="line">autoload -U +X compinit <span class="meta">&amp;&amp; compinit</span></span><br></pre></td></tr></tbody></table></figure> ### Source Configuration ROSçå¾å¤éç½®éè¦sourceä¹åæè½çæï¼ä¸ºäºé¿åæ¯æ¬¡å¯å¨terminalé½éè¦éæ°sourceï¼æä»¬æsourceè¯­å¥å å¥å°éç½®æä»¶ä¸­ã <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/opt/</span>ros<span class="regexp">/humble/</span>setup.zsh</span><br><span class="line"><span class="keyword">source</span> <span class="regexp">/usr/</span>share<span class="regexp">/colcon_argcomplete/</span>hook/colcon-argcomplete.zsh</span><br><span class="line"><span class="keyword">source</span> ~<span class="regexp">/ros2_ws/i</span>nstall/setup.zsh</span><br><span class="line"><span class="keyword">source</span> <span class="regexp">/usr/</span>share<span class="regexp">/gazebo/</span>setup.sh</span><br></pre></td></tr></tbody></table></figure> ç¬¬ä¸å¥æ¯source roså®è£åéç½®ï¼ç¬¬äºå¥æ¯sourceèªå¨è¡¥å¨éç½®ï¼ç¬¬ä¸å¥æ¯sourceå·¥ä½ç©ºé´çéç½®ãæ¯æ¬¡rosåéæ°ç¼è¯åé½éè¦éæ°source rosçå·¥ä½ç©ºé´ã ### Source Code <strong>ROS</strong>ææçä»£ç åå¼æºï¼è¿æ¥è§ï¼<a href="https://github.com/orgs/ros2/repositories">https://github.com/orgs/ros2/repositories</a>ã * rclcpp cppå¼åæ¥å£ï¼<a href="https://github.com/ros2/rclcpp">https://github.com/ros2/rclcpp</a> * rclpy pythonå¼åæ¥å£ï¼<a href="https://github.com/ros2/rclpy">https://github.com/ros2/rclpy</a> * ros2cli å½ä»¤è¡æ¥å£ï¼<a href="https://github.com/ros2/ros2cli">https://github.com/ros2/ros2cli</a> * ros2bag è®°å½æ°æ®åï¼<a href="https://github.com/ros2/rosbag2">https://github.com/ros2/rosbag2</a> * common interfaces <strong>msg</strong>å<strong>srv</strong>æºç ï¼<a href="https://github.com/ros2/common_interfaces">https://github.com/ros2/common_interfaces</a> * rviz 3Då¯è§åæ¥å£ï¼<a href="https://github.com/ros2/rviz">https://github.com/ros2/rviz</a> é¤äºæºç ï¼<strong>ROS</strong>è¿æä¾äºä¸ä»½<a href="https://design.ros2.org/">è®¾è®¡ææ¡£</a>ï¼è¯¦ç»è¯´æäºè®¾è®¡æè·¯åæ¥å£è¯´æãæºç è§ï¼<a href="git@github.com:ros2/design.git">git@github.com:ros2/design.git</a> ## åå»ºWorkSpace ### åå»ºæä»¶å¤¹ <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> &amp; <span class="built_in">mkdir</span> ros2_ws</span><br><span class="line"><span class="built_in">cd</span> ros2_ws</span><br><span class="line"><span class="built_in">mkdir</span> src</span><br></pre></td></tr></tbody></table></figure> ### ç¼è¯ <figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">colcon build <span class="comment">--symlink-install</span></span><br></pre></td></tr></tbody></table></figure> <strong>--symlink-install</strong>åæ°å¯ä»¥è®©pythonä»£ç ç«å³çæï¼èä¸éè¦éæ°buildã ç¼è¯åä¼åå»º<strong>build</strong>ï¼<strong>install</strong>ï¼<strong>log</strong>æä»¶å¤¹ï¼éè¦å°<strong>install</strong>æä»¶å¤¹åç<strong>setup.zsh</strong>æ¾å°zshrcéç½®æä»¶ä¸­ï¼è®©å·¥ä½ç©ºé´å¨å±çæã <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">.</span><br><span class="line">âââ build</span><br><span class="line">â&nbsp;&nbsp; âââ COLCON_IGNORE</span><br><span class="line">âââ install</span><br><span class="line">â&nbsp;&nbsp; âââ COLCON_IGNORE</span><br><span class="line">â&nbsp;&nbsp; âââ local_setup<span class="selector-class">.bash</span></span><br><span class="line">â&nbsp;&nbsp; âââ local_setup<span class="selector-class">.ps1</span></span><br><span class="line">â&nbsp;&nbsp; âââ local_setup<span class="selector-class">.sh</span></span><br><span class="line">â&nbsp;&nbsp; âââ _local_setup_util_ps1<span class="selector-class">.py</span></span><br><span class="line">â&nbsp;&nbsp; âââ _local_setup_util_sh<span class="selector-class">.py</span></span><br><span class="line">â&nbsp;&nbsp; âââ local_setup<span class="selector-class">.zsh</span></span><br><span class="line">â&nbsp;&nbsp; âââ setup<span class="selector-class">.bash</span></span><br><span class="line">â&nbsp;&nbsp; âââ setup<span class="selector-class">.ps1</span></span><br><span class="line">â&nbsp;&nbsp; âââ setup<span class="selector-class">.sh</span></span><br><span class="line">â&nbsp;&nbsp; âââ setup<span class="selector-class">.zsh</span></span><br><span class="line">âââ log</span><br><span class="line">â&nbsp;&nbsp; âââ build_2023-<span class="number">12</span>-<span class="number">13</span>_15-<span class="number">55</span>-<span class="number">37</span></span><br><span class="line">â&nbsp;&nbsp; â&nbsp;&nbsp; âââ events<span class="selector-class">.log</span></span><br><span class="line">â&nbsp;&nbsp; â&nbsp;&nbsp; âââ logger_all<span class="selector-class">.log</span></span><br><span class="line">â&nbsp;&nbsp; âââ COLCON_IGNORE</span><br><span class="line">â&nbsp;&nbsp; âââ latest -&gt; latest_build</span><br><span class="line">â&nbsp;&nbsp; âââ latest_build -&gt; build_2023-<span class="number">12</span>-<span class="number">13</span>_15-<span class="number">55</span>-<span class="number">37</span></span><br><span class="line">âââ <span class="attribute">src</span></span><br></pre></td></tr></tbody></table></figure> <strong>æ³¨æï¼ç¼è¯å¿é¡»å¨å·¥ä½ç©ºé´çæ ¹ç®å½è¿è¡ã</strong> <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"source ros2_ws/install/setup.zsh"</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></tbody></table></figure> æå¤ä¸ªpackageçæåµä¸ï¼å¦æä»éè¦ç¼è¯æå®çpackageï¼åå¯ä»¥ä½¿ç¨<strong>--packages-select</strong>åæ°æå®ã <figure class="highlight n1ql"><table><tbody><tr><td class="code"><pre><span class="line">colcon <span class="keyword">build</span> --packages-<span class="keyword">select</span> my_py_pkg</span><br></pre></td></tr></tbody></table></figure> ç¼è¯æååï¼ä¼å¨å·¥ä½ç©ºé´<strong>install/lib</strong>æä»¶å¤¹ä¸é¢çæå¯¹åºpackageçå¯æ§è¡æä»¶ãå·ä½ç®å½å¨<strong>setup.cfg</strong>ä¸­éç½®ã ç¼è¯æååï¼éè¦éæ°sourceï¼ä»¥è®©æ°ç¼è¯çåå®¹çæã<p></p>
<h2 id="åå»ºpackage">åå»ºPackage</h2>
<p>æ¯ä¸ä¸ªpackageé½æ¯ç¬ç«çååï¼ä¾å¦å¯ä»¥åå»ºä¸ä¸ªcamera packageï¼å¯ä»¥åå»ºä¸ä¸ªhardware control package, å¯ä»¥åå»ºä¸ä¸ªmotion planning package ### Python Package </p><figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">cd ros2_ws/<span class="attribute">src</span></span><br><span class="line">ros2 pkg create my_robot_controller <span class="attr">--build-type</span> ament_python <span class="attr">--dependencies</span> rclpy</span><br></pre></td></tr></tbody></table></figure> å¯ä»¥å¨ä»»æç®å½ä¸åå»ºpackageï¼ä½æ¯ä¸ºäºä»£ç ä¾¿äºç®¡çï¼æ¨èå¨srcç®å½ä¸åå»ºpackageã <strong>build-type</strong>éé¡¹å¯ä»¥è®¾ç½®æ¯packageçç¼åè¯­è¨ï¼å¯ä»¥æ¯pythonä¹å¯ä»¥æ¯c++ã <strong>dependencies</strong>éé¡¹å¯ä»¥è®¾ç½®è¯­è¨ï¼å¯¹äºpythonèè¨ï¼æ¯rclpyã æä»¤ä¼åå»ºä¸ä¸ªåå­ä¸ºmy_robot_controllerçpackageï¼æ¯ä¸ä¸ªåç¬çæä»¶å¤¹ï¼æä»¶ç»æå¦ä¸æç¤ºï¼ <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">.</span><br><span class="line">âââ my_robot_controller</span><br><span class="line">    âââ my_robot_controller</span><br><span class="line">    â&nbsp;&nbsp; âââ __init__<span class="selector-class">.py</span></span><br><span class="line">    âââ package<span class="selector-class">.xml</span></span><br><span class="line">    âââ resource</span><br><span class="line">    â&nbsp;&nbsp; âââ my_robot_controller</span><br><span class="line">    âââ setup<span class="selector-class">.cfg</span></span><br><span class="line">    âââ setup<span class="selector-class">.py</span></span><br><span class="line">    âââ test</span><br><span class="line">        âââ test_copyright<span class="selector-class">.py</span></span><br><span class="line">        âââ test_flake8<span class="selector-class">.py</span></span><br><span class="line">        âââ test_pep257<span class="selector-class">.py</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> directories, <span class="number">8</span> files</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> ç¶ååå°ros2_wsæ ¹ç®å½ï¼ä½¿ç¨<strong>colcon build</strong>æä»¤ç¼è¯åååå»ºçpackageã #### åå»ºèç¹ èç¹æ¯æºå¨äººæä½ç³»ç»çæå°è¿è¡ååï¼å¤ä¸ªèç¹ç»æä¸å¼ å¾ï¼å±åææä¸ä¸ªæºå¨äººæä½ç³»ç»ãä¸ä¸ªèç¹ä¸è¬åªç¨äºå®æä¸ä»¶äºæãå¤ä¸ªèç¹ä¹é´éè¿<strong>topic</strong>ã<strong>service</strong>å<strong>parameters</strong>è¿è¡éä¿¡ã å¤èç¹æ¶æéä½äºæºå¨äººæä½ç³»ç»çå¤æåº¦ï¼ä¾¿äºå¼ååè°è¯ï¼æåäºç³»ç»çé²æ£æ§ï¼ä¸ä¸ªèç¹æäºä¸å½±åå¶ä»èç¹ï¼èç¹å¯ä»¥ä½¿ç¨pythonåC++ç¼åã èç¹å½åä¸è½å²çªã èç¹çæºä»£ç å­å¨äºpackageåçååæä»¶å¤¹ä¸é¢ï¼ä¾å¦å¯¹äº<strong>my_robot_controller</strong>packageèè¨ï¼èç¹æºç åºè¯¥å­å¨äº<strong>my_robot_controller/my_robot_controller</strong>æä»¶å¤¹ä¸é¢ã * èç¹çæºç æä»¶æ¯ä¸ä¸ªå¯æ§è¡æä»¶ ä½¿ç¨ä»¥ä¸å½ä»¤åå»ºèç¹æºç æä»¶ <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> my_first_node.py</span><br><span class="line"><span class="built_in">chmod</span> +x my_first_node.py</span><br></pre></td></tr></tbody></table></figure><p></p>
<h5 id="import-rclpy">import rclpy</h5>
<p>ä½¿ç¨pythonå¼åçrosèç¹éè¦ä½¿ç¨<strong>rclpy</strong>(ROS Client Library for Python)ã </p><figure class="highlight elm"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br></pre></td></tr></tbody></table></figure> ##### å®ä¹mainå½æ° * mainå½æ° <figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">def main(<span class="attr">args=</span>None):</span><br><span class="line">    rclpy.init(<span class="attr">args=</span>args)</span><br><span class="line">    <span class="keyword">node</span> <span class="title">= MyNode</span>()</span><br><span class="line">    rclpy.spin(<span class="keyword">node</span><span class="title">=node</span>)</span><br><span class="line">    rclpy.shutdown()</span><br></pre></td></tr></tbody></table></figure> mainå½æ°å¼å¤´ç¨<strong>rclpy.init</strong>å½æ°è¿è¡åå§åï¼è½½å¥rosèµæºï¼ç»å°¾ç¨<strong>rclpy.shutdown</strong>å½æ°è¿è¡ç»æï¼éæ¾rosèµæºãå¨initåshutdownä¸­é´ï¼å¯ä»¥å®ä¹èç¹å¯¹è±¡ï¼å¹¶ä½¿ç¨<strong>rclpy.spin</strong>å½æ°ä¿è¯èç¹ä¸ç´è¿è¡ã * å¥å£ <figure class="highlight isbl"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">__name__</span> == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="function"><span class="title">main</span>()</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h5 id="ç»§æ¿nodeåå»ºèç¹ç±»">ç»§æ¿Nodeåå»ºèç¹ç±»</h5>
<p>èç¹ç±»éè¦ç»§æ¿<strong>rclpy.node</strong>ä¸­ç<strong>Node</strong>ã </p><figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">from rclpy.node import <span class="keyword">Node</span></span><br><span class="line"><span class="title">class</span> MyNode(<span class="keyword">Node</span><span class="title">):</span></span><br><span class="line"><span class="title">    def</span> __init__(self):</span><br><span class="line">        super().__init__(<span class="string">"first_node"</span>)</span><br></pre></td></tr></tbody></table></figure> å¨åå§å½æ°ä¸­å¯¹ç¶ç±»è¿è¡åå§åï¼å®ä¹èç¹åç§°ã<p></p>
<h5 id="å®è£node">å®è£node</h5>
<p>å¨åç<strong>setup.py</strong>ä¸­ç<strong>entry_points</strong>å®è£nodeã </p><figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">entry_points</span>={</span><br><span class="line">    <span class="string">'console_scripts'</span>: [</span><br><span class="line">        <span class="string">"test_node = my_robot_controller.my_first_node:main"</span>,</span><br><span class="line">        <span class="string">"draw_circle = my_robot_controller.draw_circle:main"</span></span><br><span class="line">    ],</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure> ä¸»è¦å®ä¹å¯æ§è¡æä»¶çåç§°åä»£ç æ§è¡è·¯å¾ãå¯æ§è¡æä»¶åä¸ºä½¿ç¨roså½ä»¤è¿è¡çåç§°ï¼èç¹åç§°å¨å®ä¹èç¹æ¶æå®ã<p></p>
<h3 id="c-package">C++ Package</h3>
<figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">cd ros2_ws/<span class="attribute">src</span></span><br><span class="line">ros2 pkg create my_cpp_pkg <span class="attr">--build-type</span> ament_cmake <span class="attr">--dependencies</span> rclcpp</span><br></pre></td></tr></tbody></table></figure>
<p>éè¿<strong>pkg create</strong>æä»¤åå»ºåï¼åæ°ä¸­æå®<strong>ament_cmake</strong>å<strong>rclcpp</strong>ã</p>
<h4 id="include-rclcpp">include rclcpp</h4>
<figure class="highlight arduino"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/executors.hpp"</span></span></span><br></pre></td></tr></tbody></table></figure>
<p>å¼å¥<strong>rclcpp.hpp</strong>å°±å¤äºï¼ä½æ¯ä½¿ç¨<strong>rclcpp::spin</strong>æ¶ï¼vscodeä¼æç¤ºå¨<strong>rclcpp</strong>å½åç©ºé´ä¸­æ¾ä¸å°<strong>spin</strong>ï¼å æ­¤å¼å¥<strong>executors.hpp</strong>è§£å³è¿ä¸ªé®é¢ã</p>
<h4 id="å®ä¹mainå½æ°">å®ä¹mainå½æ°</h4>
<p>ä¸pythonèç¹ç±»ä¼¼ï¼éè¦å¨mainå½æ°ä¸­ä¾æ¬¡ä½¿ç¨initãspinãshutdownå½æ°æ¥å®ç°rosèç¹çåå§åãè¿è¡åç»æåè½ã </p><figure class="highlight cpp"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;rclcpp::Node&gt;(<span class="string">"cpp_test"</span>);</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(node-&gt;<span class="built_in">get_logger</span>(), <span class="string">"Hello Cpp Node"</span>);</span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> æå°æ¥å¿ä½¿ç¨äº<strong>RCLCPP_INFO</strong>å®å®ä¹æ¥å®ç°ï¼ä¼ å¥loggerå¯¹è±¡åæ¥å¿åå®¹å­ç¬¦ä¸²å³å¯ã #### ç»§æ¿Nodeåå»ºèç¹ç±» <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> MyNode: public rclcpp::Node </span><br><span class="line">{</span><br><span class="line">    public:</span><br><span class="line">    <span class="constructor">MyNode()</span>: <span class="constructor">Node(<span class="string">"cpp_test"</span>)</span>, counter<span class="constructor">_(0)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="constructor">RCLCPP_INFO(<span class="params">this</span> -&gt; <span class="params">get_logger</span>()</span>, <span class="string">"Hello Cpp Node"</span>);</span><br><span class="line">        timer_ = this -&gt; create<span class="constructor">_wall_timer(<span class="params">std</span>::<span class="params">chrono</span>::<span class="params">seconds</span>(1)</span>,</span><br><span class="line">                                           std::bind(&amp;MyNode::timeCallback, this));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    void time<span class="constructor">Callback()</span></span><br><span class="line">    {</span><br><span class="line">        counter_++;</span><br><span class="line">        <span class="constructor">RCLCPP_INFO(<span class="params">this</span> -&gt; <span class="params">get_logger</span>()</span>, <span class="string">"Hello Cpp %d"</span>, counter_);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">    <span class="built_in">int</span> counter_;</span><br><span class="line">};</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> éè¦publicç»§æ¿<strong>rclcpp::Node</strong>ï¼å¨åå§åå½æ°ä¸­å®æèç¹åç§°çå®ä¹ã #### CMakeéç½® å¨<strong>CMakeLists.txt</strong>ä¸­å¢å æ§è¡æä»¶ãä¾èµå³ç³»åå®è£è·¯ç»çéç½®ã <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">add_executable</span><span class="params">(cpp_node src/my_first_node.cpp)</span></span></span><br><span class="line"><span class="function"><span class="title">ament_target_dependencies</span><span class="params">(cpp_node rclcpp)</span></span></span><br><span class="line"><span class="function"><span class="title">install</span><span class="params">(TARGETS cpp_node DESTINATION lib/${PROJECT_NAME})</span></span></span><br></pre></td></tr></tbody></table></figure> #### VSCodeéç½®AutoComplete å¨VSCodeä¸­ä½¿ç¨å¿«æ·é®<strong>Ctrl+Shift+P</strong>æå¼å½ä»¤ç´¢å¼æ¡ï¼è¾å¥<strong>c/c++</strong>ï¼å¨åéä¸­éæ©<strong>Edit Configuration JSON</strong>ï¼ç¶åå°rosçincludeè·¯å¾æ·»å å°<strong>includePath</strong>ä¸­ï¼å·ä½å¦ä¸æç¤ºï¼ <figure class="highlight prolog"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="string">"configurations"</span>: [</span><br><span class="line">        {</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"Linux"</span>,</span><br><span class="line">            <span class="string">"includePath"</span>: [</span><br><span class="line">                <span class="string">"${workspaceFolder}/**"</span>,</span><br><span class="line">                <span class="string">"/usr/include/**"</span>,</span><br><span class="line">                <span class="string">"/usr/local/include/**"</span>,</span><br><span class="line">                <span class="string">"/opt/ros/humble/include/**"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"defines"</span>: [],</span><br><span class="line">            <span class="string">"compilerPath"</span>: <span class="string">"/usr/bin/gcc"</span>,</span><br><span class="line">            <span class="string">"cStandard"</span>: <span class="string">"c11"</span>,</span><br><span class="line">            <span class="string">"cppStandard"</span>: <span class="string">"c17"</span>,</span><br><span class="line">            <span class="string">"intelliSenseMode"</span>: <span class="string">"linux-gcc-x64"</span></span><br><span class="line">        }</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"version"</span>: <span class="number">4</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> é¤äºä¿®æ¹<strong>includePath</strong>ï¼è¿éè¦æ·»å <strong>cppStandard</strong>ã ä¸è¿°æä»¤è¿è¡èç¹å¹¶ä¸å°èç¹éå½åä¸º<strong>abs</strong>.<p></p>
<h3 id="topic">Topic</h3>
<p><strong>Topic</strong>æä¾äºèç¹ä¹é´çéä¿¡æºå¶ï¼ç±åç§°åæ¶æ¯ç±»åå±åå®ä¹ãå¶åå®¹ç±publisheråå¸ï¼subscriberä¼å¯¹åå®¹è¿è¡çå¬åæ¶è´¹ãä¸ä¸ªtopicå¯ææå¤ä¸ªpublisherï¼ä¹å¯ä»¥æå¤ä¸ªsubscriberã #### æ¶é´åè°å½æ° æ¶é´åè°å½æ°ä¸è¬ç¨äºå¨ææ§çå®æå·¥ä½ã ##### Python * å®ä¹æ¶é´åè°å½æ° </p><figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">timer_callback</span>(<span class="params"><span class="variable language_">self</span></span>):</span><br><span class="line">    pass</span><br></pre></td></tr></tbody></table></figure> * æ³¨åæ¶é´åè°å½æ° <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">self.create<span class="constructor">_timer(1.0, <span class="params">self</span>.<span class="params">timer_callback</span>)</span></span><br></pre></td></tr></tbody></table></figure> ä¸è¬å¨åå§åå½æ°ä¸­æ³¨åæ¶é´åè°å½æ°ãæ¶é´åè°å½æ°çç¬¬ä¸ä¸ªåæ°æ¯æ¶é´å¨æï¼ç¬¬äºä¸ªåæ°æ¯è°ç¨çåè°å½æ°ã<p></p>
<h5 id="c">C++</h5>
<ul>
<li>å®ä¹æ¶é´åè°å½æ° <figure class="highlight lasso"><table><tbody><tr><td class="code"><pre><span class="line"><span class="literal">void</span> publishNews() {</span><br><span class="line">    auto msg = example_interfaces<span class="type">::msg</span><span class="type">::String</span>();</span><br><span class="line">    msg.<span class="built_in">data</span> = std<span class="type">::string</span>(<span class="string">"Hi, this is "</span>) + robot_name_ +</span><br><span class="line">        std<span class="type">::string</span>(<span class="string">" from the Robot News Station"</span>);</span><br><span class="line">    publisher_-&gt;publish(msg);</span><br><span class="line">    counter_++;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li>æ³¨åæ¶é´åè°å½æ° <figure class="highlight dts"><table><tbody><tr><td class="code"><pre><span class="line"><span class="symbol">rclcpp:</span>:TimerBase::SharedPtr timer_<span class="punctuation">;</span></span><br><span class="line">timer_ = this-&gt;create_wall_timer(</span><br><span class="line"><span class="symbol">    std:</span>:chrono::seconds(<span class="number">1</span>),</span><br><span class="line"><span class="symbol">    std:</span>:bind(<span class="variable">&amp;</span>RobotNewsStationNode::publishNews, this))<span class="punctuation">;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="publisher">publisher</h4>
<h5 id="python">Python</h5>
<ul>
<li>å®ä¹publisher ä¸è¬å¨èç¹çinitå½æ°ä¸­å®ä¹publisherã <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable language_">self</span>.cmd_vel_pub_ = <span class="variable language_">self</span>.create_publisher(<span class="title class_">Twist</span>, <span class="string">"/turtle1/cmd_vel"</span>, <span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure> éè¿<strong>create_publisher</strong>å½æ°å®ä¹publisherï¼éè¦ä¼ å¥ä¸ä¸ªæ¶æ¯ç±»åï¼ç¶åä¼ å¥ä¸ä¸ªtopicåå­, ç¬¬ä¸ä¸ªåæ°ä»£è¡¨æ¶æ¯çå¤§å°ã <strong>æ³¨æï¼å¼å¥æ°çååï¼éè¦å¨package.xmlä¸­æ·»å æ°çdependã</strong></li>
<li>å¨ææ§åéæ¶æ¯ å¨ææ§è¿è¡ä¸»è¦ä¾èµæ¶é´åè°å½æ°å®ç°ï¼é¦åå®ä¹ä¸ä¸ªæ¶é´åè°å½æ°ï¼ç¶åå¨èç¹çinitå½æ°ä¸­æ³¨åæ¶é´åè°å½æ°ï¼å·ä½å¯åç§ä¸ä¸ç« èã å¨æ¶é´åè°å½æ°ä¸­ï¼å®ä¹æ¶æ¯åå®¹ï¼å¹¶éè¿publisheråå¸æ¶æ¯ã <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">def</span> send_velocity_command(self):</span><br><span class="line">    <span class="attribute">msg</span> = Twist()</span><br><span class="line">    <span class="attribute">msg</span>.linear.x = <span class="number">2</span>.<span class="number">0</span></span><br><span class="line">    <span class="attribute">msg</span>.angular.z = <span class="number">1</span>.<span class="number">0</span></span><br><span class="line">    <span class="attribute">self</span>.cmd_vel_pub_.publish(msg)</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°ä»£ç ä¸­å®ä¹äº<strong>send_velocity_command</strong>åè°å½æ°ã</li>
</ul>
<h5 id="c-1">C++</h5>
<ul>
<li>å®ä¹publisher <figure class="highlight rust"><table><tbody><tr><td class="code"><pre><span class="line">rclcpp::Publisher&lt;example_interfaces::msg::<span class="type">String</span>&gt;::SharedPtr publisher_;</span><br><span class="line">publisher_ = this<span class="punctuation">-&gt;</span>create_publisher&lt;example_interfaces::msg::<span class="type">String</span>&gt;(</span><br><span class="line">            <span class="string">"robot_news"</span>, <span class="number">10</span>);</span><br></pre></td></tr></tbody></table></figure> å£°ææ¶ï¼å¨<strong>Publisher<template></template></strong>æ¨¡æ¿ç±»ä¸­æææ¶æ¯çç±»åï¼å£°ææ¯ä¸ä¸ªSharedPtrç±»åçåéã å®ä¹æ¶ï¼åæ ·å¨æ¨¡æ¿å½æ°ä¸­æææ¶æ¯çæ°æ®ç±»åï¼åæ¶å¨æé å½æ°ä¸­æætopicçåç§°ã</li>
<li>å¨ææ§åéæ¶æ¯ #### subscriber ä¸publisherç±»ä¼¼ï¼åæ ·å¨initå½æ°ä¸­å®ä¹subscriberã <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable language_">self</span>.pose_subscriber_ = <span class="variable language_">self</span>.create_subscription(<span class="title class_">Pose</span>, <span class="string">"/turtle1/pose"</span>, <span class="variable language_">self</span>.pose_callback, <span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>create_subscription</strong>å½æ°å®ä¹subscriberï¼éè¦ä¼ å¥topicçæ°æ®ç±»åï¼topicçåç§°ï¼åè°å½æ°ï¼ä»¥åbufferå¤§å°ãåè°å½æ°ç¨äºæ¶å°æ°æ®åçå¤çé»è¾ã</li>
</ul>
<h3 id="service">Service</h3>
<p><strong>service</strong>ä¸<strong>topic</strong>çåºå«æ¯ï¼<strong>service</strong>ç±»ä¼¼äºwebæå¡ï¼æserverä¹æclientï¼éè¿ä¼ å¥åæ°ç´æ¥è°ç¨ï¼è<strong>topic</strong>æ´åæ¯æ¶æ¯å¹¿åæ¿ï¼æåå¸èä¹æè®¢éèã <strong>service</strong>çserveråªæä¸ä¸ªï¼èclientå¯ä»¥æå¾å¤ä¸ªã <strong>topic</strong>ä¸»è¦ç¨äºèç¹ä¹é´åéæ°æ®ï¼èä¸éè¦èç¹ä¹é´çresponseãå¦æéè¦responseï¼åéè¦ä½¿ç¨<strong>service</strong>ã é¢ç¹è°ç¨serviceä¼å½±årosçæ´ä½æ§è½ã #### Server ##### Python * å®ä¹Server </p><figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable language_">self</span>.server_ = <span class="variable language_">self</span>.create_service(<span class="title class_">AddTwoInts</span>, <span class="string">"add_two_ints"</span>, <span class="variable language_">self</span>.add_two_ints_callback)</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>create_service</strong>å½æ°åå»ºserverï¼éè¦ä¼ å¥ä¸ä¸ªåæ°ãç¬¬ä¸ä¸ªåæ°æ¯Serviceçæ°æ®ç±»åï¼è¯¥æ°æ®ç±»åå®ä¹äºRequeståResponseçæ°æ®ç»æï¼ç¬¬äºä¸ªåæ°ä¸ºServiceçåç§°ï¼å¯ä¸çIDï¼ç¬¬ä¸ä¸ªåæ°ä¸ºServerçåè°å½æ°ï¼ç¨äºå®ç°ä¸å¡é»è¾ã * å®ä¹Callback <figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_two_ints_callback</span>(<span class="params">self, request, response</span>):</span><br><span class="line">    response.<span class="built_in">sum</span> = request.a + request.b</span><br><span class="line">    self.get_logger().info(<span class="built_in">str</span>(request.a) + <span class="string">"+"</span> + <span class="built_in">str</span>(request.b) + <span class="string">"="</span> + <span class="built_in">str</span>(response.<span class="built_in">sum</span>))</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></tbody></table></figure> åè°å½æ°éè¦ä¼ å¥ä¸¤ä¸ªåæ°ï¼ä¸ä¸ªæ¯<strong>request</strong>å¥åï¼å¦å¤ä¸ä¸ªæ¯<strong>response</strong>åºåã ##### C++ * å®ä¹Server <figure class="highlight zephir"><table><tbody><tr><td class="code"><pre><span class="line">rclcpp::Service&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr server_;</span><br><span class="line">server_ = this-&gt;create_service&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">"add_two_ints"</span>, std::bind(&amp;AddTwoIntsServerNode::callbackAddTwoInts, this, std::placeholders::_1, std::placeholders::_2));</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>create_service</strong>å½æ°åå»ºServiceçServerï¼éè¦æå®æ°æ®ç±»åï¼ä¸ä¼ å¥ä¸¤ä¸ªåæ°ï¼ä¸ä¸ªæ¯Serviceçåç§°ï¼è¿æ¯ä¸ä¸ªå¯ä¸çæ è¯ï¼å¨clientä¸­ä¹éè¦ç¨å°ï¼å¦å¤ä¸ä¸ªæ¯åè°å½æ°ã * å®ä¹Callback <figure class="highlight rust"><table><tbody><tr><td class="code"><pre><span class="line">void <span class="title function_ invoke__">callbackAddTwoInts</span>(<span class="keyword">const</span> example_interfaces::srv::AddTwoInts::Request::SharedPtr request,</span><br><span class="line">    <span class="keyword">const</span> example_interfaces::srv::AddTwoInts::Response::SharedPtr response)</span><br><span class="line">{</span><br><span class="line">    response<span class="punctuation">-&gt;</span>sum = request<span class="punctuation">-&gt;</span>a + request<span class="punctuation">-&gt;</span>b;</span><br><span class="line">    <span class="title function_ invoke__">RCLCPP_INFO</span>(this<span class="punctuation">-&gt;</span><span class="title function_ invoke__">get_logger</span>(), <span class="string">"%ld+%ld=%ld"</span>, request<span class="punctuation">-&gt;</span>a, request<span class="punctuation">-&gt;</span>b, response<span class="punctuation">-&gt;</span>sum);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> Serverçåè°å½æ°è¿åå¼ç±»åä¸º<strong>void</strong>ï¼ä¸æä¸¤ä¸ªå¥åï¼ä¸ä¸ªä¸º<strong>Request</strong>ï¼å¦å¤ä¸ä¸ªä¸º<strong>Response</strong>ï¼ç±»ååä¸º<strong>const SharePtr</strong>. #### Client ##### Python * å®ä¹Client <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">client</span> = self.create_client(AddTwoInts, <span class="string">"add_two_ints"</span>)</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>create_client</strong>å½æ°åå»ºclientï¼éè¦ä¼ å¥ä¸¤ä¸ªåæ°ãç¬¬ä¸ä¸ªæ¯Serviceçæ°æ®ç±»åï¼ç¬¬äºä¸ªæ¯Serviceçåç§°ã * ç­å¾Server Ready <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> not client.wait<span class="constructor">_for_service(1.0)</span>:</span><br><span class="line">    node.get<span class="constructor">_logger()</span>.warn(<span class="string">"Waiting for server AddTwoInts."</span>)</span><br></pre></td></tr></tbody></table></figure> <strong>wait_for_service</strong>å¦ææååè¿åtrueï¼å¦ååè¿åfalseï¼ä¼ å¥çåæ°ä¸ºç­å¾æ¶é´ï¼ä¸ä¼ å¥åæ°¸è¿ç­å¾ã * è¯·æ±Server <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">request = AddTwoInts.<span class="constructor">Request()</span></span><br><span class="line">request.a = <span class="number">45</span></span><br><span class="line">request.b = <span class="number">67</span></span><br><span class="line"></span><br><span class="line">future = client.call<span class="constructor">_async(<span class="params">request</span>=<span class="params">request</span>)</span></span><br><span class="line">rclpy.spin<span class="constructor">_until_future_complete(<span class="params">node</span>=<span class="params">node</span>, <span class="params">future</span>=<span class="params">future</span>)</span></span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨æ°æ®ç±»åç<strong>Request</strong>é¨ååå»ºrequestã<strong>call_async</strong>å¯ä»¥å®ç°å¼æ­¥è°ç¨ï¼è¿åä¸ä¸ªfutureå¯¹è±¡ã<strong>spin_until_feature_complete</strong>å¯ä»¥ç­å¾ç´å°è¯·æ±è¿åï¼éè¦ä¼ å¥ä¸¤ä¸ªåæ°ï¼ä¸ä¸ªæ¯èç¹å¯¹è±¡ï¼å¦å¤ä¸ä¸ªæ¯å¼æ­¥è°ç¨çfutureå¯¹è±¡ã <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">request = AddTwoInts.<span class="constructor">Request()</span></span><br><span class="line">request.a = a</span><br><span class="line">request.b = b</span><br><span class="line">future = self.client_.call<span class="constructor">_async(<span class="params">request</span>=<span class="params">request</span>)</span></span><br><span class="line">future.add<span class="constructor">_done_callback(<span class="params">partial</span>(<span class="params">self</span>.<span class="params">add_two_ints_callback</span>, <span class="params">a</span>=<span class="params">a</span>, <span class="params">b</span>=<span class="params">b</span>)</span>)</span><br></pre></td></tr></tbody></table></figure> <strong>spin_until_feature_complete</strong>éç¨äºå¨mainå½æ°ä¸­ç´æ¥å®ä¹clientæ¶ä½¿ç¨ï¼å¦ææ¯å¨classä¸­å®ä¹clientï¼åéè¦ä½¿ç¨futureç<strong>add_done_callback</strong>å½æ°ï¼å¨å¼æ­¥è¯·æ±serverå®æåï¼è°ç¨åè°å½æ°ã<strong>partial</strong>ç±»å¯ä»¥å¨ä¼ å¥åè°å½æ°çæ¶åï¼ä¼ å¥å¶ä»åæ°ã * å¤çResponse <figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">try:</span><br><span class="line">    response = future.<span class="built_in">result</span>()</span><br><span class="line">    node.<span class="built_in">get_logger</span>().<span class="built_in">info</span>(<span class="built_in">str</span>(request.a) + <span class="string">"+"</span> + <span class="built_in">str</span>(request.b) + <span class="string">"="</span> + <span class="built_in">str</span>(response.sum))</span><br><span class="line">except Exception as e:</span><br><span class="line">    node.<span class="built_in">get_logger</span>().<span class="built_in">error</span>(<span class="string">"Service call failed %r"</span> % (e,))</span><br></pre></td></tr></tbody></table></figure> éè¦ä½¿ç¨try-exceptç»æå¤çè¿åçresponseã ##### C++ * å®ä¹Client <figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">auto client = <span class="keyword">node</span><span class="title">-&gt;create_client</span><span class="tag">&lt;example_interfaces::srv::AddTwoInts&gt;</span>(<span class="string">"add_two_ints"</span>);</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>create_client</strong>å½æ°å®ä¹clientï¼éè¦æå®æ°æ®ç±»åï¼ä»éè¦ä¼ å¥ä¸ä¸ªåæ°ï¼å³Serviceçåå­ãclientæ ¹æ®åå­ä¸serverè¿è¡éä¿¡ã * ç­å¾Server Ready <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(!client-&gt;wait<span class="constructor">_for_service(<span class="params">std</span>::<span class="params">chrono</span>::<span class="params">seconds</span>(1)</span>))</span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_WARN(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"Waiting for server to be ready..."</span>);</span><br><span class="line">}</span><br><span class="line"><span class="constructor">RCLCPP_INFO(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"AddTwoInts server is ready."</span>);</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>wait_for_service</strong>å½æ°ç­å¾server readyãä¸pythonæ¥å£ç±»ä¼¼ï¼å½server readyæ¶ï¼<strong>wait_for_service</strong>å½æ°è¿åtrueï¼å¦åè¿åfalseï¼å¥åä¸ºç­å¾æ¶é´ã * è¯·æ±Server <figure class="highlight rust"><table><tbody><tr><td class="code"><pre><span class="line">auto request = std::make_shared&lt;example_interfaces::srv::AddTwoInts::Request&gt;();</span><br><span class="line">request<span class="punctuation">-&gt;</span>a = <span class="number">34</span>;</span><br><span class="line">request<span class="punctuation">-&gt;</span>b = <span class="number">56</span>;</span><br><span class="line">auto future = client<span class="punctuation">-&gt;</span><span class="title function_ invoke__">async_send_request</span>(request);</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨å¼æ­¥æ¥å£åéè¯·æ±ï¼å¥åä¸º<strong>request</strong>ï¼è¿åå¼ä¸º<strong>future</strong>ã * å¤çResponse <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(rclcpp::spin<span class="constructor">_until_future_complete(<span class="params">node</span>, <span class="params">future</span>)</span><span class="operator"> == </span>rclcpp::FutureReturnCode::SUCCESS)</span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_INFO(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"%ld+%ld=%ld"</span>, request-&gt;a, request-&gt;b, future.get<span class="literal">()</span>-&gt;sum);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_ERROR(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"Error while calling add_two_ints service"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>spin_until_future_complete</strong>å½æ°ç­å¾futureå®æï¼å¹¶æ ¡éªå®æç¶æãç¶æä¸ºæåï¼åå¤çè¿åå¼ï¼å¤±è´¥ï¼åæå°å¤±è´¥ä¿¡æ¯ã ä¸è¿°æ¹æ³æ¯ä½¿ç¨<strong>no_oop</strong>çæ¹æ³å®ç°ï¼ç´æ¥å¨mainå½æ°ä¸­å©ç¨rosæä¾ç<strong>spin_until_future_complete</strong>æ¥å£å®ç°å¼æ­¥è¯·æ±çé»å¡ãå¯¹äº<strong>oop</strong>çæ¹å¼ï¼å¨ç±»ä¸­æ æ³ä½¿ç¨ä¸è¿°æ¥å£ï¼éè¦ç´æ¥ä½¿ç¨<strong>future.get</strong>æ¥å£å®ç°é»å¡ï¼ä¸ºäºè½ä¿è¯åå§åå½æ°å®æï¼éè¦å°è¯·æ±æ¾å¨å¤çº¿ç¨ä¸­å®ç°ã <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">std::vector&lt;std::thread&gt; threads_;</span><br><span class="line">threads_.push<span class="constructor">_back(<span class="params">std</span>::<span class="params">thread</span>(<span class="params">std</span>::<span class="params">bind</span>(&amp;AddTwoIntsClientNode::<span class="params">callAddTwoIntsService</span>, <span class="params">this</span>, 89, 12)</span>));</span><br><span class="line"><span class="comment">// parse response</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">{</span><br><span class="line">    auto response = future.get<span class="literal">()</span>;</span><br><span class="line">    <span class="constructor">RCLCPP_INFO(<span class="params">this</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"%d+%d=%ld"</span>, a, b, response-&gt;sum);</span><br><span class="line">}</span><br><span class="line">catch(const std::<span class="keyword">exception</span>&amp; e)</span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_ERROR(<span class="params">this</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"Service call failed: %s"</span>, e.what<span class="literal">()</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> ### Interfaces å¨<strong>topic</strong>å<strong>service</strong>ä¸­åé¡»æä¾æ¶æ¯ç±»åï¼å¨rosä¸­è¿é¨åç»ä¸æ¾å¨<strong>interfaces</strong>ä¸­ã #### Common Interfaces ä¸ºäºä¾¿äºå¼ååä½¿ç¨ï¼<strong>ROS</strong>éå¯¹æºå¨äººé¢åå¸¸ç¨çåè½ï¼æä¾äºä¸ä»½å®æ¹ç<strong>msg</strong>å<strong>srv</strong>ï¼ç»ä¸æ¾å¨<a href="https://github.com/ros2/common_interfaces">common interfaces</a> * geometry_msgs å®ä¹äºå ä½æ¬åç¸å³çæ¶æ¯ç±»åï¼ä¾å¦ç¹ãåéãå§¿æç­ãå·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/geometry_msgs">https://github.com/ros2/common_interfaces/tree/rolling/geometry_msgs</a> * nav_msgs å®ä¹äºæºå¨äººå¯¼èªç¸å³çæ¶æ¯åæå¡ç±»åï¼ä¾å¦å°å¾ãéç¨è®¡åè½¨è¿¹ç­ãå·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/nav_msgs">https://github.com/ros2/common_interfaces/tree/rolling/nav_msgs</a> * sensor_msgs å®ä¹äºä¸ä¼ æå¨è®¾å¤ç¸å³çæ¶æ¯åæå¡ç±»åï¼ä¾å¦å¾åãIMUãç¹äºãææç­ãå·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/sensor_msgs">https://github.com/ros2/common_interfaces/tree/rolling/sensor_msgs</a> * shape_msgs å®ä¹äºä¸ç»´å½¢ç¶ï¼ä¾å¦å¹³é¢ãåä½ç­ãå·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/shape_msgs">https://github.com/ros2/common_interfaces/tree/rolling/shape_msgs</a> * std_msgs å®ä¹äºåºç¡æ°æ®ç±»åçæ¶æ¯ï¼ä¾å¦boolãstringãintãfloatç­ãå·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/std_msgs">https://github.com/ros2/common_interfaces/tree/rolling/std_msgs</a> * std_srvs å®ä¹äºåºç¡æ°æ®ç±»åçæå¡ï¼ä¾å¦boolãstringãintãfloatç­ãå·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/std_srvs">https://github.com/ros2/common_interfaces/tree/rolling/std_srvs</a> * stereo_msgs å®ä¹äºè§å·®å¾åç¸å³çæ¶æ¯ï¼å·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/stereo_msgs">https://github.com/ros2/common_interfaces/tree/rolling/stereo_msgs</a> * trajectory_msgs å®ä¹äºæºå¨äººå³èè½¨è¿¹ç¸å³çæ¶æ¯ï¼å·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/trajectory_msgs">https://github.com/ros2/common_interfaces/tree/rolling/trajectory_msgs</a> * visualization_msgs å®ä¹äº3Då¯è§åç¸å³çæ¶æ¯åæå¡ç±»åï¼ä¾å¦å¨rvizä¸­ä½¿ç¨çãå·ä½è§ï¼<a href="https://github.com/ros2/common_interfaces/tree/rolling/visualization_msgs">https://github.com/ros2/common_interfaces/tree/rolling/visualization_msgs</a><p></p>
<h4 id="custom-interfaces">Custom Interfaces</h4>
<p>é¤äº<strong>ROS</strong>æä¾çæ¶æ¯åæå¡ç±»åï¼æä»¬è¿å¯ä»¥èªå·±å®ä¹æ¶æ¯åæå¡ç±»åã ##### Create Interface Package èªå®ä¹<strong>interfaces</strong>ä¸è¬ç»ä¸æ¾å¨ä¸ä¸ªpackageä¸­ï¼å æ­¤éè¦åå»ºä¸ä¸ªpackageã </p><figure class="highlight gauss"><table><tbody><tr><td class="code"><pre><span class="line">ros2 pkg <span class="keyword">create</span> my_robot_interfaces</span><br></pre></td></tr></tbody></table></figure> <strong>interfaces</strong>çåä¸éè¦æå®<strong>build-type</strong>å<strong>dependencies</strong>åæ°ãé»è®¤åå»ºçæ¯ä¸ä¸ªcppè¯­è¨çåï¼ä½æ¯<strong>interfaces</strong>ä¸éè¦<strong>include</strong>å<strong>src</strong>æä»¶å¤¹ï¼å æ­¤ç¨ä»¥ä¸æä»¤å é¤ã <figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">cd</span> my_robot_interfaces</span><br><span class="line"><span class="keyword">rm</span> -rf <span class="keyword">include</span></span><br><span class="line"><span class="keyword">rm</span> -rf src</span><br></pre></td></tr></tbody></table></figure> <strong>interfaces</strong>ä¸è¬åæ¬æ¯æ<strong>topic</strong>çæ¶æ¯åæ¯æ<strong>service</strong>çæå¡ï¼å æ­¤åå«åå»ºä¸¤ä¸ªæä»¶å¤¹ã <figure class="highlight arduino"><table><tbody><tr><td class="code"><pre><span class="line">mkdir msg</span><br><span class="line">mkdir srv</span><br></pre></td></tr></tbody></table></figure> ##### Setup Configuration * package.xml <strong>interfaces</strong>çåä¸å¶ä»åçéç½®ä¸ä¸æ ·ï¼éè¦åç¬éç½®ãé¦åå¨<strong>package.xml</strong>ä¸­æ·»å ä»¥ä¸éç½®ï¼ <figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rosidl_default_generators<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rosidl_default_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">member_of_group</span>&gt;</span>rosidl_interface_packages<span class="tag">&lt;/<span class="name">member_of_group</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> * CMakeLists.txt <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">find_package</span><span class="params">(rosidl_default_generators REQUIRED)</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rosidl_generate_interfaces</span>(${PROJECT_NAME}</span><br><span class="line">  <span class="string">"msg/HardwareStatus.msg"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ament_export_dependencies</span><span class="params">(rosidl_default_runtime)</span></span></span><br></pre></td></tr></tbody></table></figure> ##### topicæ¶æ¯ ä¸ä¸ªtopicæ¶æ¯ä¸ºä¸ä¸ªåç¼ä¸º<strong>msg</strong>çæä»¶ï¼ç»ä¸æ¾å¨<strong>msg/</strong>æä»¶å¤¹ä¸é¢ã <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> msg</span><br><span class="line">create HardwareStatus.msg</span><br></pre></td></tr></tbody></table></figure> åå»ºæä»¶ä¹åï¼å¨<strong>CMakeLists.txt</strong>ä¸­ç<strong>rosidl_generate_interfaces</strong>æ·»å æä»¶è·¯å¾ã ä½¿ç¨åºç¡ç±»åå®ä¹æ¶æ¯ï¼å¦ä¸æç¤ºï¼ <figure class="highlight angelscript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">int64</span> temperature</span><br><span class="line"><span class="built_in">bool</span> are_motors_ready</span><br><span class="line"><span class="built_in">string</span> debug_message</span><br></pre></td></tr></tbody></table></figure> ä»¥ä¸æ¶æ¯å®ä¹äºä¸ä¸ªåéï¼åå«ä¸ºint64ç±»åçtemperatureï¼boolç±»åçare_motors_readyåstringç±»åçdebug_message ##### ç¼è¯ ä½¿ç¨ä»¥ä¸æä»¤ç¼è¯interfacesåã <figure class="highlight n1ql"><table><tbody><tr><td class="code"><pre><span class="line">colcon <span class="keyword">build</span> --packages-<span class="keyword">select</span> my_robot_interfaces </span><br></pre></td></tr></tbody></table></figure> ç¼è¯å®éè¦sourceä¸ä¸ã ##### ä½¿ç¨ æ ¹å¶ä»åä¸æ ·ï¼ç¼è¯å¥½çåä¼ç»ä¸æ¾å¨å·¥ä½ç©ºé´ç<strong>install</strong>æä»¶å¤¹ä¸é¢ã ä½¿ç¨æ¹æ³æ ¹ä½¿ç¨rosæä¾çcommon interfacesä¸æ ·ï¼ä½æ¯éè¦å¨vscodeä¸­éç½®auto completeçæ¯æã * python auto complete å¨<strong>setting.json</strong>ä¸­ç<strong>python.autoComplete.extraPaths</strong>å<strong>python.analysis.extraPaths</strong>éç½®ä¸­å°ç¼è¯å¥½çè·¯å¾æ·»å è¿å»ï¼å¦ä¸æç¤º <figure class="highlight 1c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">"/home/robot/ros2_ws/install/my_robot_interfaces/local/lib/python3.10/dist-packages"</span></span><br></pre></td></tr></tbody></table></figure> * cpp auto complete å¨<strong>c_cpp_properties.json</strong>ä¸­å°ç¼è¯å¥½ç<strong>interfaces</strong>åè·¯å¾æ·»å è¿å»ã <figure class="highlight 1c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">"/home/robot/ros2_ws/install/my_robot_interfaces/include/**"</span></span><br></pre></td></tr></tbody></table></figure> ##### serviceæå¡ ä¸ä¸ªServiceæå¡ä¸ºä¸ä¸ªåç¼ä¸º<strong>srv</strong>çæä»¶ï¼ç»ä¸æ¾å¨<strong>srv/</strong>æä»¶å¤¹ä¸é¢ã<p></p>
<h3 id="parameters">Parameters</h3>
<p><strong>Parameters</strong>æ¨¡åå¯ä»¥å¨èç¹è¿è¡æ¶æä¾åæ°éç½®ã #### Declare Parameters * Python </p><figure class="highlight lasso"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">self</span>.declare_parameter(<span class="string">"test123"</span>, <span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure> <strong>declare_parameter</strong>çpythonæ¥å£éè¦ä¼ å¥ä¸¤ä¸ªåæ°ï¼ä¸ä¸ªæ¯parameterçåç§°ï¼å¦å¤ä¸ä¸ªæ¯parameterçé»è®¤å¼ã * C++ <figure class="highlight lisp"><table><tbody><tr><td class="code"><pre><span class="line">this-&gt;declare_parameter(<span class="string">"test123"</span>, rclcpp:<span class="symbol">:ParameterType</span>:<span class="symbol">:PARAMETER_STRING</span>)<span class="comment">;</span></span><br></pre></td></tr></tbody></table></figure> <strong>declare_parameter</strong>çC++æ¥å£è°ç¨æ¹å¼å¤æ ·ï¼é¤äºparameteråç§°ï¼è¿å¯ä»¥æå®åæ°çç±»åã #### Use Parameters * Python <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable language_">self</span>.number_ = <span class="variable language_">self</span>.get_parameter(<span class="string">"number_to_publish"</span>).value</span><br></pre></td></tr></tbody></table></figure> <strong>get_parameter</strong>æ¥å£å¯ä»¥è·åå£°æå¥½çåæ°ï¼ç¨*value<strong>ååºå¯¹åºçå¼ã * C++ <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">number_</span> = this-&gt;get_parameter(<span class="string">"number_to_publish"</span>).as_int()<span class="comment">;</span></span><br></pre></td></tr></tbody></table></figure> </strong>get_parameter**æ¥å£éè¦æ¾ç¤ºè¿åæå®ç±»åçæ°æ®ã<p></p>
<h3 id="launch-file">Launch File</h3>
<p><strong>Launch File</strong>ç¨äºéç½®å¤ä¸ªèç¹çè¿è¡ä¿¡æ¯ï¼å¯ä»¥å¾æ¹ä¾¿çç®¡çæ¯ä¸ªèç¹ççåç§°ãå¥åç­ä¿¡æ¯ã #### Create Launch Package è·<strong>interfaces</strong>ç±»ä¼¼ï¼<strong>launch file</strong>ä¹åç¬æ¾å¨ä¸ä¸ªpackageä¸­è¿è¡ç®¡çãå æ­¤ï¼é¦åä½¿ç¨ä»¥ä¸å½ä»¤åå»ºpackageã </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/ros2_ws/src</span><br><span class="line">ros2 pkg create my_robot_bringup</span><br></pre></td></tr></tbody></table></figure> åå»ºpackageä¸éè¦æå®<strong>build-type</strong>å<strong>dependencies</strong>ãé»è®¤åå»ºçpackageæä»¶å¤¹æ¯cppç»æçï¼å°ä¸éè¦çæä»¶å¤¹å é¤ã <figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">rm</span> -rf <span class="keyword">include</span></span><br><span class="line"><span class="keyword">rm</span> -rf src</span><br></pre></td></tr></tbody></table></figure> åå»º<strong>launch</strong>æä»¶å¤¹ <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">mkdir <span class="built_in">launch</span></span><br></pre></td></tr></tbody></table></figure> å¨<strong>CMakeLists.txt</strong>ä¸­éç½®ç¼è¯åçå®è£ç®å½ã <figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(DIRECTORY</span><br><span class="line">  launch</span><br><span class="line">  DESTINATION share/<span class="variable">${PROJECT_NAME}</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°éç½®å°å¨/home/robot/ros2_ws/install/my_robot_bringup/share/my_robot_bringup/æä»¶å¤¹ä¸é¢åå»º<strong>launch</strong>æä»¶å¤¹ï¼ææçlaunch fileé½å¨è¿ä¸ªæä»¶å¤¹ä¸­ã<p></p>
<h4 id="create-launch-file">Create Launch File</h4>
<p>å¨<strong>launch</strong>æä»¶å¤¹ä¸é¢ï¼åå»ºåç¼ä¸º.launch.pyçæä»¶ï¼å¹¶ä½¿å¶åæå¯æ§è¡æä»¶ã </p><figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">touch number_app<span class="selector-class">.launch</span><span class="selector-class">.py</span></span><br><span class="line">chmod +x number_app<span class="selector-class">.launch</span><span class="selector-class">.py</span></span><br><span class="line"><span class="selector-tag">code</span> number_app<span class="selector-class">.launch</span>.py</span><br></pre></td></tr></tbody></table></figure> <strong>launch file</strong>ä¸ºä¸ä¸ªç¹æ®çpythonæä»¶ï¼å·ä½å¦ä¸æç¤ºï¼ <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> launch import LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions import Node</span><br><span class="line"></span><br><span class="line">def generate_launch_description():</span><br><span class="line">    ld = LaunchDescription()</span><br><span class="line">    remap_number_topic = (<span class="string">"number"</span>, <span class="string">"my_number"</span>)</span><br><span class="line">    number_publisher_node = Node(</span><br><span class="line">        <span class="attribute">package</span>=<span class="string">"test_py_pkg"</span>,</span><br><span class="line">        <span class="attribute">executable</span>=<span class="string">"number_publisher"</span>,</span><br><span class="line">        <span class="attribute">name</span>=<span class="string">"my_number_publisher"</span>,</span><br><span class="line">        remappings=[</span><br><span class="line">            remap_number_topic</span><br><span class="line">        ],</span><br><span class="line">        parameters=[</span><br><span class="line">            {<span class="string">"number_to_publish"</span>: 4}</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    number_counter_node = Node(</span><br><span class="line">        <span class="attribute">package</span>=<span class="string">"test_cpp_pkg"</span>,</span><br><span class="line">        <span class="attribute">executable</span>=<span class="string">"number_counter"</span>,</span><br><span class="line">        <span class="attribute">name</span>=<span class="string">"my_number_counter"</span>,</span><br><span class="line">        remappings=[</span><br><span class="line">            remap_number_topic,</span><br><span class="line">            (<span class="string">"number_count"</span>, <span class="string">"my_number_count"</span>)</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ld.add_action(number_publisher_node)</span><br><span class="line">    ld.add_action(number_counter_node)</span><br><span class="line">    return ld</span><br></pre></td></tr></tbody></table></figure> ä»<strong>launch</strong>ä¸­å¼å¥<strong>LaunchDescription</strong>ï¼ä»<strong>launch_ros.actions</strong>ä¸­å¼å¥<strong>Node</strong>ãå¨pythonæä»¶ä¸­åå»ºåºå®åä¸º<strong>generate_launch_description</strong>çå½æ°ï¼ææçlaunch descriptioné½å¨è¯¥å½æ°ä¸­ã ä½¿ç¨<strong>Node</strong>åå»ºå¯å¨èç¹çéç½®ï¼å·ä½å·ä½å¦ä¸æç¤ºã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">number_publisher_node = Node(</span><br><span class="line">    <span class="attribute">package</span>=<span class="string">"test_py_pkg"</span>,</span><br><span class="line">    <span class="attribute">executable</span>=<span class="string">"number_publisher"</span>,</span><br><span class="line">    <span class="attribute">name</span>=<span class="string">"my_number_publisher"</span>,</span><br><span class="line">    remappings=[</span><br><span class="line">        remap_number_topic</span><br><span class="line">    ],</span><br><span class="line">    parameters=[</span><br><span class="line">        {<span class="string">"number_to_publish"</span>: 4}</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure> <strong>package</strong>åæ°æå®è¿è¡èç¹çååç§°ï¼ <strong>executable</strong>æå®èç¹çå¯æ§è¡æä»¶åç§°ï¼ <strong>name</strong>æå®èç¹çåç§°ï¼ä¸æä¾è¯¥åæ°ï¼åä½¿ç¨èç¹çé»è®¤åï¼æä¾è¯¥åæ°ï¼åç­åäºä½¿ç¨remapåæ°éå½åèç¹åç§°ï¼ <strong>remappings</strong>å¯¹topicåç§°è¿è¡éå½åï¼éè¿tupleè¿è¡remapï¼ä¾å¦("old_name", "new_name")ï¼ <strong>parameters</strong>å¯¹èç¹åå®ä¹çparametersè¿è¡èµå¼ï¼ä¼ å¥çæ¯ä¸ä¸ªmapï¼keyæ¯parametersçåç§°ï¼valueæ¯parameterå¼ã<p></p>
<p>åå»ºå®èç¹çlaunch descriptionä¹åï¼éè¦å¨<strong>package.xml</strong>ä¸­æ·»å ä¾èµï¼å·ä½å¦ä¸æç¤ºï¼ </p><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>test_py_pkg<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>test_cpp_pkg<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> å ä¸ºæ¯è¿è¡èç¹çéç½®ï¼æä»¥æ·»å <strong>exec_depend</strong>å³å¯ã<p></p>
<h4 id="ç¼è¯launch-file">ç¼è¯launch file</h4>
<p>ä½¿ç¨<strong>colcon build</strong>å½ä»¤ç¼è¯å </p><figure class="highlight n1ql"><table><tbody><tr><td class="code"><pre><span class="line">colcon <span class="keyword">build</span> --packages-<span class="keyword">select</span> my_robot_bringup</span><br></pre></td></tr></tbody></table></figure> ç¼è¯å¹¶sourceéç½®ä¹åï¼å³å¯ä½¿ç¨å½ä»¤è¡è¿è¡ã <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> my_robot_bringup number_app.<span class="built_in">launch</span>.py</span><br></pre></td></tr></tbody></table></figure> ### Data Bag <strong>bag</strong>å½ä»¤ç¨äºè®°å½rosçtopicæ°æ®ã <figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">ros2 bag record <span class="selector-attr">[topic_name1]</span> <span class="selector-attr">[topic_name2]</span> <span class="attr">--output</span> <span class="selector-attr">[record name]</span></span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤ç¨äºè®°å½æå®<strong>topics</strong>çæ°æ®ï¼å¹¶å°å¶è®°å½å¨æå®æä»¶å¤¹ä¸­ã<p></p>
<figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">ros2 bag <span class="keyword">info</span> [<span class="type">record</span> <span class="type">name</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸è¿°æä»¤ç¨äºæ¥çè®°å½ç<strong>record</strong>ä¿¡æ¯ã</p>
<figure class="highlight delphi"><table><tbody><tr><td class="code"><pre><span class="line">ros2 bag play [<span class="keyword">record</span> <span class="keyword">name</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸è¿°æä»¤ç¨äºéæ°æ­æ¾<strong>record</strong>çæ°æ®ã</p>
<figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">ros2 bag record <span class="attr">--all</span> <span class="attr">--output</span> <span class="selector-attr">[record name]</span></span><br></pre></td></tr></tbody></table></figure>
<p>ä¸è¿°æä»¤ç¨äºè®°å½ææç<strong>topic</strong>æ°æ®ã</p>
<h3 id="å½æ°æ¥å£">å½æ°æ¥å£</h3>
<h4 id="æ¥å¿æ¥å£">æ¥å¿æ¥å£</h4>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">self.get_logger().<span class="built_in">info</span>(<span class="string">"Hello World"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="åºæ¬æä»¤">åºæ¬æä»¤</h2>
<h3 id="è¿è¡èç¹">è¿è¡èç¹</h3>
<figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">ros2 run [package name] [<span class="keyword">node</span> <span class="title">name</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>ç¤ºä¾ï¼ </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> demo_nodes_cpp talker</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤ä¼è¿è¡<strong>demo_nodes_cpp</strong>åä¸é¢ç<strong>talker</strong>èç¹ã<p></p>
<figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">run</span> my_cpp_pkg cpp_node --ros-<span class="keyword">args</span> --<span class="keyword">remap</span> __node:=abs</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸è¿°æä»¤è¿è¡èç¹å¹¶ä¸å°èç¹éå½åä¸º<strong>abs</strong>.</p>
<figure class="highlight stata"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">run</span> my_cpp_pkg robot_news_station --ros-<span class="keyword">args</span> --<span class="keyword">remap</span> __node:=my_station --<span class="keyword">remap</span> robot_news:=my_news</span><br><span class="line">ros2 <span class="keyword">run</span> my_cpp_pkg smartphone --ros-<span class="keyword">args</span> -<span class="keyword">remap</span> robot_news:=my_news</span><br></pre></td></tr></tbody></table></figure>
<p><strong>remap</strong>æä»¤é¤äºå¯ä»¥å°èç¹éå½åï¼è¿å¯ä»¥å°topicå½åã</p>
<h3 id="æ¥çèç¹graph">æ¥çèç¹graph</h3>
<figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">rqt_graph</span></span><br></pre></td></tr></tbody></table></figure>
<p>å¯ä»¥ä»¥graphçå½¢å¼ä¸­å±ç¤ºäºææè¿è¡çèç¹ï¼ä»¥åèç¹ä¹é´çå³ç³»ã <strong>æ³¨æï¼rqt_graphä¸è½æ¥çServices</strong> ### æ¥çèç¹ * åä¸¾æ­£å¨è¿è¡çæænode </p><figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">node</span> <span class="title">list</span></span><br></pre></td></tr></tbody></table></figure> * æ¥çæå®nodeçä¿¡æ¯ <figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">node</span> <span class="title">info</span> [<span class="keyword">node</span> <span class="title">name</span>]</span><br></pre></td></tr></tbody></table></figure> ### æ¥çæå¡ * åä¸¾æ­£å¨è¿è¡çæææå¡ <figure class="highlight lsl"><table><tbody><tr><td class="code"><pre><span class="line">ros2 service <span class="type">list</span></span><br></pre></td></tr></tbody></table></figure> * æ¥çæå®serviceçç±»åä¿¡æ¯ <figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">ros2 service <span class="keyword">type</span> <span class="type">[<span class="keyword">type</span> </span>name]</span><br></pre></td></tr></tbody></table></figure> * è°ç¨æå®çservice <figure class="highlight pgsql"><table><tbody><tr><td class="code"><pre><span class="line">ros2 service <span class="keyword">call</span> [<span class="keyword">type</span> <span class="type">name</span>] [<span class="keyword">type</span>] [<span class="keyword">values</span>]</span><br><span class="line">ros2 service <span class="keyword">call</span> /add_two_ints example_interfaces/srv/AddTwoInts "{'a':1, 'b':2}"</span><br></pre></td></tr></tbody></table></figure> ä¼ å¥çvaluesæ¯jsonæ ¼å¼çæ°æ®ã<p></p>
<h3 id="turtlesim-package">turtlesim package</h3>
<p>è¿è¡turtlesim ä»¿çç¯å¢ </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> turtlesim turtlesim_node</span><br></pre></td></tr></tbody></table></figure> è¿è¡é®çæ§å¶èç¹ <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> turtlesim turtle_teleop_key</span><br></pre></td></tr></tbody></table></figure> ### æ¥çtopic <strong>topic</strong>ç¨äºrosèç¹ä¹é´éä¿¡ï¼<strong>publisher</strong>å<strong>topic</strong>åéä¿¡æ¯ï¼<strong>subscriber</strong>ä»<strong>topic</strong>æ¥æ¶ä¿¡æ¯ã<strong>topic</strong>ä¿è¯äºrosèç¹ä¹é´æ¯ç¬ç«è¿è¡çã<p></p>
<p><strong>topic</strong>ä¸è¬ç±ä¸é¨åç»æï¼topicç±»åãåå¸èãçå¬èã</p>
<p><strong>topic</strong>æ¯å¿åçï¼<strong>subscriber</strong>å¯ä»¥éè¿åå­è®¢é<strong>topic</strong>ï¼ä½æ¯å¹¶ä¸ç¥éæ¯åªä¸ª<strong>publisher</strong>åå¸çã </p><figure class="highlight lsl"><table><tbody><tr><td class="code"><pre><span class="line">ros2 topic <span class="type">list</span></span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤å¯ä»¥åä¸¾æ­£å¨è¿è¡çtopicã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 topic <span class="built_in">info</span> [topic name]</span><br><span class="line">ros2 topic <span class="built_in">info</span> /chatter</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤æ¥çæå®topicçè¯¦ç»ä¿¡æ¯ï¼åæ¬topicçæ°æ®ç±»åï¼publisherçæ°éåsubscriberçæ°éã <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ros2 topic <span class="built_in">echo</span> [topic name]</span><br><span class="line">ros2 topic <span class="built_in">echo</span> /chatter</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤å¯ä»¥æå°æå®topicçåå®¹ã <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">ros2 topic hz [topic name]</span><br><span class="line">ros2 topic hz <span class="regexp">/turtle1/</span>pose</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤å¯ä»¥çå¬æå®topicçå¨æã <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">ros2 topic bw [topic name]</span><br><span class="line">ros2 topic bw <span class="regexp">/turtle1/</span>pose</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤å¯ä»¥çå¬æå®topicçæ¶æ¯çå¸¦å®½ã <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">ros2 topic pub -r <span class="number">10</span> <span class="regexp">/robot_news  example_interfaces/m</span>sg/String <span class="string">"{data: 'This is a test.'}"</span></span><br><span class="line">ros2 topic pub <span class="regexp">/cmd_vel geometry_msgs/m</span>sg/Twist <span class="string">"{linear: {x: 0.1, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 1.0}}"</span></span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤å¯ä»¥åæå®topicåéæ¶æ¯ã<p></p>
<h3 id="æ¥çæ¥å£å®ä¹">æ¥çæ¥å£å®ä¹</h3>
<figure class="highlight angelscript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">interface</span> <span class="symbol">show</span> [<span class="symbol">Object</span>]</span><br><span class="line"><span class="symbol">ros2</span> <span class="symbol">interface</span> <span class="symbol">show</span> <span class="symbol">std_msgs</span>/<span class="symbol">msg</span>/<span class="symbol">String</span></span><br></pre></td></tr></tbody></table></figure>
<p>ä½¿ç¨ä¸è¿°æä»¤å¯ä»¥æ¥çå¶å®åå®¹çæ¥å£ä¿¡æ¯ãä¾å¦å¯ä»¥æ¥çæ°æ®ç±»åçè¯¦ç»å®ä¹ã</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">interface</span> <span class="symbol">list</span></span><br></pre></td></tr></tbody></table></figure>
<p>å±ç¤ºææç<strong>msg</strong>å<strong>srv</strong>ï¼åæ¬roså®æ¹å®ä¹çåèªå®ä¹çã</p>
<figure class="highlight ada"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">interface</span> <span class="keyword">package</span> <span class="title">geometry_msgs</span></span><br></pre></td></tr></tbody></table></figure>
<p>å±ç¤ºæå®packageä¸é¢çææ<strong>msg</strong>å<strong>srv</strong>ã</p>
<h3 id="parameter">Parameter</h3>
<ul>
<li>æ¥çèç¹çææåæ° <figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">param</span> list</span><br></pre></td></tr></tbody></table></figure> å¯ä»¥åä¸¾ææèç¹çææåæ°ã</li>
<li>æ¥çæå®èç¹æå®åæ°çå¼ <figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">param</span> <span class="built_in">get</span> [node_name] [param_name]</span><br><span class="line">ros2 <span class="built_in">param</span> <span class="built_in">get</span> /number_publisher test123</span><br></pre></td></tr></tbody></table></figure></li>
<li>è¿è¡èç¹ï¼æä¾åæ°å¼ <figure class="highlight dsconfig"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">ros2</span> <span class="string">run</span> <span class="string">test_cpp_pkg</span>  <span class="string">number_publisher</span> <span class="built_in">--ros-args</span> <span class="built_in">--param</span> <span class="string">test123</span>:=<span class="string">"Hello"</span></span><br><span class="line"><span class="string">ros2</span> <span class="string">run</span> <span class="string">my_cpp_pkg</span> <span class="string">led_panel</span> <span class="built_in">--ros-args</span> <span class="built_in">--param</span> <span class="string">led_states</span>:=<span class="string">"[3,4,5]"</span></span><br></pre></td></tr></tbody></table></figure> ç¬¬ä¸æ¡æä»¤ä¼ å¥äºâHelloâå­ç¬¦ä¸²ç»<strong>test123</strong>ï¼ç¬¬äºæ¡æä»¤ä¼ å¥äº{3,4,5}çintç±»åçarrayç»<strong>led_states</strong>ã</li>
</ul>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>ROS</category>
      </categories>
      <tags>
        <tag>ROS</tag>
      </tags>
  </entry>
  <entry>
    <title>ROS2 Learning Notes RViz &amp; Gazebo</title>
    <url>/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸»è¦ä¸º<strong>ROS2 Humble</strong>çå­¦ä¹ ç¬è®°ï¼ä¸»è¦åæ¬å¦ä½ä½¿ç¨<strong>URDF</strong>å¨ä»¿çç¯å¢<strong>Gazebo</strong>ä¸­æ§å¶æºå¨äººã* * ä½¿ç¨<strong>URDF</strong>å®ä¹æºå¨äºº * å¨<strong>Gazebo</strong>ä¸­ä»¿çæºå¨äºº * ä½¿ç¨<strong>Gazebo</strong>çæä»¶æ§å¶æºå¨äººè¿å¨ * æåæ´ä¸ªæºå¨äººåºç¨ <span id="more"></span> ## Transform ### Visualize a robot tfs in RViz2 å®è£urdf tutorial package å tf2 tools. </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-urdf-tutorial</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-tf2-tools</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>å®è£æååï¼å¯ä»¥å°ä»¥ä¸è·¯å¾æ¥çå·²ç»å®ä¹å¥½çurdfæä»¶ã </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">cd <span class="regexp">/opt/</span>ros<span class="regexp">/humble/</span>share<span class="regexp">/urdf_tutorial/u</span>rdf</span><br></pre></td></tr></tbody></table></figure> <strong>share</strong>æä»¶å¤¹æ¯ææros packageæ¾ç½®çå°æ¹ã<p></p>
<p>ä½¿ç¨ä»¥ä¸å½ä»¤å¯ä»¥æ¥çä¸ä¸ªæå®çurdfæä»¶å®ä¹çrobotã </p><figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> urdf_tutorial display.<span class="built_in">launch</span>.py model:=urdf/<span class="number">08</span>-macroed.urdf.xacro</span><br></pre></td></tr></tbody></table></figure> å¯å¨æºå¨äººåï¼ä¼å¨<strong>RViz</strong>ä¸­æ¾ç¤ºæºå¨äººä»¥åæºå¨äººç<strong>tf</strong>ãå¹¶ä¼æä¸ä¸ª<strong>tf</strong>çtopicï¼ä»¥arrayçå½¢å¼å®æ¶åå¸æ¯ä¸ªå³èç<strong>tf</strong>å¼ã <figure class="highlight nestedtext"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">header:</span></span><br><span class="line">    <span class="attribute">stamp</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">sec</span><span class="punctuation">:</span> <span class="string">1703555328</span></span><br><span class="line">      <span class="attribute">nanosec</span><span class="punctuation">:</span> <span class="string">545975035</span></span><br><span class="line">    <span class="attribute">frame_id</span><span class="punctuation">:</span> <span class="string">gripper_pole</span></span><br><span class="line">  <span class="attribute">child_frame_id</span><span class="punctuation">:</span> <span class="string">left_gripper</span></span><br><span class="line">  <span class="attribute">transform</span><span class="punctuation">:</span></span><br><span class="line">    <span class="attribute">translation</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">x</span><span class="punctuation">:</span> <span class="string">0.2</span></span><br><span class="line">      <span class="attribute">y</span><span class="punctuation">:</span> <span class="string">0.01</span></span><br><span class="line">      <span class="attribute">z</span><span class="punctuation">:</span> <span class="string">0.0</span></span><br><span class="line">    <span class="attribute">rotation</span><span class="punctuation">:</span></span><br><span class="line">      <span class="attribute">x</span><span class="punctuation">:</span> <span class="string">0.0</span></span><br><span class="line">      <span class="attribute">y</span><span class="punctuation">:</span> <span class="string">0.0</span></span><br><span class="line">      <span class="attribute">z</span><span class="punctuation">:</span> <span class="string">0.0</span></span><br><span class="line">      <span class="attribute">w</span><span class="punctuation">:</span> <span class="string">1.0</span></span><br></pre></td></tr></tbody></table></figure> æ¶æ¯ç»æä¸»è¦æä¸é¨åï¼<strong>header</strong>ä¸»è¦åæ¬æ¶é´æ³åå¸§idï¼<strong>child_frame_id</strong>ä¸»è¦æ¯ä¸å½å<strong>tf</strong>åæ§å³èçå­<strong>tf</strong>ï¼<strong>transform</strong>è¡¨ç¤ºäºå½å<strong>tf</strong>åchild <strong>tf</strong>çå¹³ç§»æè½¬å³ç³»ã æºå¨äººçææ<strong>tf</strong>ä¼ä»¥æ ç¶ç»ææ¾ç¤ºï¼å·ä½å¯ä»¥ä½¿ç¨ä»¥ä¸æä»¤æ¥çã <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">ros2</span> run tf2_tools view_frames</span><br><span class="line"><span class="attribute">open</span> frames_2023-<span class="number">12</span>-<span class="number">26</span>_09.<span class="number">52</span>.<span class="number">01</span>.pdf</span><br></pre></td></tr></tbody></table></figure> é¤äºæ¥ç<strong>urdf</strong>æå®ä¹ç<strong>tf tree</strong>ï¼æä»¬è¿å¯ä»¥æ¥çä¸¤ä¸ªå³èä¹é´çåæ¢å³ç³»ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> tf2_ros tf2_echo base_link horizontal_arm</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤å¯ä»¥å®æ¶æ¥çä¸¤ä¸ªå³èä¹é´çåæ¢å³ç³»ã<p></p>
<h3 id="create-a-urdf-file">Create a URDF File</h3>
<ul>
<li>Unified Robot Description Format</li>
<li>Used to generate TFs</li>
<li>XML format #### Create and Visualize a Link <figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">"my_robot"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"green"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0 0.5 0 1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"blue"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0 0.0 0.5 1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"grey"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">color</span> <span class="attr">rgba</span>=<span class="string">"0.5 0.5 0.5 1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.6 0.4 0.2"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"green"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"second_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"0.1"</span> <span class="attr">length</span>=<span class="string">"0.2"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"grey"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"third_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"0.1 0.1 0.1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.05"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"blue"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"base_second_joint"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"second_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.2"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"second_third_joint"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"second_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"third_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.2"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> ç¬¬ä¸å¥æ æurdfæä»¶çxmlçæ¬ã ##### åºæ¬ç»æ</li>
<li>robot, å®ä¹äºä¸ä¸ªæºå¨äººï¼åç§°ä½¿ç¨nameå±æ§æ ç­¾å½å
<ul>
<li>linkï¼å®ä¹äºæºå¨äººçä¸ä¸ªé¨ä½ï¼åé¨åå«ä¸ä¸ªvisualæ ç­¾
<ul>
<li>geometry, å®ä¹äºå ä½å½¢ç¶ï¼ä¾å¦boxï¼cylinderç­ç­</li>
<li>originï¼å®ä¹äºå ä½ä½çä¸­å¿åç¹ç¸å¯¹äºlinkåæ ç³»çç¸å¯¹ä½ç½®å³ç³»ï¼äºèé»è®¤éå ã</li>
<li>materialï¼å®ä¹äºlinkçææï¼ä¾å¦é¢è²ç­ç­</li>
</ul></li>
<li>jointï¼å®ä¹äºä¸¤ä¸ªlinkä¹é´çå³ç³»ï¼ç¨nameæ è¯å½åï¼è¿ætypeå±æ§å¼ã
<ul>
<li>parentï¼å®ä¹äºç¶link</li>
<li>childï¼å®ä¹äºå­link</li>
<li>originï¼å®ä¹äºå­linkåæ ç³»ä¸ç¶linkåæ ç³»ä¹é´çç¸å¯¹ä½ç½®å³ç³»</li>
</ul></li>
<li>materialï¼å®ä¹äºææå±æ§ï¼ä½¿ç¨nameå½åæ è¯ï¼ä¾å¦é¢è²ç­ç­ã</li>
</ul></li>
</ul>
<h5 id="joint-ç±»å">joint ç±»å</h5>
<p><strong>joint</strong>å®ä¹äºä¸¤ä¸ªåä½ä¹é´çè¿å¨ï¼å æ­¤å¶ç±»åæ¯å¤ç§å¤æ ·çã * fixed ä¸¤ä¸ªåä½ä¹é´æ¯åºå®çï¼æ æ³ç§»å¨ï¼å æ­¤åªéè¦å®ä¹<strong>parent link</strong>ã<strong>child link</strong>å<strong>origin</strong>å³å¯ã</p>
<ul>
<li><p>revolute </p><figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">&lt;joint name<span class="operator">=</span><span class="string">"base_second_joint"</span> type<span class="operator">=</span><span class="string">"revolute"</span>&gt;</span><br><span class="line">    &lt;parent link<span class="operator">=</span><span class="string">"base_link"</span>/&gt;</span><br><span class="line">    &lt;child link<span class="operator">=</span><span class="string">"second_link"</span>/&gt;</span><br><span class="line">    &lt;origin xyz<span class="operator">=</span><span class="string">"0 0 0.2"</span> rpy<span class="operator">=</span><span class="string">"0 0 0"</span>/&gt;</span><br><span class="line">    &lt;axis xyz<span class="operator">=</span><span class="string">"0 0 1"</span>/&gt;</span><br><span class="line">    &lt;limit lower<span class="operator">=</span><span class="string">"-1.57"</span> upper<span class="operator">=</span><span class="string">"1.57"</span> velocity<span class="operator">=</span><span class="string">"100"</span> effort<span class="operator">=</span><span class="string">"100"</span> /&gt;</span><br><span class="line">&lt;/joint&gt;</span><br></pre></td></tr></tbody></table></figure> å­åä½æ¯æè½¬çï¼éè¦æå®æè½¬è½´<strong>axis</strong>ä»¥åæè½¬è¿å¨ç<strong>limit</strong>ãæè½¬è½´<strong>axis</strong>éè¦ç¨xyzåéè¡¨ç¤ºï¼<strong>limit</strong>ä½¿ç¨ä¸é<strong>lower</strong>ãä¸é<strong>upper</strong>ãéåº¦<strong>velocity</strong>ãå éåº¦<strong>effort</strong>ã<p></p></li>
<li><p>continuous </p><figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">&lt;joint name<span class="operator">=</span><span class="string">"base_second_joint"</span> type<span class="operator">=</span><span class="string">"continuous"</span>&gt;</span><br><span class="line">    &lt;parent link<span class="operator">=</span><span class="string">"base_link"</span>/&gt;</span><br><span class="line">    &lt;child link<span class="operator">=</span><span class="string">"second_link"</span>/&gt;</span><br><span class="line">    &lt;origin xyz<span class="operator">=</span><span class="string">"0 0 0.2"</span> rpy<span class="operator">=</span><span class="string">"0 0 0"</span>/&gt;</span><br><span class="line">    &lt;axis xyz<span class="operator">=</span><span class="string">"0 0 1"</span>/&gt;</span><br><span class="line">    &lt;limit lower<span class="operator">=</span><span class="string">"-1.57"</span> upper<span class="operator">=</span><span class="string">"1.57"</span> velocity<span class="operator">=</span><span class="string">"100"</span> effort<span class="operator">=</span><span class="string">"100"</span> /&gt;</span><br><span class="line">&lt;/joint&gt;</span><br></pre></td></tr></tbody></table></figure> <strong>continuous</strong>ç±»åä¸<strong>revolute</strong>ç±»ä¼¼ï¼ä½æ¯æ²¡æ<strong>limit</strong>éå¶ï¼å æ­¤åªéè¦æä¾ä¸ä¸ª<strong>axis</strong>å³å¯ã<p></p></li>
<li><p>prismatic </p><figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">&lt;joint name<span class="operator">=</span><span class="string">"base_second_joint"</span> type<span class="operator">=</span><span class="string">"prismatic"</span>&gt;</span><br><span class="line">    &lt;parent link<span class="operator">=</span><span class="string">"base_link"</span>/&gt;</span><br><span class="line">    &lt;child link<span class="operator">=</span><span class="string">"second_link"</span>/&gt;</span><br><span class="line">    &lt;origin xyz<span class="operator">=</span><span class="string">"0 0 0.2"</span> rpy<span class="operator">=</span><span class="string">"0 0 0"</span>/&gt;</span><br><span class="line">    &lt;axis xyz<span class="operator">=</span><span class="string">"1 0 0"</span>/&gt;</span><br><span class="line">    &lt;limit lower<span class="operator">=</span><span class="string">"0.0"</span> upper<span class="operator">=</span><span class="string">"0.2"</span> velocity<span class="operator">=</span><span class="string">"100"</span> effort<span class="operator">=</span><span class="string">"100"</span> /&gt;</span><br><span class="line">&lt;/joint&gt;</span><br></pre></td></tr></tbody></table></figure> å®ä¹äºåä½ä¹é´çå¹³ç§»è¿å¨ï¼éè¦å¹³ç§»çæ¹å<strong>axis</strong>åå¹³ç§»çéå¶<strong>limit</strong><p></p></li>
</ul>
<h4 id="create-a-robot">Create a Robot</h4>
<p>æå·²ç»åå»ºå¥½äºä¸ä¸ªrobotçurdfæä»¶ï¼<img alt="my_robot.urdf" data-src="/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/my_robot.urdf"> ä½¿ç¨ä»¥ä¸æä»¤å¯è§åå·²ç»å®ä¹å¥½çæºå¨äººã </p><figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> urdf_tutorial display.<span class="built_in">launch</span>.py model:=/home/robot/my_robot.urdf</span><br></pre></td></tr></tbody></table></figure> <strong>model</strong>åæ°éè¦æä¾å®æ´çç»å¯¹è·¯å¾ã å¨RVizä¸­å³å¯æ¾ç¤ºæºå¨äººã <img data-src="/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/my-robot.png"> ä½¿ç¨ä»¥ä¸æä»¤å¯ä»¥æ¥çå®ä¹å¥½çtfæ ç¶ç»æã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> tf2_tools view_frames</span><br></pre></td></tr></tbody></table></figure> <img data-src="/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/my-robot-view.png"><p></p>
<h4 id="launch-urdf-step-by-step">Launch URDF Step by Step</h4>
<p>é¤äºä½¿ç¨<strong>urdf_tutorial</strong>æä¾ç<strong>display.launch.py</strong>è¿è¡å®ä¹å¥½çurdfï¼æä»¬è¿å¯ä»¥ä½¿ç¨rosçå½ä»¤è¡ä¸æ­¥ä¸æ­¥å°è¿è¡ã <img data-src="/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/urdf-rqt-graph.png"> å¦ä¸å¾ææ¯ï¼å¯è§å<strong>urdf</strong>ä¹åï¼rosä¼é»è®¤åèµ·ä¸¤ä¸ªèç¹ï¼<strong>robot_state_publisher</strong>å<strong>joint_state_publisher</strong>ã</p>
<h5 id="robot_state_publisher">robot_state_publisher</h5>
<p><strong>robot_state_publisher</strong>è´è´£è§£ææºå¨äººç<strong>urdf</strong>æä»¶ï¼å¹¶å°è§£æç»æåä¸¤ä¸ª<strong>topic</strong>åéãä¸ä¸ªæ¯<strong>robot_description</strong>ï¼åå«äº<strong>urdf</strong>æä¾çæºå¨äººæè¿°ä¿¡æ¯ï¼ä¾å¦æºå¨äººç<strong>link</strong>å<strong>joint</strong>ï¼å¦å¤ä¸ä¸ªæ¯<strong>tf</strong>ï¼åå«äºæºå¨äººæºå¨äººææç<strong>tf</strong>ä¿¡æ¯ãä¸æ­¤åæ¶ï¼è¯¥èç¹è¿çå¬ä¸ä¸ª<strong>topic</strong>ï¼åå­ä¸º<strong>joint_states</strong>ï¼ä¸»è¦çå¬å¯è¿å¨å³èçå®æ¶ç¶æä¿¡æ¯ï¼å¹¶æ ¹æ®è¿äºä¿¡æ¯å®æ¶è®¡ç®<strong>tf</strong>ç»æã </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> robot_state_publisher robot_state_publisher --ros-args --param robot_description:=<span class="string">"<span class="variable">$(xacro my_robot.urdf)</span>"</span></span><br></pre></td></tr></tbody></table></figure> ä¸è¿°æä»¤éè¦ä¼ å¥äºåå®ä¹å¥½ç<strong>urdf</strong>æä»¶ãå¦æä¸æ¯å¨ç»ä¸ç®å½ä¸è¿è¡ï¼åéè¦ä¼ å¥å®æ´ç<strong>path</strong>ã ##### joint_state_publisher <strong>joint_state_publisher</strong>çå¬<strong>robot_description</strong>çä¿¡æ¯ï¼å¹¶çææä¾é©±å¨æºå¨äººå³èè¿å¨çæ¥å£ï¼é©±å¨æºå¨äººçå³èè¿å¨ï¼å¹¶å°è¿å¨ç»æåéå°<strong>joint_states</strong>ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> joint_state_publisher_gui joint_state_publisher_gui</span><br></pre></td></tr></tbody></table></figure> ##### rviz <strong>RViz</strong>é»è®¤å¯ä»¥è§£æä¸è¿°<strong>topic</strong>çç»æï¼å æ­¤å¯å¨åå¯ä»¥å¨çé¢æå¨æ·»å <strong>robot model</strong>å<strong>tf</strong>ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> rviz2 rviz2</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="launch-file">Launch File</h3>
<h4 id="xml">XML</h4>
<figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;let name<span class="operator">=</span><span class="string">"urdf_path"</span> value<span class="operator">=</span><span class="string">"$(find-pkg-share my_robot_description)/urdf/my_robot.urdf"</span>/&gt;</span><br><span class="line">    &lt;node pkg<span class="operator">=</span><span class="string">"robot_state_publisher"</span> exec<span class="operator">=</span><span class="string">"robot_state_publisher"</span>&gt;</span><br><span class="line">        &lt;param name<span class="operator">=</span><span class="string">"robot_description"</span> value<span class="operator">=</span><span class="string">"$(command 'xacro $(var urdf_path)')"</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    &lt;node pkg<span class="operator">=</span><span class="string">"joint_state_publisher_gui"</span> exec<span class="operator">=</span><span class="string">"joint_state_publisher_gui"</span>/&gt;</span><br><span class="line">    &lt;node pkg<span class="operator">=</span><span class="string">"rviz2"</span> exec<span class="operator">=</span><span class="string">"rviz2"</span> output<span class="operator">=</span><span class="string">"screen"</span>/&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>ææçå®ä¹å¨<strong>launch</strong>æ ç­¾åã åéçå®ä¹å¨<strong>let</strong>æ ç­¾åï¼åéåä¸ºnameï¼åéå¼ä¸ºvalueã <strong>$()</strong>å¯ä»¥æä¾å¯æ§è¡å½æ°é»è¾ï¼<strong>find-pkg-share my_robot_description</strong>å¯ä»¥æä¾å½åpackageå®è£çç»å¯¹è·¯å¾ï¼<strong>command ''</strong>å¯ä»¥è¿è¡å½ä»¤è¡æä»¤ï¼å·ä½å½ä»¤è¡å¨åå¼å·åã èç¹çå®ä¹å¨<strong>node</strong>æ ç­¾åï¼éè¦è³å°æä¾ä¸¤ä¸ªåæ°ï¼ä¸ä¸ªæ¯<strong>pkg</strong>æå®èç¹åçåå­ï¼å¦å¤ä¸ä¸ªæ¯<strong>exec</strong>å¶å®å¯æ§è¡æä»¶çåå­ã åæ°çå®ä¹å¨<strong>param</strong>æ ç­¾åï¼æ ç­¾éè¦æ¾ç½®å¨<strong>node</strong>æ ç­¾åï¼éè¦æä¾<strong>name</strong>å<strong>value</strong>ä¸¤ä¸ªå±æ§å¼ã #### Python </p><figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> launch <span class="keyword">import</span> LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch.substitutions <span class="keyword">import</span> Command</span><br><span class="line"><span class="keyword">from</span> launch_ros.parameter_descriptions <span class="keyword">import</span> ParameterValue</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> ament_index_python.packages <span class="keyword">import</span> get_package_share_path</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> generate_launch_description():</span><br><span class="line">    ld = LaunchDescription()</span><br><span class="line">    urdf_path = os.path.<span class="keyword">join</span>(get_package_share_path(<span class="string">'my_robot_description'</span>), <span class="string">'urdf'</span>, <span class="string">'my_robot.urdf'</span>)</span><br><span class="line">    rviz_config_path = os.path.<span class="keyword">join</span>(get_package_share_path(<span class="string">'my_robot_description'</span>), <span class="string">'rviz'</span>, <span class="string">'default.rviz'</span>)</span><br><span class="line">    robot_description = ParameterValue(Command([<span class="string">'xacro '</span>, urdf_path]), value_type=str)</span><br><span class="line">    </span><br><span class="line">    robot_state_publisher_node = Node(</span><br><span class="line">        <span class="keyword">package</span>=<span class="string">"robot_state_publisher"</span>,</span><br><span class="line">        executable=<span class="string">"robot_state_publisher"</span>,</span><br><span class="line">        parameters=[</span><br><span class="line">            {<span class="string">'robot_description'</span>: robot_description}</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    joint_state_publisher_node = Node(</span><br><span class="line">        <span class="keyword">package</span>=<span class="string">"joint_state_publisher_gui"</span>,</span><br><span class="line">        executable=<span class="string">"joint_state_publisher_gui"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    rviz2_node = Node(</span><br><span class="line">        <span class="keyword">package</span>=<span class="string">"rviz2"</span>,</span><br><span class="line">        executable=<span class="string">"rviz2"</span>,</span><br><span class="line">        arguments=[</span><br><span class="line">            rviz_config_path</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    ld.add_action(robot_state_publisher_node)</span><br><span class="line">    ld.add_action(joint_state_publisher_node)</span><br><span class="line">    ld.add_action(rviz2_node)</span><br><span class="line">    <span class="keyword">return</span> ld</span><br></pre></td></tr></tbody></table></figure> Pythonçæ¬çlaunchæä»¶åå¿é¡»æä¸ä¸ªåä¸º<strong>generate_launch_description</strong>çæä»¶ãç¶åä»<strong>launch</strong>å¼å¥<strong>LaunchDescription</strong>ï¼ä»<strong>launch_ros.actions</strong>å¼å¥<strong>Node</strong>ã <strong>get_package_share_path</strong>å½æ°å¯ä»¥å¸®å©æä»¬åç°æå®åçå®è£è·¯å¾ã <strong>ParameterValue</strong>å¯ä»¥å®ä¹ä¸ä¸ªparameteråæ°ï¼å¹¶ä¸ä½¿ç¨<strong>Command</strong>æä»¤ã<p></p>
<h3 id="improve-urdf-with-xacro">Improve URDF with Xacro</h3>
<h4 id="support-for-xacro">Support for Xacro</h4>
<p>é¦åå°urdfæä»¶åçåç¼ç±.urdfä¿®æ¹ä¸º.urdf.xacro </p><figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">mv my_robot<span class="selector-class">.urdf</span> my_robot<span class="selector-class">.urdf</span>.xacro</span><br></pre></td></tr></tbody></table></figure> ç¶åå¨<strong>robot</strong>æ ç­¾æ·»å ä¸è¡ä»£ç ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">&lt;robot <span class="attribute">name</span>=<span class="string">"my_robot"</span>&gt;</span><br><span class="line">&lt;robot <span class="attribute">name</span>=<span class="string">"my_robot"</span> xmlns:<span class="attribute">xacro</span>=<span class="string">"http://wwww.ros.org/wiki/xacro"</span>&gt;</span><br></pre></td></tr></tbody></table></figure> #### Create Variables with Xacro Properties * å®ä¹åé <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">&lt;xacro:property <span class="attribute">name</span>=<span class="string">"base_length"</span> <span class="attribute">value</span>=<span class="string">"0.6"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>xacro:property</strong>æ ç­¾å®ä¹åéï¼åéåç¨<strong>name</strong>æ è¯ï¼åéå¼ç¨<strong>value</strong>æ è¯ã * ä½¿ç¨åé <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">&lt;origin <span class="attribute">xyz</span>=<span class="string">"<span class="variable">${-base_length/4.0}</span> -0.225 0"</span> <span class="attribute">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨${}è¡¨è¾¾å¼å¼ç¨åéã<p></p>
<h4 id="create-functions-with-xacro-properties">Create Functions with Xacro Properties</h4>
<p>é¤äºå¯ä»¥ä½¿ç¨<strong>property</strong>å®ä¹åéï¼<strong>xacro</strong>è¿æä¾äº<strong>macro</strong>ç¨äºå®ä¹å½æ°ä½ï¼ å®ä¹å¥½çå½æ°ä½å¯ä»¥åå½æ°ä¸æ ·éå¤ä½¿ç¨ã </p><figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"example_macro"</span> <span class="attr">params</span>=<span class="string">"a b c"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"dummy_link"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"$</span></span></span><span class="template-variable">{a}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{b}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{c}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> ä¸è¿°ä»£ç å®ä¹äºä¸ä¸ªåä¸º<strong>example_macro</strong>çå½æ°ä½ï¼éè¦ä¼ å¥aãbåcä¸ä¸ªåæ°ã<p></p>
<p>ä½¿ç¨å½æ°ä½ã </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">&lt;xacro:example_macro <span class="attribute">a</span>=<span class="string">"2"</span> <span class="attribute">b</span>=<span class="string">"3"</span> <span class="attribute">c</span>=<span class="string">"4"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure> ç´æ¥ä½¿ç¨<strong>xacro</strong>å¼ç¨å½æ°ä½ï¼å¹¶ä¼ å¥åæ°å³å¯ã<p></p>
<h4 id="include-xacro-files-in-another-xacro-file">Include Xacro Files in Another Xacro File</h4>
<p>é¦åå®ä¹å¥½xacroæä»¶ï¼ç¶åå©ç¨<strong>xacro:include</strong>å¼å¥æä»¶å³å¯ã </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">&lt;xacro:include <span class="attribute">filename</span>=<span class="string">"mobile_base.xacro"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="meshes-for-realrobot">Meshes for RealRobot</h3>
<p><strong>urdf</strong>éè¿<strong>geometry</strong>ç<strong>mesh</strong>æ¥å£å¼å¥çå®çæºå¨äººå½¢ç¶ç»æï¼éè¦æä¾<strong>stl</strong>æä»¶ã</p>
<h3 id="simulate-robot-with-gazebo">Simulate Robot with Gazebo</h3>
<p><strong>RViz</strong>ä¸æ¯ä¸ä¸ªä»¿çå·¥å·ï¼èä»ä»æ¯ä¸ä¸ª3Då¯è§åå·¥å·ã<strong>Gazebo</strong>æ¯ä»¿çå·¥å·ï¼å¯ä»¥æ¨¡æéååç©çå±æ§ã <strong>Gazebo</strong>æ¯ä¸ä¸ªç¬ç«çå·¥å·ï¼å¯ä»¥ç´æ¥å¨terminalä¸­å¯å¨ã </p><figure class="highlight 1c"><table><tbody><tr><td class="code"><pre><span class="line">gazebo <span class="meta">&amp;</span></span><br></pre></td></tr></tbody></table></figure> <strong>Gazebo</strong>éè¿<strong>gazebo_ros</strong>å·¥å·ä¸rosç¯å¢éä¿¡ã <strong>Gazebo</strong>æå¾å¤æä»¶ï¼ä¾å¦<strong>Control plugin</strong>å<strong>Joint State Publisher plugin</strong>ç­ç­ã #### Add Inertia Tags in URDF è¦æ³å¨<strong>Gazebo</strong>ä¸­ä»¿çï¼é¤äºæä¾å¯è§åç<strong>visual</strong>æ ç­¾ï¼è¿éè¦æä¾è·è¿å¨ç¸å³ç<strong>inertial</strong>æ ç­¾ãè§åä¸è´¨éåå¸ååçå ä½ä½çæ¯éä¸è¬å¯ä»¥æ ¹æ®å¶å ä½å½¢ç¶è®¡ç®åºæ¥ï¼å æ­¤æä»¬éè¿<strong>xacro:macro</strong>å®ä¹æ¯éå½æ°ã <strong>inertial</strong>ä¸è¬åå«ä¸é¨åï¼ 1. <strong>origin</strong>ï¼ä¸è¬è·å¯è§åç<strong>origin</strong>ä¿æä¸è´ã 2. <strong>mass</strong>ï¼è´¨éå¤§å°ï¼æä¾valueå³å¯ã 3. <strong>inertia</strong>ï¼è½¬å¨æ¯éç©éµï¼éå¸¸æ¯ä¸ä¸ª3x3çå¯¹ç§°ç©éµï¼ä¸ºäºæ¹ä¾¿ï¼éå¸¸åªéè¦æä¾ä¸ä¸è§ç©éµçæ°å¼ã<p></p>
<ul>
<li><p>ç«æ¹ä½ </p><figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"box_inertia"</span> <span class="attr">params</span>=<span class="string">"m l w h xyz rpy"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"$</span></span></span><span class="template-variable">{xyz}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">rpy</span>=<span class="string">"$</span></span></span><span class="template-variable">{rpy}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">{m}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"$</span></span></span><span class="template-variable">{(m/12)*(h*h+l*l)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">ixy</span>=<span class="string">"0"</span> <span class="attr">ixz</span>=<span class="string">"0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">iyy</span>=<span class="string">"$</span></span></span><span class="template-variable">{(m/12)*(w*w+l*l)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">iyz</span>=<span class="string">"0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">izz</span>=<span class="string">"$</span></span></span><span class="template-variable">{(m/12)*(w*w+h*h)}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> éè¦æä¾ä»¥ä¸å¥åï¼m--è´¨éï¼l--é¿åº¦ï¼w--å®½åº¦ï¼h--é«åº¦ï¼xyz--originçåç¹å¹³ç§»åéï¼rpy--originçæè½¬è§åº¦ã<p></p></li>
<li><p>åæ±ä½ </p><figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"cylinder_inertia"</span> <span class="attr">params</span>=<span class="string">"m r l xyz rpy"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"$</span></span></span><span class="template-variable">{xyz}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">rpy</span>=<span class="string">"$</span></span></span><span class="template-variable">{rpy}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">{m}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"$</span></span></span><span class="template-variable">{(m/12.0)*(3*r*r+l*l)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">ixy</span>=<span class="string">"$</span></span></span><span class="template-variable">{0}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">ixz</span>=<span class="string">"$</span></span></span><span class="template-variable">{0}</span><span class="language-xml"><span class="tag"><span class="string">"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">iyy</span>=<span class="string">"$</span></span></span><span class="template-variable">{(m/12.0)*(3*r*r+l*l)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">iyz</span>=<span class="string">"$</span></span></span><span class="template-variable">{0}</span><span class="language-xml"><span class="tag"><span class="string">"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">izz</span>=<span class="string">"$</span></span></span><span class="template-variable">{(m/2.0)*(r*r)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> éè¦æä¾ä»¥ä¸å¥åï¼m--è´¨éï¼r--åæ±çåå¾ï¼l--åæ±çé«åº¦ï¼xyzårpyåä¸ã<p></p></li>
<li><p>çä½ </p><figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"sphere_inertia"</span> <span class="attr">params</span>=<span class="string">"m r xyz rpy"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"$</span></span></span><span class="template-variable">{xyz}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">rpy</span>=<span class="string">"$</span></span></span><span class="template-variable">{rpy}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">{m}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"$</span></span></span><span class="template-variable">{(2/5*m)*(r*r)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">ixy</span>=<span class="string">"0"</span> <span class="attr">ixz</span>=<span class="string">"0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">iyy</span>=<span class="string">"$</span></span></span><span class="template-variable">{(2/5*m)*(r*r)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">iyz</span>=<span class="string">"0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">izz</span>=<span class="string">"$</span></span></span><span class="template-variable">{(2/5*m)*(r*r)}</span><span class="language-xml"><span class="tag"><span class="string">"</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> éè¦æä¾ä»¥ä¸å¥åï¼m--è´¨éï¼r--ççåå¾ï¼xyzårpyåä¸ã<p></p></li>
</ul>
<p>ä¸è¿°å½æ°è°ç¨ç´æ¥å¨<strong>link</strong>æ ç­¾åéè¿<strong>xacro</strong>è°ç¨å³å¯ï¼ä¼ å¥åå­åå¥åï¼å·ä½å¦ä¸æç¤ºã </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">&lt;xacro:box_inertia <span class="attribute">m</span>=<span class="string">"5"</span> <span class="attribute">l</span>=<span class="string">"0.6"</span> <span class="attribute">w</span>=<span class="string">"0.4"</span> <span class="attribute">h</span>=<span class="string">"0.2"</span> <span class="attribute">xyz</span>=<span class="string">"0 0 0"</span> <span class="attribute">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span><br></pre></td></tr></tbody></table></figure> #### Add Collision Tags in URDF ç¢°ææ£æµå¨ä»¿çä¸­åæ ·éè¦ï¼ç¨<strong>collision</strong>æ ç­¾å®ä¹ï¼ä¸è¬ä¸<strong>visual</strong>æ ç­¾åå®ä¹çå ä½å½¢ç¶ç¸åæèæ¯ç®åçå ä½å½¢ç¶ã <figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"$</span></span></span><span class="template-variable">{base_length}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{base_width}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{base_height}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 $</span></span></span><span class="template-variable">{base_height/2.0}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> #### Spawn Robot in Gazebo ##### Step by Step æ ¹<strong>RViz</strong>ä¸æ ·ï¼<strong>Gazebo</strong>åæ ·éè¦çå¬<strong>robot_description</strong>æ¥è·åæºå¨äººçä¿¡æ¯ï¼å æ­¤éè¦å¯å¨<strong>robot_states_publisher</strong>èç¹ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> robot_state_publisher robot_state_publisher --ros-args --param robot_description:=<span class="string">"<span class="variable">$(xacro ~/ros2_ws/src/my_robot_description/urdf/my_robot.urdf.xacro)</span>"</span></span><br></pre></td></tr></tbody></table></figure> èç¹éè¦ä¼ å¥æºå¨äººç<strong>urdf</strong>ä¿¡æ¯ã<p></p>
<p>ç¶åå¯å¨æ¯æ<strong>ROS</strong>æ¥å£ç<strong>Gazebo</strong>ã </p><figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> gazebo_ros gazebo.<span class="built_in">launch</span>.py</span><br></pre></td></tr></tbody></table></figure> éè¦å¯å¨<strong>gazebo_ros</strong>åçæ¥å£ã<p></p>
<p>æåç¨<strong>gazebo_ros</strong>åç<strong>spawn_entity</strong>èç¹çææºå¨äººã </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> gazebo_ros spawn_entity.py -topic robot_description -entity my_robot</span><br></pre></td></tr></tbody></table></figure> éè¦çå¬<strong>robot_description</strong>ä¸»ä½ï¼çæ<strong>my_robot</strong>ç<strong>entity</strong>ã ##### Using a Launch File <figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">    &lt;let name<span class="operator">=</span><span class="string">"urdf_path"</span> value<span class="operator">=</span><span class="string">"$(find-pkg-share my_robot_description)/urdf/my_robot.urdf.xacro"</span>/&gt;</span><br><span class="line">    &lt;let name<span class="operator">=</span><span class="string">"rviz_config_path"</span> value<span class="operator">=</span><span class="string">"$(find-pkg-share my_robot_description)/rviz/default.rviz"</span>/&gt;</span><br><span class="line">    &lt;node pkg<span class="operator">=</span><span class="string">"robot_state_publisher"</span> exec<span class="operator">=</span><span class="string">"robot_state_publisher"</span>&gt;</span><br><span class="line">        &lt;param name<span class="operator">=</span><span class="string">"robot_description"</span> value<span class="operator">=</span><span class="string">"$(command 'xacro $(var urdf_path)')"</span>/&gt;</span><br><span class="line">    &lt;/node&gt;</span><br><span class="line">    &lt;include file<span class="operator">=</span><span class="string">"$(find-pkg-share gazebo_ros)/launch/gazebo.launch.py"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;node pkg<span class="operator">=</span><span class="string">"gazebo_ros"</span> exec<span class="operator">=</span><span class="string">"spawn_entity.py"</span> args<span class="operator">=</span><span class="string">"-topic robot_description -entity my_robot"</span>/&gt;</span><br><span class="line">    &lt;node pkg<span class="operator">=</span><span class="string">"rviz2"</span> exec<span class="operator">=</span><span class="string">"rviz2"</span> output<span class="operator">=</span><span class="string">"screen"</span> args<span class="operator">=</span><span class="string">"$(var rviz_config_path)"</span>/&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></tbody></table></figure> <strong>launch</strong>æä»¶çç»æè·ä¹åçç±»ä¼¼ï¼ä¸è¿æ·»å äºä¸¤ä¸ªæ°çåå®¹ã 1. å¯ä»¥å¨launchæä»¶ä¸­å¼å¥å¶ä»çlaunchæä»¶ï¼ç´æ¥ç¨includeæ ç­¾æä¾æä»¶çç®å½å³å¯ã 2. è¿è¡èç¹ä¼ å¥argsï¼ä¸æ¯paramï¼,å¯ä»¥ç´æ¥ä½¿ç¨argså±æ§ã<p></p>
<h5 id="add-colors-in-gazebo">Add Colors in Gazebo</h5>
<p>è¦æ³å¨<strong>Gazebo</strong>ä¸­æ¾ç¤ºæ¯ä¸ªåä½çé¢è²ï¼éè¦ä½¿ç¨<strong>gazebo</strong>æ ç­¾å¯¹åä½çå®ä¹è¿è¡é¢å¤æè¿°ã </p><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://wwww.ros.org/wiki/xacro"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Blue<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"right_wheel_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Green<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"left_wheel_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Green<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"caster_wheel_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Grey<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> ç¨<strong>reference</strong>ææè¦æè¿°çåä½ï¼linkï¼,ç¶åç¨<strong>material</strong>æ ç­¾å»å®ä¹é¢è²ã è¿å¯ä»¥ä½¿ç¨<strong>mu</strong>æ ç­¾å®ä¹æ©æ¦ç³»æ°ã <figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span> <span class="attr">reference</span>=<span class="string">"caster_wheel_link"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">material</span>&gt;</span>Gazebo/Grey<span class="tag">&lt;/<span class="name">material</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mu1</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mu2</span> <span class="attr">value</span>=<span class="string">"0.1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h5 id="add-a-gazebo-control-plugin-to-control-robot">Add a Gazebo Control Plugin to Control Robot</h5>
<p><a href="https://classic.gazebosim.org/tutorials?tut=ros_gzplugins">å®ç½æç¨</a> <a href="git@github.com:ros-simulation/gazebo_ros_pkgs.git">Gazebo ros pkgæºç </a> </p><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">"diff_drive_controller"</span> <span class="attr">filename</span>=<span class="string">"libgazebo_ros_diff_drive.so"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Update rate in Hz --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">update_rate</span>&gt;</span>50<span class="tag">&lt;/<span class="name">update_rate</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- wheels --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">left_joint</span>&gt;</span>base_left_wheel_joint<span class="tag">&lt;/<span class="name">left_joint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">right_joint</span>&gt;</span>base_right_wheel_joint<span class="tag">&lt;/<span class="name">right_joint</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- kinematics --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheel_separation</span>&gt;</span>0.45<span class="tag">&lt;/<span class="name">wheel_separation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">wheel_diameter</span>&gt;</span>0.2<span class="tag">&lt;/<span class="name">wheel_diameter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- limits --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;max_wheel_torque&gt;200&lt;/max_wheel_torque&gt;</span></span><br><span class="line"><span class="comment">        &lt;max_wheel_acceleration&gt;10.0&lt;/max_wheel_acceleration&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- input --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;command_topic&gt;cmd_vel&lt;/command_topic&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- output --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">publish_odom</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publish_odom</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">publish_odom_tf</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publish_odom_tf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">publish_wheel_tf</span>&gt;</span>true<span class="tag">&lt;/<span class="name">publish_wheel_tf</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">odometry_topic</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometry_topic</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">odometry_frame</span>&gt;</span>odom<span class="tag">&lt;/<span class="name">odometry_frame</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">robot_base_frame</span>&gt;</span>base_footprint<span class="tag">&lt;/<span class="name">robot_base_frame</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> ç´æ¥ä½¿ç¨<strong>gazebo</strong>æ ç­¾å<strong>plugin</strong>æ ç­¾å®ä¹æä»¶ã<p></p>
<h5 id="create-a-world-in-gazebo">Create a World in Gazebo</h5>
<p>å¨Gazeboä¸­ç¼è¾åä¿å­å³å¯ãç¼è¾æ¢å¯ä»¥å¨<strong>insert</strong>é¡µé¢æå¥ç©ä½ï¼ä¹å¯ä»¥å¨<strong>edit</strong>--&gt;<strong>Building Edit</strong>ä¸­æå¥å»ºç­ç©ãæåä¿å­ä¸ºä¸ä¸ªåç¼ä¸º<strong>world</strong>çæä»¶ã</p>
<h5 id="launch-the-robot-in-the-world">Launch the Robot in the World</h5>
<figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">&lt;include file<span class="operator">=</span><span class="string">"$(find-pkg-share gazebo_ros)/launch/gazebo.launch.py"</span>&gt;</span><br><span class="line">    &lt;arg name<span class="operator">=</span><span class="string">"world"</span> value<span class="operator">=</span><span class="string">"$(find-pkg-share my_robot_description)/world/my_world.world"</span>/&gt;</span><br><span class="line">&lt;/include&gt;</span><br></pre></td></tr></tbody></table></figure>
<h4 id="add-a-camera-in-urdf">Add a Camera in URDF</h4>
<h3 id="control-robot-in-gazebo">Control Robot in Gazebo</h3>
<p>ä½¿ç¨<strong>ros2_control</strong>åºæ§å¶ç¡¬ä»¶è®¾å¤ï¼å·ä½é»è¾è§ä¸å¾ã <img alt="ROS2 controller &amp; hardware" data-src="/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/controller-manager-hardware.png"> æ§å¶å¨çæ§å¶é»è¾å¦ä¸æç¤ºã <img alt="æ§å¶å¨é»è¾å¾" data-src="/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/ros2-controller.png"> æ§å¶ä¸è¬åä¸º3ç§ï¼ * position * velocity * effort #### URDF <strong>urdf</strong>åæ¬ä¸é¨åï¼ç¬¬ä¸é¨åæ¯æºå¨äººèªèº«ç¸å³ç<strong>robot.urdf.xacro</strong>ï¼å¼å§æ¯<strong>xml</strong>æä»¶ççæ¬å·ï¼ä¸è¬æ¯<strong>1.0</strong>çæ¬ã </p><figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://www.ros.org/wiki/xacro"</span> <span class="attr">name</span>=<span class="string">"robot"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"$(find robot_description)/urdf/robot_gazebo.xacro"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:include</span> <span class="attr">filename</span>=<span class="string">"$(find robot_description)/urdf/robot_ros2_control.xacro"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"effort"</span> <span class="attr">value</span>=<span class="string">"30.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"velocity"</span> <span class="attr">value</span>=<span class="string">"10.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"default_inertial"</span> <span class="attr">params</span>=<span class="string">"mass"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">{mass}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"1.0"</span> <span class="attr">ixy</span>=<span class="string">"0.0"</span> <span class="attr">ixz</span>=<span class="string">"0.0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                     <span class="attr">iyy</span>=<span class="string">"1.0"</span> <span class="attr">iyz</span>=<span class="string">"0.0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                     <span class="attr">izz</span>=<span class="string">"1.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"default_transmission"</span> <span class="attr">params</span>=<span class="string">"number"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">transmission</span> <span class="attr">name</span>=<span class="string">"transmission_$</span></span></span><span class="template-variable">{number}</span><span class="language-xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>transmission_interface/SimpleTransmission<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">actuator</span> <span class="attr">name</span>=<span class="string">"motor_$</span></span></span><span class="template-variable">{number}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">role</span>=<span class="string">"actuator1"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_$</span></span></span><span class="template-variable">{number}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">role</span>=<span class="string">"joint1"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mechanical_reduction</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">mechanical_reduction</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">transmission</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"world"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/basement.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.5 -0.5 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/basement.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.5 -0.5 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"1.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"virtual_joint"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"world"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_plate"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/base_plate.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> <span class="attr">xyz</span>=<span class="string">"-0.39 -0.39 -0.56"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/base_plate.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> <span class="attr">xyz</span>=<span class="string">"-0.39 -0.39 -0.56"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"1.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_1"</span> <span class="attr">type</span>=<span class="string">"revolute"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"base_plate"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 0 1"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.307"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">limit</span> <span class="attr">lower</span>=<span class="string">"-$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">upper</span>=<span class="string">"$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">effort</span>=<span class="string">"$</span></span></span><span class="template-variable">{effort}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">velocity</span>=<span class="string">"$</span></span></span><span class="template-variable">{velocity}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"forward_drive_arm"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/forward_drive_arm.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 -$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">xyz</span>=<span class="string">"0.19 0.06 -0.08"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/forward_drive_arm.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 -$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">xyz</span>=<span class="string">"0.19 0.06 -0.08"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"1.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_2"</span> <span class="attr">type</span>=<span class="string">"revolute"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"base_plate"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"forward_drive_arm"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"1 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> <span class="attr">xyz</span>=<span class="string">"-0.02 0 0.35"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">limit</span> <span class="attr">lower</span>=<span class="string">"-$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">upper</span>=<span class="string">"$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">effort</span>=<span class="string">"$</span></span></span><span class="template-variable">{effort}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">velocity</span>=<span class="string">"$</span></span></span><span class="template-variable">{velocity}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"horizontal_arm"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/horizontal_arm.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string"> 0 $</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">xyz</span>=<span class="string">"-0.03 -0.4 -0.06"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/horizontal_arm.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string"> 0 $</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">xyz</span>=<span class="string">"-0.03 -0.4 -0.06"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"1.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_3"</span> <span class="attr">type</span>=<span class="string">"revolute"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"forward_drive_arm"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"horizontal_arm"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"1 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> <span class="attr">xyz</span>=<span class="string">"0 0 0.8"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">limit</span> <span class="attr">lower</span>=<span class="string">"-$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">upper</span>=<span class="string">"$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">effort</span>=<span class="string">"$</span></span></span><span class="template-variable">{effort}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">velocity</span>=<span class="string">"$</span></span></span><span class="template-variable">{velocity}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"claw_support"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/claw_support.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 $</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">xyz</span>=<span class="string">"0 -0.05 -0.15"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collsion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/claw_support.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 $</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">xyz</span>=<span class="string">"0 -0.05 -0.15"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collsion</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"0.05"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"horizontal_arm_to_claw_support"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"horizontal_arm"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"claw_support"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span> <span class="attr">xyz</span>=<span class="string">"0 0.82 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"gripper_right"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/right_finger.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.1 0.5 -0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 -$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/right_finger.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.1 0.5 -0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 -$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"gripper_left"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/left_finger.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.04 0.5 -0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 -$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/left_finger.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.04 0.5 -0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 -$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"0.01"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_4"</span> <span class="attr">type</span>=<span class="string">"revolute"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"claw_support"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"gripper_right"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.04 0.13 -0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 0 1"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">limit</span> <span class="attr">lower</span>=<span class="string">"-$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">upper</span>=<span class="string">"0"</span> <span class="attr">effort</span>=<span class="string">"$</span></span></span><span class="template-variable">{effort}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">velocity</span>=<span class="string">"$</span></span></span><span class="template-variable">{velocity}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_5"</span> <span class="attr">type</span>=<span class="string">"revolute"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"claw_support"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"gripper_left"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.22 0.13 -0.1"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">axis</span> <span class="attr">xyz</span>=<span class="string">"0 0 1"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">mimic</span> <span class="attr">joint</span>=<span class="string">"joint_4"</span> <span class="attr">multiplier</span>=<span class="string">"-1"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">limit</span> <span class="attr">lower</span>=<span class="string">"0"</span> <span class="attr">upper</span>=<span class="string">"$</span></span></span><span class="template-variable">{pi/2}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">effort</span>=<span class="string">"$</span></span></span><span class="template-variable">{effort}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">velocity</span>=<span class="string">"$</span></span></span><span class="template-variable">{velocity}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:default_transmission</span> <span class="attr">number</span>=<span class="string">"1"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:default_transmission</span> <span class="attr">number</span>=<span class="string">"2"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:default_transmission</span> <span class="attr">number</span>=<span class="string">"3"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">xacro:default_transmission</span> <span class="attr">number</span>=<span class="string">"4"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> å·ä½åç§<a href="robot.urdf.xacro">robot.urdf.xacro</a>ï¼<a href="robot_gazebo.xacro">robot_gazebo.xacro</a>å<a href="robot_ros2_control.xacro">robot_ros2_control.xacro</a>ã #### Controller ç¶ååç¬åå»ºä¸ä¸ª<strong>robot_controller</strong>åï¼å¨åä¸­åå«åå»º<strong>config</strong>å<strong>launch</strong>æä»¶å¤¹ã <figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- rcl</span></span><br><span class="line">ros2 pkg <span class="built_in">create</span> robot_controller <span class="comment">--build-type ament_cmake</span></span><br><span class="line">rm -rf include src</span><br><span class="line">mkdir <span class="built_in">config</span></span><br><span class="line">mkdir launch</span><br><span class="line"><span class="comment">-- CMakeLists.txt</span></span><br><span class="line">install(</span><br><span class="line">  DIRECTORY <span class="built_in">config</span> launch</span><br><span class="line">  DESTINATION share/${PROJECT_NAME}</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure> #### Yaml Configuration <strong>Yaml</strong>å¯è¯»æ§å¾å¼ºï¼å¯ä»¥ç¨äºéç½®åæ°ï¼å·ä½å¯ä»¥åç§<a href=""></a><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>ROS</category>
      </categories>
      <tags>
        <tag>ROS</tag>
        <tag>RViz</tag>
        <tag>Gazebo</tag>
      </tags>
  </entry>
  <entry>
    <title>Make Operation System ISO Installation File Using Systemback</title>
    <url>/2023/12/25/Make-Operation-System-ISO-Installation-File-Using-Systemback/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸»è¦è®²è§£å¦ä½ä½¿ç¨<strong>systemback</strong>æåæä½ç³»ç»ï¼å¹¶å¶ä½Uçå¯å¨çã <span id="more"></span> ### å®è£systemback éè¿ä»¥ä¸æä»¤å®è£ï¼ </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo bash -c <span class="string">'echo "deb [arch=amd64] https://mirrors.bwbot.org/ stable main" &gt; /etc/apt/sources.list.d/systemback.list'</span></span><br><span class="line">sudo apt-key adv --keyserver <span class="string">'hkp://keyserver.ubuntu.com:80'</span> --recv-key 50B2C005A67B264F</span><br><span class="line">sudo apt-<span class="built_in">get</span> update</span><br><span class="line">sudo apt-<span class="built_in">get</span><span class="built_in"> upgrade</span></span><br><span class="line"><span class="built_in"></span>sudo apt-<span class="built_in">get</span> install systemback</span><br></pre></td></tr></tbody></table></figure> ### å é¤firefox <strong>FireFox</strong>æµè§å¨ä¼å¯¼è´<strong>systemback</strong>å¶ä½ç³»ç»çæ¥éï¼å æ­¤å é¤ä¹ã <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo snap remove firefox</span><br><span class="line"><span class="built_in">cd</span> snap</span><br><span class="line"><span class="built_in">rm</span> -rf firefox</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="å¶ä½ç³»ç»ç">å¶ä½ç³»ç»ç</h3>
<p>å¨terminalä¸­è¾å¥ä»¥ä¸æä»¤æå¼<strong>systemback</strong> </p><figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">systemback-sustart</span></span><br></pre></td></tr></tbody></table></figure> å¨å¼¹åºçå¯¹è¯æ¡ä¸­éæ©<strong>Live system create</strong>æé®ã <img data-src="/2023/12/25/Make-Operation-System-ISO-Installation-File-Using-Systemback/live-system-create.png"> å¨å¼¹åºçå¯¹è¯æ¡ä¸­å°å®è£isoæä»¶éå½åä¸º<strong>ubuntu-22.04-robot</strong>ï¼å¾é<strong>include user data files</strong>ï¼ç¶åç¹å»<strong>create new</strong>ã <img data-src="/2023/12/25/Make-Operation-System-ISO-Installation-File-Using-Systemback/create-new.png"><p></p>
<h3 id="åå¥uç">åå¥Uç</h3>
<p>å¨isoæä»¶å¶ä½æååï¼æå¥Uçï¼å¯ä»¥å°å¶åå¥Uçã <img data-src="/2023/12/25/Make-Operation-System-ISO-Installation-File-Using-Systemback/write-to-target"></p>
<h3 id="å®è£">å®è£</h3>
<p>Uçå¯å¨åï¼éæ©ç¬¬ä¸é¡¹è¿å¥ç³»ç»åï¼å¨terminalä¸­ä½¿ç¨<strong>systemback-sustart</strong>å½ä»¤å¯å¨ï¼ç¶åéå¨<strong>system install</strong>å³å¯å®è£ç³»ç»ã <img data-src="/2023/12/25/Make-Operation-System-ISO-Installation-File-Using-Systemback/system-install.png"></p>
</body></html>]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>OS</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 2204 Installatson and Development Environment Setups</title>
    <url>/2023/12/25/Ubuntu-2204-Installatson-and-Development-Environment-Setups/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸»è¦è®°å½Ubuntu22.04çç³»ç»å®è£åéç½®æ­¥éª¤ã <span id="more"></span> ### ä¸è½½Ubuntu22.04 æ¨èå°<a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/">æ¸åæº</a>ä¸è½½ï¼éåº¦å¾å¿«ã ### å®è£Cuda &amp; Cudnn <strong>cuda</strong>å<strong>cudnn</strong>æ¯ä½¿ç¨<strong>tensorflow</strong>GPUçæ¬çåºç¡ï¼å æ­¤å¨å®è£<strong>tensorflow</strong>ä¹åï¼é¦åå®è£éç½®<strong>cuda</strong>å<strong>cudnn</strong>ã #### å®è£Nvidia Driver æå¼<strong>Software Updater</strong>ï¼ç¹å»<strong>setting</strong>, ç¹å»<strong>Additional Drivers</strong>ï¼å·æ°åéæ©<strong>Using NVIDIA driver metapackage from nvidia-driver-525(proprietary)</strong>ï¼ç¶åç¹å»<strong>Apply Changes</strong>ï¼æç§è¦æ±éå¯çµèã <img data-src="/2023/12/25/Ubuntu-2204-Installatson-and-Development-Environment-Setups/nvidia-drivers.png"> éå¯åå¨<strong>terminal</strong>ä¸­éªè¯æ¾å¡é©±å¨æ¯å¦å®è£æåã </p><figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">nvidia-smi</span></span><br></pre></td></tr></tbody></table></figure> <img data-src="/2023/12/25/Ubuntu-2204-Installatson-and-Development-Environment-Setups/nvidia-smi.png"><p></p>
<h4 id="å®è£cuda">å®è£CUDA</h4>
<p>éæ©å®è£çCUDAçæ¬æ¯<strong>cuda_11.8.0_520.61.05_linux.run</strong>ï¼å°Nvidiaå®ç½ä¸è½½<a href="https://developer.nvidia.com/cuda-11-8-0-download-archive">CUDA Toolkit 11.8 Downloads</a>ï¼æ ¹æ®æä½ç³»ç»çæ¬éæ©ï¼ä½¿ç¨ä»¥ä¸æä»¤ä¸è½½å®è£ï¼ </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> https://developer.download.nvidia.com/compute/cuda/<span class="number">11</span>.<span class="number">8</span>.<span class="number">0</span>/local_installers/cuda_11.<span class="number">8</span>.<span class="number">0</span>_520.<span class="number">61</span>.<span class="number">05</span>_linux.run</span><br><span class="line"><span class="attribute">sudo</span> sh cuda_11.<span class="number">8</span>.<span class="number">0</span>_520.<span class="number">61</span>.<span class="number">05</span>_linux.run</span><br></pre></td></tr></tbody></table></figure> å®è£çæ¶åéè¦å°<strong>drivers</strong>æ³¨éæï¼å¦åä¼å®è£åºéã å®è£æåä¹åè®¾ç½®ç¯å¢åéï¼å°ä»¥ä¸åå®¹åå¥<strong>zshrc</strong>çéç½®æä»¶ä¸­ <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">vi ~/.zshrc</span><br><span class="line">export PATH=<span class="regexp">/usr/</span>local<span class="regexp">/cuda/</span>bin<span class="variable">${PATH:+:${PATH}</span>}</span><br><span class="line">export LD_LIBRARY_PATH=<span class="regexp">/usr/</span>local<span class="regexp">/cuda-11.8/</span>lib64<span class="variable">${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}</span>}</span><br></pre></td></tr></tbody></table></figure> #### å®è£cudnn ä¸<strong>cuda 11.8</strong>ééç<strong>cudnn</strong>çæ¬æ¯8.6ï¼å°nvidiaå®ç½<a href="https://developer.nvidia.com/rdp/cudnn-archive">cudnn-archive</a>ä¸è½½å¯¹åºå®è£åï¼ç¶åä½¿ç¨ä»¥ä¸æä»¤å®è£ã <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">tar -xvf cudnn-linux-x86_64-<span class="number">8.6</span>.<span class="number">0.163</span>_cuda11-archive.tar.xz</span><br><span class="line">sudo cp cudnn-linux-x86_64-<span class="number">8.6</span>.<span class="number">0.163</span>_cuda11-archive<span class="regexp">/include/</span>cudnn*.h <span class="regexp">/usr/</span>local<span class="regexp">/cuda/i</span>nclude</span><br><span class="line">sudo cp -p cudnn-linux-x86_64-<span class="number">8.6</span>.<span class="number">0.163</span>_cuda11-archive<span class="regexp">/lib/</span>libcudnn* <span class="regexp">/usr/</span>local<span class="regexp">/cuda/</span>lib64</span><br><span class="line">sudo chmod a+r <span class="regexp">/usr/</span>local<span class="regexp">/cuda/i</span>nclude<span class="regexp">/cudnn*.h /u</span>sr<span class="regexp">/local/</span>cuda<span class="regexp">/lib64/</span>libcudnn*</span><br></pre></td></tr></tbody></table></figure> ä¸»è¦æ¯å°cudnnçincludeålibæä»¶æ·è´å°cudaç®å½ä¸é¢ã<p></p>
<h3 id="tensorflow">Tensorflow</h3>
<p>ä¸åçæ¬ç<strong>tensorflow</strong>å¯¹åºä¸åçæ¬ç<strong>cuda</strong>å<strong>cudnn</strong>ï¼å·ä½å¯å°<a href="https://www.tensorflow.org/install/source#gpu">tensorflow source</a>æ¥çã ä½¿ç¨ä»¥ä¸æä»¤å®è£ï¼ </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo ln -s /usr/bin/python3 /usr/bin/python</span><br><span class="line">sudo apt-<span class="built_in">get</span> update</span><br><span class="line">sudo apt-<span class="built_in">get</span><span class="built_in"> upgrade</span></span><br><span class="line"><span class="built_in"></span>sudo apt-<span class="built_in">get</span> install python3-pip</span><br><span class="line">pip install <span class="attribute">tensorflow</span>==2.12.0</span><br><span class="line">pip install tensorflow_datasets</span><br></pre></td></tr></tbody></table></figure> å®è£å®ä¹åä½¿ç¨ä»¥ä¸æä»¤æ£æ¥æ¯å¦å®è£æååæ¯å¦æ¯æGPUãä¹å¯ä»¥è¿è¡ä»¥ä¸æä»¶æ£æµæ¯å¦è°ç¨gpuè¿è¡è®­ç»ã <a href="tf_gpu_test.py">tf_gpu_test.py</a> <figure class="highlight gcode"><table><tbody><tr><td class="code"><pre><span class="line">pytho<span class="symbol">n3</span> -c <span class="string">"import tensorflow as tf; print(tf.config.list_physical_devices('GPU'))"</span></span><br></pre></td></tr></tbody></table></figure> æå°çæ¥å¿ä¸­æä»¥ä¸ä¿¡æ¯ï¼åè¯æå®è£æåã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">[PhysicalDevice(<span class="attribute">name</span>=<span class="string">'/physical_device:GPU:0'</span>, <span class="attribute">device_type</span>=<span class="string">'GPU'</span>)]</span><br></pre></td></tr></tbody></table></figure> * æ¥é å¯è½ä¸éè¦å¤çã <figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">uccessful NUMA <span class="keyword">node</span> <span class="title">read</span> from SysFS had negative value (-<span class="number">1</span>), but there must be at least one NUMA <span class="keyword">node</span><span class="title">, so</span> returning NUMA <span class="keyword">node</span> <span class="title">zero</span>. </span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨ä»¥ä¸æä»¤è§£å³ã <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> /sys/bus/pci/devices/*; <span class="keyword">do</span> <span class="built_in">echo</span> 0 | sudo <span class="built_in">tee</span> -a <span class="variable">$a</span>/numa_node; <span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="pytorch">PyTorch</h3>
<p>ç´æ¥ä½¿ç¨pipå®è£æ¯æcudaçpytorchå³å¯ã </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># pip install torch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 --index-url https://download.pytorch.org/whl/cu118 -i https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br><span class="line">pip install torch torchvision torchaudio --index-url https:<span class="regexp">//</span>download.pytorch.org<span class="regexp">/whl/</span>cu118</span><br></pre></td></tr></tbody></table></figure> å®è£å®æåï¼å¯ä»¥éªè¯å®è£ççæ¬ <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">pip</span> list | grep torch</span><br><span class="line"><span class="attribute">torch</span>                                <span class="number">2</span>.<span class="number">2</span>.<span class="number">1</span>+cu118</span><br><span class="line"><span class="attribute">torchaudio</span>                           <span class="number">2</span>.<span class="number">2</span>.<span class="number">1</span>+cu118</span><br><span class="line"><span class="attribute">torchvision</span>                          <span class="number">0</span>.<span class="number">17</span>.<span class="number">1</span>+cu118</span><br></pre></td></tr></tbody></table></figure> éªè¯æ¯å¦æ¯æcudaã <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">import torch</span><br><span class="line">torch<span class="selector-class">.cuda</span><span class="selector-class">.is_available</span>()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(torch.cuda.get_device_name(<span class="number">0</span>)</span></span>)</span><br></pre></td></tr></tbody></table></figure> æå°Trueï¼åè¡¨ç¤ºæ¯æcudaãå¯ä»¥æ­£å¸¸è¾åºæ¾å¡åå·ã ä½¿ç¨ä»¥ä¸ä»£ç éªè¯ååæ¨çæ¯å¦å¯æ­£å¸¸ä½¿ç¨GPUã <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">t = torch<span class="selector-class">.nn</span><span class="selector-class">.Linear</span>(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">t<span class="selector-class">.to</span>(<span class="string">"cuda:0"</span>)</span><br><span class="line">input=torch<span class="selector-class">.randn</span>((<span class="number">3</span>,<span class="number">3</span>))<span class="selector-class">.requires_grad_</span>()<span class="selector-class">.to</span>(<span class="string">"cuda:0"</span>)</span><br><span class="line">output=<span class="built_in">t</span>(input)</span><br><span class="line">loss = torch<span class="selector-class">.sum</span>(output)</span><br><span class="line">torch<span class="selector-class">.autograd</span><span class="selector-class">.grad</span>(loss, <span class="selector-tag">input</span>, retain_graph=True)</span><br><span class="line">loss<span class="selector-class">.backward</span>()</span><br></pre></td></tr></tbody></table></figure> è¥ä»£ç æ­£å¸¸æ§è¡ä¸æ²¡ææå°å¼å¸¸ä¿¡æ¯ï¼è¡¨æå¯ä½¿ç¨GPUè¿è¡ååæ¨çã<p></p>
<h3 id="è®¾ç½®ä¸­æè¾å¥æ³">è®¾ç½®ä¸­æè¾å¥æ³</h3>
<h4 id="å®è£æ´æ°">å®è£æ´æ°</h4>
<p>æå¼<strong>Settings</strong>ï¼ä¾æ¬¡ç¹å»<strong>Region &amp; Language</strong>--&gt;<strong>Manage Installed Languages</strong>ï¼æ´æ°æ°æ®ã <img data-src="/2023/12/25/Ubuntu-2204-Installatson-and-Development-Environment-Setups/manage-installed-languiages.png"> ç¹å»<strong>Language</strong>ï¼éæ©ä¸­æãä¹åéå¯ã <img data-src="/2023/12/25/Ubuntu-2204-Installatson-and-Development-Environment-Setups/select-chinese.png"> #### è®¾ç½®ä¸­æè¾å¥æ³ ä¾æ¬¡ç¹å»<strong>Keyboard</strong>--&gt;<strong>Input Sources</strong>--&gt;<strong>+</strong>ï¼éæ©ä¸­æè¾å¥æ³ã</p>
<h3 id="å¶ä»å·¥å·åå®è£">å¶ä»å·¥å·åå®è£</h3>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install git</span><br><span class="line">sudo apt-<span class="built_in">get</span> install curl</span><br><span class="line">sudo apt-<span class="built_in">get</span> install zsh</span><br><span class="line">sudo apt-<span class="built_in">get</span> install vim</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ssh</span><br><span class="line">sudo apt-<span class="built_in">get</span> install gcc</span><br><span class="line">sudo apt-<span class="built_in">get</span> install cmake</span><br><span class="line">sudo apt-<span class="built_in">get</span> install python3-pip</span><br><span class="line">sudo apt-<span class="built_in">get</span> install tmux</span><br><span class="line">sudo apt-<span class="built_in">get</span> install tree</span><br><span class="line">sudo apt-<span class="built_in">get</span> install htop</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®è£oh-my-zsh">å®è£oh-my-zsh</h4>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sh -c <span class="string">"<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>"</span></span><br></pre></td></tr></tbody></table></figure>
<p>è¥æ¯å¨å½åï¼æ æ³è®¿é®githubï¼åè¿è¡ä»¥ä¸èæ¬ä½¿ç¨å½åçæºå®è£ã <embed src="install_oh_my_zsh.sh"> #### è®¾ç½®git </p><figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">git config <span class="attr">--global</span> user<span class="selector-class">.email</span> <span class="string">"zhaoyongsheng@zju.edu.cn"</span></span><br><span class="line">git config <span class="attr">--global</span> user<span class="selector-class">.name</span> <span class="string">"Alex"</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="å®è£å¾®ä¿¡">å®è£å¾®ä¿¡</h4>
<p>è¾è®¯å®æ¹æ¨åºäº<a href="https://linux.weixin.qq.com/en">Linuxçå¾®ä¿¡</a>ï¼ç´æ¥ä¸è½½å®è£å³å¯ã </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># wget https://archive.ubuntukylin.com/software/pool/partner/weixin_2.1.1_amd64.deb</span></span><br><span class="line"><span class="attribute">sudo</span> dpkg -i weixin_2.<span class="number">1</span>.<span class="number">1</span>_amd64.deb</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="å®è£zotero">å®è£Zotero</h4>
<p><a href="https://github.com/retorquere/zotero-deb">Zotero</a> </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">wget -qO- https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/retorquere/</span>zotero-deb<span class="regexp">/master/i</span>nstall.sh | sudo bash</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install zotero</span><br></pre></td></tr></tbody></table></figure> å®è£åç»éè´¦å·ï¼è®¾ç½®åæäºåæ­¥å³å¯ã<p></p>
<h4 id="å®è£typora">å®è£Typora</h4>
<figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install typora</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®è£vscode">å®è£VSCode</h4>
<figure class="highlight css"><table><tbody><tr><td class="code"><pre><span class="line">sudo snap install <span class="attr">--classic</span> <span class="selector-tag">code</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®è£anaconda">å®è£Anaconda</h4>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> https://repo.anaconda.com/archive/Anaconda3-<span class="number">2023</span>.<span class="number">03</span>-Linux-x86_64.sh</span><br><span class="line"><span class="attribute">bash</span> Anaconda3-<span class="number">2023</span>.<span class="number">03</span>-Linux-x86_64.sh</span><br></pre></td></tr></tbody></table></figure>
<h4 id="å®è£ros">å®è£ROS</h4>
<figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">#### è®¾ç½®vim</span><br><span class="line">Ubuntuèªå¸¦viï¼éè¦éç½®ä»¥ä¸ï¼æ¹ä¾¿ä½¿ç¨ï¼</span><br></pre></td></tr></tbody></table></figure>
<p>touch .vimrc vi .vimrc set nocompatible set backspace=2 </p><figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">#### libserial-dev</span><br><span class="line">å¨ROSä¸­ä¼ç¨å°è¿ä¸ªåºã</span><br></pre></td></tr></tbody></table></figure> sudo apt-get install libserial-dev sudo pip install pyserial <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">#### flask</span><br><span class="line">å¨ROSä¸­ä¼ç¨å°è¿ä¸ªåºã</span><br></pre></td></tr></tbody></table></figure> pip install flask pip install flask-ask-sdk pip install ask-sdk <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">#### è°æ´å¾®ä¿¡åè¾¨ç</span><br><span class="line">å¨**terminal**ä¸­è¾å¥ä»¥ä¸æä»¤ï¼æå¼è®¾ç½®çé¢ã</span><br><span class="line">* deepin-wine6-stable</span><br></pre></td></tr></tbody></table></figure> WINEPREFIX=~/.deepinwine/Deepin-WeChat deepin-wine6-stable winecfg <figure class="highlight asciidoc"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">* </span>ukylin-wine</span><br></pre></td></tr></tbody></table></figure> WINEPREFIX=~/.ukylin-wine/wechat /usr/bin/ukylin-wine winecfg <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">å¨**graphics**tabé¡µä¸­ï¼è°æ´åè¾¨çå¤§å°å³å¯ãåè¾¨çè°æ´å®æåï¼éè¦éå¯å¾®ä¿¡æè½éè¦ã</span><br><span class="line"></span><br><span class="line">#### å®è£æªå¾å·¥å·</span><br><span class="line">##### å®è£</span><br><span class="line">æ¨èçæªå¾å·¥å·æ¯**flameshot**ï¼ä½¿ç¨ä»¥ä¸å½ä»¤å®è£ï¼</span><br></pre></td></tr></tbody></table></figure> sudo apt-get install flameshot <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">##### è®¾ç½®å¿«æ·é®</span><br><span class="line">æå¼**Settings**ï¼ä¾æ¬¡ç¹å»**Keyboard**--&gt;**View and Customize Shortcuts**--&gt;**Custom Shortcuts**--&gt;**Add Shortcut**ã</span><br><span class="line"></span><br><span class="line">#### å®è£Shadowsocks</span><br><span class="line">Ubuntu22<span class="number">.04</span>è½¯ä»¶ååºä¸­èªå¸¦**shadowsocks-electron**ï¼ç¹å»å®è£å³å¯ã</span><br><span class="line"></span><br><span class="line">#### å®è£google chrome</span><br></pre></td></tr></tbody></table></figure> wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb ls sudo dpkg -i google-chrome-stable_current_amd64.deb <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">#### åå»ºssh key</span><br></pre></td></tr></tbody></table></figure> ssh-keygen -t rsa cat ~/.ssh/id_rsa.pub <figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">å°public keyæ·è´å°githubä¸­ã</span><br><span class="line"></span><br><span class="line">#### æ å°CAPSæé®</span><br><span class="line">é¦åä½¿ç¨ä»¥ä¸æä»¤æ¥çæ¯æçæ å°å³ç³»ã</span><br></pre></td></tr></tbody></table></figure> cat /usr/share/X11/xkb/rules/base.lst | grep caps <figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">ç¶åæå¼éç½®æä»¶ã</span><br></pre></td></tr></tbody></table></figure> sudo gedit /etc/default/keyboard <figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">æ·»å ä»¥ä¸éç½®</span><br></pre></td></tr></tbody></table></figure> # KEYBOARD CONFIGURATION FILE<p></p>
<h1 id="consult-the-keyboard5-manual-page.">Consult the keyboard(5) manual page.</h1>
<p>XKBMODEL="pc105" XKBLAYOUT="us" XKBVARIANT="" XKBOPTIONS="caps:shift"</p>
<p>BACKSPACE="guess" ``` éå¯ä¹åçæã</p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Environment</tag>
      </tags>
  </entry>
  <entry>
    <title>ROS2 Learning Notes Navigation 2 Stack</title>
    <url>/2023/12/29/ROS2-Learning-Notes-Navigation-2-Stack/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸»è¦ä¸ºROS2å¯¼èªåè½æ¨¡åçå­¦ä¹ ç¬è®°ã <span id="more"></span> ### Navigation2 Stack * å®è£å·¥å·å </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-navigation2</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-nav2-bringup</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-turtlebot3</span><br></pre></td></tr></tbody></table></figure> * ä¿®å¤ä¾èµé®é¢ <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">wget</span> http://archive.ubuntu.com/ubuntu/pool/universe/l/lua5.<span class="number">2</span>/liblua5.<span class="number">2</span>-<span class="number">0</span>_5.<span class="number">2</span>.<span class="number">4</span>-<span class="number">2</span>_amd64.deb</span><br><span class="line"><span class="attribute">sudo</span> dpkg -i liblua5.<span class="number">2</span>-<span class="number">0</span>_5.<span class="number">2</span>.<span class="number">4</span>-<span class="number">2</span>_amd64.deb</span><br></pre></td></tr></tbody></table></figure> ### Generate a map with SLAM #### Make a Robot Move in the World * éç½®ç¯å¢åé <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo vi ~/.zshrc</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">TURTLEBOT3_MODEL</span>=waffle</span><br></pre></td></tr></tbody></table></figure> * å¯å¨gazeboç¯å¢ <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> turtlebot3_gazebo turtlebot3_world.<span class="built_in">launch</span>.py</span><br></pre></td></tr></tbody></table></figure> * å¯å¨é®çæ§å¶ <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> turtlebot3_teleop teleop_keyboard</span><br></pre></td></tr></tbody></table></figure> #### Create and Save a Map with SLAM é¦åå¯å¨gazeboä»¿çç¯å¢ï¼çææºå¨äººã ç¶åå¯å¨<strong>cartographer</strong>ã <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> turtlebot3_cartographer cartographer.<span class="built_in">launch</span>.py use_sim_time:=True</span><br></pre></td></tr></tbody></table></figure> å¯å¨é®çæ§å¶æºå¨äººå¨ç¯å¢ä¸­ç§»å¨å°±å¯ä»¥å»ºå¾ã æåä¿å­å°å¾ã <figure class="highlight dockerfile"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="keyword">run</span><span class="language-bash"> nav2_map_server map_saver_cli -f maps/my_map</span></span><br></pre></td></tr></tbody></table></figure> å°å¾ä¿å­åå¯ä»¥ä½¿ç¨<strong>gimp</strong>ç¼è¾ä¿å­ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install gimp</span><br><span class="line">gimp</span><br></pre></td></tr></tbody></table></figure> ### Navigation in Map #### Fix Some Errors <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-rmw-cyclonedds-cpp</span><br><span class="line">sudo vi ~/.zshrc</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">RMW_IMPLEMENTATION</span>=rmw_cyclonedds_cpp</span><br></pre></td></tr></tbody></table></figure> <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">cd <span class="regexp">/opt/</span>ros<span class="regexp">/humble/</span>share<span class="regexp">/turtlebot3_navigation2/</span>param</span><br><span class="line">sudo vi waffle.yaml</span><br><span class="line"><span class="comment"># robot_model_type: "differential"</span></span><br><span class="line">robot_model_type: <span class="string">"nav2_amcl::DifferentialMotionModel"</span></span><br></pre></td></tr></tbody></table></figure> #### Navigation é¦åè¿è¡æºå¨äººçä»¿çç¯å¢ï¼ç¶åå¼å¯<strong>navigation</strong>èç¹ <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> turtlebot3_gazebo turtlebot3_world.<span class="built_in">launch</span>.py</span><br><span class="line">cd</span><br><span class="line">ros2 <span class="built_in">launch</span> turtlebot3_navigation2 navigation2.<span class="built_in">launch</span>.py use_sim_time:=True map:=maps/my_map.yaml</span><br></pre></td></tr></tbody></table></figure> éè¦æä¾å°å¾çéç½®æä»¶ï¼æåè½½å¥åä½¿ç¨<strong>2D Pose Estimation</strong>å·¥å·åå§åæºå¨äººçä½ç½®ã<p></p>
<h4 id="use-experiences">Use Experiences</h4>
<p>å¨<strong>rqt</strong>çæä»¶éé¢å¯ä»¥éç½®åæ°ã</p>
<p>Nav2æ¶æ</p>
<p>è¾å¥ï¼TF, Map, Sensor Data ç®æ ï¼ global planner --&gt; local planner(controller) --&gt; hardware controller</p>
<p>Behavior Tree--&gt;å³ç­æ  #### Odometry æ ¹æ®åºççè¿å¨ä¿¡æ¯å®ä½æºå¨äººã éçæ¶é´åè·ç¦»æç´¯ç§¯è¯¯å·®ï¼ä½æ¯ç­æ¶é´åå®ä½å¾ç¨³å®ã map frame -&gt; odom frame -&gt; base_linkã æ ¹æ®è½®å­çç¼ç å¨è®¡ç®ï¼æ ¹æ®éåº¦è®¡ç®ä½ç½®ãä¹å¯ä»¥ä½¿ç¨<strong>diff_drive_controller</strong>å®ç°ã è¿å¯ä»¥ä½¿ç¨<strong>robot_localization</strong>åèªå·±å®ç°æ´å¤æçç®æ³, åå¸<strong>filtered topic</strong>ã Topicåç§°ä¸ºï¼<strong>odom</strong>ï¼æ°æ®ç±»åä¸º<strong>nav_msgs/Odometry.msg</strong>ã</p>
<h4 id="sensor-data">Sensor Data</h4>
<ul>
<li>wheel encoder</li>
<li>lidar åå¸<strong>sensor_msgs/msg/LaserScan</strong>æ¶æ¯ï¼åå­ä¸º<strong>scan</strong>ã</li>
<li>camera åå¸<strong>sensor_msgs/msg/Image</strong>æ¶æ¯ï¼åå­ä¸º<strong>camera/image_raw</strong>ã</li>
</ul>
<h4 id="hardware-controller">Hardware Controller</h4>
<p>åå¸çæ¶æ¯ç±»åä¸º<strong>geometry_msgs/Twist</strong>ã æ¢å¯ä»¥èªå·±å®ç°çµæºé©±å¨å¨ï¼å¨è¿æ ·çæåµä¸ï¼éè¦èªå·±å®ç°<strong>Odometry</strong>ã ä¹å¯ä»¥ä½¿ç¨ros2èªå¸¦ç<strong>diff_drive_controller</strong>ã</p>
<h4 id="slam_toolbox">slam_toolbox</h4>
<p>é¤äºä½¿ç¨<strong>cartographer</strong>å»ºå¾ï¼æä»¬è¿å¯ä»¥ä½¿ç¨<strong>slam_toolbox</strong>å»ºå¾ãæ­¥éª¤å¦ä¸æç¤ºï¼ </p><figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> turtlebot3_gazebo turtlebot3_world.<span class="built_in">launch</span>.py</span><br><span class="line">ros2 <span class="built_in">launch</span> nav2_bringup navigation_launch.py use_sim_time:=True</span><br><span class="line">ros2 <span class="built_in">launch</span> slam_toolbox online_async_launch.py use_sim_time:=True</span><br><span class="line">ros2 <span class="built_in">run</span> rviz2 rviz2</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="tf_transformations">tf_transformations</h4>
<ul>
<li>å®è£ <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-tf-transformations</span><br><span class="line">sudo apt-<span class="built_in">get</span> install python3-transforms3d</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="éè¿ç¨åºåéåå§ä½ç½®">éè¿ç¨åºåéåå§ä½ç½®</h4>
<p>ä½¿ç¨<strong>nav2</strong>æä¾çå½ä»¤æ¥å£å®ç°ã </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="attribute">import</span> rclpy</span><br><span class="line"><span class="attribute">from</span> nav2_simple_commander.robot_navigator import BasicNavigator</span><br><span class="line"><span class="attribute">from</span> geometry_msgs.msg import PoseStamped</span><br><span class="line"><span class="attribute">import</span> tf_transformations</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">def</span> main():</span><br><span class="line">    <span class="comment"># init</span></span><br><span class="line">    <span class="attribute">rclpy</span>.init()</span><br><span class="line">    <span class="attribute">nav</span> = BasicNavigator()</span><br><span class="line">    <span class="comment"># set initial pose</span></span><br><span class="line">    <span class="attribute">q_x</span>, q_y, q_z, q_w = tf_transformations.quaternion_from_euler(<span class="number">0</span>.<span class="number">0</span>, <span class="number">0</span>.<span class="number">0</span>, <span class="number">0</span>.<span class="number">0</span>)</span><br><span class="line">    <span class="attribute">initial_pose</span> = PoseStamped()</span><br><span class="line">    <span class="attribute">initial_pose</span>.header.frame_id = 'map'</span><br><span class="line">    <span class="attribute">initial_pose</span>.header.stamp = nav.get_clock().now().to_msg()</span><br><span class="line">    <span class="attribute">initial_pose</span>.pose.position.x = <span class="number">0</span>.<span class="number">0</span></span><br><span class="line">    <span class="attribute">initial_pose</span>.pose.position.y = <span class="number">0</span>.<span class="number">0</span></span><br><span class="line">    <span class="attribute">initial_pose</span>.pose.position.z = <span class="number">0</span>.<span class="number">0</span></span><br><span class="line">    <span class="attribute">initial_pose</span>.pose.orientation.x = q_x</span><br><span class="line">    <span class="attribute">initial_pose</span>.pose.orientation.y = q_y</span><br><span class="line">    <span class="attribute">initial_pose</span>.pose.orientation.z = q_z</span><br><span class="line">    <span class="attribute">initial_pose</span>.pose.orientation.w = q_w</span><br><span class="line"></span><br><span class="line">    <span class="attribute">nav</span>.setInitialPose(initial_pose=initial_pose)</span><br><span class="line">    <span class="attribute">nav</span>.waitUntilNav2Active()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># shutdown</span></span><br><span class="line">    <span class="attribute">rclpy</span>.shutdown()</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="éè¿ç¨åºåéç®æ ä½ç½®">éè¿ç¨åºåéç®æ ä½ç½®</h4>
<figure class="highlight gams"><table><tbody><tr><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">import rclpy</span><br><span class="line">from nav2_simple_commander.robot_navigator import BasicNavigator</span><br><span class="line">from geometry_msgs.msg import PoseStamped</span><br><span class="line">import tf_transformations</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # init</span><br><span class="line">    rclpy.init()</span><br><span class="line">    nav = BasicNavigator()</span><br><span class="line">    # <span class="keyword">set</span> initial <span class="comment">pose</span></span><br><span class="line">    q_x, q_y, q_z, q_w <span class="comment">= tf_transformations.quaternion_from_euler(0.0, 0.0, 0.0)</span></span><br><span class="line">    initial_pose <span class="comment">= PoseStamped()</span></span><br><span class="line">    initial_pose.header.frame_id <span class="comment">=</span> <span class="comment">'map'</span></span><br><span class="line">    initial_pose.header.stamp <span class="comment">= nav.get_clock().now().to_msg()</span></span><br><span class="line">    initial_pose.pose.position.x <span class="comment">= 0.0</span></span><br><span class="line">    initial_pose.pose.position.y <span class="comment">= 0.0</span></span><br><span class="line">    initial_pose.pose.position.z <span class="comment">= 0.0</span></span><br><span class="line">    initial_pose.pose.orientation.x <span class="comment">= q_x</span></span><br><span class="line">    initial_pose.pose.orientation.y <span class="comment">= q_y</span></span><br><span class="line">    initial_pose.pose.orientation.z <span class="comment">= q_z</span></span><br><span class="line">    initial_pose.pose.orientation.w <span class="comment">= q_w</span></span><br><span class="line"></span><br><span class="line">    nav.setInitialPose(initial_pose=initial_pose)</span><br><span class="line">    nav.waitUntilNav2Active()</span><br><span class="line"></span><br><span class="line">    # <span class="keyword">set</span> <span class="comment">goal pose</span></span><br><span class="line">    q_x, q_y, q_z, q_w <span class="comment">= tf_transformations.quaternion_from_euler(0.0, 0.0, 1.57)</span></span><br><span class="line">    goal_pose <span class="comment">= PoseStamped()</span></span><br><span class="line">    goal_pose.header.frame_id <span class="comment">=</span> <span class="comment">'map'</span></span><br><span class="line">    goal_pose.header.stamp <span class="comment">= nav.get_clock().now().to_msg()</span></span><br><span class="line">    goal_pose.pose.position.x <span class="comment">= 3.5</span></span><br><span class="line">    goal_pose.pose.position.y <span class="comment">= 1.0</span></span><br><span class="line">    goal_pose.pose.position.z <span class="comment">= 0.0</span></span><br><span class="line">    goal_pose.pose.orientation.x <span class="comment">= q_x</span></span><br><span class="line">    goal_pose.pose.orientation.y <span class="comment">= q_y</span></span><br><span class="line">    goal_pose.pose.orientation.z <span class="comment">= q_z</span></span><br><span class="line">    goal_pose.pose.orientation.w <span class="comment">= q_w</span></span><br><span class="line">    nav.goToPose(goal_pose)</span><br><span class="line"></span><br><span class="line">    while <span class="comment">not nav.isTaskComplete():</span></span><br><span class="line">        feedback <span class="comment">= nav.getFeedback()</span></span><br><span class="line">        # print(feedback)</span><br><span class="line">    </span><br><span class="line">    # shutdown</span><br><span class="line">    rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if <span class="comment">__name__ ==</span> <span class="comment">'__main__'</span><span class="comment">:</span></span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>
<h4 id="waypointsåéä¸ç³»åç¹">Waypointsåéä¸ç³»åç¹</h4>
<p><embed src="nav2_test.py"> #### ç»§ç»­å­¦ä¹  * ros2_control * robotic arm (moveit 2) * advanced ros2 core concepts</p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>ROS</category>
      </categories>
      <tags>
        <tag>ROS</tag>
        <tag>Navigation</tag>
      </tags>
  </entry>
  <entry>
    <title>ROS2 Learning Notes Advanced Concepts</title>
    <url>/2024/01/14/ROS2-Learning-Notes-Advanced-Concepts/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸»è¦è®°å½<strong>ROS2</strong>çé«çº§æ¦å¿µï¼åæ¬<strong>ROS2</strong>çæ ¸å¿æ¦å¿µï¼ä¾å¦<strong>Action</strong>, <strong>Lifecycle Nodes</strong>, <strong>Executors</strong>å<strong>Components</strong>ã <span id="more"></span> ## ç¯å¢ </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">Ubuntu</span> <span class="number">22</span>.<span class="number">04</span></span><br><span class="line"><span class="attribute">ROS2</span> Humble</span><br></pre></td></tr></tbody></table></figure> ## Actions <strong>Actions</strong>æå¡äºæ§è¡æ¶é´è¾é¿çäººç©ï¼åæ ·ä»¥<strong>client/server</strong>çæ¨¡å¼è¿è¡ï¼æ§è¡è¿ç¨ä¸­å¯ä»¥åæ¶ï¼ä¹å¯ä»¥åéåé¦ä¿¡æ¯ã éå¸¸æ¯ç±ä¸ä¸ª<strong>Services</strong>åä¸¤ä¸ª<strong>Topic</strong>ç»æã * Services * Send Goal * Cancel Goal Request * Request Result * Topics * Feedback * Goal status <strong>Actions</strong>å¯ä»¥æå¤ä¸ª<strong>Clients</strong>ï¼åä¸ä¸ª<strong>Client</strong>ä¹å¯åéå¤ä¸ª<strong>Goal</strong>ã ### å®ä¹Action #### Server <figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> result</span><br><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> rclpy.action <span class="keyword">import</span> ActionServer</span><br><span class="line"><span class="keyword">from</span> rclpy.action.server <span class="keyword">import</span> ServerGoalHandle</span><br><span class="line"><span class="keyword">from</span> my_robot_interfaces.action <span class="keyword">import</span> CountUntil</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CountUntilServerNode</span>(<span class="title class_ inherited__">Node</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">"count_until_server"</span>)</span><br><span class="line">        self.count_until_server_ = ActionServer(self, CountUntil, <span class="string">"count_until"</span>, execute_callback=self.execute_callback)</span><br><span class="line">        self.get_logger().info(<span class="string">"Action server has been started."</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_callback</span>(<span class="params">self, goal_handle: ServerGoalHandle</span>):</span><br><span class="line">        <span class="comment"># Get request from goal</span></span><br><span class="line">        target_number = goal_handle.request.target_number</span><br><span class="line">        period = goal_handle.request.period</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Execute the action</span></span><br><span class="line">        self.get_logger().info(<span class="string">"Executing the goal"</span>)</span><br><span class="line">        counter = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(target_number):</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line">            self.get_logger().info(<span class="string">"counter = "</span> + <span class="built_in">str</span>(counter))</span><br><span class="line">            time.sleep(period)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Once done, set goal final state</span></span><br><span class="line">        goal_handle.succeed()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># and send the result</span></span><br><span class="line">        result = CountUntil.Result()</span><br><span class="line">        result.reached_number = counter</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line">    node = CountUntilServerNode()</span><br><span class="line">    rclpy.spin(node)</span><br><span class="line">    rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>ActionServer</strong>åå»ºserver, æå®ç±»åãåç§°ååè°å½æ°ãç±»åå®ä¹äºActionæ°æ®ä¼ è¾çæ°æ®ç±»åï¼åç§°ä¸ºå¯ä¸çè¾¨è¯ç¬¦ï¼åè°å½æ°åå®ä¹äºserveræ¶å°goalä¹åçå¤çé»è¾ã åè°å½æ°çå¤çé»è¾åå«ä¸é¨åï¼1. å¤çgoalä¸­çrequeståæ°ï¼2. æ§è¡actionï¼ 3. è¿åæ§è¡ç»æã #### Client <figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> cgitb <span class="keyword">import</span> reset</span><br><span class="line"><span class="keyword">import</span> rclpy</span><br><span class="line"><span class="keyword">from</span> rclpy.node <span class="keyword">import</span> Node</span><br><span class="line"><span class="keyword">from</span> rclpy.action <span class="keyword">import</span> ActionClient</span><br><span class="line"><span class="keyword">from</span> rclpy.action.server <span class="keyword">import</span> ServerGoalHandle</span><br><span class="line"><span class="keyword">from</span> rclpy.action.client <span class="keyword">import</span> ClientGoalHandle</span><br><span class="line"><span class="keyword">from</span> my_robot_interfaces.action <span class="keyword">import</span> CountUntil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CountUntilClientNode</span>(<span class="title class_ inherited__">Node</span>): <span class="comment"># MODIFY NAME</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="string">"count_until_client"</span>) <span class="comment"># MODIFY NAME</span></span><br><span class="line">        self.count_until_client_ = ActionClient(self, CountUntil, <span class="string">"count_until"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_goal</span>(<span class="params">self, target_number, period</span>):</span><br><span class="line">        <span class="comment"># Wait for the server</span></span><br><span class="line">        self.count_until_client_.wait_for_server()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create a goal</span></span><br><span class="line">        goal = CountUntil.Goal()</span><br><span class="line">        goal.target_number = target_number</span><br><span class="line">        goal.period = period</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Send the goal</span></span><br><span class="line">        self.get_logger().info(<span class="string">"Sending goal"</span>)</span><br><span class="line">        future = self.count_until_client_.send_goal_async(goal=goal)</span><br><span class="line">        future.add_done_callback(self.goal_response_callback)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">goal_response_callback</span>(<span class="params">self, future</span>):</span><br><span class="line">        self.goal_handle_: ClientGoalHandle = future.result()</span><br><span class="line">        <span class="keyword">if</span> self.goal_handle_.accepted:</span><br><span class="line">                self.goal_handle_.get_result_async().add_done_callback(self.goal_result_callback)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">goal_result_callback</span>(<span class="params">self, future</span>):</span><br><span class="line">         result = future.result().result</span><br><span class="line">         self.get_logger().info(<span class="string">"Result: "</span> + <span class="built_in">str</span>(result.reached_number))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">args=<span class="literal">None</span></span>):</span><br><span class="line">    rclpy.init(args=args)</span><br><span class="line">    node = CountUntilClientNode()</span><br><span class="line">    node.send_goal(<span class="number">6</span>, <span class="number">1.0</span>)</span><br><span class="line">    rclpy.spin(node)</span><br><span class="line">    rclpy.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure> ä½¿ç¨<strong>ActionClient</strong>å®ä¹client, ä¸»è¦åæ¬ç±»åï¼åç§°ãåégoalçæ­¥éª¤æ¯ç­å¾serverå°±ä½ï¼ç¶ååå»ºgoalï¼èµå¼requeståæ°ï¼ç¶åå¼æ­¥åégoalãå¼æ­¥åéæ¥å£ä¼è¿åfutureå¯¹è±¡ï¼ç¨æ¥è¡¨ææ¯æªæ¥æè½æ§è¡å®çãå¯æ¯éè¿<strong>add_done_callback</strong>æ·»å åè°å½æ°ãåè°å½æ°æä¸¤å±ï¼ç¬¬ä¸å±æ¯serveræ¥æ¶å°goalä¹åaccept/rejectç»æåè°ï¼ç¬¬äºå±æ¯acceptä¹åï¼actionæ§è¡ç»æçåè°ã<p></p>
<h4 id="acceptreject">Accept/Reject</h4>
<figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">self.count_until_server_ = <span class="constructor">ActionServer(<span class="params">self</span>, CountUntil, <span class="string">"count_until"</span>, <span class="params">goal_callback</span>=<span class="params">self</span>.<span class="params">goal_callback</span>, <span class="params">execute_callback</span>=<span class="params">self</span>.<span class="params">execute_callback</span>)</span></span><br><span class="line">def goal<span class="constructor">_callback(<span class="params">self</span>, <span class="params">goal_request</span>: CountUntil.Goal)</span>:</span><br><span class="line">    self.get<span class="constructor">_logger()</span>.info(<span class="string">"Received a goal"</span>)</span><br><span class="line">    # Validate the goal request</span><br><span class="line">    <span class="keyword">if</span> goal_request.target_number &lt;= <span class="number">0</span>:</span><br><span class="line">        self.get<span class="constructor">_logger()</span>.info(<span class="string">"Rejecting the goal"</span>)</span><br><span class="line">        return GoalResponse.REJECT</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.get<span class="constructor">_logger()</span>.info(<span class="string">"Accepting the goal"</span>)</span><br><span class="line">        return GoalResponse.ACCEPT</span><br></pre></td></tr></tbody></table></figure>
<p>å¨å®ä¹serverçæ¶åï¼æ·»å <strong>goal_callback</strong>æ¥æ ¹æ®requeståæ°å¤çacceptårejectåæ°çæåµã</p>
<h4 id="goal-state-machine">Goal State Machine</h4>
<p>ç¶ææºæ¯éå¯¹goalçï¼èä¸æ¯éå¯¹clientåserverçã ##### Goal * Accepted * Executing * Succeed * Aborted * Cancelled * Succeed * Aborted * Cancelled * Rejected</p>
<h4 id="set-goal-result">Set Goal Result</h4>
<ul>
<li>Server <figure class="highlight nix"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Once done, set goal final state</span></span><br><span class="line"><span class="comment"># goal_handle.succeed()</span></span><br><span class="line">goal_handle.<span class="built_in">abort</span>()</span><br></pre></td></tr></tbody></table></figure></li>
<li>Client <figure class="highlight scss"><table><tbody><tr><td class="code"><pre><span class="line">def <span class="built_in">goal_result_callback</span>(self, future):</span><br><span class="line">    status = future.<span class="built_in">result</span>().status</span><br><span class="line">    result = future.<span class="built_in">result</span>().result</span><br><span class="line">    if status == GoalStatus.STATUS_SUCCEEDED:</span><br><span class="line">        self.<span class="built_in">get_logger</span>().<span class="built_in">info</span>(<span class="string">"Goal succeeded."</span>)</span><br><span class="line">    elif status == GoalStatus.STATUS_ABORTED:</span><br><span class="line">        self.<span class="built_in">get_logger</span>().<span class="built_in">info</span>(<span class="string">"Goal aborted."</span>)</span><br><span class="line">    self.<span class="built_in">get_logger</span>().<span class="built_in">info</span>(<span class="string">"Result: "</span> + <span class="built_in">str</span>(result.reached_number))</span><br></pre></td></tr></tbody></table></figure> #### Send Goal Feedback</li>
<li>Server <figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">execute_callback</span>(<span class="params">self, goal_handle: ServerGoalHandle</span>):</span><br><span class="line">    <span class="comment"># Get request from goal</span></span><br><span class="line">    target_number = goal_handle.request.target_number</span><br><span class="line">    period = goal_handle.request.period</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Execute the action</span></span><br><span class="line">    self.get_logger().info(<span class="string">"Executing the goal"</span>)</span><br><span class="line">    feedback = CountUntil.Feedback()</span><br><span class="line">    counter = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(target_number):</span><br><span class="line">        counter += <span class="number">1</span></span><br><span class="line">        self.get_logger().info(<span class="string">"counter = "</span> + <span class="built_in">str</span>(counter))</span><br><span class="line">        feedback.current_number = counter</span><br><span class="line">        goal_handle.publish_feedback(feedback=feedback)</span><br><span class="line">        time.sleep(period)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Once done, set goal final state</span></span><br><span class="line">    <span class="comment"># goal_handle.succeed()</span></span><br><span class="line">    goal_handle.abort()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># and send the result</span></span><br><span class="line">    result = CountUntil.Result()</span><br><span class="line">    result.reached_number = counter</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></tbody></table></figure></li>
<li>Client <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">future = self.count_until_client_.send<span class="constructor">_goal_async(<span class="params">goal</span>=<span class="params">goal</span>, <span class="params">feedback_callback</span>=<span class="params">self</span>.<span class="params">goal_feedback_callback</span>)</span></span><br><span class="line">def goal<span class="constructor">_feedback_callback(<span class="params">self</span>, <span class="params">feedback_msg</span>)</span>:</span><br><span class="line">    number = feedback_msg.feedback.current_number</span><br><span class="line">    self.get<span class="constructor">_logger()</span>.info(<span class="string">"Got feedback: "</span> + str(number))</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="cancel-goal">Cancel Goal</h4>
<ul>
<li>Server <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">self.count_until_server_ = <span class="constructor">ActionServer(<span class="params">self</span>, CountUntil, <span class="string">"count_until"</span>, <span class="params">goal_callback</span>=<span class="params">self</span>.<span class="params">goal_callback</span>, <span class="params">cancel_callback</span>=<span class="params">self</span>.<span class="params">cancel_callback</span>, <span class="params">execute_callback</span>=<span class="params">self</span>.<span class="params">execute_callback</span>, <span class="params">callback_group</span>=ReentrantCallbackGroup()</span>)</span><br><span class="line"></span><br><span class="line">def cancel<span class="constructor">_callback(<span class="params">self</span>, <span class="params">goal_handle</span>: ServerGoalHandle)</span>:</span><br><span class="line">    self.get<span class="constructor">_logger()</span>.info(<span class="string">"Received a cancel request."</span>)</span><br><span class="line">    return CancelResponse.ACCEPT # <span class="keyword">or</span> REJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(target_number):</span><br><span class="line"><span class="keyword">if</span> goal_handle.is_cancel_requested:</span><br><span class="line">    self.get<span class="constructor">_logger()</span>.info(<span class="string">"Canceling the goal"</span>)</span><br><span class="line">    goal_handle.canceled<span class="literal">()</span></span><br><span class="line">    result.reached_number = counter</span><br><span class="line">    return result</span><br></pre></td></tr></tbody></table></figure></li>
<li>Client <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable language_">self</span>.timer_ = <span class="variable language_">self</span>.create_timer(<span class="number">2.0</span>, <span class="variable language_">self</span>.cancel_goal)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cancel_goal</span>(<span class="params"><span class="variable language_">self</span></span>):</span><br><span class="line">    <span class="variable language_">self</span>.get_logger().info(<span class="string">"Send a cancel request"</span>)</span><br><span class="line">    <span class="variable language_">self</span>.goal_handle_.cancel_goal_async()</span><br><span class="line">    <span class="variable language_">self</span>.timer_.cancel()</span><br></pre></td></tr></tbody></table></figure></li>
<li>å¤çº¿ç¨</li>
</ul>
<h2 id="lifecycle-nodes">Lifecycle Nodes</h2>
<p>åç§ç§ç¶æï¼ unconfigured, inactive, active, finalized äºç§è½¬æ¢ï¼ on_configure, on_activate, on_deactivate, on_cleanupï¼on_shutdown å­å¨çæä¹ï¼ * éç¨äºç¡¬ä»¶éä¿¡ * éæ°éç½®æ´å®¹æ * æç§é¡ºåºåå§å * æååéèµæºååå­ * å¤èç¹ä¹ååæ­¥åå§å</p>
<p><strong>Lifecycle Node</strong>å¨<strong>nav2</strong>å<strong>ros2_control</strong>ä¸­ç»å¸¸ä½¿ç¨ã ### å®ç°Lifecycle Node #### on_configure èµ·å°åå§åçä½ç¨ </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">on_configure</span>(<span class="params">self, previous_state: LifecycleState</span>):</span><br><span class="line">    self.get_logger().info(<span class="string">"In on_configure."</span>)</span><br><span class="line">    self.number_publisher_ = self.create_publisher(Int64, <span class="string">"number"</span>, <span class="number">10</span>)</span><br><span class="line">    self.number_timer_ = self.create_timer(</span><br><span class="line">        <span class="number">1.0</span> / self.publish_frequency_, self.publish_number)</span><br><span class="line">    self.get_logger().info(<span class="string">"Number publisher has been started."</span>)</span><br><span class="line">    <span class="keyword">return</span> TransitionCallbackReturn.SUCCESS</span><br></pre></td></tr></tbody></table></figure> #### on_cleanup èç¹ç»æåï¼éæ¾èµæº <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Destroy ROS2 communications , disconnect from HW</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_cleanup</span>(<span class="params"><span class="variable language_">self</span>, <span class="symbol">previous_state:</span> <span class="title class_">LifecycleState</span></span>):</span><br><span class="line">    <span class="variable language_">self</span>.get_logger().info(<span class="string">"In on_cleanup."</span>)</span><br><span class="line">    <span class="variable language_">self</span>.destroy_lifecycle_publisher(<span class="variable language_">self</span>.number_publisher_)</span><br><span class="line">    <span class="variable language_">self</span>.destroy_timer(<span class="variable language_">self</span>.number_timer_)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">TransitionCallbackReturn</span>.<span class="variable constant_">SUCCESS</span></span><br></pre></td></tr></tbody></table></figure> #### on_activate <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Activate/Enable HW</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_activate</span>(<span class="params"><span class="variable language_">self</span>, <span class="symbol">previous_state:</span> <span class="title class_">LifecycleState</span></span>):</span><br><span class="line">    <span class="variable language_">self</span>.get_logger().info(<span class="string">"In on_activate."</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">super</span>().on_activate(previous_state)</span><br></pre></td></tr></tbody></table></figure> #### on_deactivate <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Deactivate/Disable HW</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_deactivate</span>(<span class="params"><span class="variable language_">self</span>, <span class="symbol">previous_state:</span> <span class="title class_">LifecycleState</span></span>):</span><br><span class="line">    <span class="variable language_">self</span>.get_logger().info(<span class="string">"In on_deactivate."</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">super</span>().on_deactivate(previous_state)</span><br></pre></td></tr></tbody></table></figure> #### on_shutdown <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">def on<span class="constructor">_shutdown(<span class="params">self</span>, <span class="params">previous_state</span>: LifecycleState)</span>:</span><br><span class="line">    self.get<span class="constructor">_logger()</span>.info(<span class="string">"In on_shutdown."</span>)</span><br><span class="line">    self.destroy<span class="constructor">_lifecycle_publisher(<span class="params">self</span>.<span class="params">number_publisher_</span>)</span></span><br><span class="line">    self.destroy<span class="constructor">_timer(<span class="params">self</span>.<span class="params">number_timer_</span>)</span></span><br><span class="line">    return TransitionCallbackReturn.SUCCESS</span><br></pre></td></tr></tbody></table></figure> #### on_error <figure class="highlight ruby"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Process errors, deactivate + cleanup</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_error</span>(<span class="params"><span class="variable language_">self</span>, <span class="symbol">previous_state:</span> <span class="title class_">LifecycleState</span></span>):</span><br><span class="line">    <span class="variable language_">self</span>.get_logger().info(<span class="string">"In on_error."</span>)</span><br><span class="line">    <span class="variable language_">self</span>.destroy_lifecycle_publisher(<span class="variable language_">self</span>.number_publisher_)</span><br><span class="line">    <span class="variable language_">self</span>.destroy_timer(<span class="variable language_">self</span>.number_timer_)</span><br><span class="line">    <span class="comment"># do some checks, if ok then return SUCCESS, if not FAILURE</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">TransitionCallbackReturn</span>.<span class="variable constant_">FAILURE</span></span><br></pre></td></tr></tbody></table></figure> ### ä½¿ç¨Lifecycle Node æä»¬å¯æ¯ä½¿ç¨å½ä»¤è¡æ§å¶<strong>Lifecycle Node</strong>çç¶æåæ¢ã <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">ros2 lifecycle nodes <span class="comment">--æ¥çæælifecycle nodes</span></span><br><span class="line">ros2 lifecycle <span class="built_in">list</span> /number_publisher <span class="comment">--æ¥çæå®lifecycle nodeå¯ä»¥æ¥åçå½ä»¤</span></span><br><span class="line">ros2 lifecycle <span class="keyword">set</span> /number_publisher configure/<span class="built_in">activate</span>/deactivate/cleanup/shutdown <span class="comment">--è®¾ç½®æå®lifecycle nodeçç¶æ</span></span><br><span class="line">ros2 lifecycle <span class="keyword">get</span> /number_publisher <span class="comment">--æ¥çæå®lifecycleçç¶æ</span></span><br></pre></td></tr></tbody></table></figure> <strong>Lifecycle Node</strong>çæ¥å£é½æ¯<strong>service</strong>ï¼æä»¥å¯ä»¥ä½¿ç¨<strong>service client</strong>è®¿é®ã<p></p>
<h2 id="executors">Executors</h2>
<p><strong>Executors</strong>ç¨äºé»å¡ç¨åºï¼ç­å¾ç¨åºçæ§è¡,åä¸º<strong>SingleThreadExecutor</strong>å<strong>MultiThreadExecutor</strong>ã <strong>rclpy.spin()</strong>é»è®¤è°ç¨çæ¯<strong>SingleThreadExecutor</strong>ã <strong>MultiThreadExecutor</strong>éè¦æä¾<strong>callback_groups</strong>ã * ReentrantCallbackGroup çæ­£çå¤çº¿ç¨ï¼å¯ä»¥éæ°è¿å¥ï¼æ éç­å¾callbackæ§è¡å®æ * MutuallyExclusiveCallbackGroup åçº¿ç¨ï¼éè¦ç­å¾callbackæ§è¡å®ææè½åè¿å¥</p>
<h2 id="components">Components</h2>
<p>å¨ä¸ä¸ªå¯æ§è¡æä»¶ä¸­ï¼å¯ä»¥å¯å¨å¤ä¸ªèç¹ï¼</p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>ROS</category>
      </categories>
      <tags>
        <tag>ROS</tag>
        <tag>Advanced Concepts</tag>
      </tags>
  </entry>
  <entry>
    <title>ROS2 Learning Notes URDF &amp; Xacro</title>
    <url>/2024/01/21/ROS2-Learning-Notes-URDF-Xacro/</url>
    <content><![CDATA[<html><head></head><body><p><strong>URDF</strong>æ¯â<strong>Unified Robot Description Format</strong>âçç¼©åï¼å¨<strong>ROS</strong>ä¸­ç¨äºå®ä¹æºå¨äººï¼æ ¼å¼ä¸º<strong>xml</strong>ã<a href="http://wiki.ros.org/xacro">xacro</a>æ¯"<strong>XML Macros</strong>"çç¼©åï¼å¯ä»¥æ©å±<strong>xml</strong>è¯­è¨ï¼éè¿å®ä¹åéãå½æ°ï¼å¼å¥æä»¶çå½¢å¼æåä»£ç çå¯è¯»æ§ãæ¬æä¸»è¦è®²è§£<strong>urdf</strong>å<strong>xacro</strong>çåºæ¬ç¨æ³ã <span id="more"></span> ## URDF ### URDFçåºæ¬ç»æ </p><figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">xmlns:xacro</span>=<span class="string">"http://www.ros.org/wiki/xacro"</span> <span class="attr">name</span>=<span class="string">"arduinobot"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"world"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/basement.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.5 -0.5 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/basement.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.5 -0.5 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">xacro:default_inertial</span> <span class="attr">mass</span>=<span class="string">"1.0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"virtual_joint"</span> <span class="attr">type</span>=<span class="string">"fixed"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">"world"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">"base_link"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> å¼å¤´çç¬¬ä¸å¥å£°æ<strong>xml</strong>æä»¶ççæ¬åç¼ç æ ¼å¼ã æé¡¶å±çæ ç­¾æ¯<strong>robot</strong>ï¼éè¦ææä¸¤ä¸ªå±æ§ï¼ä¸ä¸ªæ¯<strong>name</strong>ï¼å¦å¤ä¸ä¸ªæ¯<strong>xmlns:xacro</strong>ãä½¿ç¨<strong>xacro</strong>ï¼æä»¬å¯ä»¥å¾æ¹ä¾¿å°å®ä¹åéãå½æ°ï¼å¼å¥æä»¶ï¼æåxmlæä»¶çå¯è¯»æ§åå¯æ©å±æ§ã éé¢çåå®¹åå«<strong>link</strong>ï¼<strong>joint</strong>ç­æ¨¡åï¼ä¸ºæºå¨äººçå·ä½å®ä¹ã ### Link <strong>Link</strong>å®ä¹åºæ¬çåä½ç»æï¼ä¸»è¦åæ¬ä¸é¨ååå®¹ï¼ <strong>visual</strong>,<strong>collision</strong>å<strong>inertial</strong>ä¸é¨åã <figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">"base_link"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collision</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collision</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> #### visual <strong>visual</strong>æ ç­¾ä¸»è¦ç¨äºå®ä¹åä½çå ä½å½¢ç¶ï¼ç¨äºå¨<strong>rviz2</strong>ä¸­å¯è§åãå ä½å½¢ç¶å¯ä»¥æ¯ç®åçå ä½ä½ï¼ä¾å¦<strong>box</strong>, <strong>sphere</strong>å<strong>cylinder</strong>ï¼ä¹å¯ä»¥æ¯è´è´£çå ä½å½¢ç¶ï¼éè¿<strong>mesh</strong>æ ç­¾ï¼å¼å¥<strong>STL</strong>æä»¶ã ##### box <figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">box</span> <span class="attr">size</span>=<span class="string">"$</span></span></span><span class="template-variable">{arm_base_length}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{arm_base_width}</span><span class="language-xml"><span class="tag"><span class="string"> $</span></span></span><span class="template-variable">{arm_base_height}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 $</span></span></span><span class="template-variable">{arm_base_height/2.0}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"orange"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> ##### cylinder <figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">cylinder</span> <span class="attr">radius</span>=<span class="string">"$</span></span></span><span class="template-variable">{forearm_radius}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">length</span>=<span class="string">"$</span></span></span><span class="template-variable">{forearm_length}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 $</span></span></span><span class="template-variable">{forearm_length/2.0}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"yellow"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> ##### sphere <figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">visual</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">sphere</span> <span class="attr">radius</span>=<span class="string">"$</span></span></span><span class="template-variable">{wheel_radius/2.0}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"0 0 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">material</span> <span class="attr">name</span>=<span class="string">"blue"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure> ##### mesh <figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">visual</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">geometry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mesh</span> <span class="attr">filename</span>=<span class="string">"package://robot_description/meshes/basement.STL"</span> <span class="attr">scale</span>=<span class="string">"0.01 0.01 0.01"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">geometry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">origin</span> <span class="attr">xyz</span>=<span class="string">"-0.5 -0.5 0"</span> <span class="attr">rpy</span>=<span class="string">"0 0 0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">visual</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> å¯è§åé¨åé¤äºå®ä¹å ä½å½¢ç¶ï¼è¿éè¦ææåæ ç³»ãé»è®¤çåæ ç³»ä¸ºå ä½ä¸­å¿ï¼éè¿<strong>origin</strong>æ ç­¾å»å®ä¹åæ ç³»ä¸é»è®¤åæ ç³»çå³ç³»ï¼<strong>xyz</strong>ææä¸¤ä¸ªåæ ç³»ä¹é´çå¹³ç§»å³ç³»ï¼<strong>rpy</strong>ææä¸¤ä¸ªåæ ç³»ä¹é´çæè½¬å³ç³»ã #### collision <strong>collision</strong>æ ç­¾ä¸»è¦ç¨äºå®ä¹ç¢°ææ£æµçèå´ï¼å¨<strong>gazebo</strong>ä»¿çä¸­ä½¿ç¨ãå¶å®ä¹åå®¹ä¸è¬ä¸<strong>visual</strong>é¨åç¸åï¼ä¹å¯ä»¥ä½¿ç¨ç®åçå ä½ä½ä»£æ¿å¤æå½¢ç¶ï¼ä»¥æåç¢°ææ£æµçæ§è½ã #### inertial <strong>inertial</strong>æ ç­¾ä¸»è¦ç¨äºå®ä¹åä½çè½¬å¨æ¯éï¼å¨<strong>gazebo</strong>ä»¿çä¸­ç¨äºè¿å¨å»ºæ¨¡ãå ä½ä½çè½¬å¨æ¯éç±å¶è´¨éåå¸åå ä½å½¢ç¶å±åå³å®ï¼è®¡ç®å¤æãå¯¹äºè´¨éåå¸ååçç®åå ä½ä½ï¼å¶è½¬å¨æ¯éæå·ä½çå¬å¼è¡¨è¾¾ãä¸è¬ä½¿ç¨<strong>xacro:macro</strong>å®ä¹å½æ°å®ç°ï¼å·ä½å¯ä»¥åè§åé¢ç« èã<p></p>
<h3 id="joint">Joint</h3>
<p>å³èä¸»è¦å®ä¹ä¸¤ä¸ª<strong>link</strong>ä¹é´çåæ ç³»ç¸å¯¹ä½ç½®å³ç³»åç¸å¯¹è¿å¨å³ç³»ã </p><figure class="highlight abnf"><table><tbody><tr><td class="code"><pre><span class="line">&lt;joint name<span class="operator">=</span><span class="string">"joint_4"</span> type<span class="operator">=</span><span class="string">"revolute"</span>&gt;</span><br><span class="line">    &lt;parent link<span class="operator">=</span><span class="string">"claw_support"</span>/&gt;</span><br><span class="line">    &lt;child link<span class="operator">=</span><span class="string">"gripper_right"</span>/&gt;</span><br><span class="line">    &lt;origin xyz<span class="operator">=</span><span class="string">"-0.04 0.13 -0.1"</span> rpy<span class="operator">=</span><span class="string">"0 0 0"</span>/&gt;</span><br><span class="line">    &lt;axis xyz<span class="operator">=</span><span class="string">"0 0 1"</span>/&gt;</span><br><span class="line">    &lt;limit lower<span class="operator">=</span><span class="string">"-${pi/2}"</span> upper<span class="operator">=</span><span class="string">"0"</span> effort<span class="operator">=</span><span class="string">"${effort}"</span> velocity<span class="operator">=</span><span class="string">"${velocity}"</span>/&gt;</span><br><span class="line">&lt;/joint&gt;</span><br></pre></td></tr></tbody></table></figure> å¶ä¸­<strong>parent</strong>å<strong>child</strong>åå«ææäºä¸¤ä¸ª<strong>link</strong>ï¼å­linkè¦å¨ç¶linkä¸­è¿å¨ã<strong>type</strong>ææäºè¿å¨å³ç³»ï¼åæ¬åºå®å¼ç<strong>fixed</strong>ï¼å³èæè½¬å¼ç<strong>revolute</strong>ç­ç­ã #### fixed<p></p>
<h4 id="revolute">revolute</h4>
<h2 id="xacro">Xacro</h2>
<h3 id="å®ä¹åé">å®ä¹åé</h3>
<figure class="highlight dust"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"effort"</span> <span class="attr">value</span>=<span class="string">"30.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:property</span> <span class="attr">name</span>=<span class="string">"velocity"</span> <span class="attr">value</span>=<span class="string">"10.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"default_inertial"</span> <span class="attr">params</span>=<span class="string">"mass"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">mass</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">{mass}</span><span class="language-xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">inertia</span> <span class="attr">ixx</span>=<span class="string">"1.0"</span> <span class="attr">ixy</span>=<span class="string">"0.0"</span> <span class="attr">ixz</span>=<span class="string">"0.0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">iyy</span>=<span class="string">"1.0"</span> <span class="attr">iyz</span>=<span class="string">"0.0"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">izz</span>=<span class="string">"1.0"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">inertial</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">"default_transmission"</span> <span class="attr">params</span>=<span class="string">"number"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">transmission</span> <span class="attr">name</span>=<span class="string">"transmission_$</span></span></span><span class="template-variable">{number}</span><span class="language-xml"><span class="tag"><span class="string">"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span>transmission_interface/SimpleTransmission<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">actuator</span> <span class="attr">name</span>=<span class="string">"motor_$</span></span></span><span class="template-variable">{number}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">role</span>=<span class="string">"actuator1"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">"joint_$</span></span></span><span class="template-variable">{number}</span><span class="language-xml"><span class="tag"><span class="string">"</span> <span class="attr">role</span>=<span class="string">"joint1"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">mechanical_reduction</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">mechanical_reduction</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">transmission</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="å®ä¹å½æ°">å®ä¹å½æ°</h3>
<figure class="highlight clean"><table><tbody><tr><td class="code"><pre><span class="line">```</span><br><span class="line">### å¼å¥æä»¶</span><br></pre></td></tr></tbody></table></figure>
<p><xacro:include filename="$(find robot_description)/urdf/robot_gazebo.xacro"> <xacro:include filename="$(find robot_description)/urdf/robot_ros2_control.xacro"> ``` <link name="base_plate"> <visual> <geometry> <mesh filename="package://robot_description/meshes/base_plate.STL" scale="0.01 0.01 0.01"> </mesh></geometry> <origin rpy="0 0 0" xyz="-0.39 -0.39 -0.56"> </origin></visual> <collision> <geometry> <mesh filename="package://robot_description/meshes/base_plate.STL" scale="0.01 0.01 0.01"> </mesh></geometry> <origin rpy="0 0 0" xyz="-0.39 -0.39 -0.56"> </origin></collision> <xacro:default_inertial mass="1.0">  <joint name="joint_1" type="revolute"> <parent link="base_link"> <child link="base_plate"> <axis xyz="0 0 1"> <origin rpy="0 0 0" xyz="0 0 0.307"> <limit lower="-${pi/2}" upper="${pi/2}" effort="${effort}" velocity="${velocity}"> </limit></origin></axis></child></parent></joint></xacro:default_inertial></xacro:include></xacro:include></p>
<pre><code>&lt;link name="forward_drive_arm"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/forward_drive_arm.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin rpy="0 -${pi/2} ${pi/2}" xyz="0.19 0.06 -0.08"/&gt;
    &lt;/visual&gt;
    &lt;collision&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/forward_drive_arm.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin rpy="0 -${pi/2} ${pi/2}" xyz="0.19 0.06 -0.08"/&gt;
    &lt;/collision&gt;
    &lt;xacro:default_inertial mass="1.0"/&gt;
&lt;/link&gt;

&lt;joint name="joint_2" type="revolute"&gt;
    &lt;parent link="base_plate"/&gt;
    &lt;child link="forward_drive_arm"/&gt;
    &lt;axis xyz="1 0 0"/&gt;
    &lt;origin rpy="0 0 0" xyz="-0.02 0 0.35"/&gt;
    &lt;limit lower="-${pi/2}" upper="${pi/2}" effort="${effort}" velocity="${velocity}"/&gt;
&lt;/joint&gt;

&lt;link name="horizontal_arm"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/horizontal_arm.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin rpy="${pi/2} 0 ${pi/2}" xyz="-0.03 -0.4 -0.06"/&gt;
    &lt;/visual&gt;
    &lt;collision&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/horizontal_arm.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin rpy="${pi/2} 0 ${pi/2}" xyz="-0.03 -0.4 -0.06"/&gt;

    &lt;/collision&gt;
    &lt;xacro:default_inertial mass="1.0"/&gt;
&lt;/link&gt;
&lt;joint name="joint_3" type="revolute"&gt;
    &lt;parent link="forward_drive_arm"/&gt;
    &lt;child link="horizontal_arm"/&gt;
    &lt;axis xyz="1 0 0"/&gt;
    &lt;origin rpy="0 0 0" xyz="0 0 0.8"/&gt;
    &lt;limit lower="-${pi/2}" upper="${pi/2}" effort="${effort}" velocity="${velocity}"/&gt;
&lt;/joint&gt;

&lt;link name="claw_support"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/claw_support.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin rpy="0 0 ${pi/2}" xyz="0 -0.05 -0.15"/&gt;
    &lt;/visual&gt;
    &lt;collsion&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/claw_support.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin rpy="0 0 ${pi/2}" xyz="0 -0.05 -0.15"/&gt;
    &lt;/collsion&gt;
    &lt;xacro:default_inertial mass="0.05"/&gt;
&lt;/link&gt;
&lt;joint name="horizontal_arm_to_claw_support" type="fixed"&gt;
    &lt;parent link="horizontal_arm"/&gt;
    &lt;child link="claw_support"/&gt;
    &lt;origin rpy="0 0 0" xyz="0 0.82 0"/&gt;
&lt;/joint&gt;

&lt;link name="gripper_right"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/right_finger.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="-0.1 0.5 -0.1" rpy="0 0 -${pi/2}"/&gt;
    &lt;/visual&gt;
    &lt;collision&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/right_finger.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="-0.1 0.5 -0.1" rpy="0 0 -${pi/2}"/&gt;
    &lt;/collision&gt;
    &lt;xacro:default_inertial mass="0.01"/&gt;
&lt;/link&gt;
&lt;link name="gripper_left"&gt;
    &lt;visual&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/left_finger.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="-0.04 0.5 -0.1" rpy="0 0 -${pi/2}"/&gt;
    &lt;/visual&gt;
    &lt;collision&gt;
        &lt;geometry&gt;
            &lt;mesh filename="package://robot_description/meshes/left_finger.STL" scale="0.01 0.01 0.01"/&gt;
        &lt;/geometry&gt;
        &lt;origin xyz="-0.04 0.5 -0.1" rpy="0 0 -${pi/2}"/&gt;
    &lt;/collision&gt;
    &lt;xacro:default_inertial mass="0.01"/&gt;
&lt;/link&gt;
&lt;joint name="joint_5" type="revolute"&gt;
    &lt;parent link="claw_support"/&gt;
    &lt;child link="gripper_left"/&gt;
    &lt;origin xyz="-0.22 0.13 -0.1" rpy="0 0 0"/&gt;
    &lt;axis xyz="0 0 1"/&gt;
    &lt;mimic joint="joint_4" multiplier="-1"/&gt;
    &lt;limit lower="0" upper="${pi/2}" effort="${effort}" velocity="${velocity}"/&gt;
&lt;/joint&gt;
&lt;xacro:default_transmission number="1"/&gt;
&lt;xacro:default_transmission number="2"/&gt;
&lt;xacro:default_transmission number="3"/&gt;
&lt;xacro:default_transmission number="4"/&gt;</code></pre>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>ROS</category>
      </categories>
      <tags>
        <tag>ROS</tag>
        <tag>URDF</tag>
        <tag>Xacro</tag>
      </tags>
  </entry>
  <entry>
    <title>Config Frp Client And Auto-Start As A Service</title>
    <url>/2024/02/02/Config-Frp-Client-And-Auto-Start-As-A-Service/</url>
    <content><![CDATA[<html><head></head><body><p><strong>Frp</strong>æ¯ä¸ä¸ªæ­å»ºé§éå®ç°åç½ç©¿éçå¸¸ç¨å·¥å·ï¼å¨ä¹åç<a href="https://youngsonzhao.github.io/2023/02/15/Expose-Local-Devices-Behind-A-NAT-To-The-Internet-Using-FRP/">ç¬è®°</a>ä¸­æä»¬å·²ç»è®²äºå¦ä½å¨æå¡å¨éç½®<strong>frps</strong>åå¨è·¯ç±å¨éç½®<strong>frpc</strong>ãä»å¤©ä¸»è¦è®°å½ä¸ä¸å¦ä½å¨<strong>Ubuntu 22.04</strong>ç³»ç»ä¸éç½®<strong>frpc</strong>ï¼å®ç°<strong>ssh</strong>è¿ç¨ç»éè®¿é®ã <span id="more"></span> ### Download <a href="https://github.com/fatedier/frp">Frp</a>ä»£ç æç®¡å¨githubä¸ï¼æä»¬å¯ä»¥å°<a href="https://github.com/fatedier/frp/releases">release</a>ä¸è½½å¯¹åºæä½ç³»ç»çæ¬çææ°åã </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/fatedier/</span>frp<span class="regexp">/releases/</span>download<span class="regexp">/v0.54.0/</span>frp_0.<span class="number">54.0</span>_linux_amd64.tar.gz</span><br></pre></td></tr></tbody></table></figure> ### Install ä¸è½½å¥½çåæ¯å·²ç»ç¼è¯å¥½çå¯æ§è¡æä»¶ï¼æä»¬åªéè¦å°å¶æ¾ç½®å¨æå®æä»¶å¤¹ä¸å³å¯. <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">mkdir</span> .frp</span><br><span class="line"><span class="attribute">cd</span> .frp</span><br><span class="line"><span class="attribute">tar</span> -xzf frp_0.<span class="number">54</span>.<span class="number">0</span>_linux_amd64.tar.gz</span><br><span class="line"><span class="attribute">cd</span> frp_0.<span class="number">54</span>.<span class="number">0</span>_linux_amd64</span><br></pre></td></tr></tbody></table></figure> ### Config éç½®å®¢æ·ç«¯éè¦åå»ºä¸ä¸ª<strong>frpc.ini</strong>çéç½®æä»¶ï¼å¨éç½®ä¸­é¦åéç½®<strong>frps</strong>çipå°åï¼ç«¯å£å·åtokenï¼ç¶åéç½®æ¬å°çç«¯å£å·åæå¡ç«¯çè½¬åç«¯å£å³å¯ã <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for authentication</span></span><br><span class="line"><span class="attr">token</span> = <span class="number">12345678</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">2222</span></span><br></pre></td></tr></tbody></table></figure> ç±äºéè¦sshç»éï¼æä»¥æ¬å°ç«¯å£ä¸º22ï¼æå¡ç«¯ç«¯å£ä¸º2222ã ### Service å°<strong>frpc</strong>è®¾ç½®ä¸ºæå¡çå½¢å¼ï¼å¯ä»¥ä¿è¯å¼å¯èªå¯å¨ã é¦åè¿å¥å°ç®å½åã <figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/systemd/system</span><br><span class="line">sudo <span class="built_in">touch</span> frpc.service</span><br><span class="line">sudo gedit frpc.service</span><br></pre></td></tr></tbody></table></figure> ç¶åéç½®æå¡ã <figure class="highlight ini"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=My Frp Client Service - %i</span><br><span class="line"><span class="attr">After</span>=network.target syslog.target</span><br><span class="line"><span class="attr">Wants</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">5</span>s</span><br><span class="line"><span class="attr">ExecStart</span>=/bin/bash -c <span class="string">'/home/robot/.frp/frp_0.54.0_linux_amd64/frpc -c /home/robot/.frp/frp_0.54.0_linux_amd64/frpc.ini'</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></tbody></table></figure> æåè¿è¡æå¡ã <figure class="highlight nsis"><table><tbody><tr><td class="code"><pre><span class="line">sudo <span class="params">system</span>ctl enable frpc.service</span><br><span class="line">sudo <span class="params">system</span>ctl start frpc.service</span><br><span class="line">sudo <span class="params">system</span>ctl status frpc.service</span><br></pre></td></tr></tbody></table></figure> ### SSH Ubuntu 22.04é»è®¤sshè¿æ¥æ¯å³é­çï¼éè¦æå¼ç«¯å£ï¼å¼å¯sshè¿æ¥ã é¦åæç¡®ææsshè¿æ¥çç«¯å£ä¸º22ã <figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">sudo vi <span class="regexp">/etc/</span>ssh/ssh_config</span><br><span class="line">port <span class="number">22</span></span><br></pre></td></tr></tbody></table></figure> ç¶åå¼å¯22ç«¯å£ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install openssh-server</span><br><span class="line">ufw <span class="built_in">enable</span></span><br><span class="line">sudo ufw <span class="built_in">enable</span></span><br><span class="line">sudo ufw allow 22/tcp</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°éç½®å®æåï¼å¨ä»»æç»ç«¯ï¼éè¿sshæä»¤ç»éå³å¯ã <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">ssh</span> robot@<span class="number">192.168.1.2</span> -p <span class="number">2222</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Ubuntu</category>
        <category>Frp</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>SSH</tag>
        <tag>Frp</tag>
      </tags>
  </entry>
  <entry>
    <title>ROS2 Learning Notes - Moveit</title>
    <url>/2024/02/03/ROS2-Learning-Notes-Moveit/</url>
    <content><![CDATA[<html><head></head><body><p><a href="https://moveit.ros.org/">MoveIt</a>æ¯æºå¨äººè¿å¨è§åä¸æ§å¶çéè¦å¼æºåï¼æ¬æä¸»è¦è®²è§£<strong>MoveIt</strong>çä½¿ç¨æ­¥éª¤åç»éªã <span id="more"></span> ### Installation </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-joint-trajectory-controller</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-forward-command-controller</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-joint-state-broadcaster</span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>ROS</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>ROS</tag>
        <tag>Moveit</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Python Virtual Environment</title>
    <url>/2024/02/21/Using-Python-Virtual-Environment/</url>
    <content><![CDATA[<html><head></head><body><p>å¨Pythonä¸­ä½¿ç¨èæç¯å¢å¯ä»¥å°åå®è£å¨ç¬ç«çç¯å¢ä¸­ï¼æ¢ä¸ä¼æ±¡æä¸»ç¯å¢ï¼ä¹ä¸ä¼ç¸äºå½±åãå æ­¤å¨è·æµè¯ç¯å¢çæ¶åï¼æ¨èä½¿ç¨èæç¯å¢ãæ¬æä¸»è¦ä»ç»èæç¯å¢çä½¿ç¨æ¹æ³ã <span id="more"></span> ### å®è£ ä½¿ç¨ä»¥ä¸æä»¤å®è£èæç¯å¢ï¼ </p><figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> virtualenv</span><br><span class="line">sudo apt-get <span class="keyword">install</span> python3.<span class="number">10</span>-venv</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="ä½¿ç¨">ä½¿ç¨</h3>
<h4 id="åå§åç¯å¢">åå§åç¯å¢</h4>
<p>å®è£æååï¼ä½¿ç¨ä»¥ä¸æä»¤å¯ä»¥åå»ºä¸ä¸ªèæç¯å¢ã </p><figure class="highlight jboss-cli"><table><tbody><tr><td class="code"><pre><span class="line">python -m venv <span class="string">.venv</span></span><br></pre></td></tr></tbody></table></figure> æåå»ºçèæç¯å¢ç®å½ä¸ºï¼<strong>.venv</strong> #### æ¿æ´»ç¯å¢ åå»ºç¯å¢åï¼å¯ä»¥ä½¿ç¨ä»¥ä¸æä»¤æ¿æ´»ç¯å¢ï¼è®©Pythonå¨èæç¯å¢ä¸­è¿è¡ã <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">source</span> ~<span class="regexp">/.venv/</span>bin/active</span><br></pre></td></tr></tbody></table></figure> æ¿æ´»åï¼æä»¬å¯ä»¥å¨èæç¯å¢ä¸­æ­£å¸¸è¿è¡pythonä»£ç ä»¥åä½¿ç¨pipå®è£åã #### å¤±æ´»ç¯å¢ <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">deactive</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>Python</tag>
        <tag>Venv</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Python Virtual Environment In Jupyter Notebook</title>
    <url>/2024/06/27/Using-Python-Virtual-Environment-In-Jupyter-Notebook/</url>
    <content><![CDATA[<html><head></head><body><p>ä»ç»å¦ä½å¨<strong>Jupyter Notebook</strong>ä¸­ä½¿ç¨Pythonçèæç¯å¢ã <span id="more"></span> ### å®è£ </p><figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">pip install --<span class="keyword">user</span> <span class="title">ipykernel</span> -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></tbody></table></figure> ### æ·»å èæç¯å¢ åå»ºpythonèæç¯å¢è¯·åç§<a href="https://youngsonzhao.github.io/2024/02/21/Using-Python-Virtual-Environment/">Using Python Virtual Environment</a> åå»ºå¥½èæç¯å¢åï¼å¯ä»¥ä½¿ç¨ä¸ä¸å½ä»¤å¨Jupyterä¸­æ³¨åèæç¯å¢ã <figure class="highlight crmsh"><table><tbody><tr><td class="code"><pre><span class="line">python -m ipykernel install --<span class="keyword">user</span> <span class="title">--name</span>=.sam</span><br></pre></td></tr></tbody></table></figure> ### å¨Jupyter Notebookä¸­ä½¿ç¨èæç¯å¢ å¨<strong>Jupyter Notebook</strong>é¡µé¢çå·¦ä¸è§æé®ï¼å¯ä»¥åæ¢kernelï¼å¦ä¸å¾æç¤ºï¼ <img alt="åæ¢kernel" data-src="/2024/06/27/Using-Python-Virtual-Environment-In-Jupyter-Notebook/ipykernel.png"><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Python</category>
        <category>Jupyter Notebook</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>Python</tag>
        <tag>Jupyter Notebook</tag>
        <tag>Venv</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Baidu Yun Python Client In Ubuntu Server</title>
    <url>/2024/06/28/Using-Baidu-Yun-Python-Client-In-Ubuntu-Server/</url>
    <content><![CDATA[<html><head></head><body><p>ç¾åº¦äºçä¸ºUbuntu Serveræä¾äºä¸ä¸ªPythonå®¢æ·ç«¯<strong>pyby</strong>ï¼å¯ä»¥å¨æå¡å¨ä¸ä¸ä¼ åä¸è½½ç¾åº¦äºçéé¢çæä»¶ã <span id="more"></span> ### å®è£ </p><figure class="highlight awk"><table><tbody><tr><td class="code"><pre><span class="line">pip install requests bypy -i https:<span class="regexp">//</span>pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></tbody></table></figure> ### ææ è¿è¡ä»¥ä¸æä»¤ä¼çæä¸ä¸ªç¨äºææçé¾æ¥ï¼å¤å¶é¾æ¥å¨æµè§å¨ä¸­æå¼å¹¶ç»éï¼åä¼çæææç ï¼æç§æç¤ºå¤å¶å°terminalä¸­å³å¯ã <figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">python</span> -m bypy <span class="literal">info</span></span><br></pre></td></tr></tbody></table></figure> ### ä½¿ç¨ ç¾åº¦äºçä¼ä¸º<strong>bypy</strong>å®¢æ·ç«¯åç¬çæä¸ä¸ªæä»¶å¤¹ï¼ä½¿ç¨ç¸å³æä»¤å¯ä»¥æ¥çæä»¶å¤¹çä¿¡æ¯ãä¸ä¼ æä»¶ãä¸è½½æä»¶ç­ã #### æ¥çç¾åº¦äºççç©ºé´ <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">bypy</span> info</span><br><span class="line"><span class="attribute">Quota</span>: <span class="number">5</span>.<span class="number">005</span>TB</span><br><span class="line"><span class="attribute">Used</span>: <span class="number">2</span>.<span class="number">416</span>GB</span><br></pre></td></tr></tbody></table></figure> #### æ¥çç¾åº¦äºççåè¡¨ <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">bypy list</span></span><br></pre></td></tr></tbody></table></figure> #### ä¸ä¼ æä»¶ <figure class="highlight applescript"><table><tbody><tr><td class="code"><pre><span class="line">bypy -v upload <span class="built_in">file</span>.path /remote_dir</span><br></pre></td></tr></tbody></table></figure> #### å¶ä»æä»¤ <figure class="highlight powershell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="variable">$</span> bypy downdir k8s <span class="comment">#ç´æ¥ä¸è½½bypyç®å½ä¸k8s</span></span><br><span class="line"><span class="variable">$</span> bypy syncup <span class="comment">#æå½åç®å½åæ­¥å°äºç</span></span><br><span class="line"><span class="variable">$</span> bypy syncdown <span class="comment">#æäºçåå®¹åæ­¥å°å½åç®å½</span></span><br><span class="line"><span class="variable">$</span> bypy downdir / <span class="comment">#æäºçåå®¹åæ­¥å°å½åç®å½</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$</span> bypy <span class="built_in">compare</span> <span class="comment">#æ¯è¾æ¬å°å½åç®å½åäºçï¼ç¨åºçï¼æ ¹ç®å½</span></span><br><span class="line"><span class="variable">$</span> bypy <span class="literal">-v</span> <span class="comment">#è¿è¡æ¶æ·»å -våæ°ï¼ä¼æ¾ç¤ºè¿åº¦è¯¦æã</span></span><br><span class="line"><span class="variable">$</span> bypy <span class="literal">-d</span> <span class="comment">#è¿è¡æ¶æ·»å -dï¼ä¼æ¾ç¤ºä¸äºè°è¯ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$</span> bypy <span class="literal">-ddd</span> <span class="comment">#æ¾ç¤ºæ´å¤httpéè®¯ä¿¡æ¯</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Tutorials</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Ngnix To Deploy A File Share Service</title>
    <url>/2024/06/28/Using-Ngnix-To-Deploy-A-File-Share-Service/</url>
    <content><![CDATA[<html><head></head><body><p>ä½¿ç¨Nginxï¼å¯ä»¥å¨æå¡å¨ä¸æ­å»ºä¸ä¸ªæä»¶åäº«æå¡ï¼éè¿ç½ç»å¯ä»¥ä¸è½½æå®æä»¶å¤¹ä¸çæä»¶ã <span id="more"></span> ### å®è£ </p><figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install nginx</span><br></pre></td></tr></tbody></table></figure> ### éç½®æå¡ å®è£ånginxä¼èªå¨è¿è¡ï¼çå¬80ç«¯å£ï¼æä»¬éè¦ä¿®æ¹é»è®¤éç½®ï¼æå®ç«¯å£årootç®å½ï¼å¹¶å¼å¯autoindexã <figure class="highlight gradle"><table><tbody><tr><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>nginx<span class="regexp">/sites-enabled/</span><span class="keyword">default</span></span><br></pre></td></tr></tbody></table></figure> <figure class="highlight nginx"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section">server</span> {</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">30001</span> default_server;</span><br><span class="line">        <span class="attribute">listen</span> [::]:<span class="number">30001</span> default_server;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># SSL configuration</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># listen 443 ssl default_server;</span></span><br><span class="line">        <span class="comment"># listen [::]:443 ssl default_server;</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Note: You should disable gzip for SSL traffic.</span></span><br><span class="line">        <span class="comment"># See: https://bugs.debian.org/773332</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Read up on ssl_ciphers to ensure a secure configuration.</span></span><br><span class="line">        <span class="comment"># See: https://bugs.debian.org/765782</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Self signed certs generated by the ssl-cert package</span></span><br><span class="line">        <span class="comment"># Don't use them in a production server!</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># include snippets/snakeoil.conf;</span></span><br><span class="line"></span><br><span class="line">        <span class="attribute">root</span> /apprun/datasets/;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add index.php to the list if you are using PHP</span></span><br><span class="line">        <span class="attribute">index</span> index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">server_name</span> _;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / {</span><br><span class="line">                <span class="comment"># First attempt to serve request as file, then</span></span><br><span class="line">                <span class="comment"># as directory, then fall back to displaying a 404.</span></span><br><span class="line">                <span class="comment"># try_files $uri $uri/ =404;</span></span><br><span class="line">                <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass PHP scripts to FastCGI server</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ {</span></span><br><span class="line">        <span class="comment">#       include snippets/fastcgi-php.conf;</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#       # With php-fpm (or other unix sockets):</span></span><br><span class="line">        <span class="comment">#       fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;</span></span><br><span class="line">        <span class="comment">#       # With php-cgi (or other tcp sockets):</span></span><br><span class="line">        <span class="comment">#       fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#}</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache's document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx's one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht {</span></span><br><span class="line">        <span class="comment">#       deny all;</span></span><br><span class="line">        <span class="comment">#}</span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> ### éå¯æå¡ <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">sudo nginx -t</span></span><br><span class="line"><span class="attribute">sudo nginx -s reload</span></span><br></pre></td></tr></tbody></table></figure><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Ubuntu</category>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Tutorials</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Training A Model Using Pytorch</title>
    <url>/2024/07/01/Training-A-Model-Using-Pytorch/</url>
    <content><![CDATA[<html><head></head><body><p><strong>Pytorch</strong>æ¯ç®åä¸»æµçæ·±åº¦å­¦ä¹ æ¡æ¶ï¼æ¬æä¸»è¦ä»ç»ä½¿ç¨<strong>Pytorch</strong>è®­ç»æ¨¡åçä¸»è¦æµç¨ï¼åæ¬è¶åæ°å®ä¹ãè®­ç»æ°æ®åå¤ãéç½®GPUãå è½½æ¨¡åãå å¨æ¨¡ååæ°ãè®­ç»æ¥å¿æå°ãæ¨¡ååæ°ä¿å­ç­æ­¥éª¤ã <span id="more"></span> ## ä¸»æµç¨ è®­ç»æ¨¡åçä¸»æµç¨ä¸è¬å®ä¹ä¸ä¸ª<strong>main</strong>å½æ°ä½ä¸ºå½æ°æ§è¡çå¥å£å½æ°ï¼å·ä½å¦ä¸æç¤ºï¼ </p><figure class="highlight cpp"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta"># train.py</span></span><br><span class="line"></span><br><span class="line"><span class="function">def <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line"><span class="function">    pass</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">if __name__ =</span>= <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="built_in">main</span>()</span><br></pre></td></tr></tbody></table></figure> ### å®ä¹è®­ç»æ¨¡åçè¶åæ° éè¿<strong>argparser</strong>å®ä¹æ¨¡åè®­ç»çè¶åæ°ï¼å·ä½å¦ä¸æç¤ºï¼ <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line"><span class="comment"># Required parameters</span></span><br><span class="line">parser.add_argument(<span class="string">"--name"</span>, <span class="attribute">required</span>=<span class="literal">True</span>,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Name of this run. Used for monitoring."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--dataset"</span>, choices=[<span class="string">"cifar10"</span>, <span class="string">"cifar100"</span>], <span class="attribute">default</span>=<span class="string">"cifar10"</span>,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Which downstream task."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--model_type"</span>, choices=[<span class="string">"ViT-B_16"</span>, <span class="string">"ViT-B_32"</span>, <span class="string">"ViT-L_16"</span>,</span><br><span class="line">                                                <span class="string">"ViT-L_32"</span>, <span class="string">"ViT-H_14"</span>, <span class="string">"R50-ViT-B_16"</span>],</span><br><span class="line">                    <span class="attribute">default</span>=<span class="string">"ViT-B_16"</span>,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Which variant to use."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--pretrained_dir"</span>, <span class="attribute">type</span>=str, <span class="attribute">default</span>=<span class="string">"checkpoint/ViT-B_16.npz"</span>,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Where to search for pretrained ViT models."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--output_dir"</span>, <span class="attribute">default</span>=<span class="string">"output"</span>, <span class="attribute">type</span>=str,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"The output directory where checkpoints will be written."</span>)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">"--img_size"</span>, <span class="attribute">default</span>=224, <span class="attribute">type</span>=int,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Resolution size"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--train_batch_size"</span>, <span class="attribute">default</span>=512, <span class="attribute">type</span>=int,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Total batch size for training."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--eval_batch_size"</span>, <span class="attribute">default</span>=64, <span class="attribute">type</span>=int,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Total batch size for eval."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--eval_every"</span>, <span class="attribute">default</span>=100, <span class="attribute">type</span>=int,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Run prediction on validation set every so many steps."</span></span><br><span class="line">                            <span class="string">"Will always run one evaluation at the end of training."</span>)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">"--learning_rate"</span>, <span class="attribute">default</span>=3e-2, <span class="attribute">type</span>=float,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"The initial learning rate for SGD."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--weight_decay"</span>, <span class="attribute">default</span>=0, <span class="attribute">type</span>=float,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Weight deay if we apply some."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--num_steps"</span>, <span class="attribute">default</span>=10000, <span class="attribute">type</span>=int,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Total number of training epochs to perform."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--decay_type"</span>, choices=[<span class="string">"cosine"</span>, <span class="string">"linear"</span>], <span class="attribute">default</span>=<span class="string">"cosine"</span>,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"How to decay the learning rate."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--warmup_steps"</span>, <span class="attribute">default</span>=500, <span class="attribute">type</span>=int,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Step of training to perform learning rate warmup for."</span>)</span><br><span class="line">parser.add_argument(<span class="string">"--max_grad_norm"</span>, <span class="attribute">default</span>=1.0, <span class="attribute">type</span>=float,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Max gradient norm."</span>)</span><br><span class="line"></span><br><span class="line">parser.add_argument(<span class="string">"--local_rank"</span>, <span class="attribute">type</span>=int, <span class="attribute">default</span>=-1,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"local_rank for distributed training on gpus"</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--seed'</span>, <span class="attribute">type</span>=int, <span class="attribute">default</span>=42,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"random seed for initialization"</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--gradient_accumulation_steps'</span>, <span class="attribute">type</span>=int, <span class="attribute">default</span>=1,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Number of updates steps to accumulate before performing a backward/update pass."</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--fp16'</span>, <span class="attribute">action</span>=<span class="string">'store_true'</span>,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Whether to use 16-bit float precision instead of 32-bit"</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--fp16_opt_level'</span>, <span class="attribute">type</span>=str, <span class="attribute">default</span>=<span class="string">'O2'</span>,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"For fp16: Apex AMP optimization level selected in ['O0', 'O1', 'O2', and 'O3']."</span></span><br><span class="line">                            <span class="string">"See details at https://nvidia.github.io/apex/amp.html"</span>)</span><br><span class="line">parser.add_argument(<span class="string">'--loss_scale'</span>, <span class="attribute">type</span>=float, <span class="attribute">default</span>=0,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"Loss scaling to improve fp16 numeric stability. Only used when fp16 set to True.\n"</span></span><br><span class="line">                            <span class="string">"0 (default value): dynamic loss scaling.\n"</span></span><br><span class="line">                            <span class="string">"Positive power of 2: static loss scaling value.\n"</span>)</span><br><span class="line">args = parser.parse_args()</span><br></pre></td></tr></tbody></table></figure> ### éç½®è®­ç»æ¨¡åçGPUæ¾å¡ æ¯æå¤å¡ååå¡è®­ç»ï¼éç½®æ¹æ³ç¥æå·®å¼ã #### åå¡è®­ç» åå¡è®­ç»ï¼é»è®¤çlocal_rank=-1 <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">device = torch<span class="selector-class">.device</span>(<span class="string">"cuda"</span> <span class="keyword">if</span> torch<span class="selector-class">.cuda</span><span class="selector-class">.is_available</span>() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line">args<span class="selector-class">.n_gpu</span> = torch<span class="selector-class">.cuda</span><span class="selector-class">.device_count</span>()</span><br><span class="line">args<span class="selector-class">.device</span> = device</span><br></pre></td></tr></tbody></table></figure> #### å¤å¡è®­ç» å¤å¡è®­ç»çå®ç°æ¹å¼æå¤ç§ï¼æ¨èä½¿ç¨<strong>åå¸å¼æ°æ®å¹¶è¡ï¼Distributed Data Parallelï¼</strong>æ¹å¼ï¼æ¢å¯ä»¥ç¨äºåæºå¤å¡è®­ç»ï¼åå¯ä»¥ç¨äºå¤æºå¤å¡è®­ç»ãç±å¤è¿ç¨å®ç°ï¼å¯ä»¥ä»ä»¥ä¸æ¹é¢çè§£ï¼ 1. ä»ä¸å¼å§å°±ä¼å¯å¨å¤ä¸ªè¿ç¨(è¿ç¨æ°ç­äºGPUæ°)ï¼æ¯ä¸ªè¿ç¨ç¬äº«ä¸ä¸ªGPUï¼æ¯ä¸ªè¿ç¨é½ä¼ç¬ç«å°æ§è¡ä»£ç ãè¿æå³çæ¯ä¸ªè¿ç¨é½ç¬ç«å°åå§åæ¨¡åãè®­ç»ï¼å½ç¶ï¼å¨æ¯æ¬¡è¿­ä»£è¿ç¨ä¸­ä¼éè¿è¿ç¨é´éä¿¡å±äº«æ¢¯åº¦ï¼æ´åæ¢¯åº¦ï¼ç¶åç¬ç«å°æ´æ°åæ°ã<p></p>
<ol start="2" type="1">
<li><p>æ¯ä¸ªè¿ç¨é½ä¼åå§åä¸ä»½è®­ç»æ°æ®éï¼å½ç¶å®ä»¬ä¼ä½¿ç¨æ°æ®éä¸­çä¸åè®°å½åè®­ç»ï¼è¿ç¸å½äºåæ ·çæ¨¡ååè¿å»ä¸åçæ°æ®åè®­ç»ï¼ä¹å°±æ¯æè°çæ°æ®å¹¶è¡ãè¿æ¯éè¿torch.utils.data.distributed.DistributedSamplerå½æ°å®ç°çï¼ä¸è¿é»è¾ä¸ä¹ä¸é¾æ³å°ï¼åªè¦åä¸ä¸æ°æ®partitionï¼ä¸åè¿ç¨æ¿å°ä¸åçpartitionå°±å¯ä»¥äºã</p></li>
<li><p>è¿ç¨éè¿local_rankåéæ¥æ è¯èªå·±ï¼local_rankä¸º0çä¸ºmasterï¼å¶ä»æ¯slaveãlocal_rankè¡¨ç¤ºçæ¯å½åçè¿ç¨å¨å½åèç¹çç¼å·ï¼å ä¸ºæä»¬è®¾ç½®äº2ä¸ªè¿ç¨ï¼å æ­¤è¿ç¨çç¼å·å°±æ¯0å1ãå¨ä½¿ç¨å¯å¨å½ä»¤æ¶ï¼torch.distributed.launchå·¥å·ä¼é»è®¤å°æ ¹æ®nproc_per_nodeä¼ å¥local_rankåæ°ã <img alt="pytorchå¤GPUè®­ç»çä¸¤ç§æ¨¡å¼" data-src="https://blog.csdn.net/Mr_health/article/details/122822483"> <img alt="pytorch-multi-gpu-training" data-src="https://github.com/jia-zhuang/pytorch-multi-gpu-training"></p></li>
</ol>
<ul>
<li>éè¿<strong>argparser</strong>å®ä¹local_rankåæ° <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">parser.add_argument(<span class="string">"--local_rank"</span>, <span class="attribute">type</span>=int, <span class="attribute">default</span>=-1,</span><br><span class="line">                    <span class="attribute">help</span>=<span class="string">"local_rank for distributed training on gpus"</span>)</span><br></pre></td></tr></tbody></table></figure></li>
<li>å½ä»¤è¡æ³¨å¥local_rankåæ° <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">python -m torch.distributed.launch <span class="attribute">--nproc_per_node</span>=4 <span class="attribute">--nnodes</span>=1 train.py</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°å½ä»¤è¡¨ç¤ºå¯å¨ä¸ä¸ªè®­ç»èç¹ï¼æ¯ä¸ªèç¹4å¼ GPUå¡ã<strong>torch.distributed.launch</strong>å°±ä»¥å½ä»¤è¡åæ°çæ¹å¼å°args.local_rankåéæ³¨å¥å°æ¯ä¸ªè¿ç¨ä¸­ï¼æ¯ä¸ªè¿ç¨å¾å°çåéå¼é½ä¸ç¸åãæ¯å¦ä½¿ç¨ 4 ä¸ªGPUçè¯ï¼å 4 ä¸ªè¿ç¨è·å¾çargs.local_rankå¼åå«ä¸º0ã1ã2ã3ã</li>
<li>è°ç¨GPUæ¾å¡ <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">torch.cuda.set<span class="constructor">_device(<span class="params">args</span>.<span class="params">local_rank</span>)</span></span><br><span class="line">device = torch.device(<span class="string">"cuda"</span>, args.local_rank)</span><br><span class="line">torch.distributed.init<span class="constructor">_process_group(<span class="params">backend</span>='<span class="params">nccl</span>', <span class="params">timeout</span>=<span class="params">timedelta</span>(<span class="params">minutes</span>=60)</span>)</span><br><span class="line">args.n_gpu = <span class="number">1</span></span><br><span class="line">args.device = device</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="è®¾ç½®éæºæ°ç§å­">è®¾ç½®éæºæ°ç§å­</h3>
<p>éæºæ°å½±åäºæ¨¡ååå§åï¼è¿èå½±åæ¨¡åçè®­ç»ææï¼ä¸ºäºä¿è¯å¤æ¬¡è®­ç»çç»æä¸è´æ§ï¼éå¸¸å°éæºæ°ç§å­è®¾ç½®ä¸ºåºå®å¼ã </p><figure class="highlight maxima"><table><tbody><tr><td class="code"><pre><span class="line">def set_seed(<span class="built_in">args</span>):</span><br><span class="line">    <span class="built_in">random</span>.seed(<span class="built_in">args</span>.seed)</span><br><span class="line">    <span class="built_in">np</span>.<span class="built_in">random</span>.seed(<span class="built_in">args</span>.seed)</span><br><span class="line">    torch.manual_seed(<span class="built_in">args</span>.seed)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">args</span>.n_gpu &gt; <span class="number">0</span>:</span><br><span class="line">        torch.cuda.manual_seed_all(<span class="built_in">args</span>.seed)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="éç½®æ¨¡å">éç½®æ¨¡å</h3>
<p>åä¸ä¸ªæ¨¡åç»æï¼ä¸è¬ä¼é¢çä¸äºè¶åæ°ï¼ç¨äºçææ¨¡ååæ°éçæ¨¡åã #### éç½®æ¨¡ååæ° æ¨èä½¿ç¨<strong>ml_collections</strong>å®ç°æ¨¡ååæ°éç½®ï¼å·ä½å¦ä¸æç¤ºï¼ </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ml_collections</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_model_config</span>():</span><br><span class="line">    <span class="string">"""Returns a minimal configuration for testing."""</span></span><br><span class="line">    config = ml_collections.ConfigDict()</span><br><span class="line">    config.patches = ml_collections.ConfigDict({<span class="string">'size'</span>: (<span class="number">16</span>, <span class="number">16</span>)})</span><br><span class="line">    config.hidden_size = <span class="number">1</span></span><br><span class="line">    config.transformer = ml_collections.ConfigDict()</span><br><span class="line">    config.transformer.mlp_dim = <span class="number">1</span></span><br><span class="line">    config.transformer.num_heads = <span class="number">1</span></span><br><span class="line">    config.transformer.num_layers = <span class="number">1</span></span><br><span class="line">    config.transformer.attention_dropout_rate = <span class="number">0.0</span></span><br><span class="line">    config.transformer.dropout_rate = <span class="number">0.1</span></span><br><span class="line">    config.classifier = <span class="string">'token'</span></span><br><span class="line">    config.representation_size = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> config</span><br></pre></td></tr></tbody></table></figure> ä¸è¿°ä»£ç å¯ä»¥çæå¦ä¸æç¤ºçéç½®ã <figure class="highlight nestedtext"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">classifier</span><span class="punctuation">:</span> <span class="string">token</span></span><br><span class="line"><span class="attribute">hidden_size</span><span class="punctuation">:</span> <span class="string">1</span></span><br><span class="line"><span class="attribute">patches</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">size</span><span class="punctuation">:</span> <span class="string">!!python/tuple</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">16</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">16</span></span><br><span class="line"><span class="attribute">representation_size</span><span class="punctuation">:</span> <span class="string">null</span></span><br><span class="line"><span class="attribute">transformer</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">attention_dropout_rate</span><span class="punctuation">:</span> <span class="string">0.0</span></span><br><span class="line">  <span class="attribute">dropout_rate</span><span class="punctuation">:</span> <span class="string">0.1</span></span><br><span class="line">  <span class="attribute">mlp_dim</span><span class="punctuation">:</span> <span class="string">1</span></span><br><span class="line">  <span class="attribute">num_heads</span><span class="punctuation">:</span> <span class="string">1</span></span><br><span class="line">  <span class="attribute">num_layers</span><span class="punctuation">:</span> <span class="string">1</span></span><br></pre></td></tr></tbody></table></figure> æ¨¡åçå¤ä¸ªéç½®ï¼å¯ä»¥ä½¿ç¨ä¸ä¸ªdictè®°å½ã <figure class="highlight stylus"><table><tbody><tr><td class="code"><pre><span class="line">CONFIGS = {</span><br><span class="line">    <span class="string">'ViT-B_16'</span>: configs<span class="selector-class">.get_b16_config</span>(),</span><br><span class="line">    <span class="string">'ViT-B_32'</span>: configs<span class="selector-class">.get_b32_config</span>(),</span><br><span class="line">    <span class="string">'ViT-L_16'</span>: configs<span class="selector-class">.get_l16_config</span>(),</span><br><span class="line">    <span class="string">'ViT-L_32'</span>: configs<span class="selector-class">.get_l32_config</span>(),</span><br><span class="line">    <span class="string">'ViT-H_14'</span>: configs<span class="selector-class">.get_h14_config</span>(),</span><br><span class="line">    <span class="string">'R50-ViT-B_16'</span>: configs<span class="selector-class">.get_r50_b16_config</span>(),</span><br><span class="line">    <span class="string">'testing'</span>: configs<span class="selector-class">.get_testing</span>(),</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> #### çæå¹¶å è½½æ¨¡å é¦åï¼å°éç½®ä¼ å¥æ¨¡åæé å½æ°ä¸­ï¼çææ¨¡åï¼å¶æ¬¡ï¼æ¨¡åå¯ä»¥è½½å¥ä¹åä¿å­å¥½çåæ°ï¼æåï¼å°æ¨¡åå è½½å°deviceä¸­ã <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line">model = <span class="constructor">VisionTransformer(<span class="params">config</span>, <span class="params">args</span>.<span class="params">img_size</span>, <span class="params">zero_head</span>=True, <span class="params">num_classes</span>=<span class="params">num_classes</span>)</span></span><br><span class="line">model.load<span class="constructor">_from(<span class="params">np</span>.<span class="params">load</span>(<span class="params">args</span>.<span class="params">pretrained_dir</span>)</span>)</span><br><span class="line">model.<span class="keyword">to</span>(args.device)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="ç»è®¡æ¨¡ååæ°é">ç»è®¡æ¨¡ååæ°é</h4>
<p>æ¨¡ååæ°ä¸è¬æçæ¯ææ¢¯åº¦çåæ°ã </p><figure class="highlight stan"><table><tbody><tr><td class="code"><pre><span class="line">def count_parameters(<span class="title">model</span>):</span><br><span class="line">    params = <span class="built_in">sum</span>(p.numel() <span class="keyword">for</span> p <span class="keyword">in</span> <span class="title">model</span>.<span class="title">parameters</span>() <span class="keyword">if</span> p.requires_grad)</span><br><span class="line">    <span class="keyword">return</span> params/<span class="number">1000000</span> <span class="comment"># in millionï¼Mï¼</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="è®­ç»æ¨¡å">è®­ç»æ¨¡å</h3>
<p>æ¨¡åè®­ç»ä¸è¬ç±ä¸ä¸ª<strong>train</strong>å½æ°å®ç°ã </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">args, model</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure> #### ä¿å­è®­ç»è¿ç¨ * éè¿<strong>SummaryWriter</strong>ä¿å­è®­ç»è¿ç¨æ°æ®æ¥å¿ï¼å¹¶å¯ä»¥éè¿<strong>TensorBoard</strong>æ¥çã ä¸è¬ç±åå¡æèmasterå¡ä¿å­è®­ç»æ¥å¿ï¼å¤å¡è®­ç»çslaveèç¹ä¸ä¿å­æ¥å¿ã <figure class="highlight reasonml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> args.local_rank <span class="keyword">in</span> <span class="literal">[-<span class="number">1</span>, <span class="number">0</span>]</span>:</span><br><span class="line">    os.makedirs(args.output_dir, exist_ok=True)</span><br><span class="line">    writer = <span class="constructor">SummaryWriter(<span class="params">log_dir</span>=<span class="params">os</span>.<span class="params">path</span>.<span class="params">join</span>(<span class="string">"logs"</span>, <span class="params">args</span>.<span class="params">name</span>)</span>)</span><br><span class="line"></span><br><span class="line"># train loop</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.local_rank <span class="keyword">in</span> <span class="literal">[-<span class="number">1</span>, <span class="number">0</span>]</span>:</span><br><span class="line">        writer.close<span class="literal">()</span></span><br></pre></td></tr></tbody></table></figure> * å¨terminalä¸­æå°æ¥å¿ æ¨èä½¿ç¨<strong>logging</strong>åå®ç°ï¼å·ä½å¦ä¸æç¤ºï¼ <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">import<span class="built_in"> logging</span></span><br><span class="line"><span class="built_in"></span>logger = logging.getLogger(__name__)</span><br><span class="line">logger.<span class="built_in">info</span>(<span class="string">"***** Running training *****"</span>)</span><br><span class="line">logger.<span class="built_in">info</span>(<span class="string">"  Total optimization steps = %d"</span>, args.num_steps)</span><br><span class="line">logger.<span class="built_in">info</span>(<span class="string">"  Instantaneous batch size per GPU = %d"</span>, args.train_batch_size)</span><br><span class="line">logger.<span class="built_in">info</span>(<span class="string">"  Total train batch size (w. parallel, distributed &amp; accumulation) = %d"</span>,</span><br><span class="line">                args.train_batch_size * args.gradient_accumulation_steps * (</span><br><span class="line">                    torch.distributed.get_world_size() <span class="keyword">if</span> args.local_rank != -1 <span class="keyword">else</span> 1))</span><br><span class="line">logger.<span class="built_in">info</span>(<span class="string">"  Gradient Accumulation steps = %d"</span>, args.gradient_accumulation_steps)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="åå¤æ°æ®é">åå¤æ°æ®é</h4>
<p>éè¿ä¸ä¸ª<strong>data_loader</strong>å½æ°å®ç°ï¼è¿å<strong>train_loader</strong>å<strong>test_loader</strong>ï¼å·ä½åç§ï¼(æ°æ®éåå¤)[] </p><figure class="highlight autohotkey"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">train_loader,</span> test_loader = dat<span class="built_in">a_loader</span>(args)</span><br></pre></td></tr></tbody></table></figure> #### åå¤ä¼åå¨åè®­ç»è®¡å éè¦ä½¿ç¨<strong>apex</strong>åºã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> apex import amp</span><br><span class="line"><span class="keyword">from</span> apex.parallel import DistributedDataParallel as DDP</span><br><span class="line"><span class="comment"># Prepare optimizer and scheduler</span></span><br><span class="line">optimizer = torch.optim.SGD(model.parameters(),</span><br><span class="line">                            <span class="attribute">lr</span>=args.learning_rate,</span><br><span class="line">                            <span class="attribute">momentum</span>=0.9,</span><br><span class="line">                            <span class="attribute">weight_decay</span>=args.weight_decay)</span><br><span class="line">t_total = args.num_steps</span><br><span class="line"><span class="keyword">if</span> args.decay_type == <span class="string">"cosine"</span>:</span><br><span class="line">   <span class="built_in"> scheduler </span>= WarmupCosineSchedule(optimizer, <span class="attribute">warmup_steps</span>=args.warmup_steps, <span class="attribute">t_total</span>=t_total)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">   <span class="built_in"> scheduler </span>= WarmupLinearSchedule(optimizer, <span class="attribute">warmup_steps</span>=args.warmup_steps, <span class="attribute">t_total</span>=t_total)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.fp16:</span><br><span class="line">    model, optimizer = amp.initialize(<span class="attribute">models</span>=model,</span><br><span class="line">                                        <span class="attribute">optimizers</span>=optimizer,</span><br><span class="line">                                        <span class="attribute">opt_level</span>=args.fp16_opt_level)</span><br><span class="line">    amp._amp_state.loss_scalers[0]._loss_scale = 2*<span class="number">*20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Distributed training</span></span><br><span class="line"><span class="keyword">if</span> args.local_rank != -1:</span><br><span class="line">    model = DDP(model, <span class="attribute">message_size</span>=250000000, <span class="attribute">gradient_predivide_factor</span>=get_world_size())</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="å¼å§è®­ç»">å¼å§è®­ç»</h4>
<ul>
<li>valid å¨è®­ç»è¿ç¨ä¸­ä¸è¬ä¼æ¯éä¸å®æ¶é´ç¨æµè¯éè¯ä¼°ä¸ä¸æ¨¡åçè®­ç»ç»æï¼è¿ç¨å¦ä¸æç¤ºï¼ <figure class="highlight scss"><table><tbody><tr><td class="code"><pre><span class="line">def <span class="built_in">valid</span>(args, model, writer, test_loader, global_step):</span><br><span class="line">    # Validation!</span><br><span class="line">    eval_losses = <span class="built_in">AverageMeter</span>()</span><br><span class="line"></span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"***** Running Validation *****"</span>)</span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"  Num steps = %d"</span>, <span class="built_in">len</span>(test_loader))</span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"  Batch size = %d"</span>, args.eval_batch_size)</span><br><span class="line"></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    all_preds, all_label = [], []</span><br><span class="line">    epoch_iterator = <span class="built_in">tqdm</span>(test_loader,</span><br><span class="line">                          desc=<span class="string">"Validating... (loss=X.X)"</span>,</span><br><span class="line">                          bar_format=<span class="string">"{l_bar}{r_bar}"</span>,</span><br><span class="line">                          dynamic_ncols=True,</span><br><span class="line">                          disable=args.local_rank not in [-<span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line">    loss_fct = torch.nn.<span class="built_in">CrossEntropyLoss</span>()</span><br><span class="line">    for step, batch in <span class="built_in">enumerate</span>(epoch_iterator):</span><br><span class="line">        batch = <span class="built_in">tuple</span>(t.<span class="built_in">to</span>(args.device) for t in batch)</span><br><span class="line">        x, y = batch</span><br><span class="line">        with torch.<span class="built_in">no_grad</span>():</span><br><span class="line">            logits = <span class="built_in">model</span>(x)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            eval_loss = <span class="built_in">loss_fct</span>(logits, y)</span><br><span class="line">            eval_losses.<span class="built_in">update</span>(eval_loss.<span class="built_in">item</span>())</span><br><span class="line"></span><br><span class="line">            preds = torch.<span class="built_in">argmax</span>(logits, dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        if <span class="built_in">len</span>(all_preds) == <span class="number">0</span>:</span><br><span class="line">            all_preds.<span class="built_in">append</span>(preds.<span class="built_in">detach</span>().<span class="built_in">cpu</span>().<span class="built_in">numpy</span>())</span><br><span class="line">            all_label.<span class="built_in">append</span>(y.<span class="built_in">detach</span>().<span class="built_in">cpu</span>().<span class="built_in">numpy</span>())</span><br><span class="line">        else:</span><br><span class="line">            all_preds[<span class="number">0</span>] = np.<span class="built_in">append</span>(</span><br><span class="line">                all_preds[<span class="number">0</span>], preds.<span class="built_in">detach</span>().<span class="built_in">cpu</span>().<span class="built_in">numpy</span>(), axis=<span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            all_label[<span class="number">0</span>] = np.<span class="built_in">append</span>(</span><br><span class="line">                all_label[<span class="number">0</span>], y.<span class="built_in">detach</span>().<span class="built_in">cpu</span>().<span class="built_in">numpy</span>(), axis=<span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">        epoch_iterator.<span class="built_in">set_description</span>(<span class="string">"Validating... (loss=%2.5f)"</span> % eval_losses.val)</span><br><span class="line"></span><br><span class="line">    all_preds, all_label = all_preds[<span class="number">0</span>], all_label[<span class="number">0</span>]</span><br><span class="line">    accuracy = <span class="built_in">simple_accuracy</span>(all_preds, all_label)</span><br><span class="line"></span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"\n"</span>)</span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"Validation Results"</span>)</span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"Global Steps: %d"</span> % global_step)</span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"Valid Loss: %2.5f"</span> % eval_losses.avg)</span><br><span class="line">    logger.<span class="built_in">info</span>(<span class="string">"Valid Accuracy: %2.5f"</span> % accuracy)</span><br><span class="line"></span><br><span class="line">    writer.<span class="built_in">add_scalar</span>(<span class="string">"test/accuracy"</span>, scalar_value=accuracy, global_step=global_step)</span><br><span class="line">    return accuracy</span><br><span class="line"></span><br><span class="line">def <span class="built_in">simple_accuracy</span>(preds, labels):</span><br><span class="line">    return (preds == labels).<span class="built_in">mean</span>()</span><br></pre></td></tr></tbody></table></figure></li>
<li>train é¦åï¼å¨whileå¾ªç¯å¼å§è®­ç»ä¹åï¼å®ä¹loss, global_step, best_accç­å¨å±åéï¼ç¶åå¼å¯whileå¾ªç¯ï¼å¼å§è®­ç»ï¼æåéè¿global_stepåtotal_stepç»æè®­ç»ãè®­ç»è¿ç¨ä¸­éè¦ç¨å°<strong>tqdm</strong>åºã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">model.zero_grad()</span><br><span class="line">set_seed(args)  # Added here <span class="keyword">for</span> reproducibility (even between python 2 <span class="keyword">and</span> 3)</span><br><span class="line">losses = AverageMeter()</span><br><span class="line">global_step, best_acc = 0, 0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    model.train()</span><br><span class="line">    epoch_iterator = tqdm(train_loader,</span><br><span class="line">                            <span class="attribute">desc</span>=<span class="string">"Training (X / X Steps) (loss=X.X)"</span>,</span><br><span class="line">                            <span class="attribute">bar_format</span>=<span class="string">"{l_bar}{r_bar}"</span>,</span><br><span class="line">                            <span class="attribute">dynamic_ncols</span>=<span class="literal">True</span>,</span><br><span class="line">                            <span class="attribute">disable</span>=args.local_rank <span class="keyword">not</span> <span class="keyword">in</span> [-1, 0])</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">step</span>, batch <span class="keyword">in</span> enumerate(epoch_iterator):</span><br><span class="line">        batch = tuple(t.<span class="keyword">to</span>(args.device) <span class="keyword">for</span> t <span class="keyword">in</span> batch)</span><br><span class="line">        x, y = batch</span><br><span class="line">        loss = model(x, y)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> args.gradient_accumulation_steps &gt; 1:</span><br><span class="line">            loss = loss / args.gradient_accumulation_steps</span><br><span class="line">        <span class="keyword">if</span> args.fp16:</span><br><span class="line">            with amp.scale_loss(loss, optimizer) as scaled_loss:</span><br><span class="line">                scaled_loss.backward()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            loss.backward()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">step</span> + 1) % args.gradient_accumulation_steps == 0:</span><br><span class="line">            losses.update(loss.item()<span class="number">*a</span>rgs.gradient_accumulation_steps)</span><br><span class="line">            <span class="keyword">if</span> args.fp16:</span><br><span class="line">                torch.nn.utils.clip_grad_norm_(amp.master_params(optimizer), args.max_grad_norm)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                torch.nn.utils.clip_grad_norm_(model.parameters(), args.max_grad_norm)</span><br><span class="line">            scheduler.<span class="keyword">step</span>()</span><br><span class="line">            optimizer.<span class="keyword">step</span>()</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            global_step += 1</span><br><span class="line"></span><br><span class="line">            epoch_iterator.set_description(</span><br><span class="line">                <span class="string">"Training (%d / %d Steps) (loss=%2.5f)"</span> % (global_step, t_total, losses.val)</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">if</span> args.local_rank <span class="keyword">in</span> [-1, 0]:</span><br><span class="line">                writer.add_scalar(<span class="string">"train/loss"</span>, <span class="attribute">scalar_value</span>=losses.val, <span class="attribute">global_step</span>=global_step)</span><br><span class="line">                writer.add_scalar(<span class="string">"train/lr"</span>, <span class="attribute">scalar_value</span>=scheduler.get_lr()[0], <span class="attribute">global_step</span>=global_step)</span><br><span class="line">            <span class="keyword">if</span> global_step % args.eval_every == 0 <span class="keyword">and</span> args.local_rank <span class="keyword">in</span> [-1, 0]:</span><br><span class="line">                accuracy = valid(args, model, writer, test_loader, global_step)</span><br><span class="line">                <span class="keyword">if</span> best_acc &lt; accuracy:</span><br><span class="line">                    save_model(args, model)</span><br><span class="line">                    best_acc = accuracy</span><br><span class="line">                model.train()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> global_step % t_total == 0:</span><br><span class="line">                break</span><br><span class="line">    losses.reset()</span><br><span class="line">    <span class="keyword">if</span> global_step % t_total == 0:</span><br><span class="line">        break</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Deep Learning</category>
        <category>Pytorch</category>
      </categories>
      <tags>
        <tag>Deep Learning</tag>
        <tag>Tutorials</tag>
        <tag>Pytorch</tag>
      </tags>
  </entry>
  <entry>
    <title>Usage Of Testing Tool Locust</title>
    <url>/2024/08/22/Usage-Of-Testing-Tool-Locust/</url>
    <content><![CDATA[<html><head></head><body><p>å®æåç«¯æå¡å¼ååï¼å¨ä¸å¡ä¸çº¿ä¹åï¼éå¸¸éè¦è¿è¡ååæµè¯ï¼ä»¥è¯ä¼°ç®åçæå¡å¨ç®åå¨ä¸åQPSè¯·æ±ä¸çè´è½½æ¿åè½åï¼ä»¥æ­¤åç³»ç»åç«¯å¯é æ§åæã<strong>Locust</strong>æ¯åºäºPythonæ¥å£çå¼æºååæµè¯å·¥å·ï¼æ¬æå°ä»ç»å¦ä½ä½¿ç¨è¯¥å·¥å·å¯¹åç«¯æå¡å¨è¿è¡ååæµè¯ã <span id="more"></span> ### å®è£ å¯ä»¥ç´æ¥ä½¿ç¨<strong>pip</strong>åç®¡çå·¥å·è¿è¡å®è£ï¼å¦ä¸æç¤ºï¼ </p><figure class="highlight cmake"><table><tbody><tr><td class="code"><pre><span class="line">pip <span class="keyword">install</span> locust</span><br></pre></td></tr></tbody></table></figure> éè¦å°<strong>Locust</strong>å®è£ç®å½æ·»å å°<strong>PATH</strong>ä¸­ï¼è¿æ ·å¯ä»¥ç´æ¥å¨<strong>terminal</strong>ä¸­ä½¿ç¨<strong>locust</strong>æä»¤ã <figure class="highlight routeros"><table><tbody><tr><td class="code"><pre><span class="line">vi ~/.zshrc</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">PATH</span>=<span class="string">"/home/parallels/.local/bin:<span class="variable">$PATH</span>"</span></span><br></pre></td></tr></tbody></table></figure> å®è£å®æåï¼å¯ä»¥éè¿å¦ä¸æä»¤æ¥çå¹¶ç¡®è®¤å®è£æ¯å¦æåï¼ <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">locust -V</span></span><br></pre></td></tr></tbody></table></figure> å¦æçå°ä»¥ä¸ä¿¡æ¯ï¼åè¡¨æå®è£æåã <figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">locust</span> <span class="number">2</span>.<span class="number">31</span>.<span class="number">3</span> from /home/parallels/.local/lib/python3.<span class="number">10</span>/site-packages/locust (Python <span class="number">3</span>.<span class="number">10</span>.<span class="number">12</span>, OpenSSL <span class="number">3</span>.<span class="number">0</span>.<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure> ### åæµç¨ä¾ * HttpUser é¦ååå»ºä¸ä¸ª<strong>locustfile.py</strong>æä»¶ï¼å¹¶å®ç°ä¸ä¸ªç»§æ¿<strong>HttpUser</strong>çèªå®ä¹æµè¯ç±»ï¼<strong>Locust</strong>ç¨åºå¨åç®å½å¯å¨åä¼é»è®¤æ§è¡è¯¥æµè¯ç¨ä¾ã <figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> response</span><br><span class="line"><span class="keyword">from</span> locust <span class="keyword">import</span> HttpUser, task, between, constant</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ServoApiUser</span>(<span class="title class_ inherited__">HttpUser</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    User class that does requests to the locust web server running on localhost,</span></span><br><span class="line"><span class="string">    using the fast HTTP client</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    host = <span class="string">"https://www.yourwebsite.com"</span></span><br><span class="line">    wait_time = between(<span class="number">2</span>, <span class="number">5</span>)</span><br><span class="line">    <span class="comment"># wait_time = constant(1)</span></span><br><span class="line">    <span class="comment"># some things you can configure on FastHttpUser</span></span><br><span class="line">    <span class="comment"># connection_timeout = 60.0</span></span><br><span class="line">    <span class="comment"># insecure = True</span></span><br><span class="line">    <span class="comment"># max_redirects = 5</span></span><br><span class="line">    <span class="comment"># max_retries = 1</span></span><br><span class="line">    <span class="comment"># network_timeout = 60.0</span></span><br><span class="line">    <span class="comment"># proxy_host = my-proxy.com</span></span><br><span class="line">    <span class="comment"># proxy_port = 8080</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):</span><br><span class="line">        self.client.headers = {</span><br><span class="line">            <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">            <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">            <span class="string">'Authorization'</span>: <span class="string">'TOKEN xxxxxxxxx'</span>,</span><br><span class="line">            <span class="string">'Cookie'</span>: <span class="string">'csrftoken=xxxxxxx'</span></span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line"><span class="meta">    @task</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_card_info</span>(<span class="params">self</span>):</span><br><span class="line">        url = <span class="string">"/api/card_info/?stage=pregnancy&amp;level=user"</span></span><br><span class="line">        response = self.client.get(url=url, name=<span class="string">'get_card_info'</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"status code: {}"</span>.<span class="built_in">format</span>(response.status_code))</span><br><span class="line">        <span class="comment"># print("data: {}".format(response.json()))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># @task</span></span><br><span class="line">    <span class="comment"># def stats(self):</span></span><br><span class="line">    <span class="comment">#     self.client.get("/stats/requests")</span></span><br></pre></td></tr></tbody></table></figure> <strong>host</strong>åæ°å¯ä»¥è®¾ç½®æµè¯æå¡å¨çå°åã <strong>wait_time</strong>åæ°å¯ä»¥è®¾ç½®æ¯ä¸ªç¨æ·å®ä¾å®æä¸ä¸ªtaskä¹åï¼æ§è¡ä¸ä¸ä¸ªtaskéè¦çç­å¾æ¶é´ï¼<strong>constant</strong>ä¸ºåºå®ç­å¾æ¶é´ï¼<strong>between</strong>ä¸ºéæºç­å¾æ¶é´ãè¯¥åæ°å¯ä»¥æ¨¡æä¸åç¨æ·éæºè®¿é®çæåµã <strong>on_start</strong>å½æ°ä¼å¨æµè¯ä»»å¡å¯å¨æ¶è¿è¡ä¸æ¬¡ï¼éå¸¸ç¨æ·éç½®ä¸äºé¢ç¹ä½¿ç¨ä½æ¯æµè¯è¿ç¨ä¸­ä¿æä¸åçåæ°åéï¼ä¾å¦headerã <strong>task</strong>decoratorç¨äºå®ä¹ä¸ä¸ªå·ä½çæµè¯ä»»å¡ï¼éå¸¸ä¸ºä¸ä¸ª<strong>api</strong>æ¥å£ç<strong>POST</strong>ã<strong>GET</strong>ã<strong>DELETEã</strong>ç­requestè¯·æ±ä»»å¡ï¼ç¨äºç¨æ·èªå®ä¹æµè¯ä»»å¡ã ### åæµ å¨<strong>locustfile.py</strong>åç®å½ç<strong>terminal</strong>è¾å¥ä»¥ä¸æä»¤ï¼å³å¯å¯å¨åæµã <figure class="highlight ebnf"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">locust</span></span><br></pre></td></tr></tbody></table></figure> å¨æµè§å¨ä¸­è®¿é®<strong>http://0.0.0.0:8089</strong>å³å¯å¼å§åæµã <strong>Number of Users</strong>ç¨äºéå¶åæµçæé«ç¨æ·æ°éï¼éå<strong>wait_time</strong>å³å¯ä¼°ç®åºæé«QPS <span class="math display">\[qps = \frac{UV}{wait\_time}\]</span> <strong>Ramp Up</strong>ç¨æ·æ¯ç§éç¨æ·å¢é¿çæ°éï¼ç¨äºæµè¯è®¿é®ç¨æ·ä¸æ­å¢é¿æåµä¸ï¼æå¡å¨çæ§è½è¡¨ç°ã<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Testing Tool</category>
      </categories>
      <tags>
        <tag>Tutorials</tag>
        <tag>Testing Tool</tag>
      </tags>
  </entry>
  <entry>
    <title>Learning Note Of Vision Transformer</title>
    <url>/2024/07/05/Learning-Note-Of-Vision-Transformer/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æå°ç¸æºè¯¦è§£Vision Transformeræ¨¡åçç»æã <span id="more"></span> ### Embedding è¯¥æ¨¡åçä½ç¨æ¯å°å¾åè½¬æ¢ä¸ºåºåç¹å¾ã * è¶åæ° -- patch_sizeï¼å³å®äºå°å¾åååä¸ºpatchçå¤§å° patchçæ°éç±è¾å¥å¾åçå°ºå¯¸<span class="math inline">\(\[width, height\]\)</span>åpatchçå°ºå¯¸å±åå³å®ï¼ <span class="math display">\[patch_num=\frac{width}{patch\_size} * \frac{height}{patch\_size}\]</span> * è¶åæ° -- hidden_sizeï¼å³å®äºembeddingç¹å¾çé¿åº¦ * è¶åæ° -- dropout_rateï¼å³å®äºembeddingç¹å¾dropoutçæ¯ç ååpatchéè¿äºç»´å·ç§¯å®ç°ï¼æ¼æ¥ä¸ç±»ç®ç¼ç ä¹ååå ä¸ä½ç½®ç¼ç ã </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Embeddings</span>(nn.Module):</span><br><span class="line">    <span class="string">"""Construct the embeddings from patch, position embeddings.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config, img_size, in_channels=<span class="number">3</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(Embeddings, self).__init__()</span><br><span class="line">        self.hybrid = <span class="literal">None</span></span><br><span class="line">        img_size = _pair(img_size)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> config.patches.get(<span class="string">"grid"</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            grid_size = config.patches[<span class="string">"grid"</span>]</span><br><span class="line">            patch_size = (img_size[<span class="number">0</span>] // <span class="number">16</span> // grid_size[<span class="number">0</span>], img_size[<span class="number">1</span>] // <span class="number">16</span> // grid_size[<span class="number">1</span>])</span><br><span class="line">            n_patches = (img_size[<span class="number">0</span>] // <span class="number">16</span>) * (img_size[<span class="number">1</span>] // <span class="number">16</span>)</span><br><span class="line">            self.hybrid = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            patch_size = _pair(config.patches[<span class="string">"size"</span>])</span><br><span class="line">            n_patches = (img_size[<span class="number">0</span>] // patch_size[<span class="number">0</span>]) * (img_size[<span class="number">1</span>] // patch_size[<span class="number">1</span>])</span><br><span class="line">            self.hybrid = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.hybrid:</span><br><span class="line">            self.hybrid_model = ResNetV2(block_units=config.resnet.num_layers,</span><br><span class="line">                                         width_factor=config.resnet.width_factor)</span><br><span class="line">            in_channels = self.hybrid_model.width * <span class="number">16</span></span><br><span class="line">        self.patch_embeddings = Conv2d(in_channels=in_channels,</span><br><span class="line">                                       out_channels=config.hidden_size,</span><br><span class="line">                                       kernel_size=patch_size,</span><br><span class="line">                                       stride=patch_size)</span><br><span class="line">        self.position_embeddings = nn.Parameter(torch.zeros(<span class="number">1</span>, n_patches+<span class="number">1</span>, config.hidden_size))</span><br><span class="line">        self.cls_token = nn.Parameter(torch.zeros(<span class="number">1</span>, <span class="number">1</span>, config.hidden_size))</span><br><span class="line"></span><br><span class="line">        self.dropout = Dropout(config.transformer[<span class="string">"dropout_rate"</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># input x shape is [b,c,h,w]</span></span><br><span class="line">        B = x.shape[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># cls_token shape: [1, 1, emb_len] ==&gt; [b, 1, emb_len]</span></span><br><span class="line">        cls_tokens = self.cls_token.expand(B, -<span class="number">1</span>, -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.hybrid:</span><br><span class="line">            x = self.hybrid_model(x)</span><br><span class="line">        <span class="comment"># x shape: [b,c,h,w] ==&gt; [b, emb_len, h//patch_size, w//patch_size]</span></span><br><span class="line">        x = self.patch_embeddings(x)</span><br><span class="line">        <span class="comment"># x shape: [b, emb_len, h_p, w_p] ==&gt; [b, emb_len, h_p * w_p] ==&gt; [b, emb_len, n_patches]</span></span><br><span class="line">        x = x.flatten(<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># x shape: [b, emb_len, n_patches] ==&gt; [b, n_patches, emb_len]</span></span><br><span class="line">        x = x.transpose(-<span class="number">1</span>, -<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># x shape: [b, n_patches, emb_len] ==&gt; [b, n_patches+1, emb_len]</span></span><br><span class="line">        x = torch.cat((cls_tokens, x), dim=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># x shape: [b, n_patches+1, emb_len] ==&gt; [b, n_patches+1, emb_len], add is auto broadcasting</span></span><br><span class="line">        embeddings = x + self.position_embeddings</span><br><span class="line">        embeddings = self.dropout(embeddings)</span><br><span class="line">        <span class="keyword">return</span> embeddings</span><br></pre></td></tr></tbody></table></figure> ### Attention <strong>Self-Attention</strong>æ¨¡åæ¯<strong>Transformer</strong>çæ ¸å¿åºç¡æ¨¡åã * è¶åæ° -- num_headsï¼å¤å¤´æ³¨æåæºå¶çå¤´æ°é * è¶åæ° -- hidden_sizeï¼å³å®äºè¾å¥çembeddingç¹å¾é¿åº¦ <strong>hidden_size</strong>å<strong>num_heads</strong>å±åå³å®äºå¤å¤´æ³¨æåæºå¶æ¯ä¸å¤´çç¹å¾é¿åº¦ã <span class="math display">\[attention\_head\_size = \frac{hidden\_size}{num\_heads}\]</span> ä¸è¬éè¦ç¡®ä¿ä¸è¿°å¬å¼æ¯æ´é¤çã * è¶åæ° -- attention_dropout_rateï¼å³å®äºattention_scoreåoutputçdropoutæ¯ç <figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Attention</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config, vis</span>):</span><br><span class="line">        <span class="built_in">super</span>(Attention, self).__init__()</span><br><span class="line">        self.vis = vis</span><br><span class="line">        self.num_attention_heads = config.transformer[<span class="string">"num_heads"</span>]</span><br><span class="line">        self.attention_head_size = <span class="built_in">int</span>(config.hidden_size / self.num_attention_heads)</span><br><span class="line">        self.all_head_size = self.num_attention_heads * self.attention_head_size</span><br><span class="line"></span><br><span class="line">        self.query = Linear(config.hidden_size, self.all_head_size)</span><br><span class="line">        self.key = Linear(config.hidden_size, self.all_head_size)</span><br><span class="line">        self.value = Linear(config.hidden_size, self.all_head_size)</span><br><span class="line"></span><br><span class="line">        self.out = Linear(config.hidden_size, config.hidden_size)</span><br><span class="line">        self.attn_dropout = Dropout(config.transformer[<span class="string">"attention_dropout_rate"</span>])</span><br><span class="line">        self.proj_dropout = Dropout(config.transformer[<span class="string">"attention_dropout_rate"</span>])</span><br><span class="line"></span><br><span class="line">        self.softmax = Softmax(dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transpose_for_scores</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="comment"># x size: [b, seq, all_head_len], new_x_shape: [b, seq, num_heads, head_len]</span></span><br><span class="line">        new_x_shape = x.size()[:-<span class="number">1</span>] + (self.num_attention_heads, self.attention_head_size)</span><br><span class="line">        <span class="comment"># reshape: [b, seq, all_head_len] ==&gt; [b, seq, num_heads, head_len]</span></span><br><span class="line">        x = x.view(*new_x_shape)</span><br><span class="line">        <span class="comment"># x: [b, seq, num_heads, head_len] ==&gt; [b, hum_heads, seq, head_len]</span></span><br><span class="line">        <span class="keyword">return</span> x.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, hidden_states</span>):</span><br><span class="line">        <span class="comment"># input: [b, seq, emb_len] ==&gt; [b, seq, all_head_len]</span></span><br><span class="line">        mixed_query_layer = self.query(hidden_states)</span><br><span class="line">        mixed_key_layer = self.key(hidden_states)</span><br><span class="line">        mixed_value_layer = self.value(hidden_states)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># transpose_for_scores: ååä¸ºå¤å¤´</span></span><br><span class="line">        <span class="comment"># input: [b, seq, all_head_len] ==&gt; [b, num_heads, seq, head_len]</span></span><br><span class="line">        query_layer = self.transpose_for_scores(mixed_query_layer)</span><br><span class="line">        key_layer = self.transpose_for_scores(mixed_key_layer)</span><br><span class="line">        value_layer = self.transpose_for_scores(mixed_value_layer)</span><br><span class="line">        <span class="comment"># [b, num_heads, seq, head_len] * [b, num_heads, head_len, seq] ==&gt; [b, num_heads, seq, seq]</span></span><br><span class="line">        <span class="comment"># æ¬è´¨ä¸æ¯å¨num_headsä¸ªééä¸ï¼è®¡ç®ä¸ä¸ª[seq, seq]ç»´åº¦çåæ¹å·®ç©éµï¼è¡¨å¾åºåç¹å¾ä¹é´çç¸ä¼¼åº¦</span></span><br><span class="line">        attention_scores = torch.matmul(query_layer, key_layer.transpose(-<span class="number">1</span>, -<span class="number">2</span>))</span><br><span class="line">        <span class="comment"># scaling factor: sqrt(head_len)</span></span><br><span class="line">        attention_scores = attention_scores / math.sqrt(self.attention_head_size)</span><br><span class="line">        <span class="comment"># å¨æåç»´åº¦softmax</span></span><br><span class="line">        attention_probs = self.softmax(attention_scores)</span><br><span class="line">        <span class="comment"># è¿åå¯è§åçattention_score [b, num_heads, seq, seq]</span></span><br><span class="line">        weights = attention_probs <span class="keyword">if</span> self.vis <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">        <span class="comment"># dropout</span></span><br><span class="line">        attention_probs = self.attn_dropout(attention_probs)</span><br><span class="line">        <span class="comment"># [b, num_heads, seq, seq] * [b, num_heads, seq, head_len] ==&gt; [b, num_heads, seq, head_len]</span></span><br><span class="line">        <span class="comment"># æ¬è´¨ä¸æ¯ç¨åºåç¸ä¼¼åº¦å æå¹³ååºåç¹å¾</span></span><br><span class="line">        context_layer = torch.matmul(attention_probs, value_layer)</span><br><span class="line">        <span class="comment"># [b, num_heads, seq, head_len] ==&gt; [b, seq, num_heads, head_len]</span></span><br><span class="line">        context_layer = context_layer.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>).contiguous()</span><br><span class="line">        <span class="comment"># [b, seq, num_heads, head_len] ==&gt; [b, seq, all_head_size]</span></span><br><span class="line">        <span class="comment"># åå¹¶å¤å¤´ï¼å½¢æattentionç¹å¾</span></span><br><span class="line">        new_context_layer_shape = context_layer.size()[:-<span class="number">2</span>] + (self.all_head_size,)</span><br><span class="line">        context_layer = context_layer.view(*new_context_layer_shape)</span><br><span class="line">        <span class="comment"># çº¿æ§åæ¢</span></span><br><span class="line">        attention_output = self.out(context_layer)</span><br><span class="line">        <span class="comment"># dropout</span></span><br><span class="line">        attention_output = self.proj_dropout(attention_output)</span><br><span class="line">        <span class="keyword">return</span> attention_output, weights</span><br></pre></td></tr></tbody></table></figure> ### Mlp è¯¥æ¨¡åä¸ºä¸¤å±å¨èæ¥å±ï¼æ¬è´¨ä¸æ¯å°Attentionè¾åºçç¹å¾æ å°å°æ´é«ç»´åº¦ï¼ç¬¬ä¸å±ï¼ä¹ååæ å°åç»ä¸ç»´åº¦ï¼ç¬¬äºå±ï¼ã * è¶åæ° -- hidden_stateï¼å®ä¹äºè¾å¥è¾åºçç¹å¾ç»´åº¦ * è¶åæ° -- ### Transformer<p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Deep Learning</category>
        <category>Pytorch</category>
        <category>Vision Transformer</category>
      </categories>
      <tags>
        <tag>Deep Learning</tag>
        <tag>Tutorials</tag>
        <tag>Pytorch</tag>
        <tag>Vision Transformer</tag>
      </tags>
  </entry>
  <entry>
    <title>Vision Servo Control For Robot Manipulation</title>
    <url>/2024/10/02/Vision-Servo-Control-For-Robot-Manipulation/</url>
    <content><![CDATA[<html><head></head><body><p>è§è§ä¼ºææ¯å¤èªç±åº¦æºæ¢°èçµå·§ä½ä¸é¢åç»å¸è¿å¨æ§å¶ç®æ³ä¹ä¸ï¼å¸¸ç¨äºå¯¹ç²¾ç»ä½ä¸åèåä½ä¸ï¼ä¾å¦å©ç¨è§è§ä¼ºæå®ç°å¯¹æ¥çº¿é¢æ¿åUSBæ¥å£çææãè§è§ä¼ºæç®æ³çæ ¸å¿ææ³æ¯å©ç¨è§è§åé¦ä¿¡æ¯ï¼å¯¹æºæ¢°èæ«ç«¯æ§è¡å¨è¿è¡å®æ¶ä½ç½®åå§¿æè°æ´ï¼ä»¥å®ç°ç²¾ç¡®çè¿å¨æ§å¶ãè§è§ä¼ºæéå¸¸åä¸ºä¸¤ç±»ï¼ä¸ç±»æ¯åºäºå¾åç¹å¾çè§è§ä¼ºæï¼IBVSï¼ï¼å¦ä¸ç±»æ¯åºäºä½ç½®å§¿æçè§è§ä¼ºæï¼PBVSï¼ãæ¬æå°ä»ç»è¿ä¸¤ç§è§è§ä¼ºæç®æ³çåºæ¬åçåå®ç°æ¹æ³ã <span id="more"></span> ## èæ¯çè®º è§è§ä¼ºææ¬è´¨ä¸æ¯ä¸ä¸ªå¨åæ è½¬æ¢ï¼å¹³ç§»ãæè½¬ï¼è¿å¨ç©ºé´çéçº¿æ§ä¼åé®é¢ï¼å æ­¤ä¼ç¨å°<strong>Gauss-Newton</strong>éçº¿æ§ä¼åç®æ³å<strong>Jacobianç©éµ</strong>ã ### éçº¿æ§ä¼åé®é¢ å°æä¼åé®é¢çç®æ å½æ°è¡¨ç¤ºä¸º<span class="math inline">\(f(x)\)</span>ï¼å¶ä¸­<span class="math inline">\(f(x)\)</span>äºé¶è¿ç»­å¯å¾®ï¼é£ä¹æä¼åçé®é¢å¯ä»¥è½¬åï¼ <span class="math display">\[{argmin}_{x}f(x)\]</span> å³æ±è§£<span class="math inline">\(f(x)\)</span>çæå°å¼ä»¥åå¯¹åºç<span class="math inline">\(x^{*}\)</span>ã å¤æçéçº¿æ§æä¼åé®é¢ï¼<span class="math inline">\(f(x)\)</span>ä¸è¬ä¸ºé«ç»´éçº¿æ§æ¹ç¨ç»ï¼<span class="math inline">\(x\)</span>ä¸ºå¤ç»´åéï¼å³<span class="math inline">\(x \in \mathbb{R}^n\)</span>ï¼<span class="math inline">\(f(x) \in \mathbb{R}^m\)</span>ï¼å¶ä¸­<span class="math inline">\(m \geq n\)</span>ã</p>
<p>å¯¹äºæºæ¢°èè§è§ä¼ºæè¿å¨æ§å¶é®é¢ï¼ä¸è¿°éçº¿æ§ä¼åé®é¢å¯ä»¥è¡¨ç¤ºä¸ºï¼ <span class="math display">\[x = \begin{bmatrix}t &amp; r \end{bmatrix}\]</span> å¶ä¸­<span class="math inline">\(t\)</span>è¡¨ç¤ºåæ è½¬æ¢ç©ºé´ä¸­çå¹³ç§»åéï¼ç»´åº¦ä¸º<span class="math inline">\([3x1]\)</span>ï¼<span class="math inline">\(r\)</span>è¡¨ç¤ºåæ è½¬æ¢ç©ºé´ä¸­çæè½¬åéï¼ç»´åº¦ä¸º<span class="math inline">\([3x1]\)</span>ã <span class="math display">\[f(x) = x_{target} - x_{current}\]</span> æè <span class="math display">\[f(x) = x_{target}^{-1} x_{current}\]</span> å¬å¼éæ©åå³äºåèåæ ç³»çéæ©ï¼å·²ç»è§è§ä¼ºææ¹å¼çéæ©ï¼å·ä½è¯·è§<strong>è§è§ä¼ºæ</strong>ç« èã</p>
<h3 id="jacobianç©éµ">Jacobianç©éµ</h3>
<p>å¯¹äºå¤æçéçº¿æ§ç®æ å½æ°ï¼å¨æ°å­¦ä¸ç´æ¥æ±è§£è§£æè§£æ¯è¾å¤æï¼ä¸è¬éè¿ä¸çº§æ³°åå¬å¼å±å¼è¿è¡çº¿æ§åè¿ä¼¼ï¼å³ï¼ <span class="math display">\[f(x+\Delta x) \approx f(x) + J(x)\Delta x\]</span> å¶ä¸­ï¼<span class="math inline">\(J(x)\)</span>ä¸º<span class="math inline">\(f(x)\)</span>å¨<span class="math inline">\(x\)</span>å¤åå¯¼æ°<span class="math inline">\(\frac{\partial f(x)}{\partial x}\)</span>ï¼ç§°ä¸ºJacobianç©éµï¼<span class="math inline">\(\Delta x\)</span>ä¸ºå¢éã</p>
<p>åè®¾<span class="math inline">\(f(x) \in \mathbb{R}^m\)</span>ï¼<span class="math inline">\(x \in \mathbb{R}^n\)</span>ï¼åéå¯æ¯ç©éµè¡¨ç¤ºçæ¯<span class="math inline">\(\mathbb{R}^n\)</span>ç©ºé´å°<span class="math inline">\(\mathbb{R}^m\)</span>ç©ºé´ççº¿æ§æ å°ï¼æ¯ä¸ä¸ª<span class="math inline">\([mÃn]\)</span>çç©éµï¼æ¢å¥è¯è®²å¶éè¦æä¹å¨äºå®è¡¨ç°äºä¸ä¸ªå¤åæ°åéå½æ°çæä½³çº¿æ§é¼è¿ï¼å¬å¼ä¸ºï¼ <span class="math display">\[J(x) = \frac{\partial f(x)}{\partial x} = 
\begin{bmatrix}
\frac{\partial f(x)}{\partial x_{1}} &amp; \cdots &amp; \frac{\partial f(x)}{\partial x_{n}}
\end{bmatrix} = 
\begin{bmatrix}
\frac{\partial f_{1}(x)}{\partial x_{1}} &amp; \cdots &amp; \frac{\partial f_{1}(x)}{\partial x_{n}} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial f_{m}(x)}{\partial x_{1}} &amp; \cdots &amp; \frac{\partial f_{m}(x)}{\partial x_{n}} \\
\end{bmatrix}\]</span> ä¸çº§æ³°åå¬å¼å±å¼çº¿æ§é¼è¿å¬å¼å¯ä»¥æè¿°ä¸ºç©éµå½¢å¼ï¼ <span class="math display">\[
\begin{bmatrix}
f_{1}(x + \Delta x) \\ \vdots \\ f_{m}(x + \Delta x)
\end{bmatrix} = 
\begin{bmatrix}
f_{1}(x) \\ \vdots \\ f_{m}(x)
\end{bmatrix} + 
\begin{bmatrix}
\frac{\partial f_{1}(x)}{\partial x_{1}} &amp; \cdots &amp; \frac{\partial f_{1}(x)}{\partial x_{n}} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial f_{m}(x)}{\partial x_{1}} &amp; \cdots &amp; \frac{\partial f_{m}(x)}{\partial x_{n}} \\
\end{bmatrix}
\begin{bmatrix}
\Delta x_{1} \\ \vdots \\ \Delta x_{n}
\end{bmatrix} 
\]</span></p>
<p>å¦æ <span class="math inline">\(m = n\)</span>ï¼é£ä¹éå¯æ¯ç©éµæ¯ä¸ä¸ª<span class="math inline">\([nxn]\)</span>æ¹éµãäºæ¯æä»¬å¯ä»¥åå®çè¡åå¼ï¼ç§°ä¸ºéå¯æ¯è¡åå¼ã * åèé¾æ¥</p>
<p><a href="https://zh.wikipedia.org/zh-hans/%E9%9B%85%E5%8F%AF%E6%AF%94%E7%9F%A9%E9%98%B5">Jacobian Matrix</a></p>
<p><a href="https://blog.csdn.net/gwplovekimi/article/details/104977255">éåæ¯ç©éµåæºæ¢°èå³èåæ è½¬æ¢</a></p>
<h3 id="gauss-newtonéçº¿æ§ä¼å">Gauss-Newtonéçº¿æ§ä¼å</h3>
<p>å¯¹äºå¤§é¨åéçº¿æ§ä¼åé®é¢ï¼ä¸è¬å¾é¾ç´æ¥å¾å°è§£æè§£ãå¨æ°å­¦ä¸å¯ä»¥ä½¿ç¨<strong>Gauss-Newton</strong>ç®æ³éè¿å¾ªç¯è¿­ä»£å°æ¹å¼è·åéçº¿æ§æ¹ç¨ç»çæ°å¼è§£ï¼å¶åºæ¬ææ³æ¯ä»ç»å®çåå§å¼<span class="math inline">\(x^{0}\)</span>å¼å§ï¼æ²¿çæ¢¯åº¦ä¸éçæ¹åï¼å¾ªç¯è¿­ä»£ç´è³ç®æ å½æ°è¾¾å°æèæ¥è¿æä¼å¼ã</p>
<p>åºäºä¸çº§æ³°åå¬å¼å±å¼çº¿æ§é¼è¿æ¹ç¨ï¼å¯ä»¥å°æä¼åé®é¢è½¬æ¢ä¸ºå³äº<span class="math inline">\(\Delta x\)</span>ççº¿æ§æå°äºä¹é®é¢ï¼ <span class="math display">\[argmin_{x}\frac{1}{2} \Vert f(x) + J(x)\Delta x \Vert^2\]</span> å¶ä¸­ï¼<span class="math inline">\(J(x)\)</span>ä¸º<span class="math inline">\(f(x)\)</span>å¨<span class="math inline">\(x\)</span>å¤åå¯¼æ°<span class="math inline">\(\frac{\partial f(x)}{\partial x}\)</span>ï¼ç§°ä¸ºJacobianç©éµï¼<span class="math inline">\(\Delta x\)</span>ä¸ºå¢éã</p>
<p>æ³¨æï¼<strong>Gauss-Newton</strong>ç®æ³å¿é¡»è¦è½¬æ¢ææå°äºä¹é®é¢è¿è¡æ±è§£ã</p>
<p>æ±åä¸è¿°å¬å¼ç¸å¯¹äº<span class="math inline">\(\Delta x\)</span>çå¯¼æ°ï¼å¹¶ä»¤å¯¼æ°ç­äº0ï¼å³å¯å¾å°æä¼è§£ãæ¨å¯¼è¿ç¨å¦ä¸æç¤ºï¼</p>
<p>å·²ç¥å¬å¼ï¼<span class="math inline">\(\Vert X \Vert^2 = X^TX\)</span>ï¼å¶ä¸­<span class="math inline">\(X\)</span>ä¸ºç©éµã</p>
<p>å¯ä»¥å°æå°äºä¹å½æ°è½¬åä¸ºï¼ <span class="math display">\[
\begin{align}
\frac{1}{2} \Vert f(x) + J(x)\Delta x \Vert^2 &amp;= (f(x) + J(x)\Delta x)^T(f(x) + J(x)\Delta x) \\
&amp;= f(x)^Tf(x) + \Delta x^TJ(x)^Tf(x) + f(x)^TJ(x)\Delta x + \Delta x^TJ(x)^TJ(x)\Delta x
\end{align}
\]</span> å·²ç¥ç©éµæ±å¯¼å¬å¼<span class="math inline">\(\frac{\partial x^Ta}{\partial x}=\frac{\partial a^Tx}{\partial x} = a\)</span>ï¼<span class="math inline">\(\frac{}{}\)</span> $$</p>
<p>$$ è¿­ä»£å¬å¼ä¸ºï¼ * åèé¾æ¥</p>
<p><a href="https://zhuanlan.zhihu.com/p/482540286?utm_id=0">Bundle Adjustment éæå½±è¯¯å·®æ¨¡ååç¸åºéåæ¯å¬å¼æ¨å¯¼</a></p>
<p><a href="https://www.cnblogs.com/bingjianing/p/9093054.html">Jacobianç©éµãHessianç©éµåNewton's method</a></p>
<p><a href="https://loopvoid.github.io/2018/04/28/Jacobian%E7%9F%A9%E9%98%B5%E4%B8%8EHessian%E7%9F%A9%E9%98%B5%E4%B8%8E%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98/">Jacobianç©éµä¸Hessianç©éµä¸æå°äºä¹</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/273729929">ç©éµæ±å¯¼</a> ## è§è§ä¼ºæ ### åºäºä½ç½®çè§è§ä¼ºæï¼PBVSï¼ ### åºäºå¾åçè§è§ä¼ºæï¼IBVSï¼</p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Algorithms</category>
        <category>Robotics</category>
      </categories>
      <tags>
        <tag>Vision Servo</tag>
        <tag>PBVS</tag>
        <tag>IBVS</tag>
      </tags>
  </entry>
  <entry>
    <title>Architecture Of Transformer And PyTorch Implementation</title>
    <url>/2024/12/23/Architecture-Of-Transformer-And-PyTorch-Implementation/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æè¯¦ç»ä»ç»<a href="https://user.phil.hhu.de/~cwurm/wp-content/uploads/2020/01/7181-attention-is-all-you-need.pdf">Attention Is All You Need</a>è®ºæä¸­Transformeræ¨¡åæ¶æãåä¸ªæ¨¡åçæ°å­¦åçãè¾å¥è¾åºãåæ°è§æ¨¡ï¼ä»¥åPyTorchå®ç°ã <span id="more"></span></p>
<h2 id="æ¨¡åæ´ä½æ¶æ">æ¨¡åæ´ä½æ¶æ</h2>
<p><img alt="Transformeræ¨¡åç»æå¾" data-src="/2024/12/23/Architecture-Of-Transformer-And-PyTorch-Implementation/transformer-architecture.png"> åå§çTransformeræ¨¡åæ¯<strong>ç¼ç å¨ï¼Encoderï¼</strong>å<strong>è§£ç å¨ï¼Decoderï¼</strong>çç»å¸ç»æï¼<strong>ç¼ç å¨ï¼Encoderï¼</strong>å<strong>è§£ç å¨ï¼Decoderï¼</strong>åå«ç±<span class="math inline">\(N_e\)</span>ä¸ª<strong>Encoder Block</strong>å<span class="math inline">\(N_d\)</span>ä¸ª<strong>Decoder Block</strong>æ®å·®å å ç»æãç¼ç å¨çè¾å¥æ¯æºåºåï¼å°ºå¯¸æ¯(batch_size, src_seq_len)ï¼è¾åºæ¯Encoder Embeddingï¼å°ºå¯¸æ¯(batch_size, src_seq_len, embed_size)ï¼è§£ç å¨çè¾å¥æ¯ç®æ åºåï¼å°ºå¯¸æ¯(batch_size, tgt_seq_len)åEncoder Embeddingï¼è¾åºæ¯Decoder Embeddingï¼å°ºå¯¸æ¯(batch_size, seq_len, embed_size)ã</p>
<ul>
<li>åèè¿æ¥
<ul>
<li><a href="https://xiaosheng.blog/2022/06/28/use-pytorch-to-implement-transformer">ä½¿ç¨ Pytorch ä¸æ­¥ä¸æ­¥å®ç° Transformer Encoder</a></li>
<li><a href="https://mingchao.wang/crmAf7MS/">Transformer</a></li>
<li><a href="https://github.com/hkproj/pytorch-transformer/tree/main">pytorch-transformer</a></li>
<li><a href="https://www.youtube.com/watch?v=ISNdQcPhsts">Coding a Transformer from scratch on PyTorch, with full explanation, training and inference</a></li>
<li><a href="https://www.zhihu.com/question/347678607">å¦ä½çè§£Transformerè®ºæä¸­çpositional encodingï¼åä¸è§å½æ°æä»ä¹å³ç³»ï¼</a></li>
</ul></li>
</ul>
<h2 id="åæ¨¡åæ°å­¦åçä¸ä»£ç å®ç°">åæ¨¡åæ°å­¦åçä¸ä»£ç å®ç°</h2>
<h3 id="input-embedding"><strong>Input Embedding</strong></h3>
<p><strong>Input Embedding</strong>ï¼è¾å¥åµå¥ï¼æ¯å°ç¦»æ£Tokenåºåè½¬æ¢ä¸ºè¿ç»­åéåºåçè¿ç¨ãTransformeræ¨¡åçè¾å¥æ¯ææ¬å­ç¬¦ä¸²ï¼é¦åå©ç¨<a href="">Tokenizer</a>å°ææ¬è½¬æ¢ä¸ºTokenåºåï¼ç¶åå©ç¨<a href="">nn.Embedding</a>å°æ¯ä¸ä¸ªTokenä¿å­ä¸ºä¸ä¸ªembed_sizeç»´çEmbeddingåéã<strong>nn.Embedding</strong>æ¬è´¨æ¯ä¸ä¸ªLookup Tableï¼Keyæ¯Tokenï¼Valueæ¯Embeddingåéï¼å³é®åæ°æä¸¤ä¸ªï¼vocab_sizeè¡¨ç¤ºè¯è¡¨ä¸­çTokenæ°é, embed_sizeè¡¨ç¤ºEmbeddingåéçç»´åº¦ã</p>
<p>Input Embeddingæ¯(vocab_size, embed_size)çåæ°ç©éµï¼å¨æ¨¡åè®­ç»æ¶ä¼åæ­¥æ´æ°è¯¥åæ°ç©éµãå¦ææ³è¦å»ç»Input Embeddingçåæ°ç©éµï¼å¯ä»¥è®¾ç½®embedding.weight.requires_grad = FalseãInput Embeddingçå®ç°ä»£ç å¦ä¸ï¼</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InputEmbedding</span>(nn.Module):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Embedding layer for input tokens.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size: <span class="built_in">int</span>, embed_size: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="string">"""Initialize the embedding layer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            vocab_size: size of the vocabulary</span></span><br><span class="line"><span class="string">            embed_size: size of the embedding vector</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            None</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="built_in">super</span>(InputEmbedding, self).__init__()</span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        self.embed_size = embed_size</span><br><span class="line">        self.embedding = nn.Embedding(vocab_size, embed_size)</span><br><span class="line">        self.embedding.weight.data.uniform_(-<span class="number">0.1</span>, <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">"""Forward pass of the embedding layer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            embedded tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.embedding(x) * math.sqrt(self.embed_size)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="positional-encoding"><strong>Positional Encoding</strong></h3>
<p><strong>Positional Encoding</strong>ï¼ä½ç½®ç¼ç ï¼æ¯Transformeræ¨¡åä¸­ç¨äºç»æ¯ä¸ªTokenæ·»å ä½ç½®ä¿¡æ¯çæºå¶ãç±äºTransformeræ¨¡åä¸­æ²¡æå¾ªç¯ç¥ç»ç½ç»ï¼RNNï¼ä¸­çåºåä½ç½®é¡ºåºä¿¡æ¯ï¼å æ­¤éè¦éè¿ä½ç½®ç¼ç æ¥æä¾åºåçé¡ºåºä¿¡æ¯ï¼å¨è®ºæä¸­ä½¿ç¨äºæ­£å¼¦åä½å¼¦å½æ°æ¥ç¼ç ä½ç½®ä¿¡æ¯ã å¨ Transformer æ¨¡åä¸­ï¼<strong>Positional Encoding (ä½ç½®ç¼ç )</strong> ç¨äºä¸ºè¾å¥åºåå¼å¥ä½ç½®ä¿¡æ¯ï¼ä»¥å¼¥è¡¥èªæ³¨æåæºå¶ï¼Self-Attentionï¼ç¼ºå°åºåé¡ºåºæç¥è½åçä¸è¶³ãå®çè®¾è®¡åºäºæ­£å¼¦åä½å¼¦å½æ°çæ°å­¦åçï¼ä½¿å¾ä¸åä½ç½®çç¼ç å·æå¯è§£æçç¸å¯¹ä½ç½®ä¿¡æ¯ã</p>
<h4 id="æ°å­¦å¬å¼"><strong>æ°å­¦å¬å¼</strong></h4>
<p>ç»å®ä¸ä¸ªä½ç½® <span class="math inline">\(pos\)</span> åä¸ä¸ªç»´åº¦ <span class="math inline">\(i\)</span>ï¼åµå¥åéçç¬¬ <span class="math inline">\(i\)</span> ä¸ªç»´åº¦ï¼ï¼ä½ç½®ç¼ç çå¼ç±ä»¥ä¸å¬å¼å®ä¹ï¼ <span class="math display">\[
PE(pos, k) = 
\begin{cases} 
\sin\left(\frac{1}{10000^{\frac{2i}{embed\_size}}} * pos\right)&amp; \text{if } k = 2i \\
\cos\left(\frac{1}{10000^{\frac{2i}{embed\_size}}} * pos\right)&amp; \text{if } k = 2i+1
\end{cases}
\]</span> å¶ä¸­ * <span class="math inline">\(pos\)</span> æ¯Tokenå¨åºåä¸­çä½ç½®ï¼ä» 0 å¼å§ï¼æå¤§å¼æ¯seq_len - 1ï¼ã * <span class="math inline">\(k\)</span> æ¯Embeddingçç»´åº¦ç´¢å¼ï¼ä» 0 å¼å§ï¼æå¤§å¼æ¯embed_size - 1ï¼ã * <span class="math inline">\(embed\_size\)</span> æ¯Embeddingçç»´åº¦ï¼embed_sizeï¼ã <img alt="æ­£å¼¦ä½ç½®ç¼ç ç¤ºæå¾" data-src="/2024/12/23/Architecture-Of-Transformer-And-PyTorch-Implementation/sine_frequencies_plot.png"></p>
<h4 id="ä½ç½®ç¼ç å¯è§å"><strong>ä½ç½®ç¼ç å¯è§å</strong></h4>
<p>ä¸ååºåé¿åº¦ååµå¥ç¹å¾ç»´åº¦ä¸çä½ç½®ç¼ç å¯è§åå¦ä¸ï¼ <img alt="ä½ç½®ç¼ç å¯è§åï¼embed_size=512, seq_len=256ï¼" data-src="/2024/12/23/Architecture-Of-Transformer-And-PyTorch-Implementation/positional_encoding_heatmap.png"> <img alt="ä½ç½®ç¼ç å¯è§åï¼embed_size=256, seq_len=128ï¼" data-src="/2024/12/23/Architecture-Of-Transformer-And-PyTorch-Implementation/positional_encoding_heatmap_1.png"> <img alt="ä½ç½®ç¼ç å¯è§åï¼embed_size=128, seq_len=64ï¼" data-src="/2024/12/23/Architecture-Of-Transformer-And-PyTorch-Implementation/positional_encoding_heatmap_2.png"></p>
<ol type="1">
<li><strong>é¢çèå´ï¼</strong>
<ul>
<li>åæ¯ä¸­ç <span class="math inline">\(10000^{\frac{2i}{embed\_size}}\)</span> å©ç¨ææ°å½æ°è®¾è®¡äºä¸ä¸ªé¢çç¼©æ¾æºå¶ï¼ä½¿å¾é«ç»´åº¦å¯¹åºçé¢çæ´ä½ï¼ä½ç»´åº¦å¯¹åºçé¢çæ´é«ã</li>
<li>è¿ç§è®¾è®¡è®©æ¯ä¸ªç»´åº¦çç¼ç å¼å·æä¸åçé¢çç¹æ§ï¼ç¡®ä¿ç¼ç ä¸­åå«ä¸°å¯çä½ç½®ä¿¡æ¯ã</li>
<li>å¯¹äºæ¯ä¸ªç»´åº¦ <span class="math inline">\(i\)</span>ï¼éè¿ä¸åçé¢çç¼ç ï¼ç± <span class="math inline">\(10000^{\frac{2i}{embed\_size}}\)</span> æ§å¶ï¼çæä¸ä¸ªç¬ç¹çä¿¡å·ï¼ä½¿å¾é«ç»´ä¿¡æ¯æè·ç»ç²åº¦çç¸å¯¹ä½ç½®ä¿¡æ¯ã</li>
<li>åµå¥ç¹å¾çç»´åº¦ï¼embed_sizeï¼è¶é«ï¼ä½ç½®ç¼ç çç²åº¦è¶ç»ï¼ä¿¡æ¯ä¸°å¯åº¦è¶å¤§ã</li>
</ul></li>
<li><strong>æ­£å¼¦ä¸ä½å¼¦å½æ°ï¼</strong>
<ul>
<li>ä½¿ç¨æ­£å¼¦åä½å¼¦ä¸ºå¥æ°ç»´åº¦åå¶æ°ç»´åº¦çæä¸åçååæ¨¡å¼ã</li>
<li>æ­£å¼¦åä½å¼¦å½æ°å¯ä»¥ä¿è¯ä½ç½®ç¼ç çå¼å¨[-1, 1]èå´åã</li>
</ul></li>
</ol>
<h4 id="æ ¸å¿æ§è´¨"><strong>æ ¸å¿æ§è´¨</strong></h4>
<ol type="1">
<li><strong>ç»å¯¹ä¸ç¸å¯¹ä½ç½®ï¼</strong>
<ul>
<li>ä½ç½®ç¼ç æ¯å¯¹ææä½ç½®<span class="math inline">\((pos, k)\)</span>çç»å¯¹ç¼ç ï¼ä¸ç¼ç å¯ä¸ï¼ç±åµå¥ç¹å¾ç»´åº¦å³å®ï¼ã</li>
<li>ä½ç½®ç¼ç çè®¾è®¡ç¡®ä¿äºä»»æä¸¤ä¸ªä½ç½®ä¹é´çç¸å¯¹ä½ç½®ä¿¡æ¯å¯ä»¥è¢«ç®åè®¡ç®ï¼ <span class="math display">\[
PE(pos_1) - PE(pos_2)
\]</span> è¿ä¸æ§è´¨å¸®å©æ¨¡åç´æ¥æè·ç¸å¯¹ä½ç½®ã</li>
</ul></li>
<li><strong>åºåé¿åº¦æ å³ï¼</strong>
<ul>
<li>ç±äºæ­£å¼¦å½æ°åä½å¼¦å½æ°æ¯å¨ææ§å½æ°ï¼å¶é¢çç³»æ°ç±åµå¥ç¹å¾çç»´åº¦ï¼embed_sizeï¼ååµå¥ç¹å¾çç´¢å¼ï¼<span class="math inline">\(2i\)</span>ï¼å³å®ï¼å æ­¤ä½ç½®ç¼ç çå¼ä¸åºåé¿åº¦æ å³ï¼ä½ç½®ç¼ç å¯ä»¥ä¸ºä»»æé¿åº¦çåºåç¼ç ï¼ä¸ç¸ååºåç´¢å¼ï¼<span class="math inline">\(pos\)</span>ï¼çä½ç½®ç¼ç ç¸åã</li>
<li></li>
</ul></li>
<li><strong>æ éè®­ç»ï¼</strong>
<ul>
<li>ä½ç½®ç¼ç çå¼æ¯éè¿å¬å¼è®¡ç®çï¼æ éå­¦ä¹ åæ°ãè¿åå°äºæ¨¡ååæ°éï¼åæ¶ä¿æäºè¯å¥½çæ³åè½åã</li>
</ul></li>
</ol>
<h3 id="æ¹è¿ä¸æ¿ä»£æ¹æ³"><strong>æ¹è¿ä¸æ¿ä»£æ¹æ³</strong></h3>
<p>å°½ç®¡æ­£å¼¦-ä½å¼¦ä½ç½®ç¼ç æè¯¸å¤ä¼ç¹ï¼ä½å¨åç»­ç ç©¶ä¸­ï¼ä¹æåºäºè®¸å¤æ¿ä»£æ¹æ³ï¼</p>
<ol type="1">
<li><p><strong>å¯å­¦ä¹ çä½ç½®ç¼ç ï¼</strong><br>
éè¿å°ä½ç½®ç¼ç è§ä¸ºå¯å­¦ä¹ çåæ°ç©éµï¼ä½¿æ¨¡åå¨ç¹å®ä»»å¡ä¸æ´å·éåºæ§ã</p></li>
<li><p><strong>ç¸å¯¹ä½ç½®ç¼ç ï¼Relative Positional Encodingï¼ï¼</strong><br>
æåä½ç½®ä¹é´çç¸å¯¹å³ç³»ï¼å¦ Transformer-XL å T5 ä¸­çæ¹è¿çæ¬ã</p></li>
<li><p><strong>æè½¬ä½ç½®ç¼ç ï¼RoPE, Rotary Positional Embeddingï¼ï¼</strong><br>
å¨ Transformers ä¸­éè¿æè½¬æä½é«ææè·ç¸å¯¹ä½ç½®ä¿¡æ¯ã</p></li>
</ol>
<h4 id="ä»£ç å®ç°"><strong>ä»£ç å®ç°</strong></h4>
<p>ä¸ºäºæåè®¡ç®æçï¼å°ä½ç½®ç¼ç ä¸­çé¢çç³»æ°åå¦ä¸ä¼åï¼ <span class="math display">\[
\begin{align*}
\frac{1}{10000^{\frac{2i}{embed\_size}}}
  &amp;= \exp(\log(\frac{1}{10000^{\frac{2i}{embed\_size}}})) \\
  &amp;= \exp(\log({10000^{\frac{2i}{embed\_size}}}^{-1})) \\
  &amp;= \exp(-1 * \log({10000^{\frac{2i}{embed\_size}}})) \\
  &amp;= \exp(-1 * {\frac{2i}{embed\_size}} * \log(10000)) \\
  &amp;= \exp(-{\frac{\log(10000)}{embed\_size}} * {2i})
\end{align*}
\]</span> </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PositionalEncoding</span>(nn.Module):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Positional encoding layer for input tokens.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embed_size: <span class="built_in">int</span>, seq_len: <span class="built_in">int</span>, dropout: <span class="built_in">float</span> = <span class="number">0.1</span></span>):</span><br><span class="line">        <span class="string">"""Initialize the positional encoding layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            embed_size: size of the embedding vector</span></span><br><span class="line"><span class="string">            max_len: maximum length of the input sequence</span></span><br><span class="line"><span class="string">            dropout: dropout rate</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="built_in">super</span>(PositionalEncoding, self).__init__()</span><br><span class="line">        self.embed_size = embed_size</span><br><span class="line">        self.seq_len = seq_len</span><br><span class="line">        self.dropout = nn.Dropout(p=dropout)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create positional encoding, a matrix of shape (seq_len, embed_size)</span></span><br><span class="line">        pe = torch.zeros(seq_len, embed_size)</span><br><span class="line">        pos = torch.arange(<span class="number">0</span>, seq_len, dtype=torch.<span class="built_in">float</span>).unsqueeze(<span class="number">1</span>) <span class="comment"># (seq_len, 1), unsqueeze: add a new dimension</span></span><br><span class="line">        div_term = torch.exp(torch.arange(<span class="number">0</span>, embed_size, <span class="number">2</span>).<span class="built_in">float</span>() * (-math.log(<span class="number">10000.0</span>) / embed_size)) <span class="comment"># (embed_size/2,)</span></span><br><span class="line">        pe[:, <span class="number">0</span>::<span class="number">2</span>] = torch.sin(pos * div_term)</span><br><span class="line">        pe[:, <span class="number">1</span>::<span class="number">2</span>] = torch.cos(pos * div_term)</span><br><span class="line">        <span class="comment"># self.pe = self.pe.unsqueeze(0).transpose(0, 1) # (seq_len, 1, embed_size)</span></span><br><span class="line">        pe = pe.unsqueeze(<span class="number">0</span>) <span class="comment"># (1, seq_len, embed_size), 1 for batch size</span></span><br><span class="line">        self.register_buffer(<span class="string">'pe'</span>, pe) <span class="comment"># register buffer, so it doesn't need to be trained but can be saved</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">"""Forward pass of the positional encoding layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            positional encoded tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># x = x + self.pe[:, :x.size(1), :].requires_grad(False)</span></span><br><span class="line">        x = x + self.pe[:, :x.size(<span class="number">1</span>), :].detach()</span><br><span class="line">        <span class="keyword">return</span> self.dropout(x)</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="layer-normalization"><strong>Layer Normalization</strong></h3>
<p><strong>Layer Normalization</strong>ï¼å±å½ä¸åï¼æ¯ä¸ç§å¸¸ç¨äºæ·±åº¦å­¦ä¹ æ¨¡åçæ­£ååææ¯ï¼ç¹å«æ¯å¨åºåå»ºæ¨¡åèªç¶è¯­è¨å¤çä»»å¡ä¸­ãå®æ¨å¨éè¿æ ååæ¯ä¸å±çæ¿æ´»å¼æ¥æé«æ¨¡åçè®­ç»ç¨³å®æ§åæ¶æéåº¦ã</p>
<h4 id="åºæ¬åç"><strong>åºæ¬åç</strong></h4>
<p>å¨ç¥ç»ç½ç»ä¸­ï¼æ¯ä¸å±çæ¿æ´»å¼å¯è½å è¾å¥æ°æ®çååèå¹åº¦ä¸ä¸ï¼è¿ç§ååè¢«ç§°ä¸º<strong>åé¨åå¸æ¼ç§»ï¼Internal Covariate Shiftï¼</strong>ãLayer Normalization éè¿å¯¹æ¯ä¸å±çç¥ç»åè¾åºè¿è¡æ ååï¼åå°è¿ç§æ¼ç§»çå½±åã</p>
<p>Layer Normalization çæ ååæ¯éå¯¹<strong>å±çç»´åº¦</strong>ï¼å³ç¥ç»åçéåï¼è¿è¡çï¼èä¸æ¯å Batch Normalization éå¯¹<strong>æ ·æ¬çç»´åº¦</strong>ãå·ä½èè¨ï¼å¯¹äºæ¯ä¸ªè¾å¥æ ·æ¬ï¼Layer Normalization ä¼å¯¹å¶å½åå±çæ¿æ´»å¼è¿è¡å½ä¸åå¤çã</p>
<h4 id="æ°å­¦è¡¨è¾¾"><strong>æ°å­¦è¡¨è¾¾</strong></h4>
<p>åè®¾æå±çè¾å¥æ¯ä¸ä¸ªåé <span class="math inline">\(\mathbf{h} = [h_1, h_2, ..., h_d]\)</span>ï¼å¶ä¸­ <span class="math inline">\(d\)</span> æ¯è¯¥å±çç¥ç»åæ°ãLayer Normalization çè®¡ç®è¿ç¨å¦ä¸ï¼</p>
<ol type="1">
<li><p><strong>è®¡ç®åå¼åæ¹å·®</strong>ï¼ <span class="math display">\[
\mu = \frac{1}{d} \sum_{i=1}^d h_i, \quad \sigma^2 = \frac{1}{d} \sum_{i=1}^d (h_i - \mu)^2
\]</span></p></li>
<li><p><strong>æ åå</strong>ï¼ <span class="math display">\[
\hat{h}_i = \frac{h_i - \mu}{\sqrt{\sigma^2 + \epsilon}}
\]</span> å¶ä¸­ï¼<span class="math inline">\(\epsilon\)</span> æ¯ä¸ä¸ªå°å¸¸æ°ï¼ç¨äºé²æ­¢åæ¯ä¸ºé¶ã</p></li>
<li><p><strong>æ·»å å¯å­¦ä¹ åæ°</strong>ï¼ä»¿å°åæ¢ï¼ï¼ <span class="math display">\[
h_i^{\text{norm}} = \gamma \hat{h}_i + \beta
\]</span> å¶ä¸­ï¼<span class="math inline">\(\gamma\)</span> å <span class="math inline">\(\beta\)</span> æ¯å¯å­¦ä¹ åæ°ï¼ç¨äºæ¢å¤ç½ç»çè¡¨è¾¾è½åã</p></li>
</ol>
<h4 id="ä¸-batch-normalization-çå¯¹æ¯"><strong>ä¸ Batch Normalization çå¯¹æ¯</strong></h4>
<table>
<thead>
<tr class="header">
<th>ç¹æ§</th>
<th>Layer Normalization</th>
<th>Batch Normalization</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>å½ä¸åç»´åº¦</strong></td>
<td>æ¯å±ç¥ç»åï¼æ ·æ¬åé¨ï¼</td>
<td>æ ·æ¬ç»´åº¦ï¼æ¹æ¬¡åçæ ·æ¬é´ï¼</td>
</tr>
<tr class="even">
<td><strong>ä¾èµæ¹å¤§å°</strong></td>
<td>ä¸ä¾èµ</td>
<td>ä¾èµæ¹å¤§å°</td>
</tr>
<tr class="odd">
<td><strong>éç¨åºæ¯</strong></td>
<td>RNNãTransformer ç­åºåæ¨¡å</td>
<td>CNN ç­éè¦å¤§æ¹éè®­ç»çæ¨¡å</td>
</tr>
<tr class="even">
<td><strong>è®¡ç®å¼é</strong></td>
<td>è¾å°</td>
<td>å¯è½è¾å¤§</td>
</tr>
</tbody>
</table>
<h4 id="ä¼ç¹"><strong>ä¼ç¹</strong></h4>
<ol type="1">
<li><strong>éç¨äºå°æ¹éæåæ ·æ¬è®­ç»</strong>ï¼å ä¸ºä¸ä¾èµæ¹æ¬¡ç»è®¡ä¿¡æ¯ï¼Layer Normalization è½å¾å¥½å°éç¨äºå°æ¹éçè³åæ ·æ¬è®­ç»ã</li>
<li><strong>æ¹åæ¶ææ§</strong>ï¼éè¿åå°æ¿æ´»å¼çååï¼æ¨¡åæ´å®¹ææ¶æã</li>
<li><strong>å¨åºåä»»å¡ä¸­çä¼å¿</strong>ï¼ç¹å«éå Recurrent Neural Networkï¼RNNï¼å Transformerï¼å ä¸ºå®ä¸ä¼ç ´åæ¶é´æ­¥çä¾èµå³ç³»ã</li>
</ol>
<h4 id="åºç¨åºæ¯"><strong>åºç¨åºæ¯</strong></h4>
<ul>
<li>Transformer ä¸­å¹¿æ³ä½¿ç¨ï¼ä¾å¦ BERT å GPT æ¨¡åï¼ã</li>
<li>å¨åºåå»ºæ¨¡ï¼å¦è¯­è¨æ¨¡åãæ¶é´åºåé¢æµï¼åå°æ¹éè®­ç»ä»»å¡ä¸­æææ¾èã</li>
</ul>
<p>éè¿ Layer Normalizationï¼æ·±åº¦å­¦ä¹ æ¨¡åå¯ä»¥æ´å¿«å°å­¦ä¹ ãé¿åæ¢¯åº¦çç¸ææ¶å¤±ï¼å¹¶å¢å¼ºæ³åè½åã</p>
<h4 id="ä»£ç å®ç°-1"><strong>ä»£ç å®ç°</strong></h4>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LayerNormalization</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, eps: <span class="built_in">float</span> = <span class="number">1e-6</span></span>):</span><br><span class="line">        <span class="string">"""Initialize the layer normalization layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            embed_size: size of the embedding vector</span></span><br><span class="line"><span class="string">            eps: epsilon value for numerical stability</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="built_in">super</span>(LayerNormalization, self).__init__()</span><br><span class="line">        self.eps = eps <span class="comment"># epsilon value for numerical stability</span></span><br><span class="line">        self.gamma = nn.Parameter(torch.ones(<span class="number">1</span>)) <span class="comment"># scale parameter, learnable parameter</span></span><br><span class="line">        self.beta = nn.Parameter(torch.zeros(<span class="number">1</span>)) <span class="comment"># shift parameter, learnable parameter</span></span><br><span class="line">        <span class="comment"># self.beta = nn.Parameter(torch.ones(embed_size))</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">"""Forward pass of the layer normalization layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            normalized tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        mean = x.mean(dim=-<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        std = x.std(dim=-<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> self.gamma * (x - mean) / (std + self.eps) + self.beta</span><br></pre></td></tr></tbody></table></figure>
<h3 id="feed-forward-block"><strong>Feed Forward Block</strong></h3>
<p><strong>Feed Forward Block</strong> æ¯ Transformer æ¶æä¸­çä¸ä¸ªéè¦æ¨¡åï¼ä¸»è¦ç¨äºå°åºåç¹å¾è¿è¡éçº¿æ§åæ¢ï¼ä»¥æåæ¨¡åçè¡¨è¾¾è½åãå®ç±ä¸¤ä¸ªå¨è¿æ¥å±ç»æï¼ç¬¬ä¸ä¸ªå±ç¨äºå¤çè¾å¥åºåç¹å¾ï¼ç¬¬äºä¸ªå±ç¨äºå¤çç¬¬ä¸ä¸ªå±çè¾åºã</p>
<p>ä¸»è¦åæ°æä¸¤ä¸ªï¼ * embed_size: è¾å¥åºåç¹å¾çç»´åº¦ * hidden_size: å¨è¿æ¥å±çéèå±ç»´åº¦</p>
<h4 id="æ°å­¦åç"><strong>æ°å­¦åç</strong></h4>
<ol type="1">
<li><p><strong>ç¬¬ä¸å±å¨è¿æ¥å±</strong>ï¼å°è¾å¥åºåç¹å¾ <span class="math inline">\(X\)</span> éè¿çº¿æ§åæ¢æ å°å°ä¸ä¸ªæ´é«ç»´åº¦çç©ºé´ï¼å¾å° <span class="math inline">\(Y\)</span>ã <span class="math display">\[
Y = W_1X + b_1
\]</span> å¶ä¸­<span class="math inline">\(X \in \mathbb{R}^{seq\_len \times embed\_size}\)</span>ä¸ºè¾å¥åºåç¹å¾ï¼<span class="math inline">\(Y \in \mathbb{R}^{seq\_len \times hidden\_size}\)</span>ä¸ºç¬¬ä¸å±å¨è¿æ¥å±çè¾åºåºåç¹å¾ã<span class="math inline">\(W_1\)</span>å<span class="math inline">\(b_1\)</span>æ¯å¯å­¦ä¹ çåæ°ï¼<span class="math inline">\(W_1 \in \mathbb{R}^{hidden\_size \times embed\_size}\)</span>, <span class="math inline">\(b_1 \in \mathbb{R}^{hidden\_size}\)</span>ã</p></li>
<li><p><strong>æ¿æ´»å½æ°</strong>ï¼å¨ç¬¬ä¸å±å¨è¿æ¥å±ä¹åï¼éå¸¸ä¼æ·»å ä¸ä¸ªéçº¿æ§æ¿æ´»å½æ°ï¼å¦ ReLU æ GELUï¼ä»¥å¼å¥éçº¿æ§åæ¢ã</p></li>
<li><p><strong>Dropout</strong>ï¼ä¸ºäºé²æ­¢è¿æåï¼éå¸¸ä¼å¨ç¬¬äºå±å¨è¿æ¥å±ä¹åæ·»å  Dropoutã</p></li>
<li><p><strong>ç¬¬äºå±å¨è¿æ¥å±</strong>ï¼å°ç¬¬ä¸å±å¨è¿æ¥å±çè¾åº<span class="math inline">\(Y\)</span>éè¿çº¿æ§åæ¢æ å°ååå§ç©ºé´ï¼å¾å° <span class="math inline">\(Z\)</span>ã <span class="math display">\[
Z = W_2Y + b_2
\]</span> å¶ä¸­<span class="math inline">\(Y \in \mathbb{R}^{seq\_len \times hidden\_size}\)</span>ä¸ºç¬¬ä¸ä¸ªå¨è¿æ¥å±çè¾åºç¹å¾ï¼<span class="math inline">\(Z \in \mathbb{R}^{seq\_len \times embed\_size}\)</span>ä¸ºç¬¬äºå±å¨è¿æ¥å±çè¾åºåºåç¹å¾ã<span class="math inline">\(W_2\)</span>å<span class="math inline">\(b_2\)</span>æ¯å¯å­¦ä¹ çåæ°ï¼<span class="math inline">\(W_2 \in \mathbb{R}^{embed\_size \times hidden\_size}\)</span>, <span class="math inline">\(b_2 \in \mathbb{R}^{embed\_size}\)</span>ã</p></li>
</ol>
<h4 id="ä»£ç å®ç°-2"><strong>ä»£ç å®ç°</strong></h4>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FeedForwardBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embed_size: <span class="built_in">int</span>, hidden_size: <span class="built_in">int</span>, dropout: <span class="built_in">float</span> = <span class="number">0.1</span></span>):</span><br><span class="line">        <span class="string">"""Initialize the feedforward layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            embed_size: size of the embedding vector</span></span><br><span class="line"><span class="string">            hidden_size: size of the hidden layer</span></span><br><span class="line"><span class="string">            dropout: dropout rate</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="built_in">super</span>(FeedForwardBlock, self).__init__()</span><br><span class="line">        self.linear1 = nn.Linear(embed_size, hidden_size) <span class="comment"># (embed_size, hidden_size), linear layer</span></span><br><span class="line">        self.relu = nn.ReLU()</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.linear2 = nn.Linear(hidden_size, embed_size) <span class="comment"># (hidden_size, embed_size), linear layer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">"""Forward pass of the feedforward layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            output tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        x = self.linear1(x) <span class="comment"># (batch_size, seq_len, hidden_size)</span></span><br><span class="line">        x = self.relu(x) <span class="comment"># (batch_size, seq_len, hidden_size)</span></span><br><span class="line">        x = self.dropout(x) <span class="comment"># (batch_size, seq_len, hidden_size)</span></span><br><span class="line">        x = self.linear2(x) <span class="comment"># (batch_size, seq_len, embed_size)</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></tbody></table></figure>
<h3 id="multi-head-attention-block"><strong>Multi Head Attention Block</strong></h3>
<p><strong>Multi Head Attention Block</strong> æ¯ Transformer æ¶æä¸­çæ ¸å¿æ¨¡åï¼ä¸»è¦ç¨äºå¤çåºåç¹å¾ä¹é´çäº¤äºå³ç³»ï¼æååºåç¼ç ç¹å¾ãå®ç±ä¸ä¸ªä¸»è¦é¨åç»æï¼<strong>Query, Key, Value</strong>ï¼ä»¥åå¤å¤´æ³¨æåæºå¶ã</p>
<p>ä¸»è¦åæ°æä¸ä¸ªï¼ * embed_size: è¾å¥åºåç¹å¾çç»´åº¦ * num_heads: å¤å¤´æ³¨æåæºå¶çheadsæ°é * dropout: Dropoutå±çæ¦çï¼ç¨äºé²æ­¢è¿æåï¼å¨<strong>Query</strong>å<strong>Key</strong>ç¸ä¹ä¹åä½¿ç¨</p>
<h4 id="æ°å­¦åç-1"><strong>æ°å­¦åç</strong></h4>
<p><img alt="å¤å¤´æ³¨æåæºå¶ç½ç»æ¶æå¾" data-src="/2024/12/23/Architecture-Of-Transformer-And-PyTorch-Implementation/multi_head_self_attention.png"> å¦ä¸å¾ææ¯ï¼å¤å¤´æ³¨æåæºå¶ç±<strong>Scaled Dot-Product Attention</strong>å<strong>Multi-Head Attention</strong>ä¸¤é¨åç»æã <strong>Scaled Dot-Product Attention</strong> æ¯å¤å¤´æ³¨æåæºå¶åºç¡é¨åï¼å¶å¬å¼å¦ä¸ï¼ <span class="math display">\[
Attention(Q, K, V) = softmax(\frac{QK^T}{\sqrt{head\_size}})V
\]</span> å¶ä¸­<span class="math inline">\(Q, K, V \in \mathbb{R}^{batch\_size \times num\_heads \times seq\_len \times head\_size}\)</span>åå«è¡¨ç¤ºQuery, Key, Valueåºåç¹å¾ï¼<span class="math inline">\(head\_size\)</span>è¡¨ç¤ºåºåç¹å¾å¤´ç»´åº¦ï¼<span class="math inline">\(\sqrt{head\_size}\)</span>æ¯ä¸ºäºé²æ­¢<span class="math inline">\(QK^T\)</span>è¿å¤§å¯¼è´çæ¢¯åº¦æ¶å¤±é®é¢ã</p>
<p>å¨è®¡ç®<span class="math inline">\(\frac{QK^T}{\sqrt{head\_size}}\)</span>ä¹åï¼éè¦è¿è¡ä¸æ­¥æä½ï¼ 1. éè¦ä½¿ç¨<strong>mask</strong>å¯¹å¾å°çæ³¨æåæéè¿è¡æ©ç æä½ï¼é²æ­¢æ¨¡åå³æ³¨å°æ æçä½ç½®ã 2. ä½¿ç¨<strong>softmax</strong>å¯¹æ³¨æåæéè¿è¡å½ä¸åï¼å¾å°æç»çæ³¨æåæéç©éµã 3. å°æ³¨æåæéç©éµè¿è¡<strong>dropout</strong>æä½ï¼é²æ­¢è¿æåã</p>
<p><strong>Multi-Head Attention</strong> æ¯å¤å¤´æ³¨æåæºå¶çæç»å®ç°ï¼æ¯å¨<strong>Scaled Dot-Product Attention</strong>çåºç¡ä¸è¿è¡äºçº¿æ§æ å°ï¼ä»¥æé«å¤å¤´æ³¨æåæ¨¡åçè¡¨è¾¾è½ååæåè½åã å¯¹è¾å¥åºåç¹å¾<span class="math inline">\(Q, K, V\)</span>è¿è¡çº¿æ§æ å°ï¼å¾å°æ°çåºåç¹å¾ï¼å¬å¼å¦ä¸ï¼ <span class="math display">\[
\begin{align*}
Q^{'} &amp;= W_{q}Q + b_{q} \\
K^{'} &amp;= W_{k}K + b_{k} \\
V^{'} &amp;= W_{v}V + b_{v} 
\end{align*}
\]</span></p>
<p>å¯¹è¾åºåºåç¹å¾<span class="math inline">\(O\)</span>è¿è¡çº¿æ§æ å°ï¼å¾å°æç»çè¾åºåºåç¹å¾ï¼å¬å¼å¦ä¸ï¼ <span class="math display">\[
O^{'} = W_{o}O + b_{o} 
\]</span></p>
<h4 id="ä»£ç å®ç°-3"><strong>ä»£ç å®ç°</strong></h4>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MultiHeadAttentionBlock</span>(nn.Module):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Multi-head attention block.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embed_size: <span class="built_in">int</span>, num_heads: <span class="built_in">int</span>, dropout: <span class="built_in">float</span> = <span class="number">0.1</span></span>):</span><br><span class="line">        <span class="string">"""Initialize the multi-head attention layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            embed_size: size of the embedding vector</span></span><br><span class="line"><span class="string">            num_heads: number of attention heads</span></span><br><span class="line"><span class="string">            dropout: dropout rate</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="built_in">super</span>(MultiHeadAttentionBlock, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> embed_size % num_heads == <span class="number">0</span>, <span class="string">"Embedding size must be divisible by number of heads"</span></span><br><span class="line">        self.embed_size = embed_size</span><br><span class="line">        self.num_heads = num_heads</span><br><span class="line">        self.head_size = embed_size // num_heads</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># define the linear layers</span></span><br><span class="line">        self.query = nn.Linear(embed_size, embed_size) <span class="comment"># (embed_size, embed_size), linear layer for query seq</span></span><br><span class="line">        self.key = nn.Linear(embed_size, embed_size) <span class="comment"># (embed_size, embed_size), linear layer for key seq</span></span><br><span class="line">        self.value = nn.Linear(embed_size, embed_size) <span class="comment"># (embed_size, embed_size), linear layer for value seq</span></span><br><span class="line">        </span><br><span class="line">        self.out = nn.Linear(embed_size, embed_size) <span class="comment"># (embed_size, embed_size), linear layer for output</span></span><br><span class="line">    <span class="comment"># @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attention</span>(<span class="params">self, query, key, value, mask=<span class="literal">None</span>, dropout: nn.Dropout = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">"""Compute the attention scores and apply the softmax function. key and value are the same shape and key_seq_len = value_seq_len.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: input tensor of shape (batch_size, head_nums, query_seq_len, head_size)</span></span><br><span class="line"><span class="string">            key: input tensor of shape (batch_size, head_nums, key_seq_len, head_size)</span></span><br><span class="line"><span class="string">            value: input tensor of shape (batch_size, head_nums, value_seq_len, head_size)</span></span><br><span class="line"><span class="string">            mask: optional mask tensor of shape (batch_size, 1, 1, key_seq_len) or (batch_size, 1, query_seq_len, key_seq_len)</span></span><br><span class="line"><span class="string">            dropout: optional dropout layer</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            embedding: attention embedding tensor of shape (batch_size, num_heads, seq_len, head_size)</span></span><br><span class="line"><span class="string">            score: attention scores tensor of shape (batch_size, num_heads, seq_len, seq_len)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># compute the attention scores, QK^T/(sqrt(head_size)</span></span><br><span class="line">        <span class="comment"># (batch_size, num_heads, query_seq_len, head_size) x (batch_size, num_heads, key_seq_len, head_size) --&gt; (batch_size, num_heads, query_seq_len, key_seq_len)</span></span><br><span class="line">        score = torch.matmul(query, key.transpose(-<span class="number">2</span>, -<span class="number">1</span>)) / math.sqrt(query.size(-<span class="number">1</span>)) <span class="comment"># (batch_size, num_heads, query_seq_len, key_seq_len)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># apply mask if provided</span></span><br><span class="line">        <span class="keyword">if</span> mask <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># print(type(mask))</span></span><br><span class="line">            <span class="comment"># print(mask.shape)</span></span><br><span class="line">            score = score.masked_fill(mask == <span class="number">0</span>, -<span class="number">1e9</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># apply softmax function</span></span><br><span class="line">        score = torch.softmax(score, dim=-<span class="number">1</span>) <span class="comment"># (batch_size, num_heads, query_seq_len, key_seq_len)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># apply dropout</span></span><br><span class="line">        <span class="keyword">if</span> dropout <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            score = dropout(score)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># compute the weighted sum of values as embedding</span></span><br><span class="line">        <span class="comment"># key_seq_len = value_seq_len</span></span><br><span class="line">        <span class="comment"># (batch_size, num_heads, query_seq_len, key_seq_len) x (batch_size, num_heads, value_seq_len, head_size) --&gt; (batch_size, num_heads, query_seq_len, head_size)</span></span><br><span class="line">        embedding = torch.matmul(score, value) <span class="comment">#(batch_size, num_heads, query_seq_len, head_size)</span></span><br><span class="line">        <span class="keyword">return</span> embedding, score</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, query, key, value, mask=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">"""Forward pass of the multi-head attention layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">            key: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">            value: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">            mask: optional mask tensor of shape (batch_size, 1, 1, seq_len) or (batch_size, 1, seq_len, seq_len)</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            output tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Linear transformations for query, key, and value</span></span><br><span class="line">        query = self.query(query) <span class="comment"># (batch_size, seq_len, embed_size) --&gt; (batch_size, seq_len, embed_size)</span></span><br><span class="line">        key = self.key(key) <span class="comment"># (batch_size, seq_len, embed_size) --&gt; (batch_size, seq_len, embed_size)</span></span><br><span class="line">        value = self.value(value) <span class="comment"># (batch_size, seq_len, embed_size) --&gt; (batch_size, seq_len, embed_size)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># split the embedding into multiple heads</span></span><br><span class="line">        <span class="comment"># (batch_size, seq_len, embed_size) --&gt; (batch_size, seq_len, num_heads, head_size) --&gt; (batch_size, num_heads, seq_len, head_size)</span></span><br><span class="line">        <span class="comment"># view: reshape tensor without changing its data</span></span><br><span class="line">        <span class="comment"># transpose: swap the positions of two axes in an array</span></span><br><span class="line">        batch_size = query.shape[<span class="number">0</span>]</span><br><span class="line">        query = query.view(batch_size, -<span class="number">1</span>, self.num_heads, self.head_size).transpose(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># (batch_size, num_heads, query_seq_len, head_size)</span></span><br><span class="line">        key = key.view(batch_size, -<span class="number">1</span>, self.num_heads, self.head_size).transpose(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># (batch_size, num_heads, key_seq_len, head_size)</span></span><br><span class="line">        value = value.view(batch_size, -<span class="number">1</span>, self.num_heads, self.head_size).transpose(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># (batch_size, num_heads, value_seq_len, head_size)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># compute the attention embedding and score</span></span><br><span class="line">        embedding, self.score = self.attention(query, key, value, mask, self.dropout)</span><br><span class="line">        <span class="comment"># (batch_size, num_heads, query_seq_len, head_size) --&gt; (batch_size, query_seq_len, num_heads, head_size) --&gt; (batch_size, query_seq_len, embed_size)</span></span><br><span class="line">        embedding = embedding.transpose(<span class="number">1</span>, <span class="number">2</span>).contiguous().view(batch_size, -<span class="number">1</span>, self.embed_size) </span><br><span class="line">        <span class="keyword">return</span> self.out(embedding) <span class="comment"># (batch_size, query_seq_len, embed_size) --&gt; (batch_size, query_seq_len, embed_size)</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="residual-connection"><strong>Residual Connection</strong></h3>
<p>ä»Transformeræ¨¡åç»æå¾ä¸­å¯ä»¥çåºï¼æ¯ä¸ä¸ª<strong>Encoder Block</strong>å<strong>Decoder Block</strong>é½åå«<strong>Residual Connection</strong>æ¨¡åï¼å®å°è¾å¥ä¸ç»è¿å­å±ï¼Sublayerï¼çè¾åºç¸å ï¼ç¶åè¿è¡Layer Normalizationãè¿æ ·åçå¥½å¤æ¯ï¼å¯ä»¥é²æ­¢æ¢¯åº¦æ¶å¤±åæ¢¯åº¦çç¸ï¼åæ¶ä¹å¯ä»¥è®©æ¨¡åæ´å®¹æè®­ç»ã</p>
<h4 id="æ°å­¦åç-2">æ°å­¦åç</h4>
<p><strong>Residual Connection</strong>çæ°å­¦åçå¾ç®åï¼å°±æ¯å°è¾å¥ä¸ç»è¿Dropoutæä½ä¹åçå­å±ï¼Sublayerï¼è¾åºç¸å ï¼ç¶åè¿è¡Layer Normalizationãå·ä½å¬å¼å¦ä¸ï¼ <span class="math display">\[
\text{Residual Connection}(x, \text{Sublayer}(x)) = x + \text{Dropout}(\text{Sublayer}(\text{Layer Normalization}(x)))
\]</span></p>
<ul>
<li>Layer Normalizationï¼å¨è¿è¡å­å±æä½ä¹åé¦åè¿è¡Layer Normalizationæä½ï¼ç¨äºå¯¹è¾å¥è¿è¡å½ä¸åï¼ä½¿å¾è¾å¥å·æåå¼ä¸º0åæ åå·®ä¸º1çåå¸ï¼ä»èæé«æ¨¡åçè®­ç»ææã</li>
<li>Sublayerï¼è¡¨ç¤ºå­å±ï¼å¯ä»¥æ¯ä»»ä½ç¥ç»ç½ç»å±ï¼å¦Multi-Head AttentionãFeed Forward Networkç­</li>
<li>Dropoutï¼å­å±æä½ä¹åéè¦è¿è¡Dropoutæä½ï¼ç¨äºé²æ­¢è¿æå</li>
</ul>
<h4 id="ä»£ç å®ç°-4">ä»£ç å®ç°</h4>
<figure class="highlight julia"><table><tbody><tr><td class="code"><pre><span class="line">class ResidualConnection(nn.<span class="built_in">Module</span>):</span><br><span class="line">    def __init__(self, dropout: float = <span class="number">0.1</span>):</span><br><span class="line">        <span class="string">"""Initialize the residual connection layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            dropout: dropout rate</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        super(ResidualConnection, self).__init__()</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line">        self.norm = LayerNormalization()</span><br><span class="line"></span><br><span class="line">    def forward(self, x: torch.Tensor, sublayer: nn.<span class="built_in">Module</span>) -&gt; torch.Tensor:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Applies a sublayer followed by a residual connection and layer normalization.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">            sublayer: nn.Module representing the sublayer to be applied</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            output tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># return self.norm(x + self.dropout(sublayer(x)))</span></span><br><span class="line">        <span class="keyword">return</span> x + self.dropout(sublayer(self.norm(x)))</span><br></pre></td></tr></tbody></table></figure>
<h3 id="encoder-block"><strong>Encoder Block</strong></h3>
<p><strong>Encoder Block</strong>æ¯Transformeræ¨¡åçæ ¸å¿ç»æé¨åï¼å®ç±ä¸ä¸ªå­æ¨¡åç»æï¼<strong>Multi-Head Attention</strong>ï¼<strong>Feed Forward Block</strong>å<strong>Residual Connection</strong>ã</p>
<h4 id="æ°å­¦åç-3">æ°å­¦åç</h4>
<p><strong>Encoder Block</strong>çæ°å­¦åçå¦ä¸ï¼ <span class="math display">\[
\text{Encoder Block}(x) = 
\begin{cases} 
\text{Residual Connection}(x, \text{Multi-Head Attention}(x, x, x))&amp; step1 \\
\text{Residual Connection}(x, \text{Feed Forward Block}(x))&amp; step2
\end{cases}
\]</span></p>
<ul>
<li>Multi-Head Attentionï¼ç¨äºå¯¹è¾å¥è¿è¡èªæ³¨æåæºå¶ï¼æåè¾å¥ä¸­çå³é®ä¿¡æ¯ã</li>
<li>Feed Forward Networkï¼ç¨äºå¯¹è¾å¥è¿è¡éçº¿æ§åæ¢ï¼å¢å æ¨¡åçè¡¨è¾¾è½åã</li>
</ul>
<h4 id="ä»£ç å®ç°-5">ä»£ç å®ç°</h4>
<figure class="highlight ceylon"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> EncoderBlock(nn.Module):</span><br><span class="line">    def <span class="number">__</span>init<span class="number">__</span>(self, embed<span class="number">_</span>size: int, hidden<span class="number">_</span>size: int, num<span class="number">_</span>heads: int, dropout: float = <span class="number">0.1</span>):</span><br><span class="line">        <span class="string">"""Initialize the encoder block layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            embed_size: embedding size</span></span><br><span class="line"><span class="string">            hidden_size: hidden size</span></span><br><span class="line"><span class="string">            num_heads: number of heads</span></span><br><span class="line"><span class="string">            dropout: dropout rate</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">super</span>(EncoderBlock, self).<span class="number">__</span>init<span class="number">__</span>()</span><br><span class="line">        self.multi<span class="number">_</span>head<span class="number">_</span>attention = MultiHeadAttentionBlock(embed<span class="number">_</span>size, num<span class="number">_</span>heads, dropout)</span><br><span class="line">        self.feed<span class="number">_f</span>orward = FeedForwardBlock(embed<span class="number">_</span>size, hidden<span class="number">_</span>size, dropout)</span><br><span class="line">        self.residual<span class="number">_</span>connections = nn.ModuleList([ResidualConnection(dropout) <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> range(<span class="number">2</span>)])</span><br><span class="line"></span><br><span class="line">    def forward(self, x: torch.Tensor, src<span class="number">_m</span>ask: torch.Tensor = None) -&gt; torch.Tensor:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Applies encode block layer followed by a feed-forward layer and a residual connection.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">            src_mask: optional mask tensor of shape (batch_size, 1, 1, seq_len)</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            output tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        x = self.residual<span class="number">_</span>connections[<span class="number">0</span>](x, lambda x: self.multi<span class="number">_</span>head<span class="number">_</span>attention(x, x, x, src<span class="number">_m</span>ask))</span><br><span class="line">        x = self.residual<span class="number">_</span>connections[<span class="number">1</span>](x, self.feed<span class="number">_f</span>orward)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></tbody></table></figure>
<h3 id="encoder"><strong>Encoder</strong></h3>
<p><strong>Encoder</strong>æ¯Transformeræ¨¡åä¸­çç¼ç å¨é¨åï¼å®ç±å¤ä¸ª<strong>Encoder Block</strong>ä¸²èç»æã</p>
<h4 id="æ°å­¦åç-4">æ°å­¦åç</h4>
<p><strong>Encoder</strong>çæ°å­¦åçå¦ä¸ï¼ <span class="math display">\[
\text{Encoder}(x) = \text{Layer Normalization}(\text{Encoder Block}(\text{Encoder Block}(...(\text{Encoder Block}(x))...)))
\]</span></p>
<ul>
<li>Encoder Blockï¼ç¼ç å¨ä¸²èå¤ä¸ªEncoder Blockæååºåç¹å¾ï¼åå§Transformeræ¨¡åä¸­ä½¿ç¨äº6ä¸ªEncoder Blockã</li>
<li>Layer Normalizationï¼å¯¹Encoder Blockè¾åºè¿è¡å½ä¸åï¼ä»¥è§£å³ç¹å¾è¿ç§»é®é¢ã</li>
</ul>
<h4 id="ä»£ç å®ç°-6">ä»£ç å®ç°</h4>
<figure class="highlight ceylon"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> Encoder(nn.Module):</span><br><span class="line">    def <span class="number">__</span>init<span class="number">__</span>(self, embed<span class="number">_</span>size: int, hidden<span class="number">_</span>size: int, num<span class="number">_</span>heads: int, num<span class="number">_</span>layers: int, dropout: float = <span class="number">0.1</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initializes the encoder layer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            embed_size: embedding size</span></span><br><span class="line"><span class="string">            hidden_size: hidden size</span></span><br><span class="line"><span class="string">            num_heads: number of heads</span></span><br><span class="line"><span class="string">            num_layers: number of encoder blocks</span></span><br><span class="line"><span class="string">            dropout: dropout rate, defaults to 0.1</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">super</span>(Encoder, self).<span class="number">__</span>init<span class="number">__</span>()</span><br><span class="line">        self.encoder<span class="number">_</span>blocks = nn.ModuleList([EncoderBlock(embed<span class="number">_</span>size, hidden<span class="number">_</span>size, num<span class="number">_</span>heads, dropout) <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> range(num<span class="number">_</span>layers)])</span><br><span class="line">        self.norm = LayerNormalization()</span><br><span class="line"></span><br><span class="line">    def forward(self, x: torch.Tensor, mask: torch.Tensor = None) -&gt; torch.Tensor:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Applies encode layer followed by a stack of encoder blocks and a layer normalization.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">            mask: optional mask tensor of shape (batch_size, 1, 1, seq_len)</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            output tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> encoder<span class="number">_</span>block <span class="keyword">in</span> self.encoder<span class="number">_</span>blocks:</span><br><span class="line">            x = encoder<span class="number">_</span>block(x, mask)</span><br><span class="line">        <span class="keyword">return</span> self.norm(x)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="decoder-block"><strong>Decoder Block</strong></h3>
<p><strong>Decoder Block</strong>æ¯Transformeræ¨¡åçæ ¸å¿ç»æé¨åï¼å®ç±ä¸ä¸ªå­æ¨¡åç»æï¼<strong>Multi-Head Attention</strong>ï¼<strong>Feed Forward Block</strong>å<strong>Residual Connection</strong>ï¼å¶ä¸­<strong>Multi-Head Attention</strong>æ¨¡ååæ ¹æ®è¾å¥çåºåç¹å¾ä¸ååæä¸¤ä¸ªå®ä¾æ¨¡åï¼ä¸ä¸ªæ¯<strong>self-attention</strong>æ¨¡åï¼ä¸ä¸ªæ¯<strong>cross-attention</strong>æ¨¡åã</p>
<p><strong>self-attention</strong>æ¨¡åç¨äºå¤ç<strong>Decoder Block</strong>çè¾å¥åºåï¼å®éä¸ä¸ºæ¨¡åçè¾åºåºåï¼ï¼è<strong>cross-attention</strong>æ¨¡åç¨äºå¤ç<strong>Encoder</strong>è¾åºçåºåç¹å¾å<strong>self-attention</strong>æ¨¡åå¤çåçåºåç¹å¾ã</p>
<h4 id="æ°å­¦åç-5">æ°å­¦åç</h4>
<p><strong>Decoder Block</strong>çæ°å­¦åçå¦ä¸ï¼ <span class="math display">\[
\text{Decoder Block}(x) = 
\begin{cases}
\text{Residual Connection}(x, \text{Multi-Head Attention}(x, x, x, tgt\_mask)) &amp; step1 \\
\text{Residual Connection}(x, \text{Multi-Head Attention}(x, enc\_output, enc\_output, src\_mask)) &amp; step2 \\
\text{Residual Connection}(x, \text{Feed Forward Block}(x) &amp; step3
\end{cases}
\]</span></p>
<ul>
<li>Multi-Head Attentionï¼å¤å¤´æ³¨æåæºå¶ï¼ç¨äºæååºåç¹å¾ã</li>
<li>Feed Forward Networkï¼ç¨äºå¯¹è¾å¥è¿è¡éçº¿æ§åæ¢ï¼å¢å æ¨¡åçè¡¨è¾¾è½åã</li>
<li>Residual Connectionï¼æ®å·®è¿æ¥ï¼ç¨äºå®ç°æ¢¯åº¦ vanishing å exploding çé®é¢ã</li>
</ul>
<h4 id="ä»£ç å®ç°-7">ä»£ç å®ç°</h4>
<figure class="highlight haskell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">DecoderBlock</span>(<span class="title">nn</span>.<span class="type">Module</span>):</span></span><br><span class="line"><span class="class">    def __init__(<span class="title">self</span>, <span class="title">embed_size</span>: <span class="title">int</span>, <span class="title">hidden_size</span>: <span class="title">int</span>, <span class="title">num_heads</span>: <span class="title">int</span>, <span class="title">dropout</span>: <span class="title">float</span> = 0.1):</span></span><br><span class="line"><span class="class">        super(<span class="type">DecoderBlock</span>, <span class="title">self</span>).__init__()</span></span><br><span class="line"><span class="class">        self.self_attention_block = <span class="type">MultiHeadAttentionBlock</span>(<span class="title">embed_size</span>, <span class="title">num_heads</span>, <span class="title">dropout</span>)</span></span><br><span class="line"><span class="class">        self.cross_attention_block = <span class="type">MultiHeadAttentionBlock</span>(<span class="title">embed_size</span>, <span class="title">num_heads</span>, <span class="title">dropout</span>)</span></span><br><span class="line"><span class="class">        self.feed_forward = <span class="type">FeedForwardBlock</span>(<span class="title">embed_size</span>, <span class="title">hidden_size</span>, <span class="title">dropout</span>)</span></span><br><span class="line"><span class="class">        self.residual_connections = nn.<span class="type">ModuleList</span>([<span class="type">ResidualConnection(dropout)</span> <span class="title">for</span> <span class="title">_</span> <span class="title">in</span> <span class="title">range</span>(3)])</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    def forward(<span class="title">self</span>, <span class="title">x</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">enc_output</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">src_mask</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">tgt_mask</span>: <span class="title">torch</span>.<span class="type">Tensor</span>) -&gt; torch.<span class="type">Tensor</span>:</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        <span class="type">Applies</span> the decoder block.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="type">Args</span>:</span></span><br><span class="line"><span class="class">            x: input tensor of shape (<span class="title">batch_size</span>, <span class="title">tgt_seq_len</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">            enc_output: encoder output tensor of shape (<span class="title">batch_size</span>, <span class="title">src_seq_len</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">            src_mask: source mask tensor of shape (<span class="title">batch_size</span>, 1, 1, <span class="title">src_seq_len</span>)</span></span><br><span class="line"><span class="class">            tgt_mask: target mask tensor of shape (<span class="title">batch_size</span>, 1, <span class="title">tgt_seq_len</span>, <span class="title">tgt_seq_len</span>)</span></span><br><span class="line"><span class="class">        <span class="type">Returns</span>:</span></span><br><span class="line"><span class="class">            output tensor of shape (<span class="title">batch_size</span>, <span class="title">tgt_seq_len</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        x = self.residual_connections[0](<span class="title">x</span>, <span class="title">lambda</span> <span class="title">x</span>: <span class="title">self</span>.<span class="title">self_attention_block</span>(<span class="title">x</span>, <span class="title">x</span>, <span class="title">x</span>, <span class="title">tgt_mask</span>))</span></span><br><span class="line"><span class="class">        x = self.residual_connections[1](<span class="title">x</span>, <span class="title">lambda</span> <span class="title">x</span>: <span class="title">self</span>.<span class="title">cross_attention_block</span>(<span class="title">x</span>, <span class="title">enc_output</span>, <span class="title">enc_output</span>, <span class="title">src_mask</span>))</span></span><br><span class="line"><span class="class">        x = self.residual_connections[2](<span class="title">x</span>, <span class="title">self</span>.<span class="title">feed_forward</span>)</span></span><br><span class="line"><span class="class">        return x</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="decoder"><strong>Decoder</strong></h3>
<p><strong>Decoder</strong>æ¯Transformeræ¨¡åçè§£ç å¨é¨åï¼å®ç±å¤ä¸ª<strong>Decoder Block</strong>ä¸²èç»æã</p>
<h4 id="æ°å­¦åç-6">æ°å­¦åç</h4>
<p><strong>Decoder</strong>çæ°å­¦åçå¦ä¸ï¼ <span class="math display">\[
\text{Decoder}(x) = \text{Layer Normalization}(\text{Decoder Block}(\text{Decoder Block}(...(\text{Decoder Block}(x))...)))
\]</span></p>
<ul>
<li>Decoder Blockï¼è§£ç å¨ä¸²èå¤ä¸ªDecoder Blockæååºåç¹å¾ï¼åå§Transformeræ¨¡åä¸­ä½¿ç¨äº6ä¸ªDecoder Blockã</li>
<li>Layer Normalizationï¼å¯¹Decoder Blockè¾åºè¿è¡å½ä¸åï¼ä»¥è§£å³ç¹å¾è¿ç§»é®é¢ã</li>
</ul>
<h4 id="ä»£ç å®ç°-8">ä»£ç å®ç°</h4>
<figure class="highlight haskell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Decoder</span>(<span class="title">nn</span>.<span class="type">Module</span>):</span></span><br><span class="line"><span class="class">    def __init__(<span class="title">self</span>, <span class="title">embed_size</span>: <span class="title">int</span>, <span class="title">hidden_size</span>: <span class="title">int</span>, <span class="title">num_heads</span>: <span class="title">int</span>, <span class="title">num_layers</span>: <span class="title">int</span>, <span class="title">dropout</span>: <span class="title">float</span> = 0.1):</span></span><br><span class="line"><span class="class">        super(<span class="type">Decoder</span>, <span class="title">self</span>).__init__()</span></span><br><span class="line"><span class="class">        self.decoder_blocks = nn.<span class="type">ModuleList</span>([<span class="type">DecoderBlock</span>(<span class="title">embed_size</span>, <span class="title">hidden_size</span>, <span class="title">num_heads</span>, <span class="title">dropout</span>) for _ in range(<span class="title">num_layers</span>)])</span></span><br><span class="line"><span class="class">        self.norm = <span class="type">LayerNormalization</span>()</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    def forward(<span class="title">self</span>, <span class="title">x</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">enc_output</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">src_mask</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">tgt_mask</span>: <span class="title">torch</span>.<span class="type">Tensor</span>) -&gt; torch.<span class="type">Tensor</span>:</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        <span class="type">Applies</span> the decoder by a stack of decoder blocks and a layer normalization.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="type">Args</span>:</span></span><br><span class="line"><span class="class">            x: input tensor of shape (<span class="title">batch_size</span>, <span class="title">tgt_seq_len</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">            enc_output: encoder output tensor of shape (<span class="title">batch_size</span>, <span class="title">src_seq_len</span>, <span class="title">embed_size</span>) as the input of decoder</span></span><br><span class="line"><span class="class">            src_mask: source mask tensor of shape (<span class="title">batch_size</span>, 1, 1, <span class="title">src_seq_len</span>)</span></span><br><span class="line"><span class="class">            tgt_mask: target mask tensor of shape (<span class="title">batch_size</span>, 1, <span class="title">tgt_seq_len</span>, <span class="title">tgt_seq_len</span>)</span></span><br><span class="line"><span class="class">        <span class="type">Returns</span>:</span></span><br><span class="line"><span class="class">            output tensor of shape (<span class="title">batch_size</span>, <span class="title">tgt_seq_len</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        for decoder_block in self.decoder_blocks:</span></span><br><span class="line"><span class="class">            x = decoder_block(<span class="title">x</span>, <span class="title">enc_output</span>, <span class="title">src_mask</span>, <span class="title">tgt_mask</span>)</span></span><br><span class="line"><span class="class">        return self.norm(<span class="title">x</span>)</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="projection-layer"><strong>Projection Layer</strong></h3>
<p><strong>Projection Layer</strong>æ¯Transformeræ¨¡åçè¾åºå±ï¼ä½ç¨æ¯è§£ç å¨çè¾åºåºåç¹å¾æ å°å°è¯æ±è¡¨å¤§å°ï¼ä»¥çææç»çé¢æµç»æã åæ°æä¸¤ä¸ªï¼ * vocab_sizeï¼è¯æ±è¡¨å¤§å°ã * embed_sizeï¼åµå¥åéçç»´åº¦ã</p>
<h4 id="æ°å­¦åç-7">æ°å­¦åç</h4>
<p><strong>Projection Layer</strong>çæ°å­¦åçå¦ä¸ï¼ <span class="math display">\[
\text{Projection Layer}(x) = \text{log_softmax}(\text{Linear}(x))
\]</span></p>
<h4 id="ä»£ç å®ç°-9">ä»£ç å®ç°</h4>
<figure class="highlight julia"><table><tbody><tr><td class="code"><pre><span class="line">class ProjectionLayer(nn.<span class="built_in">Module</span>):</span><br><span class="line">    def __init__(self, embed_size: int, vocab_size: int):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initializes the projection layer.</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            embed_size: embedding size</span></span><br><span class="line"><span class="string">            vocab_size: vocabulary size</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        super(ProjectionLayer, self).__init__()</span><br><span class="line">        <span class="comment"># assert embed_size == vocab_size, "Embedding size and vocabulary size must be equal"</span></span><br><span class="line">        self.projection = nn.Linear(embed_size, vocab_size)</span><br><span class="line"></span><br><span class="line">    def forward(self, x: torch.Tensor) -&gt; torch.Tensor:</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Applies the projection layer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            x: input tensor of shape (batch_size, seq_len, embed_size)</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            output tensor of shape (batch_size, seq_len, vocab_size)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># (batch_size, seq_len, embed_size) -&gt; (batch_size, seq_len, vocab_size)</span></span><br><span class="line">        <span class="keyword">return</span> torch.log_softmax(self.projection(x), dim=-<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="transformer"><strong>Transformer</strong></h3>
<p><strong>Transformer</strong>çæ¨¡åå¯ä»¥ç±ä¸è¿°æ¨¡åç»æï¼å®ç±<strong>Input Embedding</strong>ã<strong>Positional Encoding</strong>ã<strong>Encoder</strong>ã<strong>Decoder</strong>å<strong>Projection Layer</strong>ç»æã</p>
<h4 id="ä»£ç å®ç°-10">ä»£ç å®ç°</h4>
<figure class="highlight haskell"><table><tbody><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">Transformer</span>(<span class="title">nn</span>.<span class="type">Module</span>):</span></span><br><span class="line"><span class="class">    def __init__(<span class="title">self</span>, <span class="title">src_vocab_size</span>: <span class="title">int</span>, <span class="title">tgt_vocab_size</span>: <span class="title">int</span>, <span class="title">src_seq_len</span>: <span class="title">int</span>, <span class="title">tgt_seq_len</span>: <span class="title">int</span>, <span class="title">embed_size</span>: <span class="title">int</span> = 512, <span class="title">hidden_size</span>: <span class="title">int</span> = 2048, <span class="title">num_heads</span>: <span class="title">int</span> = 8, <span class="title">num_encoder_layers</span>: <span class="title">int</span> = 6, <span class="title">num_decoder_layers</span>: <span class="title">int</span>=6, <span class="title">dropout</span>: <span class="title">float</span> = 0.1):</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        <span class="type">Initializes</span> the transformer model. <span class="type">The</span> model consists of an encoder and a decoder.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="type">Args</span>:</span></span><br><span class="line"><span class="class">            src_vocab_size: source vocabulary size</span></span><br><span class="line"><span class="class">            tgt_vocab_size: target vocabulary size</span></span><br><span class="line"><span class="class">            src_seq_len: source sequence length</span></span><br><span class="line"><span class="class">            tgt_seq_len: target sequence length</span></span><br><span class="line"><span class="class">            embed_size: embedding size</span></span><br><span class="line"><span class="class">            hidden_size: hidden size</span></span><br><span class="line"><span class="class">            num_heads: number of attention heads</span></span><br><span class="line"><span class="class">            num_encoder_layers: number of encoder layers</span></span><br><span class="line"><span class="class">            num_decoder_layers: number of decoder layers</span></span><br><span class="line"><span class="class">            dropout: dropout rate</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        super(<span class="type">Transformer</span>, <span class="title">self</span>).__init__()</span></span><br><span class="line"><span class="class">        # <span class="type">Create</span> input embedding layer</span></span><br><span class="line"><span class="class">        self.src_embedding = <span class="type">InputEmbedding</span>(<span class="title">src_vocab_size</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">        self.tgt_embedding = <span class="type">InputEmbedding</span>(<span class="title">tgt_vocab_size</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">        # <span class="type">Create</span> positional encoding layers</span></span><br><span class="line"><span class="class">        self.src_pos_encoding = <span class="type">PositionalEncoding</span>(<span class="title">embed_size</span>, <span class="title">src_seq_len</span>, <span class="title">dropout</span>)</span></span><br><span class="line"><span class="class">        self.tgt_pos_encoding = <span class="type">PositionalEncoding</span>(<span class="title">embed_size</span>, <span class="title">tgt_seq_len</span>, <span class="title">dropout</span>)</span></span><br><span class="line"><span class="class">        # <span class="type">Create</span> encoder and decoder</span></span><br><span class="line"><span class="class">        self.encoder = <span class="type">Encoder</span>(<span class="title">embed_size</span>, <span class="title">hidden_size</span>, <span class="title">num_heads</span>, <span class="title">num_encoder_layers</span>, <span class="title">dropout</span>)</span></span><br><span class="line"><span class="class">        self.decoder = <span class="type">Decoder</span>(<span class="title">embed_size</span>, <span class="title">hidden_size</span>, <span class="title">num_heads</span>, <span class="title">num_decoder_layers</span>, <span class="title">dropout</span>)</span></span><br><span class="line"><span class="class">        self.projection = <span class="type">ProjectionLayer</span>(<span class="title">embed_size</span>, <span class="title">tgt_vocab_size</span>)</span></span><br><span class="line"><span class="class">        # <span class="type">Initialize</span> the parameters</span></span><br><span class="line"><span class="class">        for p in self.parameters():</span></span><br><span class="line"><span class="class">            if p.dim() &gt; 1:</span></span><br><span class="line"><span class="class">                nn.init.xavier_uniform_(<span class="title">p</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    def forward(<span class="title">self</span>, <span class="title">src</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">tgt</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">src_mask</span>: <span class="title">torch</span>.<span class="type">Tensor</span>, <span class="title">tgt_mask</span>: <span class="title">torch</span>.<span class="type">Tensor</span>) -&gt; torch.<span class="type">Tensor</span>:</span></span><br><span class="line"><span class="class">        """<span class="type">Performs</span> a forward pass through the transformer model.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="type">Args</span>:</span></span><br><span class="line"><span class="class">            src (<span class="title">torch</span>.<span class="type">Tensor</span>): source input, shape (<span class="title">batch_size</span>, <span class="title">src_seq_len</span>)</span></span><br><span class="line"><span class="class">            tgt (<span class="title">torch</span>.<span class="type">Tensor</span>): target input, shape (<span class="title">batch_size</span>, <span class="title">tgt_seq_len</span>)</span></span><br><span class="line"><span class="class">            src_mask (<span class="title">torch</span>.<span class="type">Tensor</span>): source mask, shape (<span class="title">batch_size</span>, 1, 1, <span class="title">src_seq_len</span>)</span></span><br><span class="line"><span class="class">            tgt_mask (<span class="title">torch</span>.<span class="type">Tensor</span>): target mask, shape (<span class="title">batch_size</span>, 1, <span class="title">tgt_seq_len</span>, <span class="title">tgt_seq_len</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="type">Returns</span>:</span></span><br><span class="line"><span class="class">            torch.<span class="type">Tensor</span>: output of the transformer model, shape (<span class="title">batch_size</span>, <span class="title">tgt_seq_len</span>, <span class="title">tgt_vocab_size</span>)</span></span><br><span class="line"><span class="class">        """</span></span><br><span class="line"><span class="class">        # <span class="type">Encoder</span></span></span><br><span class="line"><span class="class">        # (<span class="title">batch_size</span>, <span class="title">src_seq_len</span>) -&gt; (<span class="title">batch_size</span>, <span class="title">src_seq_len</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">        src = self.src_embedding(<span class="title">src</span>)</span></span><br><span class="line"><span class="class">        # (<span class="title">batch_size</span>, <span class="title">src_seq_len</span>, <span class="title">embed_size</span>) -&gt; (<span class="title">batch_size</span>, <span class="title">src_seq_len</span>, <span class="title">embed_size</span>)</span></span><br><span class="line"><span class="class">        src = self.src_pos_encoding(<span class="title">src</span>)</span></span><br><span class="line"><span class="class">        enc_output = self.encoder(<span class="title">src</span>, <span class="title">src_mask</span>)</span></span><br><span class="line"><span class="class">        # <span class="type">Decoder</span></span></span><br><span class="line"><span class="class">        tgt = self.tgt_embedding(<span class="title">tgt</span>)</span></span><br><span class="line"><span class="class">        tgt = self.tgt_pos_encoding(<span class="title">tgt</span>)</span></span><br><span class="line"><span class="class">        output = self.decoder(<span class="title">tgt</span>, <span class="title">enc_output</span>, <span class="title">src_mask</span>, <span class="title">tgt_mask</span>)</span></span><br><span class="line"><span class="class">        # projection</span></span><br><span class="line"><span class="class">        return self.projection(<span class="title">output</span>)</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="è®­ç»">è®­ç»</h2>
<figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">Epoch</span> <span class="number">0</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">0</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:02&lt;00:00,  5.49it/s, loss=5.7891]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">1</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">1</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:02&lt;00:00,  5.49it/s, loss=4.3471]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">2</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">2</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:02&lt;00:00,  5.49it/s, loss=4.2629]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">3</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">3</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:02&lt;00:00,  5.50it/s, loss=5.1802]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">4</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">4</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:01&lt;00:00,  5.50it/s, loss=4.5534]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">5</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">5</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:01&lt;00:00,  5.50it/s, loss=3.7544]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">6</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">6</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:00&lt;00:00,  5.51it/s, loss=2.6769]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">7</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">7</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:59&lt;00:00,  5.51it/s, loss=3.1740]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">8</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">8</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:59&lt;00:00,  5.52it/s, loss=1.5529]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">9</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">9</span>: <span class="number">100</span>%|âââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:00&lt;00:00,  5.51it/s, loss=1.5789]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">10</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">10</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [11:00&lt;00:00,  5.51it/s, loss=2.2088]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">11</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">11</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:57&lt;00:00,  5.53it/s, loss=1.8507]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">12</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">12</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:58&lt;00:00,  5.53it/s, loss=1.6555]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">13</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">13</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:57&lt;00:00,  5.53it/s, loss=1.7904]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">14</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">14</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:57&lt;00:00,  5.53it/s, loss=2.1260]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">15</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">15</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:56&lt;00:00,  5.54it/s, loss=2.6503]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">16</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">16</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:56&lt;00:00,  5.54it/s, loss=2.1801]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">17</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">17</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:56&lt;00:00,  5.54it/s, loss=2.6803]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">18</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">18</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:56&lt;00:00,  5.54it/s, loss=2.0962]</span></span><br><span class="line"><span class="attribute">Epoch</span> <span class="number">19</span></span><br><span class="line"><span class="attribute">Processing</span> epoch  <span class="number">19</span>: <span class="number">100</span>%|ââââ| <span class="number">3638</span>/<span class="number">3638</span><span class="meta"> [10:56&lt;00:00,  5.54it/s, loss=1.8696]</span></span><br></pre></td></tr></tbody></table></figure>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Deep Learning</category>
        <category>Pytorch</category>
        <category>Transformer</category>
      </categories>
      <tags>
        <tag>Deep Learning</tag>
        <tag>Tutorials</tag>
        <tag>Pytorch</tag>
        <tag>Transformer</tag>
      </tags>
  </entry>
  <entry>
    <title>Roadmap To Learn Large Language Model Of GPT Series</title>
    <url>/2024/12/21/Roadmap-To-Learn-Large-Language-Model-Of-GPT-Series/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸»è¦æ¯OpenAIçGPTç³»åè®ºæçéè¯»ç¬è®°ã</p>
<span id="more"></span>
<h2 id="gpt-1-improving-language-understanding-by-generative-pre-training">GPT-1: Improving Language Understanding by Generative Pre-Training</h2>
<p>GPT-1çè®ºæå¨2018å¹´6æåå¸ï¼GPT-1çæ¨¡ååæ°éè¾¾å°äº1.17äº¿ï¼è®­ç»æ°æ®éè¾¾å°äº40GBï¼è®­ç»ææ¬è¾¾å°äº12.5ä¸ç¾åã ## GPT-2: Language Models are Unsupervised Multitask Learners GPT-2çè®ºæå¨2018å¹´11æåå¸ï¼GPT-2çæ¨¡ååæ°éè¾¾å°äº1.5äº¿ï¼è®­ç»æ°æ®éè¾¾å°äº1.5TBï¼è®­ç»ææ¬è¾¾å°äº100ä¸ç¾åã ## GPT-3: Language Models are Few-Shot Learners GPT-3çè®ºæå¨2021å¹´12æåå¸ï¼GPT-3çæ¨¡ååæ°éè¾¾å°äº1750äº¿ï¼è®­ç»æ°æ®éè¾¾å°äº45TBï¼è®­ç»ææ¬è¾¾å°äº1200ä¸ç¾åãGPT-3ä¸»è¦è§£å³çæ¯è¯­è¨æ¨¡åä¸­çå°æ ·æ¬å­¦ä¹ é®é¢ã ### Introduction * In-Context Learning In-Context Learning (ICL)æ¯å°é¢è®­ç»æ¨¡åçææ¬è¾å¥ä½ä¸ºä¸ç§ä»»å¡å·è±¡åçå½¢å¼ï¼å°èªç¶è¯­è¨æä»¤æèç¤ºä¾ä½ä¸ºæ¡ä»¶ï¼ç¶åé¢æµåé¢è¾åºçææ¬ã * Zero-shot VS. One-shot VS. Few-shot Learning åå³äºæ¨¡åæ¨çæ¶è¾å¥çç¤ºä¾æ°éã</p>
<p><img alt="In-Contextç¤ºä¾æ°éãæ¨¡åå¤§å°ä¸æ¨¡ååç¡®åº¦çå³ç³»" data-src="/2024/12/21/Roadmap-To-Learn-Large-Language-Model-Of-GPT-Series/In-Context-Examples-Accuracy.png"> ä»ä¸å¾å¯ä»¥çåºç»è®ºï¼ 1. æ¨¡ååæ°éè¶å¤§ï¼æ¨¡åçåç¡®åº¦è¶é«ã 2. ä¸éè¦æ¢¯åº¦è®­ç»åå¾®è°ï¼ä»ä»æä¾æ´å¤çIn-Contextç¤ºä¾ï¼ä¹è½æ¾èæåæ¨¡åçåç¡®åº¦ã 3. æ¨¡ååæ°éè¶å¤§ï¼In-Contextç¤ºä¾æ°éçè¾¹éæ¶çè¶å¤§ã * æ¨¡ååæ°é GPT-3æå¤§æ¨¡åçåæ°éæ¯175Bï¼è¿æ125Må13Bçå°æ¨¡åã ### Approach GPT-3çé¢è®­ç»æ¹æ³åæ¬æ¨¡åãæ°æ®åè®­ç»ä¸GPT-2çé¢è®­ç»æ¹æ³ä¸è´ï¼ä»ä»æ¯æåäºæ¨¡ååæ°æ®çè§æ¨¡åå¤æåº¦ï¼å¹¶å»¶é¿äºè®­ç»æ¶é´ãæä»¥ä¸åä¸ªç¹éè¦éç¹è®¨è®ºï¼ * 1. Fine-tuning Fine-tuningçå¥½å¤æ¯éè¿çç£æ ·æ¬å¾®è°ï¼å¯ä»¥æ¾èæåå¨æå®åºåä»»å¡ä¸çè¡¨ç°ã Fine-tuningçç¼ºç¹æ¯éå¯¹æ¯ä¸ä¸ªä»»å¡ï¼é½éè¦åå¤æ°éè¶³å¤å¤ççç£æ ·æ¬ï¼ä¼éä½æ¨¡åå¨çç£æ°æ®åå¸ä¹å¤çæ³åè½åã GPT-3æ´å³æ³¨ä»»å¡æ å³çæ§è½è¡¨ç°ï¼å æ­¤æ²¡æä½¿ç¨Fine-tuningã * 2. Few-Shot Learning Few-Shot Learningæçæ¯å¨æ¨¡åæ¨çé¶æ®µæä¾å ä¸ªç¤ºä¾ä½ä¸ºæ¡ä»¶ï¼å¹¶æ²¡æç¨è¿å ä¸ªç¤ºä¾åå¾®è°åè®­ç»ã ä¸ä¸ªå®æ´çç¤ºä¾åå«äºä¸ä¸æåææè¾åºã ç¤ºä¾çæ°éä»10å°100ä¸ç­ï¼åå³äºGPT-3æ¨¡åçä¸ä¸æé¿åº¦ã Few-Shot Learningçä¼ç¹æ¯æ¾èéä½äºå¯¹äºä»»å¡ç¸å³æ°æ®çä¾èµï¼å¹¶é¿åäºæ¨¡ååçªåå¸æ°æ®å½±åèæ³åæ§éä½çé®é¢ã * 3. One-Shot Learning One-Shot Learningä¸Few-Shot Learningç±»ä¼¼ï¼å¨æ¨¡åæ¨çæ¶åªæä¾ä¸ä¸ªç¤ºä¾ãå®æ´æ¥è¿äºäººç±»å®æè¯­è¨ä»»å¡çæ¹å¼ã * 4. Zero-Shot Learning Zero-Shot Learningæçæ¯å¨æ¨¡åæ¨çæ¶æ²¡ææä¾ä»»ä½ç¤ºä¾ä½ä¸ºæ¡ä»¶ï¼ä»ä»æä¾è¯­è¨æä»¤æè¿°ä»»å¡ã</p>
<figure>
<img alt="" data-src="/2024/12/21/Roadmap-To-Learn-Large-Language-Model-Of-GPT-Series/Few-One-Zero-Shot.png"><figcaption>Few-Shot VS. One-Shot VS. Zero-Shot VS. Fine-tuning</figcaption>
</figure>
<h4 id="models-and-architectures">Models and Architectures</h4>
<p>GPT-3çæ¨¡åæ¶æä¸GPT-2çæ¨¡åæ¶æç±»ä¼¼ï¼åæ¬åæ°åå§åæ¹æ³ãé¢æ­£ååæ¹æ³ãå¯éçTokenåæ¹æ³ï¼ä¸åçæ¯Transformerä¸­çAttentionæ¨¡å¼ãGPT-3çAttentionæ¨¡å¼ä¸Sparse Transformerç±»ä¼¼ã ä¸ºäºéªè¯ä¸åæ¨¡åå¤§å°å¯¹æ§è½çå½±åï¼GPT-3æ»å±è®­ç»äº3ä¸ªåæ°éçº§8ä¸ªæ¨¡åï¼å·ä½å¦ä¸å¾ææ¯ï¼ <img alt="GPT-3æ¨¡ååæ°é" data-src="/2024/12/21/Roadmap-To-Learn-Large-Language-Model-Of-GPT-Series/GPT-3-Model-Parameters.png"> GPT-3ä½¿ç¨çContext Windowä¸º2048ã <span class="math display">\[embed\_size = n_{heads} \times d_{head}\]</span> ååç¥ç»ç½ç»çåæ°éæ¯Transformerç¹å¾åéç4åï¼<span class="math inline">\(d_{ff} = 4 \times embed\_size\)</span>ã #### Training Datasets ç¨äºè®­ç»GPT-3çæ°æ®éæ¯Common Crawl,å±è®¡åå«1TBå­æ°çææ¬æ°æ®ãä¸ºäºä¿éæ°æ®éçè´¨éåäºå¦ä¸å¤çï¼ * 1. æ ¹æ®ä¸é«è´¨éè¯­æçç¸ä¼¼åº¦è¿è¡è¿æ»¤ * 2. å¨æä»¶å±é¢è¿è¡äºæ¨¡ç³å»é * 3. æ·»å äºä¸äºé«è´¨éçåèè¯­æï¼åæ¬æ©å±çæ¬çWebTextæ°æ®éãä¸¤ä¸ªäºèç½ä¹¦åºï¼Books1åBook2ï¼ä»¥åè±æççç»´åºç¾ç§ã Common Crawlæ°æ®éæ¶µçäº2016-2019å¹´çWebæ°æ®ï¼è¿æ»¤åçææ¬æ°æ®çº¦45TBï¼è¿æ»¤åæ570GBï¼çº¦æ4000äº¿ä¸ªTokensã å¨è®­ç»çæ¶åï¼è´¨éè¶é«çæ°æ®è¢«éæ ·çæ¦çè¶é«ï¼å±è®¡ç¨äº3000äº¿ä¸ªTokensè¿è¡è®­ç»ï¼Common Crawlæ°æ®éçéæ ·çå°äº1ï¼ã #### Training å¤§åæ°éçæ¨¡åéè¦ä½¿ç¨å¤§çBatch Sizeåå°çLearning Rateè¿è¡è®­ç»ã GPT-3æ¯ä½¿ç¨V100éç¾¤è¿è¡åå¸å¼è®­ç»çï¼ä½¿ç¨äºæ··åæ¨¡åå¹¶è¡åçæ¹å¼æ¥èçåå­ï¼åæ¬ç©éµç¸ä¹å¹¶è¡ååå±é´å¹¶è¡åã</p>
<h3 id="results">Results</h3>
<p>å½æ¨¡åç»æãè®­ç»æ°æ®åè®­ç»æ¹æ³é«ææ¶ï¼æ¨¡åçæ§è½è¡¨ç°ä¸ç®åææ­£ç¸å³ã #### Language Modeling, Cloze, and Completion Tasks ##### Language Modeling GPT-3ä»ä»ä½¿ç¨Zero-shot Learningè¿è¡è¯­è¨å»ºæ¨¡,å°±å¨PTBæ°æ®éä¸æ¿å°äºSOTAã ##### LAMBDA è¯¥æ°æ®éé¢æµä¸æ®µè¯æåä¸ä¸ªå­ï¼ç¨æ­¤ç¨äºæµè¯é¿èå´çè¯­è¨æ¨¡åæ§è½ã è¯¥æ°æ®éçæµè¯åæè¡¨æï¼éçæ¨¡ååæ°éçå¢å ï¼æ¨¡åçFew-Shotæ§è½ä¼æ¾èæåã <img alt="æ¨¡åæ§è½ä¸åæ°éçå³ç³»" data-src="/2024/12/21/Roadmap-To-Learn-Large-Language-Model-Of-GPT-Series/Performance-wrt-Model-Size.png"></p>
<h4 id="translation">Translation</h4>
<p>GPT-2ç±äºæ¨¡åè½åçéå¶ï¼åªå¨è±ææ°æ®éä¸è¿è¡äºè®­ç»ãGPT-3çè®­ç»æ°æ®éæ93%çè±ææ°æ®ï¼æ7%çå¶ä»è¯­è¨æ°æ®ï¼åæ¬æ³è¯­ãå¾·è¯­åç½é©¬è¯­ã</p>
<h4 id="winograd-style-tasks">Winograd-Style Tasks</h4>
<p>Winograd-Style Tasksæ¯NLPä¸­çç»å¸ä»»å¡ï¼ä¸»è¦æ¯æ ¹æ®ä¸ä¸æçè¯­ä¹å³å®ä»£è¯çå«ä¹ã</p>
<h4 id="common-sense-reasoning">Common Sense Reasoning</h4>
<ul>
<li>PhysicalQAï¼ç©çç¥è¯æ¨ç</li>
<li>ARCï¼3-9å¹´çº§ç§å­¦èè¯ä¸­çå¤éé¢</li>
<li>OpenBookQAï¼éè¯»çè§£</li>
</ul>
<h4 id="reading-comprehension">Reading Comprehension</h4>
<h4 id="superglue">SuperGLUE</h4>
<h4 id="natural-language-inference">Natural Language Inference</h4>
<h4 id="synthetic-and-qualitative-tasks">Synthetic and Qualitative Tasks</h4>
<h5 id="arithmetic">Arithmetic</h5>
<h5 id="word-scrambling-and-manipulation-tasks">Word Scrambling and Manipulation Tasks</h5>
<ul>
<li>Cycle letters in word</li>
<li>Anagrams of all but first and last character</li>
<li>Anagrams of all but first and last two characters</li>
<li>Random insertion in word</li>
<li>Reversed words ##### SAT Analogies ##### News Article Generation éè¿æµè¯äººç±»æ¯å¦è½åºåæç« æ¯äººåçè¿æ¯å¤§æ¨¡ååçæ¥è¯ä¼°å¤§æ¨¡åå¨è¿æ¹é¢çè½åã175BçGPT-3çæçæç« åä¸æµè¯ç80ä¸ªäººå¤æ­åç¡®çä»52%ï¼æå³çGPT-3çæçæç« å·²ç»åºæ¬è¾¾å°äººç±»æ°´å¹³ã ##### Correcting English Grammar</li>
</ul>
<h4 id="measuring-and-preventing-memorization-of-benchmarks">Measuring and Preventing Memorization of Benchmarks</h4>
<p>ç±äºè®­ç»æ¨¡åçæ°æ®æ¥èªäºèç½ï¼å æ­¤åºåæµè¯éä¸­çæµè¯æ°æ®å¾å¯è½ä¹åå«å¨æ¨¡åè®­ç»æ°æ®ä¸­ã</p>
<h2 id="gpt-4-gpt-4-technical-report">GPT-4: GPT-4 Technical Report</h2>
<p>GPT-4æ¯ä¸ä¸ªå¤æ¨¡æå¤§æ¨¡åï¼å¯ä»¥åæ¶å¤çææ¬åå¾åï¼å¹¶çæææ¬ã GPT-4æ¯ä½¿ç¨RLHFï¼Reinforcement Learning from Human Feedbackï¼è¿è¡å¾®è°çã GPT-4çè´¡ç®å¨äºOpenAIå¼åäºæ·±åº¦å­¦ä¹ æ åºç¡è®¾ç½®åæä¼åç®æ³ï¼è®©ä¸åå°ºåº¦çæ¨¡åè¡¨ç°åå¾å¯ä»¥é¢æµãåºäºè¿é¡¹ææ¯ï¼OpenAIå¯ä»¥ä»¥1/1000çç®åè®­ç»åè¯ä¼°æ¨¡åã GPT-4è®­ç»çæ°æ®éæ¥èª2021å¹´9æä¹åçæ°æ®ã Rule based reward models(RBRM)æ¯GPT-4æ¨¡åZero-shotçåç±»å¨ãè¿ä¸ªæ¨¡åå¨RLHFå¾®è°é¶æ®µæä¾é¢å¤çä¿¡å·ï¼æ¥æ ¡åGPT-4çè¾åºè¡ä¸ºã RBRMçè¾å¥åå«ä¸é¨åï¼1. Promptï¼2. æ¨¡åçè¾åºï¼3. äººç±»å®ä¹çè¯ä¼°è§åéåã ## æ°æ®é * <a href="https://commoncrawl.org/get-started">Common Crawl</a> - Over 250 billion pages spanning 17 years. - Free and open corpus since 2007. - Cited in over 10,000 research papers. - 3â5 billion new pages added each month. * <a href="https://paperswithcode.com/dataset/webtext">WebText</a> - WebText is an internal OpenAI corpus created by scraping web pages with emphasis on document quality. The authors scraped all outbound links from Reddit which received at least 3 karma. - WebText contains the text subset of these 45 million links. It consists of over 8 million documents for a total of 40 GB of text. - All Wikipedia documents were removed from WebText since it is a common data source for other datasets. * <a href="https://skylion007.github.io/OpenWebTextCorpus/">OpenWebText</a> - The release of a beta version of Open WebText â an open source effort to reproduce OpenAIâs WebText dataset. - <a href="https://huggingface.co/datasets/Skylion007/openwebtext">Download</a> * <a href="https://catalog.ldc.upenn.edu/LDC99T42">Penn TreeBank(PTB)</a> - The Penn Treebank (PTB) project selected 2,499 stories from a three year Wall Street Journal (WSJ) collection of 98,732 stories for syntactic annotation. These 2,499 stories have been distributed in both Treebank-2 (LDC95T7) and Treebank-3 (LDC99T42) releases of PTB. Treebank-2 includes the raw text for each story. Three "map" files are available in a compressed file (pennTB_tipster_wsj_map.tar.gz) as an additional download for users who have licensed Treebank-2 and provide the relation between the 2,499 PTB filenames and the corresponding WSJ DOCNO strings in TIPSTER. * <a href="https://zenodo.org/records/2630551#.YFJVaWT7S_w">LAMBDA</a> - We introduce LAMBADA, a dataset to evaluate the capabilities of computational models for text understanding by means of a word prediction task. LAMBADA is a collection of narrative passages sharing the characteristic that human subjects are able to guess their last word if they are exposed to the whole passage, but not if they only see the last sentence preceding the target word. To succeed on LAMBADA, computational models cannot simply rely on local context, but must be able to keep track of information in the broader discourse. We show that LAMBADA exemplifies a wide range of linguistic phenomena, and that none of several state-of-the-art language models reaches accuracy above 1% on this novel benchmark. We thus propose LAMBADA as a challenging test set, meant to encourage the development of new models capable of genuine understanding of broad context in natural language text. * <a href="https://rowanzellers.com/hellaswag/">HellaSwag</a> - Pick the best ending to the context. - We achieve this via Adversarial Filtering (AF), a data collection paradigm wherein a series of discriminators iteratively select an adversarial set of machine-generated wrong answers. * <a href="https://huggingface.co/datasets/Salesforce/wikitext">WikiText-103</a> - The WikiText language modeling dataset is a collection of over 100 million tokens extracted from the set of verified Good and Featured articles on Wikipedia. The dataset is available under the Creative Commons Attribution-ShareAlike License. - Compared to the preprocessed version of Penn Treebank (PTB), WikiText-2 is over 2 times larger and WikiText-103 is over 110 times larger. - The WikiText dataset also features a far larger vocabulary and retains the original case, punctuation and numbers - all of which are removed in PTB. As it is composed of full articles, the dataset is well suited for models that can take advantage of long term dependencies. * <a href="https://www.gutenberg.org/">Books1</a> - OpenAIç¨äºè®­ç»GPT-3çå¾ä¹¦æ°æ®éï¼å ä¸ºçæåå ï¼æ°æ®éä¸ºéå¼æºã * <a href="https://www.gutenberg.org/">Books2</a> - OpenAIç¨äºè®­ç»GPT-3çå¾ä¹¦æ°æ®éï¼å ä¸ºçæåå ï¼æ°æ®éä¸ºéå¼æºã * <a href="https://huggingface.co/datasets/LSDSem/story_cloze">StoryCloze</a> - This dataset proposes a new framework for evaluating story understanding and script learning: the 'Story Cloze Test'. This test requires a system to choose the correct ending to a four-sentence story. - It contains a new corpus of ~50k five-sentence commonsense stories, ROCStories, to enable this evaluation. - This corpus is unique in two ways: (1) it captures a rich set of causal and temporal commonsense relations between daily events, and (2) it is a high quality collection of everyday life stories that can also be used for story generation. * <a href="https://ai.google.com/research/NaturalQuestions">Natural Questions</a> - To help spur development in open-domain question answering, we have created the Natural Questions (NQ) corpus, along with a challenge website based on this data. - The NQ corpus contains questions from real users, and it requires QA systems to read and comprehend an entire Wikipedia article that may or may not contain the answer to the question. - The inclusion of real user questions, and the requirement that solutions should read an entire page to find the answer, cause NQ to be a more realistic and challenging task than prior QA datasets. * <a href="https://worksheets.codalab.org/worksheets/0xba659fe363cb46e7a505c5b6a774dc8a">WebQuestions</a> - This dataset consists of 6,642 question/answer pairs. - The questions are supposed to be answerable by Freebase, a large knowledge graph. - The questions are mostly centered around a single named entity. - The questions are popular ones asked on the web (at least in 2013). * <a href="https://nlp.cs.washington.edu/triviaqa/">TriviaQA</a> - TriviaQA is a reading comprehension dataset containing over 650K question-answer-evidence triples. - TriviaQA includes 95K question-answer pairs authored by trivia enthusiasts and independently gathered evidence documents, six per question on average, that provide high quality distant supervision for answering the questions. * <a href="https://cs.nyu.edu/~davise/papers/WinogradSchemas/WS.html">Winograd Schema Challenge</a> - The Winograd Schema Challenge (WSC) (Levesque, Davis, and Morgenstern 2011), a benchmark for commonsense reasoning, is a set of 273 expert-crafted pronoun resolution problems originally designed to be unsolvable for statistical models that rely on selectional preferences or word associations. * <a href="https://winogrande.allenai.org/">Winograde</a> - WinoGrande, a large-scale dataset of 44k problems, inspired by the original WSC design, but adjusted to improve both the scale and the hardness of the dataset. * <a href="">PhysicalQA</a> - PIQA is a dataset for commonsense reasoning, and was created to investigate the physical knowledge of existing models in NLP. * <a href="https://github.com/google-research-datasets/arc">ARC</a> * <a href="https://stanfordnlp.github.io/coqa/">CoQA</a> * <a href="https://rajpurkar.github.io/SQuAD-explorer/">QuAC</a> * <a href="https://github.com/google-research-datasets/drop">DROP</a> * <a href="">RACE</a> * <a href="https://rajpurkar.github.io/SQuAD-explorer/">SQuAD</a> * <a href="https://huggingface.co/datasets/webarchive/resolve/main/multinews.jsonl">MultiNews</a> * <a href="https://openbookqa.org/">OpenBookQA</a> * <a href="https://github.com/tliuhuan/COPA">COPA</a> * <a href="https://github.com/allenai/record">ReCoRD</a> * <a href="https://huggingface.co/datasets/webarchive/resolve/main/boolq.jsonl">BoolQ</a> * <a href="https://huggingface.co/datasets/webarchive/resolve/main/multiRC.jsonl">MultiRC</a> * <a href="https://huggingface.co/datasets/webarchive/resolve/main/rte.jsonl">RTE</a> * <a href="https://huggingface.co/datasets/webarchive/resolve/main/anli.jsonl">ANLI</a> * <a href="https://huggingface.co/datasets/webarchive/resolve/main/triviaqa.jsonl">TruthfulQA</a></p>
<h2 id="éå½">éå½</h2>
<h3 id="bleu">BLEU</h3>
<p>BLEUï¼Bilingual Evaluation Understudyï¼æ¯èªç¶è¯­è¨å¤ç (NLP) ä¸­ä¸ç§å¸¸ç¨çè¯ä¼°ææ ï¼ä¸»è¦ç¨äºè¡¡éæºå¨ç¿»è¯ç³»ç»çæææ¬çè´¨éï¼ç±IBMçç ç©¶äººåKenneyåManningå¨2002å¹´æåºãBLEUéè¿è®¡ç®çæææ¬ä¸åèææ¬ä¹é´çç¸ä¼¼åº¦æ¥è¯ä¼°ç¿»è¯çåç¡®æ§åæµçæ§ãï¼æ¥è¯ä¼°æºå¨ç¿»è¯çè´¨éã</p>
<p>ä»¥ä¸æ¯ BLEU çæ ¸å¿ææ³åå¶è®¡ç®æ¹å¼ï¼</p>
<h4 id="æ ¸å¿ææ³">æ ¸å¿ææ³</h4>
<ol type="1">
<li><p><strong>N-gram å¹é</strong>ï¼ BLEU éè¿è®¡ç®çæææ¬ä¸åèææ¬ä¹é´ç n-gram å¹éæåµæ¥è¡¡éè´¨éãn-gram æ¯ææ¬ä¸­è¿ç»­ n ä¸ªè¯çåºåï¼ä¾å¦ï¼"the cat" æ¯ä¸ä¸ª 2-gramï¼ãBLEU ä¼åå«è®¡ç® 1-gramã2-gramã3-gram ç­çå¹éæåµã</p></li>
<li><p><strong>ç²¾ç¡®ç (Precision)</strong>ï¼ BLEU è®¡ç®çæææ¬ä¸­ n-gram ä¸åèææ¬ä¸­ n-gram çå¹éæ¯ä¾ãä¾å¦ï¼å¦æçæææ¬åå« 10 ä¸ª 2-gramï¼èå¶ä¸­ 6 ä¸ªå¨åèææ¬ä¸­åºç°ï¼å 2-gram çç²¾ç¡®çä¸º 60%ã</p></li>
<li><p><strong>æ©ç½æºå¶ (Brevity Penalty)</strong>ï¼ ä¸ºäºé¿åçæç³»ç»éè¿è¿äºç®ç­çè¾åºï¼ä¾å¦ï¼éå¤åèä¸­çé«é¢è¯ï¼è·å¾é«åï¼BLEU å¼å¥äºé¿åº¦æ©ç½ãå¦æçæææ¬çé¿åº¦ææ¾ç­äºåèææ¬ï¼BLEU åæ°ä¼éä½ã</p></li>
</ol>
<h4 id="è®¡ç®æ­¥éª¤">è®¡ç®æ­¥éª¤</h4>
<ol type="1">
<li><p><strong>è®¡ç® n-gram çç²¾ç¡®ç</strong>ï¼ <span class="math display">\[
P_n = \frac{\text{çæææ¬ä¸­ä¸åèææ¬å¹éç n-gram æ°}}{\text{çæææ¬ä¸­ç n-gram æ»æ°}}
\]</span></p></li>
<li><p><strong>å ä½å¹³åç²¾ç¡®ç</strong>ï¼ å¯¹ä¸å n-gramï¼å¦ 1-gram å° 4-gramï¼çç²¾ç¡®çåå ä½å¹³åï¼ <span class="math display">\[
\text{Precision}_{\text{geometric mean}} = \left( \prod_{n=1}^{N} P_n \right)^{1/N}
\]</span></p></li>
<li><p><strong>é¿åº¦æ©ç½ (Brevity Penalty, BP)</strong>ï¼ å¦æçæææ¬é¿åº¦ ( c ) å°äºåèææ¬é¿åº¦ ( r )ï¼å¼å¥æ©ç½å å­ï¼ <span class="math display">\[
BP = 
\begin{cases} 
1 &amp; \text{å¦æ } c &gt; r \\ 
e^{1 - r/c} &amp; \text{å¦æ } c \leq r 
\end{cases}
\]</span></p></li>
<li><p><strong>æç» BLEU åæ°</strong>ï¼ å°å ä½å¹³åç²¾ç¡®çåæ©ç½å å­ç¸ç»åï¼ <span class="math display">\[
BLEU = BP \cdot \exp\left(\sum_{n=1}^{N} w_n \cdot \log P_n \right)
\]</span> å¶ä¸­ ( w_n ) æ¯ n-gram çæéï¼éå¸¸ååï¼å¦ ( w_n = 1/N )ï¼ã</p></li>
</ol>
<h4 id="ä¼ç¹ä¸å±éæ§">ä¼ç¹ä¸å±éæ§</h4>
<p><strong>ä¼ç¹</strong>ï¼ - èªå¨åè¯ä¼°ï¼è®¡ç®å¿«éã - ä¸åèç¿»è¯çç´æ¥æ¯è¾ï¼éç¨äºå¤ç§è¯­è¨ã</p>
<p><strong>å±éæ§</strong>ï¼ 1. <strong>å¿½ç¥è¯­ä¹</strong>ï¼BLEU åªå³å¿ n-gram çè¡¨é¢å¹éï¼ä¸èèè¯­ä¹ã 2. <strong>ä¾èµåèç¿»è¯</strong>ï¼å¦æåèç¿»è¯è´¨éä¸å¥½ï¼BLEU åæ°ä¹ä¼åå°å½±åã 3. <strong>é¿ææ¬éç¨æ§å¼±</strong>ï¼å¯¹æ®µè½ææ´ç¯æç« çç¿»è¯ï¼BLEU å¯è½æ æ³å¨é¢åæ è´¨éã</p>
<h3 id="bpe">BPE</h3>
<p>BPEï¼Byte Pair Encodingï¼æ¯ä¸ç§åºäºæ°æ®åç¼©ææ¯ç<strong>å­è¯åå²ç®æ³</strong>ï¼å¹¿æ³åºç¨äºèªç¶è¯­è¨å¤çï¼NLPï¼ä»»å¡ä¸­ï¼å°¤å¶æ¯ç¥ç»æºå¨ç¿»è¯åé¢è®­ç»è¯­è¨æ¨¡åãå¶æ ¸å¿ææ³æ¯éè¿éå½å°åå¹¶é¢çæé«çå­ç¬¦å¯¹æå­è¯å¯¹ï¼éæ­¥æå»ºéåºè¯­æåå¸çå­è¯ååï¼ä»èå¨åå°è¯è¡¨å¤§å°åå¤çæªç»å½è¯ï¼OOVï¼é®é¢ä¹é´åå¾å¹³è¡¡ã</p>
<h4 id="ä¸ºä»ä¹éè¦-bpe">ä¸ºä»ä¹éè¦ BPEï¼</h4>
<p>ä¼ ç»çåè¯æ¹æ³ï¼å¦æè¯åå²ææå­ç¬¦åå²ï¼å­å¨ä»¥ä¸é®é¢ï¼ 1. <strong>æè¯åå²</strong>ï¼ - è¯è¡¨ä¼éå¸¸å¤§ï¼é¾ä»¥å¤çã - å¯¹ä½é¢è¯è¡¨ç°ä¸å¥½ï¼å®¹æå¯¼è´ OOVï¼Out-Of-Vocabularyï¼æªç»å½è¯ï¼ã 2. <strong>æå­ç¬¦åå²</strong>ï¼ - è¯è¡¨å¾å°ï¼ä½ä¸ä¸æå³ç³»çå­¦ä¹ é¾åº¦å¤§ã - çæçåºåå¤ªé¿ï¼å½±åæ¨¡åæçã</p>
<p><strong>BPE</strong> éè¿å°é«é¢çå­ç¬¦åºååå¹¶ä¸ºå­è¯ååï¼æ¢éä½äºè¯è¡¨å¤§å°ï¼åè½ææå¸¸è§è¯çæ´ä½ä¿¡æ¯ï¼è§£å³äºä¸è¿°é®é¢ã</p>
<h4 id="bpe-çåºæ¬åç">BPE çåºæ¬åç</h4>
<p>BPE çæ ¸å¿ææ³æ¯<strong>åºäºé¢ççåå¹¶</strong>ï¼ä»åå§å­ç¬¦å¼å§ï¼å°åºç°é¢çæé«çå­ç¬¦å¯¹éæ­¥åå¹¶ä¸ºæ°çå­è¯ååï¼ç´å°è¾¾å°é¢å®ä¹çåè¯ååæ°éæå¶ä»åæ­¢æ¡ä»¶ã</p>
<h5 id="ç®æ³æ­¥éª¤">ç®æ³æ­¥éª¤ï¼</h5>
<ol type="1">
<li><strong>åå§å</strong>ï¼
<ul>
<li>å°è®­ç»è¯­æä¸­çæ¯ä¸ªåè¯åè§£ä¸ºå­ç¬¦åºåï¼å¹¶å¨æ¯ä¸ªåè¯çæ«å°¾æ·»å ç¹æ®æ è®°ï¼å¦ <code>â</code> è¡¨ç¤ºè¯çå¼å¤´ï¼ã</li>
<li>ä¾å¦ï¼<code>hello world</code> â <code>h e l l o â w o r l d</code></li>
</ul></li>
<li><strong>ç»è®¡å­ç¬¦å¯¹çé¢ç</strong>ï¼
<ul>
<li>è®¡ç®è¯­æä¸­æ¯å¯¹ç¸é»å­ç¬¦çé¢çã</li>
<li>ä¾å¦ï¼<code>h e l l o</code> ä¸­ï¼<code>he</code>ã<code>el</code>ã<code>ll</code>ã<code>lo</code> æ¯å­ç¬¦å¯¹ï¼ç»è®¡å¶åºç°æ¬¡æ°ã</li>
</ul></li>
<li><strong>åå¹¶é¢çæé«çå­ç¬¦å¯¹</strong>ï¼
<ul>
<li>æ¾å°é¢çæé«çå­ç¬¦å¯¹ï¼å°å¶åå¹¶ä¸ºæ°çå­è¯ååã</li>
<li>ä¾å¦ï¼å¦æ <code>ll</code> æ¯é¢çæé«çå¯¹ï¼ååå¹¶ä¸º <code>ll</code>ï¼æ´æ°åºåä¸ºï¼<code>h e ll o</code>.</li>
</ul></li>
<li><strong>éå¤æ­¥éª¤ 2 å 3</strong>ï¼
<ul>
<li>æ¯æ¬¡åå¹¶åéæ°ç»è®¡é¢çï¼ç´å°è¾¾å°é¢å®ä¹çå­è¯ååæ°éã</li>
</ul></li>
<li><strong>çæå­è¯è¯è¡¨</strong>ï¼
<ul>
<li>è®°å½ææçæçå­è¯ååï¼ä½ä¸ºæç»çåè¯è¯è¡¨ã</li>
</ul></li>
</ol>
<h5 id="ç®æ³å®ç°">ç®æ³å®ç°ï¼</h5>
<p>BPE çæ ¸å¿å¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸ä¼ªä»£ç ï¼</p>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="code"><pre><span class="line">è¾å¥ï¼è¯­æ Dï¼ç®æ å­è¯è¡¨å¤§å° V</span><br><span class="line">åå§åï¼å° D åè§£ä¸ºå­ç¬¦åºå S</span><br><span class="line"><span class="keyword">while</span> |S| &lt; V:</span><br><span class="line">    ç»è®¡ S ä¸­ææç¸é»å­ç¬¦å¯¹çé¢ç</span><br><span class="line">    æ¾å°é¢çæé«çå­ç¬¦å¯¹ <span class="keyword">a</span>, b</span><br><span class="line">    å° <span class="keyword">a</span>, b åå¹¶ä¸ºæ°çå­è¯åå ab</span><br><span class="line">    æ´æ° S ä¸­çææåºç°</span><br><span class="line">è¾åºï¼æç»çå­è¯è¯è¡¨ S</span><br></pre></td></tr></tbody></table></figure>
<h5 id="ç¤ºä¾">ç¤ºä¾</h5>
<p>åè®¾æä»¬å¯¹ä»¥ä¸åè¯åºç¨ BPEï¼<code>low</code>, <code>lowest</code>, <code>new</code>, <code>newer</code>.</p>
<ol type="1">
<li><p><strong>åå§ç¶æ</strong>ï¼ </p><figure class="highlight excel"><table><tbody><tr><td class="code"><pre><span class="line">l o w</span><br><span class="line">l o w e s <span class="built_in">t</span></span><br><span class="line"><span class="built_in">n</span> e w</span><br><span class="line"><span class="built_in">n</span> e w e r</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p><strong>ç»è®¡å­ç¬¦å¯¹é¢ç</strong>ï¼ </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">l</span> o: <span class="number">2</span>, o w: <span class="number">2</span>, w e: <span class="number">2</span>, e s: <span class="number">1</span>, s t: <span class="number">1</span>, n e: <span class="number">2</span>, e w: <span class="number">2</span>, w e: <span class="number">2</span></span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p><strong>åå¹¶é¢çæé«çå¯¹</strong>ï¼ åè®¾ <code>o w</code> é¢çæé«ï¼åå¹¶ä¸º <code>ow</code>ï¼ </p><figure class="highlight excel"><table><tbody><tr><td class="code"><pre><span class="line">l ow</span><br><span class="line">l ow e s <span class="built_in">t</span></span><br><span class="line"><span class="built_in">n</span> e w</span><br><span class="line"><span class="built_in">n</span> e w e r</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p><strong>éå¤ä»¥ä¸æ­¥éª¤</strong>ï¼</p>
<ul>
<li>åå¹¶åéæ°ç»è®¡é¢çå¹¶åå¹¶ï¼ç´å°è¾¾å°é¢å®ä¹çå­è¯ååæ°éã</li>
</ul></li>
</ol>
<h4 id="bpe-å¨-nlp-ä¸­çåºç¨">BPE å¨ NLP ä¸­çåºç¨</h4>
<ol type="1">
<li><strong>æºå¨ç¿»è¯</strong>ï¼å¦ Transformer ä¸­ï¼BPE è¢«ç¨ä½æ ååè¯æ¹æ³ï¼ä»¥åå° OOV ç°è±¡å¹¶æé«æ¨¡åçæ³åè½åã</li>
<li><strong>é¢è®­ç»æ¨¡å</strong>ï¼å¦ GPT å BERTï¼BPE ç¨äºæå»ºå­è¯è¯è¡¨ï¼å¼é¡¾è¯è¡¨å¤§å°ä¸è¦ççã</li>
<li><strong>å¤è¯­è¨ä»»å¡</strong>ï¼BPE å¨å¤è¯­è¨æ¨¡åä¸­å°¤å¶ææï¼è½å¤çæè¯­è¨æ å³çç»ä¸è¯è¡¨ã</li>
</ol>
<h4 id="ä¼ç¹ä¸å±éæ§-1">ä¼ç¹ä¸å±éæ§</h4>
<p><strong>ä¼ç¹</strong>ï¼ 1. <strong>è¯è¡¨å¤§å°çµæ´»</strong>ï¼éè¿éå¶è¯è¡¨å¤§å° ( V )ï¼å¯ä»¥å¨æçä¸è¡¨è¾¾è½åä¹é´åå¾å¹³è¡¡ã 2. <strong>å¤çæªç»å½è¯ï¼OOVï¼</strong>ï¼å°ç½è§è¯åè§£ä¸ºå­è¯ååï¼ä»èåå° OOV çåçã 3. <strong>è¯­è¨æ å³æ§</strong>ï¼BPE æ¯åºäºé¢ççç»è®¡æ¹æ³ï¼ä¸ä¾èµå·ä½è¯­è¨è§åã</p>
<p><strong>å±éæ§</strong>ï¼ 1. <strong>åºå®è¯è¡¨</strong>ï¼è®­ç»å¥½çå­è¯è¯è¡¨å¯¹æ°é¢åçéåºæ§æéã 2. <strong>ä¸ä¸æç¬ç«æ§</strong>ï¼åå¹¶è§åæ¯åºäºå¨å±é¢ççï¼èä¸èèä¸ä¸æã 3. <strong>çææç</strong>ï¼å¨è§£ç è¿ç¨ä¸­ï¼å¯è½å¯¼è´çæåºåè¾é¿ï¼å½±åæ¨¡åæ¨æ­éåº¦ã</p>
<h4 id="æ»ç»">æ»ç»</h4>
<p>BPE æ¯ä¸ç§ç®åèé«æçåè¯ç®æ³ï¼è½å¤çæå¼å·è¯è¯­ä¿¡æ¯åçµæ´»æ§çå­è¯ååï¼å¨ NLP ä¸­å¹¿æ³åºç¨ï¼æ¯ç°ä»£è¯­è¨æ¨¡åçå³é®é¢å¤çæ­¥éª¤ä¹ä¸ã</p>
<h3 id="superglueåºåæµè¯é">SuperGLUEåºåæµè¯é</h3>
<p>SuperGLUEï¼<strong>A Stickier Benchmark for General-Purpose Language Understanding Systems</strong>ï¼æ¯èªç¶è¯­è¨å¤çï¼NLPï¼é¢åä¸­çä¸ä¸ªåºåæµè¯éï¼ç¨äºè¯ä¼°æ¨¡åå¨å¹¿æ³çè¯­è¨çè§£ä»»å¡ä¸çè½åãå®æ¯å¯¹ GLUEï¼General Language Understanding Evaluationï¼çæ¹è¿çï¼ä¸é¨è®¾è®¡æ¥ææåºäºé¢è®­ç»è¯­è¨æ¨¡åï¼å¦ BERTãGPTï¼å¨å¤ç§è¯­è¨çè§£ä»»å¡ä¸çæ§è½ï¼æ¶µçæ´å¤æçæ¨çåè¯­ä¹çè§£é®é¢ã</p>
<h4 id="superglue-çæ ¸å¿ç»æ"><strong>SuperGLUE çæ ¸å¿ç»æ</strong></h4>
<p>SuperGLUE åå« 8 ä¸ªä¸åçä»»å¡ï¼æ¯ä¸ªä»»å¡å¯¹åºä¸ç§è¯­è¨çè§£çæ ¸å¿è½åãä»¥ä¸æ¯æ¯ä¸ªä»»å¡çè¯¦ç»è¯´æï¼</p>
<h5 id="boolean-question-boolq">1. <strong>Boolean Question (BoolQ)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼äºåç±»ä»»å¡ï¼Yes/Noï¼ã</li>
<li><strong>ç®æ </strong>ï¼æ ¹æ®ç»å®çæ®µè½åé®é¢ï¼å¤æ­ç­æ¡æ¯âæ¯âè¿æ¯âå¦âã</li>
<li><strong>è¾å¥</strong>ï¼ä¸ä¸ªæ®µè½ï¼contextï¼åä¸ä¸ªèªç¶è¯­è¨é®é¢ï¼questionï¼ã</li>
<li><strong>è¾åº</strong>ï¼å¸å°å¼ï¼Yes/Noï¼ã</li>
<li><strong>æ°æ®æ¥æº</strong>ï¼ä»çå®ç¨æ·æ¥è¯¢çæçé®é¢ï¼ä¾å¦ç»´åºç¾ç§ã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>é®é¢çç­æ¡éè¦éè¿å¤ææ¨çåè·¨å¥å­è¯­ä¹æ´åæ¥ç¡®å®ã</li>
</ul></li>
</ul>
<hr>
<h5 id="commitmentbank-cb">2. <strong>CommitmentBank (CB)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼ä¸åç±»ä»»å¡ï¼Entailment / Neutral / Contradictionï¼ã</li>
<li><strong>ç®æ </strong>ï¼å¤æ­ä¸ä¸ªåè®¾ï¼hypothesisï¼æ¯å¦ä»ç»å®çææ¬æ®µè½ï¼premiseï¼ä¸­å¯ä»¥ï¼
<ol type="1">
<li>æ¨åºï¼Entailmentï¼ï¼</li>
<li>ä¸ç¡®å®ï¼Neutralï¼ï¼</li>
<li>æçç¾ï¼Contradictionï¼ã</li>
</ol></li>
<li><strong>è¾å¥</strong>ï¼ä¸ä¸ªåæå¥ï¼premiseï¼åä¸ä¸ªåè®¾å¥ï¼hypothesisï¼ã</li>
<li><strong>è¾åº</strong>ï¼ä¸åç±»æ ç­¾ã</li>
<li><strong>æ°æ®æ¥æº</strong>ï¼å¯¹è¯­è¨å­¦ç ç©¶ä¸­çåµå¥ä»å¥è¿è¡æ æ³¨ã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>æ¶åå¤æçè¯­ä¹æ¨çåå¥æ³å³ç³»ã</li>
</ul></li>
</ul>
<hr>
<h5 id="choice-of-plausible-alternatives-copa">3. <strong>Choice of Plausible Alternatives (COPA)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼å ææ¨çï¼äºéä¸ï¼ã</li>
<li><strong>ç®æ </strong>ï¼å¤æ­ç»å®çå¥å­æ¯å¦æ¯å æé¾ä¸­çåå æç»æï¼å¹¶ä»ä¸¤ä¸ªå¤éç­æ¡ä¸­éæ©ä¸ä¸ªã</li>
<li><strong>è¾å¥</strong>ï¼ä¸ä¸ªå¥å­åä¸¤ä¸ªå¤éç­æ¡ã</li>
<li><strong>è¾åº</strong>ï¼éæ©ä¸ä¸ªæ´å¯è½çç­æ¡ï¼1 æ 2ï¼ã</li>
<li><strong>æ°æ®æ¥æº</strong>ï¼æå¨åå»ºçå ææ¨çæ°æ®ã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>æ¶åå æå³ç³»çæ¨çã</li>
<li>åéç­æ¡å·æä¸å®çè¿·ææ§ã</li>
</ul></li>
</ul>
<hr>
<h5 id="multi-sentence-reading-comprehension-record">4. <strong>Multi-Sentence Reading Comprehension (ReCoRD)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼å¡«ç©ºé®é¢ã</li>
<li><strong>ç®æ </strong>ï¼éè¿éè¯»é¿æ®µè½ï¼éæ©å¡«åé®é¢ç©ºç½çæ­£ç¡®è¯è¯­æç­è¯­ã</li>
<li><strong>è¾å¥</strong>ï¼ä¸ä¸ªé¿æ®µè½ååå«ç©ºç½çå¥å­ã</li>
<li><strong>è¾åº</strong>ï¼æ­£ç¡®çè¯è¯­æç­è¯­ï¼ä»æ®µè½ä¸­éåï¼ã</li>
<li><strong>æ°æ®æ¥æº</strong>ï¼æ°é»è¯­æåºã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>æ¶åè·¨å¥å­å³ç³»ççè§£ã</li>
<li>åéç­æ¡å¯è½å·æè¯­ä¹ç¸ä¼¼æ§ï¼å¢å äºä»»å¡é¾åº¦ã</li>
</ul></li>
</ul>
<hr>
<h5 id="reading-comprehension-with-commonsense-reasoning-rte">5. <strong>Reading Comprehension with Commonsense Reasoning (RTE)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼äºåç±»ä»»å¡ï¼Entailment / Not Entailmentï¼ã</li>
<li><strong>ç®æ </strong>ï¼å¤æ­åè®¾ï¼hypothesisï¼æ¯å¦å¯ä»¥ä»åæå¥ï¼premiseï¼ä¸­æ¨åºã</li>
<li><strong>è¾å¥</strong>ï¼åæå¥ååè®¾å¥ã</li>
<li><strong>è¾åº</strong>ï¼äºåç±»æ ç­¾ï¼Entailment / Not Entailmentï¼ã</li>
<li><strong>æ°æ®æ¥æº</strong>ï¼å¤ä¸ªç°æçèªç¶è¯­è¨æ¨çæ°æ®éã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>æ¨çæ¶åéå«çèæ¯ç¥è¯åå¸¸è¯ã</li>
</ul></li>
</ul>
<hr>
<h5 id="winograd-schema-challenge-wic">6. <strong>Winograd Schema Challenge (WiC)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼è¯ä¹æ¶æ­§ã</li>
<li><strong>ç®æ </strong>ï¼å¤æ­æä¸ªè¯å¨ä¸¤ä¸ªå¥å­ä¸­çå«ä¹æ¯å¦ç¸åã</li>
<li><strong>è¾å¥</strong>ï¼ä¸¤ä¸ªå¥å­åç®æ è¯ã</li>
<li><strong>è¾åº</strong>ï¼å¸å°å¼ï¼Yes/Noï¼ã</li>
<li><strong>æ°æ®æ¥æº</strong>ï¼è¯ä¹æ æ³¨åä¸ä¸æä¿¡æ¯ã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>æ¶åå¯¹å¤ä¹è¯çåç¡®è¯­ä¹å¤æ­ã</li>
<li>èéªæ¨¡åå¯¹ä¸ä¸æç»å¾®å·®å«ççè§£ã</li>
</ul></li>
</ul>
<hr>
<h5 id="winograd-schema-challenge-wsc">7. <strong>Winograd Schema Challenge (WSC)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼å±ææ¶è§£ã</li>
<li><strong>ç®æ </strong>ï¼å¤æ­ä»£è¯æåè¯ç­è¯­çæä»£å¯¹è±¡ã</li>
<li><strong>è¾å¥</strong>ï¼ä¸ä¸ªå¥å­ï¼åå«ä¸ä¸ªæä»£ç®æ åä¸¤ä¸ªåéå¯¹è±¡ã</li>
<li><strong>è¾åº</strong>ï¼æ­£ç¡®çæä»£å¯¹è±¡ã</li>
<li><strong>æ°æ®æ¥æº</strong>ï¼æå·¥åå»ºçå±ææ¶è§£æ°æ®ã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>èå¯æ¨¡åå¯¹ä»£è¯è§£æåè¯­ä¹å¸¸è¯ççè§£ã</li>
</ul></li>
</ul>
<hr>
<h5 id="ax-b-broadcoverage-diagnostic">8. <strong>AX-b (BroadCoverage Diagnostic)</strong></h5>
<ul>
<li><strong>ä»»å¡ç±»å</strong>ï¼å¯¹ææ¬çæ®µè¿è¡è¯­è¨ç°è±¡çè¯æ­è¯ä¼°ã</li>
<li><strong>ç®æ </strong>ï¼åææ¨¡åå¨ç¹å®è¯­è¨ç°è±¡ï¼å¦é»è¾æ¨çæä¸çç¥è¯æ¨çï¼ä¸çè¡¨ç°ã</li>
<li><strong>è¾å¥åè¾åº</strong>ï¼ä¸å¶ä»ä»»å¡ç±»ä¼¼ï¼å·ä½è®¾è®¡ç¨äºæµè¯æ¨¡åçå¼±ç¹ã</li>
<li><strong>ææ</strong>ï¼
<ul>
<li>è®¾è®¡éå¯¹æ§å¼ºï¼æ¨å¨æ´é²æ¨¡åå±éã</li>
</ul></li>
</ul>
<h4 id="superglue-çè¯ä»·æ¹å¼"><strong>SuperGLUE çè¯ä»·æ¹å¼</strong></h4>
<ol type="1">
<li><strong>ä»»å¡ææ </strong>ï¼
<ul>
<li>æ¯ä¸ªä»»å¡æç¹å®çè¯ä¼°ææ ï¼å¦åç¡®çãF1 åæ°ç­ï¼ã</li>
</ul></li>
<li><strong>æ»ä½åæ°</strong>ï¼
<ul>
<li>éè¿ææä»»å¡çå æå¹³ååæ°è¯ä¼°æ¨¡åæ´ä½æ§è½ã</li>
</ul></li>
<li><strong>äººç±»åºå</strong>ï¼
<ul>
<li>è¶è¿ GLUE åºåçäººç±»æ°´å¹³è®¾ç½®ä¸º SuperGLUE çåèåºçº¿ã</li>
</ul></li>
</ol>
<h4 id="superglue-çæä¹"><strong>SuperGLUE çæä¹</strong></h4>
<ul>
<li><strong>æ´é«é¾åº¦</strong>ï¼SuperGLUE è®¾è®¡äºæ´å¤æçè¯­è¨çè§£ä»»å¡ï¼èéªæ¨¡åçæ¨çè½åãå¸¸è¯ç¥è¯åè¯­ä¹çè§£ã</li>
<li><strong>æ¨å¨ç ç©¶</strong>ï¼æä¾äºç»ä¸çè¯ä¼°æ¡æ¶ï¼ä¿è¿äºæ´å¼ºå¤§åéç¨çè¯­è¨çè§£æ¨¡åçå¼åã</li>
<li><strong>é¢åè¦çå¹¿</strong>ï¼ä»»å¡æ¶åå¤ç§è¯­è¨çè§£è½åï¼ä½¿æ¨¡åéå·å¤å¹¿æ³çéåºæ§ã</li>
</ul>
<h4 id="æ¨¡åææ"><strong>æ¨¡åææ</strong></h4>
<p>è½ç¶å½åæ¨¡åï¼å¦ T5ãGPT-4 ç­ï¼å·²ç»å¨é¨åä»»å¡ä¸æ¥è¿æè¶è¿äººç±»æ°´å¹³ï¼ä½å¨æ¶åå¸¸è¯æ¨çãå æå³ç³»åç»ç²åº¦è¯­ä¹åæçä»»å¡ä¸ï¼ä»ç¶å­å¨æ¹è¿ç©ºé´ãSuperGLUE å æ­¤è¢«è§ä¸ºæ¨å¨ NLP é¢åè¿æ­¥çéè¦åºåä¹ä¸ã</p>
<h3 id="mmluåºåæµè¯é">MMLUåºåæµè¯é</h3>
<p><strong>MMLU (Massive Multitask Language Understanding)</strong> æ¯ä¸ä¸ªç¨äºè¯ä¼°è¯­è¨æ¨¡åå¤ä»»å¡è½åçåºåæµè¯éãå®ä¸é¨è®¾è®¡ç¨äºæµè¯å¤§è¯­è¨æ¨¡åï¼å¦ GPT ç³»åï¼ç <strong>å¤ä»»å¡å­¦ä¹ ï¼multitask learningï¼</strong> å <strong>éç¨è¯­è¨çè§£è½åï¼general language understandingï¼</strong>ãMMLU åºåæµè¯éæ¶µçäºå¤ç§ä¸åç±»åçä»»å¡ï¼ä»å¸¸è§çåç±»ãæ¨çä»»å¡å°æ´å ä¸ä¸çç¥è¯é¢åï¼å¦å»å­¦ãæ³å¾ç­ï¼çåºç¨ï¼è½å¤å¨é¢å°è¯ä¼°è¯­è¨æ¨¡åå¨åç§åºæ¯ä¸çè¡¨ç°ã</p>
<h4 id="mmlu-åºåæµè¯éçææ"><strong>MMLU åºåæµè¯éçææ</strong></h4>
<p>MMLU åºåæµè¯éåæ¬å¤ç§ç±»åçä»»å¡ï¼ä»¥ä¸æ¯å ä¸ªä¸»è¦ç±»å«çä»»å¡åä¸äºå¸¸è§çå­ä»»å¡ï¼</p>
<ol type="1">
<li><strong>å¸¸è¯æ¨ç</strong>ï¼
<ul>
<li>æµè¯è¯­è¨æ¨¡åå¨æ¥å¸¸å¸¸è¯æ¹é¢ççè§£ã</li>
<li>ç¤ºä¾ä»»å¡ï¼åç­å³äºä¸çå¸¸è¯çé®é¢ï¼å¦åå²äºä»¶ãäººç©ãç§å­¦å¸¸è¯ç­ï¼ã</li>
</ul></li>
<li><strong>æ°å­¦ä¸é»è¾æ¨ç</strong>ï¼
<ul>
<li>åå«ç®æ¯ãä»£æ°ãå ä½ç­æ°å­¦é®é¢çè§£ç­ã</li>
<li>ç¤ºä¾ä»»å¡ï¼è§£å³æ°å­¦è¿ç®é®é¢ï¼ä¾å¦åºç¡çå åä¹é¤ï¼çè³æ´å¤æçå ä½åä»£æ°é®é¢ï¼ã</li>
</ul></li>
<li><strong>ç§å­¦ä¸ææ¯çè§£</strong>ï¼
<ul>
<li>æµè¯æ¨¡åå¨ç©çãåå­¦ãçç©å­¦ç­ç§å­¦é¢åçç¥è¯çè§£ã</li>
<li>ç¤ºä¾ä»»å¡ï¼è§£ç­å³äºç©çå­¦åçãåå­¦ååºãçç©å­¦æ¦å¿µç­é®é¢ã</li>
</ul></li>
<li><strong>ä¸ä¸é¢åç¥è¯</strong>ï¼
<ul>
<li>æ¶åæ³å¾ãå»å­¦ãéèç­ä¸ä¸é¢åçä»»å¡ã</li>
<li>ç¤ºä¾ä»»å¡ï¼æ³å¾æ¡ä»¶åæãå»å­¦çç¶è¯æ­ãè´¢å¡æ¥ååæç­ã</li>
</ul></li>
<li><strong>è¯­è¨å­¦ä»»å¡</strong>ï¼
<ul>
<li>æ¶åè¯­æ³ãè¯­ä¹åæåæ¨ççä»»å¡ã</li>
<li>ç¤ºä¾ä»»å¡ï¼å¥æ³åæãè¯­ä¹å³ç³»æåãææåæç­ã</li>
</ul></li>
<li><strong>éè¯»çè§£ä¸æ¨ç</strong>ï¼
<ul>
<li>åæ¬ä»æç« ææ®µè½ä¸­æåä¿¡æ¯å¹¶è¿è¡æ¨çã</li>
<li>ç¤ºä¾ä»»å¡ï¼éè¯»çè§£ï¼ç»å®ä¸æ®µæç« ååç­ç¸å³é®é¢ï¼åæ¨çä»»å¡ï¼åºäºæç« è¿è¡é»è¾æ¨çï¼ã</li>
</ul></li>
<li><strong>æåä¸åå²</strong>ï¼
<ul>
<li>ä»»å¡æ¶åå¯¹æåãåå²ãå°çåäººç±»ç¤¾ä¼ççè§£ã</li>
<li>ç¤ºä¾ä»»å¡ï¼åç­åå²äºä»¶çå·ä½ç»èææåç°è±¡çè§£è¯»ã</li>
</ul></li>
</ol>
<h4 id="mmluçä¸»è¦ç¹ç¹"><strong>MMLUçä¸»è¦ç¹ç¹</strong></h4>
<ul>
<li><strong>å¤æ ·æ§</strong>ï¼MMLU æ¶µçäºä»åºç¡çè¯­è¨çè§£ä»»å¡å°å¤æçæ¨çãä¸ä¸ç¥è¯é¢åçä»»å¡ï¼æ¶åå¤ä¸ªé¢ååç¥è¯å±é¢ã</li>
<li><strong>é¾åº¦èå´å¹¿</strong>ï¼åå«äºä»å®¹æå°å°é¾ä¸ç­çä»»å¡ï¼å¸®å©æµè¯æ¨¡åå¨ä¸åé¾åº¦çº§å«ä¸çè½åã</li>
<li><strong>é«è´¨éé®é¢</strong>ï¼é®é¢éå¸¸ç»è¿ç²¾å¿è®¾è®¡ï¼æ¶µçäºå¹¿æ³çç¥è¯ï¼ç¡®ä¿æµè¯çå¨é¢æ§åä»£è¡¨æ§ã</li>
<li><strong>æ ååçè¯ä¼°</strong>ï¼éè¿ç»ä¸çä»»å¡åæ ååçè¯åä½ç³»ï¼å¯ä»¥æ¯è¾ä¸åè¯­è¨æ¨¡åå¨åä¸åºåä¸çè¡¨ç°ã</li>
</ul>
<h4 id="mmluåºåæµè¯éçè¯ä»·æ å"><strong>MMLUåºåæµè¯éçè¯ä»·æ å</strong></h4>
<p>MMLU åºåæµè¯çæ§è½éå¸¸ä½¿ç¨ <strong>åç¡®çï¼Accuracyï¼</strong> æ¥è¡¡éãå¯¹äºæ¯ä¸ªä»»å¡ï¼æ¨¡åç»åºçç­æ¡ä¼æ ¹æ®æ¯å¦æ­£ç¡®è¿è¡è¯åï¼æç»éè¿å æå¹³åè®¡ç®åºåä»»å¡çç»¼ååç¡®çã</p>
<ul>
<li><strong>ä»»å¡çå æ</strong>ï¼MMLU éå¸¸ä¼ä¸ºä¸åç±»åçä»»å¡è®¾å®ä¸åçæéï¼ä»¥ç¡®ä¿æç»çè¯åè½å¤åç¡®åæ æ¨¡åçç»¼åè½åã</li>
<li><strong>æ ·æ¬é</strong>ï¼æ¯ä¸ªä»»å¡ä¸­çé®é¢éå¸¸æå¤ä¸ªæ ·æ¬ï¼è¿äºæ ·æ¬è¢«è®¾è®¡ä¸ºå·ææææ§çï¼ç¡®ä¿è¯ä¼°ç»æå·æä»£è¡¨æ§ã</li>
</ul>
<h4 id="mmluçåºç¨"><strong>MMLUçåºç¨</strong></h4>
<p>MMLU çè®¾è®¡ä½¿å¶æä¸ºæµè¯å¤§åè¯­è¨æ¨¡åå¤ä»»å¡è½ååçè§£æ·±åº¦çæ åå·¥å·ãå®çåºç¨ä¸»è¦ä½ç°å¨ä»¥ä¸å ä¸ªæ¹é¢ï¼</p>
<ol type="1">
<li><strong>è¯­è¨æ¨¡åçç»¼åè½åè¯ä¼°</strong>ï¼éè¿å¨é¢è¯ä¼°æ¨¡åå¨å¤ç§ä»»å¡ä¸­çè¡¨ç°ï¼MMLU å¯ä»¥å¸®å©ç ç©¶äººååå·¥ç¨å¸äºè§£æ¨¡åçéç¨è¯­è¨çè§£è½åã</li>
<li><strong>æ¨¡åä¹é´çæ¯è¾</strong>ï¼MMLU æä¾äºä¸ä¸ªç»ä¸çæµè¯æ åï¼å¯ä»¥ç¨æ¥æ¯è¾ä¸åæ¨¡åçæ§è½ï¼å°¤å¶æ¯ä¸åè§æ¨¡ãæ¶æçè¯­è¨æ¨¡åä¹é´ã</li>
<li><strong>å¤ä»»å¡å­¦ä¹ ç ç©¶</strong>ï¼MMLU å¯¹äºæ¢ç´¢åä¼åå¤ä»»å¡å­¦ä¹ æéè¦æä¹ãå®å¸®å©ç ç©¶äººåæµè¯å¨å¤ä¸ªä»»å¡ä¸è®­ç»æ¨¡åæ¶çææï¼è¯ä¼°æ¨¡åå¦ä½ä»å¤ä¸ªä»»å¡ä¸­è¿è¡æ³åã</li>
</ol>
<h4 id="mmluåºåæµè¯çä¾å­"><strong>MMLUåºåæµè¯çä¾å­</strong></h4>
<h5 id="ä¾1å¸¸è¯æ¨çä»»å¡"><strong>ä¾1ï¼å¸¸è¯æ¨çä»»å¡</strong></h5>
<p>ä»»å¡ï¼åªä¸ªå½å®¶ä½äºåç¾æ´²ï¼ - éé¡¹ï¼A) å æ¿å¤§ B) å¾·å½ C) å·´è¥¿ D) ä¸­å½ - æ­£ç¡®ç­æ¡ï¼A) å æ¿å¤§</p>
<h5 id="ä¾2æ°å­¦ä»»å¡"><strong>ä¾2ï¼æ°å­¦ä»»å¡</strong></h5>
<p>ä»»å¡ï¼5x + 3 = 23, æ±xçå¼ã - éé¡¹ï¼A) 3 B) 4 C) 5 D) 2 - æ­£ç¡®ç­æ¡ï¼B) 4</p>
<h5 id="ä¾3æ³å¾ä»»å¡"><strong>ä¾3ï¼æ³å¾ä»»å¡</strong></h5>
<p>ä»»å¡ï¼æ ¹æ®ç¾å½å®ªæ³ï¼è°æ¯æé«æ³é¢çæ³å®ï¼ - éé¡¹ï¼A) æ»ç» B) æé«æ³é¢é¦å¸­æ³å® C) ç¾å½å½ä¼ D) åå·å·é¿ - æ­£ç¡®ç­æ¡ï¼B) æé«æ³é¢é¦å¸­æ³å®</p>
<h5 id="ä¾4ç§å­¦ä»»å¡"><strong>ä¾4ï¼ç§å­¦ä»»å¡</strong></h5>
<p>ä»»å¡ï¼ååä½ç¨æ¯å¦ä½åççï¼ - éé¡¹ï¼A) å©ç¨å¤ªé³åå°æ°´åäºæ°§åç¢³è½¬åä¸ºæ°§æ°åè¡èç³ B) éè¿ç»èå¼å¸ C) éè¿è¸å D) éè¿åå­¦ååº - æ­£ç¡®ç­æ¡ï¼A) å©ç¨å¤ªé³åå°æ°´åäºæ°§åç¢³è½¬åä¸ºæ°§æ°åè¡èç³</p>
<h4 id="mmluçææåæ¹è¿"><strong>MMLUçææåæ¹è¿</strong></h4>
<ol type="1">
<li><strong>ä»»å¡è®¾è®¡çå¤ææ§</strong>ï¼éçè¯­è¨æ¨¡ååå¾è¶æ¥è¶å¼ºå¤§ï¼æµè¯éçä»»å¡è®¾è®¡ä¹éè¦ä¸æ­æåï¼ä»¥ç¡®ä¿è½å¤è¡¡éæ¨¡åçæ·±åº¦çè§£åæ¨çè½åã</li>
<li><strong>å¤æ ·åçæµè¯</strong>ï¼MMLU è¿å¯ä»¥è¿ä¸æ­¥æ©å±ï¼æ¶µçæ´å¤æ ·åçé¢ååä»»å¡ï¼å°¤å¶æ¯è·¨æ¨¡æä»»å¡ï¼å¦å¾åãè§é¢ç­ï¼çç»åã</li>
<li><strong>ä¸å¹³è¡¡æ§</strong>ï¼ä¸åä»»å¡çé¾åº¦ä¸åè¡¡ï¼å¯è½å¯¼è´ä¸äºæ¨¡åå¨æäºä»»å¡ä¸è¡¨ç°çªåºï¼èå¨å¦ä¸äºä»»å¡ä¸è¡¨ç°è¾å·®ã</li>
</ol>
<h4 id="æ»ç»-1"><strong>æ»ç»</strong></h4>
<p>MMLUï¼Massive Multitask Language Understandingï¼æ¯ä¸ä¸ªç»¼åæ§å¼ºãè¦çé¢å¹¿çåºåæµè¯éï¼æ¨å¨è¯ä¼°è¯­è¨æ¨¡åå¨åç§ä»»å¡ä¸çè¡¨ç°ãå®éè¿æ¶åå¸¸è¯æ¨çãæ°å­¦ãç§å­¦ãæ³å¾ç­å¤ç§ä»»å¡ï¼å¨é¢è¡¡éæ¨¡åçå¤ä»»å¡å­¦ä¹ è½åï¼æä¸ºè¡¡éå¤§è§æ¨¡è¯­è¨æ¨¡åéç¨è½åçéè¦å·¥å·ã</p>
</body></html>]]></content>
      <categories>
        <category>Notes</category>
        <category>Deep Learning</category>
        <category>Papers</category>
      </categories>
      <tags>
        <tag>GPT</tag>
        <tag>LLM</tag>
        <tag>NLP</tag>
      </tags>
  </entry>
  <entry>
    <title>Basic Usage of Hexo</title>
    <url>/2019/11/30/Basic-Usage-of-Hexo/</url>
    <content><![CDATA[<html><head></head><body><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>
<h2 id="quick-start">Quick Start</h2>
<h3 id="create-a-new-post">Create a new post</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="run-server">Run server</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="generate-static-files">Generate static files</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="deploy-to-remote-sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
<h2 id="writing">Writing</h2>
<p>Basically, <a href="https://hexo.io/">Hexo</a> supports <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> and it can automatically compile Markdown to static webpage.</p>
<h3 id="insert-images">Insert Images</h3>
There are multiple ways that can insert images in Markdown, such as using absolute path, relative path, or url path. In Hexo, we can simply put the images we want to inert in <strong>source/images</strong> and insert it using the following command. <figure class="highlight arcade"><table><tbody><tr><td class="code"><pre><span class="line">![descriptions](<span class="regexp">/images/im</span>age_example.jpg)</span><br></pre></td></tr></tbody></table></figure> This method is easy to use. However, if we have huge amounts of images in our blog, it would be difficult to efficiently manage them. Luckily, Hexo provides a more organized way to many images on a post-per-post basis. We first turn on this convenient approach by setting the <strong>post_assert_folder</strong> setting in **_config.yml** to true. <figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">post_assert_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure> With asset folder management enabled, Hexo will create a folder every time you make a new post with the **hexo new [layout]
<title>
&lt;p&gt;** command. This asset folder will have the same name as the markdown file associated with the post. Place all assets related to your post into the associated folder, and you will be able to reference them using a relative path, making for an easier and more convenient workflow. Then we can insert images using the following command. &lt;figure class="highlight scss"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;!&lt;span class="selector-attr"&gt;[descriptions]&lt;/span&gt;(image.jpg)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt; More info: &lt;a href="https://hexo.io/docs/asset-folders.html"&gt;Assert Folders&lt;/a&gt; ### File download links Similar with inserting images, we can put files we want to share in the same fold and share it using the following markdown command. &lt;figure class="highlight applescript"&gt;&lt;table&gt;&lt;tr&gt;&lt;td class="gutter"&gt;&lt;pre&gt;&lt;span class="line"&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="line"&gt;[Download &lt;span class="built_in"&gt;file&lt;/span&gt;](&lt;span class="built_in"&gt;file&lt;/span&gt;.example)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</title></body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>NexT</tag>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>Visualization and Analysis Of Parameters And Architectures Of Models</title>
    <url>/2024/12/31/Visualization-and-Analysis-Of-Parameters-And-Architectures-Of-Models/</url>
    <content><![CDATA[<html><head></head><body><p>æ¬æä¸»è¦ä»ç»æ¨¡ååæ°éçåææ¹æ³åæ¨¡åç»æçå¯è§åæ¹æ³ãæ¬æä¸»è¦æä¸¤é¨ååå®¹ï¼ç¬¬ä¸é¨åæ¯ä½¿ç¨<a href="https://github.com/TylerYep/torchinfo">torchinfo</a>åææ¨¡ååæ°éï¼ç¬¬äºé¨åæ¯ä½¿ç¨<a href="https://github.com/lanpa/torch-summary">torchview</a>å·¥å·åå¯¹æ¨¡åç»æåæ¨¡åè¿è¡å¯è§åã <span id="more"></span></p>
<h2 id="parameter-and-memory-analysis"><strong>Parameter and Memory Analysis</strong></h2>
<p>æ¨¡ååæ°åæåèæç« ï¼<a href="https://medium.com/the-owl/how-to-get-model-summary-in-pytorch-57db7824d1e3#id_token=eyJhbGciOiJSUzI1NiIsImtpZCI6ImFiODYxNGZmNjI4OTNiYWRjZTVhYTc5YTc3MDNiNTk2NjY1ZDI0NzgiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIyMTYyOTYwMzU4MzQtazFrNnFlMDYwczJ0cDJhMmphbTRsamRjbXMwMHN0dGcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIyMTYyOTYwMzU4MzQtazFrNnFlMDYwczJ0cDJhMmphbTRsamRjbXMwMHN0dGcuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTA0MjY2MjgwMDUyOTgwMTQyMDAiLCJlbWFpbCI6InlvbmdzaGVuZy56aGFvLmNzY0BnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmJmIjoxNzM1NTc0MDgyLCJuYW1lIjoiWW91bmdzb24gWmhhbyIsInBpY3R1cmUiOiJodHRwczovL2xoMy5nb29nbGV1c2VyY29udGVudC5jb20vYS9BQ2c4b2NLUWltYTZjZ054WnFOZW1majF1LXdXRW5Cd09wZWlMRERFenJ3Y01aNTNSY1JocXM0PXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6IllvdW5nc29uIiwiZmFtaWx5X25hbWUiOiJaaGFvIiwiaWF0IjoxNzM1NTc0MzgyLCJleHAiOjE3MzU1Nzc5ODIsImp0aSI6ImU2OTRmMzEyZDAwZTA3Yjg3NWU1NzBmMDIxZTlkY2YyMWEwOTQ0MjIifQ.jB6C-8q7ZWwyWSwEa0a3Y4smtKiCtXT7zSkJQBqzNARU5zvDn_w90Funus3UgKcYEFh4g80KwKv3uEiDlnicvcQO93-LqOihbz2n8ljKuKpOyQpuTnaGQ4YayxmoLRwOHC4gzTpZkVadrDnc1BiBoyoXiFNKCE54wJIToD5Dj7qJFBC43djXHG6MlGnyt4TRJEu2ovbnpvef8LqryEXnpv1KVmlFdak_gsrnD4NSsQCQJd3Z_BJBls1nRt8Ph0QEi2SzZjnu7HbNBWS9cQxYTNllR4HP_umrd8GHBQWzQjPay0X0MXC9-j0jCV78Da_NtPJtWqv4T-88b16XZx1Ydw">How to get Model Summary in PyTorch</a> ### <strong>torchinfo</strong> <a href="https://github.com/TylerYep/torchinfo">torchinfo</a>æ¯ä¸ä¸ªç¨äºåæPyTorchæ¨¡ååæ°çå·¥å·åï¼å¯ä»¥æ¹ä¾¿å°æ¥çæ¨¡åçåæ°éãè®¡ç®éãåå­å ç¨ç­ä¿¡æ¯ã</p>
<ul>
<li><p>torchinfoçå®è£æ¹æ³å¦ä¸ï¼ </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">pip install torchinfo</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>torchinfoçä½¿ç¨æ¹æ³å¦ä¸ï¼ </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torchinfo <span class="keyword">import</span> summary</span><br><span class="line">device = torch.device(<span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line"><span class="comment"># define model</span></span><br><span class="line">model = get_model(config, tokenizer_src.get_vocab_size(), tokenizer_tgt.get_vocab_size())</span><br><span class="line"></span><br><span class="line"><span class="comment"># print model summary information</span></span><br><span class="line">summary(model, input_data=(torch.randint(<span class="number">2</span>, (<span class="number">16</span>, <span class="number">256</span>)).to(device), torch.randint(<span class="number">2</span>, (<span class="number">16</span>, <span class="number">256</span>)).to(device), torch.randint(<span class="number">1</span>, (<span class="number">16</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">256</span>)).to(device), torch.randint(<span class="number">1</span>, (<span class="number">16</span>, <span class="number">1</span>, <span class="number">256</span>, <span class="number">256</span>)).to(device)), device=device.<span class="built_in">type</span>)</span><br></pre></td></tr></tbody></table></figure><p></p></li>
<li><p>torchinfoçæ¨¡åsummaryä¿¡æ¯(ä»¥Transformer)å¦ä¸ï¼ </p><figure class="highlight nestedtext"><table><tbody><tr><td class="code"><pre><span class="line">=========================================================================================================</span><br><span class="line">Layer (type:depth-idx)                                  Output Shape              Param #</span><br><span class="line"><span class="attribute">=========================================================================================================</span></span><br><span class="line"><span class="attribute">Transformer                                             [16, 256, 22466]          --</span></span><br><span class="line"><span class="attribute">ââInputEmbedding</span><span class="punctuation">:</span> <span class="string">1-1                                   [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">â    ââEmbedding</span><span class="punctuation">:</span> <span class="string">2-1                                   [16, 256, 512]            8,038,912</span></span><br><span class="line"><span class="attribute">ââPositionalEncoding</span><span class="punctuation">:</span> <span class="string">1-2                               [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">â    ââDropout</span><span class="punctuation">:</span> <span class="string">2-2                                     [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">ââEncoder</span><span class="punctuation">:</span> <span class="string">1-3                                          [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">â    ââModuleList</span><span class="punctuation">:</span> <span class="string">2-3                                  --                        --</span></span><br><span class="line"><span class="attribute">â    â    ââEncoderBlock</span><span class="punctuation">:</span> <span class="string">3-1                           [16, 256, 512]            3,150,340</span></span><br><span class="line"><span class="attribute">â    â    ââEncoderBlock</span><span class="punctuation">:</span> <span class="string">3-2                           [16, 256, 512]            3,150,340</span></span><br><span class="line"><span class="attribute">â    â    ââEncoderBlock</span><span class="punctuation">:</span> <span class="string">3-3                           [16, 256, 512]            3,150,340</span></span><br><span class="line"><span class="attribute">â    â    ââEncoderBlock</span><span class="punctuation">:</span> <span class="string">3-4                           [16, 256, 512]            3,150,340</span></span><br><span class="line"><span class="attribute">â    â    ââEncoderBlock</span><span class="punctuation">:</span> <span class="string">3-5                           [16, 256, 512]            3,150,340</span></span><br><span class="line"><span class="attribute">â    â    ââEncoderBlock</span><span class="punctuation">:</span> <span class="string">3-6                           [16, 256, 512]            3,150,340</span></span><br><span class="line"><span class="attribute">â    ââLayerNormalization</span><span class="punctuation">:</span> <span class="string">2-4                          [16, 256, 512]            2</span></span><br><span class="line"><span class="attribute">ââInputEmbedding</span><span class="punctuation">:</span> <span class="string">1-4                                   [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">â    ââEmbedding</span><span class="punctuation">:</span> <span class="string">2-5                                   [16, 256, 512]            11,502,592</span></span><br><span class="line"><span class="attribute">ââPositionalEncoding</span><span class="punctuation">:</span> <span class="string">1-5                               [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">â    ââDropout</span><span class="punctuation">:</span> <span class="string">2-6                                     [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">ââDecoder</span><span class="punctuation">:</span> <span class="string">1-6                                          [16, 256, 512]            --</span></span><br><span class="line"><span class="attribute">â    ââModuleList</span><span class="punctuation">:</span> <span class="string">2-7                                  --                        --</span></span><br><span class="line"><span class="attribute">â    â    ââDecoderBlock</span><span class="punctuation">:</span> <span class="string">3-7                           [16, 256, 512]            4,200,966</span></span><br><span class="line"><span class="attribute">â    â    ââDecoderBlock</span><span class="punctuation">:</span> <span class="string">3-8                           [16, 256, 512]            4,200,966</span></span><br><span class="line"><span class="attribute">â    â    ââDecoderBlock</span><span class="punctuation">:</span> <span class="string">3-9                           [16, 256, 512]            4,200,966</span></span><br><span class="line"><span class="attribute">â    â    ââDecoderBlock</span><span class="punctuation">:</span> <span class="string">3-10                          [16, 256, 512]            4,200,966</span></span><br><span class="line"><span class="attribute">â    â    ââDecoderBlock</span><span class="punctuation">:</span> <span class="string">3-11                          [16, 256, 512]            4,200,966</span></span><br><span class="line"><span class="attribute">â    â    ââDecoderBlock</span><span class="punctuation">:</span> <span class="string">3-12                          [16, 256, 512]            4,200,966</span></span><br><span class="line"><span class="attribute">â    ââLayerNormalization</span><span class="punctuation">:</span> <span class="string">2-8                          [16, 256, 512]            2</span></span><br><span class="line"><span class="attribute">ââProjectionLayer</span><span class="punctuation">:</span> <span class="string">1-7                                  [16, 256, 22466]          --</span></span><br><span class="line"><span class="attribute">â    ââLinear</span><span class="punctuation">:</span> <span class="string">2-9                                      [16, 256, 22466]          11,525,058</span></span><br><span class="line"><span class="attribute">=========================================================================================================</span></span><br><span class="line"><span class="attribute">Total params</span><span class="punctuation">:</span> <span class="string">75,174,402</span></span><br><span class="line"><span class="attribute">Trainable params</span><span class="punctuation">:</span> <span class="string">75,174,402</span></span><br><span class="line"><span class="attribute">Non-trainable params</span><span class="punctuation">:</span> <span class="string">0</span></span><br><span class="line"><span class="attribute">Total mult-adds (G)</span><span class="punctuation">:</span> <span class="string">1.20</span></span><br><span class="line"><span class="attribute">=========================================================================================================</span></span><br><span class="line"><span class="attribute">Input size (MB)</span><span class="punctuation">:</span> <span class="string">8.49</span></span><br><span class="line"><span class="attribute">Forward/backward pass size (MB)</span><span class="punctuation">:</span> <span class="string">3521.18</span></span><br><span class="line"><span class="attribute">Params size (MB)</span><span class="punctuation">:</span> <span class="string">300.70</span></span><br><span class="line"><span class="attribute">Estimated Total Size (MB)</span><span class="punctuation">:</span> <span class="string">3830.37</span></span><br><span class="line">=========================================================================================================</span><br></pre></td></tr></tbody></table></figure><p></p></li>
</ul>
<h3 id="parameter-analysis-step-by-step"><strong>Parameter Analysis Step by Step</strong></h3>
<p><strong>Transformer</strong>æ¨¡åçåæ°å¦ä¸æç¤ºï¼ </p><figure class="highlight apache"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attribute">src_vocab_size</span>: <span class="number">15701</span></span><br><span class="line"><span class="attribute">tgt_vocab_size</span>: <span class="number">22466</span></span><br><span class="line"><span class="attribute">src_seq_len</span>: <span class="number">256</span></span><br><span class="line"><span class="attribute">tgt_seq_len</span>: <span class="number">256</span></span><br><span class="line"><span class="attribute">embed_size</span>: <span class="number">512</span></span><br><span class="line"><span class="attribute">hidden_size</span>: <span class="number">2048</span></span><br><span class="line"><span class="attribute">num_heads</span>: <span class="number">8</span></span><br><span class="line"><span class="attribute">num_encoder_layers</span>: <span class="number">6</span></span><br><span class="line"><span class="attribute">num_decoder_layers</span>: <span class="number">6</span></span><br><span class="line"><span class="attribute">dropout</span>: <span class="number">0</span>.<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure> <strong>Transformer</strong>æ¨¡ååæ°éå¤§å°è·<strong>src_vocab_size</strong>ã<strong>tgt_vocab_size</strong>ã<strong>embed_size</strong>ã<strong>hidden_size</strong>ã<strong>num_encoder_layers</strong>ã<strong>num_decoder_layers</strong>æå³ã<p></p>
<h4 id="inputembedding"><strong>InputEmbedding</strong></h4>
<p><strong>InputEmbedding</strong>æ¬è´¨ä¸æ¯ä¸ä¸ªè¯è¡¨åµå¥åéç©éµï¼ç¨Lookup Tableå®ç°ï¼å¶å¤§å°åå³äºè¯è¡¨ä¸­çè¯æ°åæ¯ä¸ªè¯çåµå¥åéç»´åº¦ã</p>
<ul>
<li><p>å¯¹äºæºåºåï¼å¶<strong>InputEmbedding</strong>çåæ°éå¤§å°ä¸ºï¼ <span class="math display">\[ 
P_{ie}^{src} = src\_vocab\_size \times embed\_size = 15701 \times 512 = 8038912
\]</span> å¶ä¸­<span class="math inline">\(P_{ie}^{src}\)</span>ä¸ºæºåºåç<strong>InputEmbedding</strong>åæ°éå¤§å°ã</p></li>
<li><p>å¯¹äºç®æ åºåï¼å¶<strong>InputEmbedding</strong>çåæ°éå¤§å°ä¸ºï¼ <span class="math display">\[ 
P_{ie}^{tgt} = tgt\_vocab\_size \times embed\_size = 22466 \times 512 = 11502592
\]</span> å¶ä¸­<span class="math inline">\(P_{ie}^{tgt}\)</span>ä¸ºç®æ åºåç<strong>InputEmbedding</strong>åæ°éå¤§å°ã</p></li>
</ul>
<h4 id="positionalencoding"><strong>PositionalEncoding</strong></h4>
<p><strong>PositionalEncoding</strong>æ¯ç±ä¸åé¢ççæ­£å¼¦åä½å¼¦å½æ°çæçç»å¯¹ä½ç½®ç¼ç ï¼æ¯ä¸ä¸ªå¯ä¸ç¡®å®çä½ç½®ç¼ç è¡¨ï¼ä¸å­å¨å¯è®­ç»çåæ°ï¼å æ­¤å¶åæ°éä¸º0ã</p>
<h4 id="encoder"><strong>Encoder</strong></h4>
<p><strong>Encoder</strong>ç±6ä¸ª<strong>EncoderBlock</strong>å1ä¸ª<strong>LayerNormalization</strong>ç»æï¼å æ­¤å¶åæ°éå¤§å°ä¸ºï¼ <span class="math display">\[
P_{enc} = 6 \times P_{encb} + P_{ln} = 6 \times 3150340 + 2 = 18902042
\]</span> å¶ä¸­<span class="math inline">\(P_{enc}\)</span>ä¸º<strong>Encoder</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{encb}\)</span>ä¸º<strong>EncoderBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{ln}\)</span>ä¸º<strong>LayerNormalization</strong>çåæ°éå¤§å°ã</p>
<h5 id="encoderblock"><strong>EncoderBlock</strong></h5>
<p><strong>EncoderBlock</strong>ç±ä¸ä¸ª<strong>MultiHeadAttentionBlock</strong>ãä¸ä¸ª<strong>FeedForwardBlock</strong>åä¸¤ä¸ª<strong>ResidualConnection</strong>ç»æï¼å æ­¤å¶åæ°éå¤§å°ä¸ºï¼ <span class="math display">\[
P_{encb} = P_{mhab} + P_{ffb} + 2 \times P_{rc} = 1050624 + 2099712 + 2 \times 2 = 3150340
\]</span> å¶ä¸­<span class="math inline">\(P_{encb}\)</span>ä¸º<strong>EncoderBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{mhab}\)</span>ä¸º<strong>MultiHeadAttentionBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{ffb}\)</span>ä¸º<strong>FeedForwardBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{rc}\)</span>ä¸º<strong>ResidualConnection</strong>çåæ°éå¤§å°ã</p>
<h6 id="residualconnection"><strong>ResidualConnection</strong></h6>
<p><strong>ResidualConnection</strong>æ¨¡ååå«ä¸ä¸ª<strong>LayerNormalization</strong>åä¸ä¸ª<strong>Add</strong>æä½ï¼å æ­¤å¶åæ°éså¤§å°ä¸ºï¼ <span class="math display">\[
P_{rc} = P_{ln} = 2
\]</span> å¶ä¸­<span class="math inline">\(P_{rc}\)</span>ä¸º<strong>ResidualConnection</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{ln}\)</span>ä¸º<strong>LayerNormalization</strong>çåæ°éå¤§å°ã</p>
<h6 id="multiheadattentionblock"><strong>MultiHeadAttentionBlock</strong></h6>
<p><strong>MultiHeadAttentionBlock</strong>ç±åä¸ª<strong>Linear</strong>æ¨¡åç»æï¼å æ­¤å¶åæ°éå¤§å°ä¸ºï¼ <span class="math display">\[
P_{mhab} = 4 \times P_{linear} = 4 \times (embed\_size \times embed\_size + embed\_size) = 4 \times (512 \times 512 + 512 \times 512 + 512) = 1050624
\]</span> å¶ä¸­<span class="math inline">\(P_{linear}\)</span>ä¸º<strong>MultiHeadAttentionBlock</strong>æ¨¡åä¸­ççº¿æ§æ å°å±ï¼å±æ4ä¸ªï¼<span class="math inline">\(embed\_size\)</span>ä¸º<strong>Linear</strong>æ¨¡åçè¾å¥åè¾åºç»´åº¦ã</p>
<h6 id="feedforwardblock"><strong>FeedForwardBlock</strong></h6>
<p><strong>FeedForwardBlock</strong>ç±ä¸¤ä¸ª<strong>Linear</strong>ãä¸ä¸ª<strong>ReLU</strong>åä¸ä¸ª<strong>Dropout</strong>ç»æï¼å¶ä¸­<strong>ReLU</strong>å<strong>Dropout</strong>æ¨¡åä¸åå«å¯è®­ç»çåæ°ï¼å æ­¤å¶åæ°éå¤§å°ä¸ºï¼ <span class="math display">\[
P_{ffb} = embed\_size \times hidden\_size + hidden\_size + hidden\_size \times embed\_size + embed\_size = 512 \times 2048 + 2048 + 2048 \times 512 + 512 = 2099712
\]</span> å¶ä¸­<span class="math inline">\(P_{ffb}\)</span>ä¸º<strong>FeedForwardBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(embed\_size\)</span>ä¸º<strong>Linear</strong>æ¨¡åçè¾å¥åè¾åºç»´åº¦ï¼<span class="math inline">\(hidden\_size\)</span>ä¸º<strong>FeedForwardBlock</strong>çéèå±ç»´åº¦ã</p>
<h4 id="decoder"><strong>Decoder</strong></h4>
<p><strong>Decoder</strong>ç±6ä¸ª<strong>DecoderBlock</strong>å1ä¸ª<strong>LayerNormalization</strong>ç»æï¼å æ­¤å¶åæ°éå¤§å°ä¸ºï¼ <span class="math display">\[
P_{dec} = 6 \times P_{decb} + P_{ln} = 6 \times 4200966 + 2 = 25205798
\]</span> å¶ä¸­<span class="math inline">\(P_{dec}\)</span>ä¸º<strong>Decoder</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{decb}\)</span>ä¸º<strong>DecoderBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{ln}\)</span>ä¸º<strong>LayerNormalization</strong>çåæ°éå¤§å°ã</p>
<h5 id="decoderblock"><strong>DecoderBlock</strong></h5>
<p><strong>DecoderBlock</strong>ç±ä¸¤ä¸ª<strong>MultiHeadAttentionBlock</strong>ãä¸ä¸ª<strong>FeedForwardBlock</strong>åä¸ä¸ª<strong>ResidualConnection</strong>ç»æï¼å æ­¤å¶åæ°éå¤§å°ä¸ºï¼ <span class="math display">\[
P_{decb} = P_{smhab} + P_{cmhab} + P_{ffb} + 3 \times P_{rc} = 1050624 + 1050624 + 2099712 + 3 \times 2 = 4200966
\]</span> å¶ä¸­<span class="math inline">\(P_{decb}\)</span>ä¸º<strong>DecoderBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{smhab}\)</span>ä¸º<strong>SelfMultiHeadAttentionBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{cmhab}\)</span>ä¸º<strong>CrossMultiHeadAttentionBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{ffb}\)</span>ä¸º<strong>FeedForwardBlock</strong>çåæ°éå¤§å°ï¼<span class="math inline">\(P_{rc}\)</span>ä¸º<strong>ResidualConnection</strong>çåæ°éå¤§å°ã</p>
<h4 id="projectionlayer"><strong>ProjectionLayer</strong></h4>
<p><strong>ProjectionLayer</strong>ç±ä¸ä¸ª<strong>Linear</strong>åä¸ä¸ª<strong>Dropout</strong>ç»æï¼å æ­¤å¶åæ°éå¤§å°ä¸ºï¼ <span class="math display">\[
P_{pl} = embedding\_size \times tgt\_vocab\_size + tgt\_vocab\_size = 512 \times 22466 + 22466 = 11525058
\]</span></p>
<h4 id="total-parameters"><strong>Total Parameters</strong></h4>
<p><strong>Transformer</strong>æ¨¡åçæ»åæ°éä¸ºï¼ <span class="math display">\[
P_{total} = P_{ie}^{src} + P_{ie}^{tgt} + P_{enc} + P_{dec} + P_{pl} = 8038912 + 11502592 + 18902042 + 25205798 + 11525058 = 75174402
\]</span></p>
<h3 id="memory-analysis"><strong>Memory Analysis</strong></h3>
<p><strong>Transformer</strong>æ¨¡åçåæ°é½æ¯Float32æ ¼å¼çï¼ä¸ä¸ªåæ°å ç¨4å­èï¼å æ­¤åæ°éå ç¨åå­å¤§å°ä¸ºï¼ <span class="math display">\[
M_{total} = P_{total} * 4 / 1000 / 1000 = 75174402 * 4 / 1000 / 1000 = 300.70MB
\]</span></p>
<h4 id="ä¸­é´æ¿æ´»å¼">ä¸­é´æ¿æ´»å¼</h4>
<p>ä¸­é´æ¿æ´»å¼æ¯ä¸ºäºè®¡ç®æ¢¯åº¦èéè¦ä¿ççä¸­é´ç»æï¼å·ä½è®¡ç®æ¹æ³åæ­¥éª¤å¯ä»¥åç§<a href="https://mingchao.wang/4KTgtnFc/">è¿é</a>ã</p>
<h2 id="architecture-visualization"><strong>Architecture Visualization</strong></h2>
<p><a href="https://github.com/mert-kurttutan/torchview">torchview</a>æ¯pytorchæ¨¡åç»æå¸¸ç¨çå¯è§åå·¥å·ï¼å¯ä»¥åå±æ¥çæ¨¡åç»æåæ¨¡åçè¾å¥è¾åºã ### <strong>å®è£</strong> <strong>torchview</strong>æ¯åºäº<strong>graphviz</strong>å®ç°çï¼å æ­¤éè¦åå®è£<strong>graphviz</strong>ï¼ç¶åå®è£<strong>torchview</strong>ã </p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo apt-get install graphviz</span><br><span class="line">pip install graphviz</span><br><span class="line">pip install torchview</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="ä½¿ç¨"><strong>ä½¿ç¨</strong></h3>
<p><strong>torchview</strong>çä½¿ç¨æ­¥éª¤å¾ç®åï¼é¦åå®ä¹æ¨¡å(æ­¥éª¤è§ä¸é¢ç« è)ï¼ç¶åå®ä¹æ¨¡åçè¾å¥æ°æ®ï¼æåè°ç¨<strong>torchview</strong>å½æ°å³å¯ã </p><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torchview <span class="keyword">import</span> draw_graph</span><br><span class="line">model_graph = draw_graph(model, input_data=(torch.randint(<span class="number">2</span>, (<span class="number">16</span>, <span class="number">256</span>)).to(device), torch.randint(<span class="number">2</span>, (<span class="number">16</span>, <span class="number">256</span>)).to(device), torch.randint(<span class="number">1</span>, (<span class="number">16</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">256</span>)).to(device), torch.randint(<span class="number">1</span>, (<span class="number">16</span>, <span class="number">1</span>, <span class="number">256</span>, <span class="number">256</span>)).to(device)), depth=<span class="number">2</span>, device=device.<span class="built_in">type</span>, expand_nested=<span class="literal">True</span>, save_graph=<span class="literal">True</span>, filename=<span class="string">'transformer'</span>)</span><br><span class="line">model_graph.visual_graph</span><br></pre></td></tr></tbody></table></figure> <img alt="Transformeræ¨¡åç»æï¼depth=2, expand_nested=Trueï¼" data-src="/2024/12/31/Visualization-and-Analysis-Of-Parameters-And-Architectures-Of-Models/transformer.png"><p></p>
</body></html>]]></content>
      <categories>
        <category>Tutorials</category>
        <category>Deep Learning</category>
        <category>Pytorch</category>
        <category>Model</category>
        <category>Transformer</category>
      </categories>
      <tags>
        <tag>Deep Learning</tag>
        <tag>Tutorials</tag>
        <tag>Pytorch</tag>
        <tag>Transformer</tag>
        <tag>Model</tag>
      </tags>
  </entry>
</search>

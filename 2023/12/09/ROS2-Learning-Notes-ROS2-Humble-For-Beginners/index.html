<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="msvalidate.01" content="3caebbd6f719430c88b5a8dc11df5a98">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Helvetica:300,300italic,400,400italic,700,700italic|Courier New:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://blog.zhaoyongsheng.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"default"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: true,
    lazyload: true,
    pangu: true,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="本文为ROS 2初学者的学习笔记，主要记录了我学习ROS 2过程中的重要信息，防止遗漏。主要参考资料为ROS 2: Humble的官方文档和ROS 2 Tutorials - ROS2 Humble For Beginners。">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS2 Learning Notes - ROS2 Humble For Beginners">
<meta property="og:url" content="http://blog.zhaoyongsheng.com/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/index.html">
<meta property="og:site_name" content="Dr. Zhao&#39;s Blog">
<meta property="og:description" content="本文为ROS 2初学者的学习笔记，主要记录了我学习ROS 2过程中的重要信息，防止遗漏。主要参考资料为ROS 2: Humble的官方文档和ROS 2 Tutorials - ROS2 Humble For Beginners。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-12-09T08:49:51.000Z">
<meta property="article:modified_time" content="2023-12-09T08:49:51.000Z">
<meta property="article:author" content="Dr. Zhao">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.zhaoyongsheng.com/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>ROS2 Learning Notes - ROS2 Humble For Beginners | Dr. Zhao's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-153610516-2"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-153610516-2');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?01357a85fc2ab892b21c9ec34514f480";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dr. Zhao's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Focus on Scientific Research</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.zhaoyongsheng.com/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Dr. Zhao">
      <meta itemprop="description" content="A technical blog for sharing articles related to Computer Vision, Robotics & Deep Learning.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dr. Zhao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          ROS2 Learning Notes - ROS2 Humble For Beginners
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-09 16:49:51" itemprop="dateCreated datePublished" datetime="2023-12-09T16:49:51+08:00">2023-12-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tutorials/" itemprop="url" rel="index">
                    <span itemprop="name">Tutorials</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tutorials/ROS/" itemprop="url" rel="index">
                    <span itemprop="name">ROS</span>
                  </a>
                </span>
            </span>

          
            <span id="/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/" class="post-meta-item leancloud_visitors" data-flag-title="ROS2 Learning Notes - ROS2 Humble For Beginners" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>20 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <html><head></head><body><p>本文为<strong>ROS 2</strong>初学者的学习笔记，主要记录了我学习ROS 2过程中的重要信息，防止遗漏。主要参考资料为<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/index.html">ROS 2: Humble</a>的官方文档和<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=0aPbWsyENA8&amp;list=PLLSegLrePWgJudpPUof4-nVFHGkB62Izy">ROS 2 Tutorials - ROS2 Humble For Beginners</a>。 <span id="more"></span> ## ROS2 VS. ROS1 * 适用不可靠的无线网络 * 适用于机器人集群 * 通信安全 * 适用于嵌入式系统 * 支持实时系统 ## ROS2的结构 底层的通信协议使用的是<strong>DDS</strong> * Cyclone DDS * Fast DDS * Connext DDS 上面是中间件， <strong>ROS 2 Middleeare</strong> 再上面是<strong>rcl</strong>， <strong>ROS 2 Client Library</strong> 再上面是各种语言接口，例如<strong>C++</strong>, <strong>Python</strong>, <strong>Java</strong> 顶层的是这些语言开发的<strong>Applications</strong></p>
<p><strong>ROS2</strong>可以帮助我们实现硬件抽象，设备底层控制， 通信和包管理的功能。 ## 安装ROS2 Humble <strong>ROS</strong>的全称是<strong>Robot Operation System</strong>，主要特点是分布式的结构，节点之间通过通信实现数据交换。ROS还提供了一系列即插即用的库。 ### 按照官网教程安装 ROS2 Humble支持在Ubuntu22.04上包安装，所以直接按照<a target="_blank" rel="noopener" href="https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html">官网教程</a>安装即可。 ### 其他设置 * 安装ROS工具包 </p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-gazebo-ros2-control</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-gazebo-ros-pkgs</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-moveit</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-urdf-tutorial</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-tf2-tools</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-navigation2</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-nav2-bringup</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-turtlebot3</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-turtlebot3-gazebo</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-tf-transformations</span><br><span class="line">sudo apt-<span class="built_in">get</span> install python3-transforms3d</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-joint-trajectory-controller</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-joint-state-broadcaster</span><br><span class="line">sudo apt-<span class="built_in">get</span> install ros-humble-forward-command-controller</span><br></pre></td></tr></tbody></table></figure> * 安装Python编译工具--colcon <figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install <span class="keyword">python3</span>-colcon-common-extensions</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"source /usr/share/colcon_argcomplete/hook/colcon-argcomplete.zsh"</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></tbody></table></figure> * 解决setuptools版本问题导致的warning <figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>lib<span class="regexp">/python3/</span>dist-packages<span class="regexp">/setuptools/</span>command/install.py:<span class="number">34</span>: SetuptoolsDeprecationWarning: setup.py install is deprecated. Use build and pip and other standards-based tools.</span><br><span class="line">  warnings.warn(</span><br></pre></td></tr></tbody></table></figure> setuptools默认安装的版本为59.6.0，需要降级为58.2.0。 <figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pip</span> install setuptools==<span class="number">58</span>.<span class="number">2</span>.<span class="number">0</span></span><br></pre></td></tr></tbody></table></figure> * 解决ros的指令在terminal中自动补全 将以下内容添加到zshrc配置文件中： <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># argcomplete for ros2 &amp; colcon</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="subst">$(register-python-argcomplete3 ros2)</span>"</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="subst">$(register-python-argcomplete3 colcon)</span>"</span></span><br></pre></td></tr></tbody></table></figure> 需要将<strong>rosidl-argcomplete.zsh</strong>文件中的一行代码注释掉。 <figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi <span class="regexp">/opt/</span>ros<span class="regexp">/humble/</span>share<span class="regexp">/rosidl_cli/</span>environment/rosidl-argcomplete.zsh</span><br></pre></td></tr></tbody></table></figure> 注释 <figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autoload -U +X compinit <span class="meta">&amp;&amp; compinit</span></span><br></pre></td></tr></tbody></table></figure> ### Source Configuration ROS的很多配置需要source之后才能生效，为了避免每次启动terminal都需要重新source，我们把source语句加入到配置文件中。 <figure class="highlight gradle"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/opt/</span>ros<span class="regexp">/humble/</span>setup.zsh</span><br><span class="line"><span class="keyword">source</span> <span class="regexp">/usr/</span>share<span class="regexp">/colcon_argcomplete/</span>hook/colcon-argcomplete.zsh</span><br><span class="line"><span class="keyword">source</span> ~<span class="regexp">/ros2_ws/i</span>nstall/setup.zsh</span><br><span class="line"><span class="keyword">source</span> <span class="regexp">/usr/</span>share<span class="regexp">/gazebo/</span>setup.sh</span><br></pre></td></tr></tbody></table></figure> 第一句是source ros安装包配置，第二句是source自动补全配置，第三句是source工作空间的配置。每次ros包重新编译后都需要重新source ros的工作空间。 ### Source Code <strong>ROS</strong>所有的代码均开源，连接见：<a target="_blank" rel="noopener" href="https://github.com/orgs/ros2/repositories">https://github.com/orgs/ros2/repositories</a>。 * rclcpp cpp开发接口：<a target="_blank" rel="noopener" href="https://github.com/ros2/rclcpp">https://github.com/ros2/rclcpp</a> * rclpy python开发接口：<a target="_blank" rel="noopener" href="https://github.com/ros2/rclpy">https://github.com/ros2/rclpy</a> * ros2cli 命令行接口：<a target="_blank" rel="noopener" href="https://github.com/ros2/ros2cli">https://github.com/ros2/ros2cli</a> * ros2bag 记录数据包：<a target="_blank" rel="noopener" href="https://github.com/ros2/rosbag2">https://github.com/ros2/rosbag2</a> * common interfaces <strong>msg</strong>和<strong>srv</strong>源码：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces">https://github.com/ros2/common_interfaces</a> * rviz 3D可视化接口：<a target="_blank" rel="noopener" href="https://github.com/ros2/rviz">https://github.com/ros2/rviz</a> 除了源码，<strong>ROS</strong>还提供了一份<a target="_blank" rel="noopener" href="https://design.ros2.org/">设计文档</a>，详细说明了设计思路和接口说明。源码见：<a href="git@github.com:ros2/design.git">git@github.com:ros2/design.git</a> ## 创建WorkSpace ### 创建文件夹 <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> &amp; <span class="built_in">mkdir</span> ros2_ws</span><br><span class="line"><span class="built_in">cd</span> ros2_ws</span><br><span class="line"><span class="built_in">mkdir</span> src</span><br></pre></td></tr></tbody></table></figure> ### 编译 <figure class="highlight ada"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build <span class="comment">--symlink-install</span></span><br></pre></td></tr></tbody></table></figure> <strong>--symlink-install</strong>参数可以让python代码立即生效，而不需要重新build。 编译后会创建<strong>build</strong>，<strong>install</strong>，<strong>log</strong>文件夹，需要将<strong>install</strong>文件夹内的<strong>setup.zsh</strong>放到zshrc配置文件中，让工作空间全局生效。 <figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">│&nbsp;&nbsp; └── COLCON_IGNORE</span><br><span class="line">├── install</span><br><span class="line">│&nbsp;&nbsp; ├── COLCON_IGNORE</span><br><span class="line">│&nbsp;&nbsp; ├── local_setup<span class="selector-class">.bash</span></span><br><span class="line">│&nbsp;&nbsp; ├── local_setup<span class="selector-class">.ps1</span></span><br><span class="line">│&nbsp;&nbsp; ├── local_setup<span class="selector-class">.sh</span></span><br><span class="line">│&nbsp;&nbsp; ├── _local_setup_util_ps1<span class="selector-class">.py</span></span><br><span class="line">│&nbsp;&nbsp; ├── _local_setup_util_sh<span class="selector-class">.py</span></span><br><span class="line">│&nbsp;&nbsp; ├── local_setup<span class="selector-class">.zsh</span></span><br><span class="line">│&nbsp;&nbsp; ├── setup<span class="selector-class">.bash</span></span><br><span class="line">│&nbsp;&nbsp; ├── setup<span class="selector-class">.ps1</span></span><br><span class="line">│&nbsp;&nbsp; ├── setup<span class="selector-class">.sh</span></span><br><span class="line">│&nbsp;&nbsp; └── setup<span class="selector-class">.zsh</span></span><br><span class="line">├── log</span><br><span class="line">│&nbsp;&nbsp; ├── build_2023-<span class="number">12</span>-<span class="number">13</span>_15-<span class="number">55</span>-<span class="number">37</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; ├── events<span class="selector-class">.log</span></span><br><span class="line">│&nbsp;&nbsp; │&nbsp;&nbsp; └── logger_all<span class="selector-class">.log</span></span><br><span class="line">│&nbsp;&nbsp; ├── COLCON_IGNORE</span><br><span class="line">│&nbsp;&nbsp; ├── latest -&gt; latest_build</span><br><span class="line">│&nbsp;&nbsp; └── latest_build -&gt; build_2023-<span class="number">12</span>-<span class="number">13</span>_15-<span class="number">55</span>-<span class="number">37</span></span><br><span class="line">└── <span class="attribute">src</span></span><br></pre></td></tr></tbody></table></figure> <strong>注意：编译必须在工作空间的根目录进行。</strong> <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"source ros2_ws/install/setup.zsh"</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></tbody></table></figure> 有多个package的情况下，如果仅需要编译指定的package，则可以使用<strong>--packages-select</strong>参数指定。 <figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon <span class="keyword">build</span> --packages-<span class="keyword">select</span> my_py_pkg</span><br></pre></td></tr></tbody></table></figure> 编译成功后，会在工作空间<strong>install/lib</strong>文件夹下面生成对应package的可执行文件。具体目录在<strong>setup.cfg</strong>中配置。 编译成功后，需要重新source，以让新编译的内容生效。<p></p>
<h2 id="创建package">创建Package</h2>
<p>每一个package都是独立的单元，例如可以创建一个camera package，可以创建一个hardware control package, 可以创建一个motion planning package ### Python Package </p><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ros2_ws/<span class="attribute">src</span></span><br><span class="line">ros2 pkg create my_robot_controller <span class="attr">--build-type</span> ament_python <span class="attr">--dependencies</span> rclpy</span><br></pre></td></tr></tbody></table></figure> 可以在任意目录下创建package，但是为了代码便于管理，推荐在src目录下创建package。 <strong>build-type</strong>选项可以设置是package的编写语言，可以是python也可以是c++。 <strong>dependencies</strong>选项可以设置语言，对于python而言，是rclpy。 指令会创建一个名字为my_robot_controller的package，是一个单独的文件夹，文件结构如下所示： <figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">└── my_robot_controller</span><br><span class="line">    ├── my_robot_controller</span><br><span class="line">    │&nbsp;&nbsp; └── __init__<span class="selector-class">.py</span></span><br><span class="line">    ├── package<span class="selector-class">.xml</span></span><br><span class="line">    ├── resource</span><br><span class="line">    │&nbsp;&nbsp; └── my_robot_controller</span><br><span class="line">    ├── setup<span class="selector-class">.cfg</span></span><br><span class="line">    ├── setup<span class="selector-class">.py</span></span><br><span class="line">    └── test</span><br><span class="line">        ├── test_copyright<span class="selector-class">.py</span></span><br><span class="line">        ├── test_flake8<span class="selector-class">.py</span></span><br><span class="line">        └── test_pep257<span class="selector-class">.py</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> directories, <span class="number">8</span> files</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> 然后回到ros2_ws根目录，使用<strong>colcon build</strong>指令编译刚刚创建的package。 #### 创建节点 节点是机器人操作系统的最小运行单元，多个节点组成一张图，共同构成一个机器人操作系统。一个节点一般只用于完成一件事情。多个节点之间通过<strong>topic</strong>、<strong>service</strong>和<strong>parameters</strong>进行通信。 多节点架构降低了机器人操作系统的复杂度，便于开发和调试；提升了系统的鲁棒性，一个节点挂了不影响其他节点；节点可以使用python和C++编写。 节点命名不能冲突。 节点的源代码存在于package包的同名文件夹下面，例如对于<strong>my_robot_controller</strong>package而言，节点源码应该存在于<strong>my_robot_controller/my_robot_controller</strong>文件夹下面。 * 节点的源码文件是一个可执行文件 使用以下命令创建节点源码文件 <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> my_first_node.py</span><br><span class="line"><span class="built_in">chmod</span> +x my_first_node.py</span><br></pre></td></tr></tbody></table></figure><p></p>
<h5 id="import-rclpy">import rclpy</h5>
<p>使用python开发的ros节点需要使用<strong>rclpy</strong>(ROS Client Library for Python)。 </p><figure class="highlight elm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rclpy</span><br></pre></td></tr></tbody></table></figure> ##### 定义main函数 * main函数 <figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def main(<span class="attr">args=</span>None):</span><br><span class="line">    rclpy.init(<span class="attr">args=</span>args)</span><br><span class="line">    <span class="keyword">node</span> <span class="title">= MyNode</span>()</span><br><span class="line">    rclpy.spin(<span class="keyword">node</span><span class="title">=node</span>)</span><br><span class="line">    rclpy.shutdown()</span><br></pre></td></tr></tbody></table></figure> main函数开头用<strong>rclpy.init</strong>函数进行初始化，载入ros资源；结尾用<strong>rclpy.shutdown</strong>函数进行结束，释放ros资源。在init和shutdown中间，可以定义节点对象，并使用<strong>rclpy.spin</strong>函数保证节点一直运行。 * 入口 <figure class="highlight isbl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">if</span></span> <span class="variable">__name__</span> == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="function"><span class="title">main</span>()</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h5 id="继承node创建节点类">继承Node创建节点类</h5>
<p>节点类需要继承<strong>rclpy.node</strong>中的<strong>Node</strong>。 </p><figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from rclpy.node import <span class="keyword">Node</span></span><br><span class="line"><span class="title">class</span> MyNode(<span class="keyword">Node</span><span class="title">):</span></span><br><span class="line"><span class="title">    def</span> __init__(self):</span><br><span class="line">        super().__init__(<span class="string">"first_node"</span>)</span><br></pre></td></tr></tbody></table></figure> 在初始函数中对父类进行初始化，定义节点名称。<p></p>
<h5 id="安装node">安装node</h5>
<p>在包的<strong>setup.py</strong>中的<strong>entry_points</strong>安装node。 </p><figure class="highlight ebnf"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">entry_points</span>={</span><br><span class="line">    <span class="string">'console_scripts'</span>: [</span><br><span class="line">        <span class="string">"test_node = my_robot_controller.my_first_node:main"</span>,</span><br><span class="line">        <span class="string">"draw_circle = my_robot_controller.draw_circle:main"</span></span><br><span class="line">    ],</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure> 主要定义可执行文件的名称和代码执行路径。可执行文件名为使用ros命令运行的名称，节点名称在定义节点时指定。<p></p>
<h3 id="c-package">C++ Package</h3>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ros2_ws/<span class="attribute">src</span></span><br><span class="line">ros2 pkg create my_cpp_pkg <span class="attr">--build-type</span> ament_cmake <span class="attr">--dependencies</span> rclcpp</span><br></pre></td></tr></tbody></table></figure>
<p>通过<strong>pkg create</strong>指令创建包，参数中指定<strong>ament_cmake</strong>和<strong>rclcpp</strong>。</p>
<h4 id="include-rclcpp">include rclcpp</h4>
<figure class="highlight arduino"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/rclcpp.hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"rclcpp/executors.hpp"</span></span></span><br></pre></td></tr></tbody></table></figure>
<p>引入<strong>rclcpp.hpp</strong>就够了，但是使用<strong>rclcpp::spin</strong>时，vscode会提示在<strong>rclcpp</strong>命名空间中找不到<strong>spin</strong>，因此引入<strong>executors.hpp</strong>解决这个问题。</p>
<h4 id="定义main函数">定义main函数</h4>
<p>与python节点类似，需要在main函数中依次使用init、spin、shutdown函数来实现ros节点的初始化、运行和结束功能。 </p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    rclcpp::<span class="built_in">init</span>(argc, argv);</span><br><span class="line">    <span class="keyword">auto</span> node = std::<span class="built_in">make_shared</span>&lt;rclcpp::Node&gt;(<span class="string">"cpp_test"</span>);</span><br><span class="line">    <span class="built_in">RCLCPP_INFO</span>(node-&gt;<span class="built_in">get_logger</span>(), <span class="string">"Hello Cpp Node"</span>);</span><br><span class="line">    rclcpp::<span class="built_in">spin</span>(node);</span><br><span class="line">    rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> 打印日志使用了<strong>RCLCPP_INFO</strong>宏定义来实现，传入logger对象和日志内容字符串即可。 #### 继承Node创建节点类 <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> MyNode: public rclcpp::Node </span><br><span class="line">{</span><br><span class="line">    public:</span><br><span class="line">    <span class="constructor">MyNode()</span>: <span class="constructor">Node(<span class="string">"cpp_test"</span>)</span>, counter<span class="constructor">_(0)</span></span><br><span class="line">    {</span><br><span class="line">        <span class="constructor">RCLCPP_INFO(<span class="params">this</span> -&gt; <span class="params">get_logger</span>()</span>, <span class="string">"Hello Cpp Node"</span>);</span><br><span class="line">        timer_ = this -&gt; create<span class="constructor">_wall_timer(<span class="params">std</span>::<span class="params">chrono</span>::<span class="params">seconds</span>(1)</span>,</span><br><span class="line">                                           std::bind(&amp;MyNode::timeCallback, this));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    void time<span class="constructor">Callback()</span></span><br><span class="line">    {</span><br><span class="line">        counter_++;</span><br><span class="line">        <span class="constructor">RCLCPP_INFO(<span class="params">this</span> -&gt; <span class="params">get_logger</span>()</span>, <span class="string">"Hello Cpp %d"</span>, counter_);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    rclcpp::TimerBase::SharedPtr timer_;</span><br><span class="line">    <span class="built_in">int</span> counter_;</span><br><span class="line">};</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure> 需要public继承<strong>rclcpp::Node</strong>，在初始化函数中完成节点名称的定义。 #### CMake配置 在<strong>CMakeLists.txt</strong>中增加执行文件、依赖关系和安装路经的配置。 <figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">add_executable</span><span class="params">(cpp_node src/my_first_node.cpp)</span></span></span><br><span class="line"><span class="function"><span class="title">ament_target_dependencies</span><span class="params">(cpp_node rclcpp)</span></span></span><br><span class="line"><span class="function"><span class="title">install</span><span class="params">(TARGETS cpp_node DESTINATION lib/${PROJECT_NAME})</span></span></span><br></pre></td></tr></tbody></table></figure> #### VSCode配置AutoComplete 在VSCode中使用快捷键<strong>Ctrl+Shift+P</strong>打开命令索引框，输入<strong>c/c++</strong>，在候选中选择<strong>Edit Configuration JSON</strong>，然后将ros的include路径添加到<strong>includePath</strong>中，具体如下所示： <figure class="highlight prolog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="string">"configurations"</span>: [</span><br><span class="line">        {</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"Linux"</span>,</span><br><span class="line">            <span class="string">"includePath"</span>: [</span><br><span class="line">                <span class="string">"${workspaceFolder}/**"</span>,</span><br><span class="line">                <span class="string">"/usr/include/**"</span>,</span><br><span class="line">                <span class="string">"/usr/local/include/**"</span>,</span><br><span class="line">                <span class="string">"/opt/ros/humble/include/**"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"defines"</span>: [],</span><br><span class="line">            <span class="string">"compilerPath"</span>: <span class="string">"/usr/bin/gcc"</span>,</span><br><span class="line">            <span class="string">"cStandard"</span>: <span class="string">"c11"</span>,</span><br><span class="line">            <span class="string">"cppStandard"</span>: <span class="string">"c17"</span>,</span><br><span class="line">            <span class="string">"intelliSenseMode"</span>: <span class="string">"linux-gcc-x64"</span></span><br><span class="line">        }</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"version"</span>: <span class="number">4</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> 除了修改<strong>includePath</strong>，还需要添加<strong>cppStandard</strong>。 上述指令运行节点并且将节点重命名为<strong>abs</strong>.<p></p>
<h3 id="topic">Topic</h3>
<p><strong>Topic</strong>提供了节点之间的通信机制，由名称和消息类型共同定义。其内容由publisher发布，subscriber会对内容进行监听和消费。一个topic可有有多个publisher，也可以有多个subscriber。 #### 时间回调函数 时间回调函数一般用于周期性的完成工作。 ##### Python * 定义时间回调函数 </p><figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">timer_callback</span>(<span class="params"><span class="variable language_">self</span></span>):</span><br><span class="line">    pass</span><br></pre></td></tr></tbody></table></figure> * 注册时间回调函数 <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.create<span class="constructor">_timer(1.0, <span class="params">self</span>.<span class="params">timer_callback</span>)</span></span><br></pre></td></tr></tbody></table></figure> 一般在初始化函数中注册时间回调函数。时间回调函数的第一个参数是时间周期，第二个参数是调用的回调函数。<p></p>
<h5 id="c">C++</h5>
<ul>
<li>定义时间回调函数 <figure class="highlight lasso"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">void</span> publishNews() {</span><br><span class="line">    auto msg = example_interfaces<span class="type">::msg</span><span class="type">::String</span>();</span><br><span class="line">    msg.<span class="built_in">data</span> = std<span class="type">::string</span>(<span class="string">"Hi, this is "</span>) + robot_name_ +</span><br><span class="line">        std<span class="type">::string</span>(<span class="string">" from the Robot News Station"</span>);</span><br><span class="line">    publisher_-&gt;publish(msg);</span><br><span class="line">    counter_++;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li>注册时间回调函数 <figure class="highlight dts"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">rclcpp:</span>:TimerBase::SharedPtr timer_<span class="punctuation">;</span></span><br><span class="line">timer_ = this-&gt;create_wall_timer(</span><br><span class="line"><span class="symbol">    std:</span>:chrono::seconds(<span class="number">1</span>),</span><br><span class="line"><span class="symbol">    std:</span>:bind(<span class="variable">&amp;</span>RobotNewsStationNode::publishNews, this))<span class="punctuation">;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="publisher">publisher</h4>
<h5 id="python">Python</h5>
<ul>
<li>定义publisher 一般在节点的init函数中定义publisher。 <figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.cmd_vel_pub_ = <span class="variable language_">self</span>.create_publisher(<span class="title class_">Twist</span>, <span class="string">"/turtle1/cmd_vel"</span>, <span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure> 通过<strong>create_publisher</strong>函数定义publisher，需要传入一个消息类型，然后传入一个topic名字, 第三个参数代表消息的大小。 <strong>注意：引入新的包后，需要在package.xml中添加新的depend。</strong></li>
<li>周期性发送消息 周期性运行主要依赖时间回调函数实现，首先定义一个时间回调函数，然后在节点的init函数中注册时间回调函数，具体可参照上一章节。 在时间回调函数中，定义消息内容，并通过publisher发布消息。 <figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">def</span> send_velocity_command(self):</span><br><span class="line">    <span class="attribute">msg</span> = Twist()</span><br><span class="line">    <span class="attribute">msg</span>.linear.x = <span class="number">2</span>.<span class="number">0</span></span><br><span class="line">    <span class="attribute">msg</span>.angular.z = <span class="number">1</span>.<span class="number">0</span></span><br><span class="line">    <span class="attribute">self</span>.cmd_vel_pub_.publish(msg)</span><br></pre></td></tr></tbody></table></figure> 上述代码中定义了<strong>send_velocity_command</strong>回调函数。</li>
</ul>
<h5 id="c-1">C++</h5>
<ul>
<li>定义publisher <figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rclcpp::Publisher&lt;example_interfaces::msg::<span class="type">String</span>&gt;::SharedPtr publisher_;</span><br><span class="line">publisher_ = this<span class="punctuation">-&gt;</span>create_publisher&lt;example_interfaces::msg::<span class="type">String</span>&gt;(</span><br><span class="line">            <span class="string">"robot_news"</span>, <span class="number">10</span>);</span><br></pre></td></tr></tbody></table></figure> 声明时，在<strong>Publisher<template></template></strong>模板类中指明消息的类型，声明是一个SharedPtr类型的变量。 定义时，同样在模板函数中指明消息的数据类型，同时在构造函数中指明topic的名称。</li>
<li>周期性发送消息 #### subscriber 与publisher类似，同样在init函数中定义subscriber。 <figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.pose_subscriber_ = <span class="variable language_">self</span>.create_subscription(<span class="title class_">Pose</span>, <span class="string">"/turtle1/pose"</span>, <span class="variable language_">self</span>.pose_callback, <span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure> 使用<strong>create_subscription</strong>函数定义subscriber，需要传入topic的数据类型，topic的名称，回调函数，以及buffer大小。回调函数用于收到数据后的处理逻辑。</li>
</ul>
<h3 id="service">Service</h3>
<p><strong>service</strong>与<strong>topic</strong>的区别是，<strong>service</strong>类似于web服务，有server也有client，通过传入参数直接调用，而<strong>topic</strong>更像是消息广告板，有发布者也有订阅者。 <strong>service</strong>的server只有一个，而client可以有很多个。 <strong>topic</strong>主要用于节点之间发送数据，而不需要节点之间的response。如果需要response，则需要使用<strong>service</strong>。 频繁调用service会影响ros的整体性能。 #### Server ##### Python * 定义Server </p><figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.server_ = <span class="variable language_">self</span>.create_service(<span class="title class_">AddTwoInts</span>, <span class="string">"add_two_ints"</span>, <span class="variable language_">self</span>.add_two_ints_callback)</span><br></pre></td></tr></tbody></table></figure> 使用<strong>create_service</strong>函数创建server，需要传入三个参数。第一个参数是Service的数据类型，该数据类型定义了Request和Response的数据结构；第二个参数为Service的名称，唯一的ID；第三个参数为Server的回调函数，用于实现业务逻辑。 * 定义Callback <figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">add_two_ints_callback</span>(<span class="params">self, request, response</span>):</span><br><span class="line">    response.<span class="built_in">sum</span> = request.a + request.b</span><br><span class="line">    self.get_logger().info(<span class="built_in">str</span>(request.a) + <span class="string">"+"</span> + <span class="built_in">str</span>(request.b) + <span class="string">"="</span> + <span class="built_in">str</span>(response.<span class="built_in">sum</span>))</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></tbody></table></figure> 回调函数需要传入两个参数，一个是<strong>request</strong>入参，另外一个是<strong>response</strong>出参。 ##### C++ * 定义Server <figure class="highlight zephir"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rclcpp::Service&lt;example_interfaces::srv::AddTwoInts&gt;::SharedPtr server_;</span><br><span class="line">server_ = this-&gt;create_service&lt;example_interfaces::srv::AddTwoInts&gt;(<span class="string">"add_two_ints"</span>, std::bind(&amp;AddTwoIntsServerNode::callbackAddTwoInts, this, std::placeholders::_1, std::placeholders::_2));</span><br></pre></td></tr></tbody></table></figure> 使用<strong>create_service</strong>函数创建Service的Server，需要指定数据类型，且传入两个参数，一个是Service的名称，这是一个唯一的标识，在client中也需要用到；另外一个是回调函数。 * 定义Callback <figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void <span class="title function_ invoke__">callbackAddTwoInts</span>(<span class="keyword">const</span> example_interfaces::srv::AddTwoInts::Request::SharedPtr request,</span><br><span class="line">    <span class="keyword">const</span> example_interfaces::srv::AddTwoInts::Response::SharedPtr response)</span><br><span class="line">{</span><br><span class="line">    response<span class="punctuation">-&gt;</span>sum = request<span class="punctuation">-&gt;</span>a + request<span class="punctuation">-&gt;</span>b;</span><br><span class="line">    <span class="title function_ invoke__">RCLCPP_INFO</span>(this<span class="punctuation">-&gt;</span><span class="title function_ invoke__">get_logger</span>(), <span class="string">"%ld+%ld=%ld"</span>, request<span class="punctuation">-&gt;</span>a, request<span class="punctuation">-&gt;</span>b, response<span class="punctuation">-&gt;</span>sum);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> Server的回调函数返回值类型为<strong>void</strong>，且有两个入参，一个为<strong>Request</strong>，另外一个为<strong>Response</strong>，类型均为<strong>const SharePtr</strong>. #### Client ##### Python * 定义Client <figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">client</span> = self.create_client(AddTwoInts, <span class="string">"add_two_ints"</span>)</span><br></pre></td></tr></tbody></table></figure> 使用<strong>create_client</strong>函数创建client，需要传入两个参数。第一个是Service的数据类型，第二个是Service的名称。 * 等待Server Ready <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> not client.wait<span class="constructor">_for_service(1.0)</span>:</span><br><span class="line">    node.get<span class="constructor">_logger()</span>.warn(<span class="string">"Waiting for server AddTwoInts."</span>)</span><br></pre></td></tr></tbody></table></figure> <strong>wait_for_service</strong>如果成功则返回true，否则则返回false；传入的参数为等待时间，不传入则永远等待。 * 请求Server <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">request = AddTwoInts.<span class="constructor">Request()</span></span><br><span class="line">request.a = <span class="number">45</span></span><br><span class="line">request.b = <span class="number">67</span></span><br><span class="line"></span><br><span class="line">future = client.call<span class="constructor">_async(<span class="params">request</span>=<span class="params">request</span>)</span></span><br><span class="line">rclpy.spin<span class="constructor">_until_future_complete(<span class="params">node</span>=<span class="params">node</span>, <span class="params">future</span>=<span class="params">future</span>)</span></span><br></pre></td></tr></tbody></table></figure> 使用数据类型的<strong>Request</strong>部分创建request。<strong>call_async</strong>可以实现异步调用，返回一个future对象。<strong>spin_until_feature_complete</strong>可以等待直到请求返回，需要传入两个参数，一个是节点对象，另外一个是异步调用的future对象。 <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request = AddTwoInts.<span class="constructor">Request()</span></span><br><span class="line">request.a = a</span><br><span class="line">request.b = b</span><br><span class="line">future = self.client_.call<span class="constructor">_async(<span class="params">request</span>=<span class="params">request</span>)</span></span><br><span class="line">future.add<span class="constructor">_done_callback(<span class="params">partial</span>(<span class="params">self</span>.<span class="params">add_two_ints_callback</span>, <span class="params">a</span>=<span class="params">a</span>, <span class="params">b</span>=<span class="params">b</span>)</span>)</span><br></pre></td></tr></tbody></table></figure> <strong>spin_until_feature_complete</strong>适用于在main函数中直接定义client时使用，如果是在class中定义client，则需要使用future的<strong>add_done_callback</strong>函数，在异步请求server完成后，调用回调函数。<strong>partial</strong>类可以在传入回调函数的时候，传入其他参数。 * 处理Response <figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    response = future.<span class="built_in">result</span>()</span><br><span class="line">    node.<span class="built_in">get_logger</span>().<span class="built_in">info</span>(<span class="built_in">str</span>(request.a) + <span class="string">"+"</span> + <span class="built_in">str</span>(request.b) + <span class="string">"="</span> + <span class="built_in">str</span>(response.sum))</span><br><span class="line">except Exception as e:</span><br><span class="line">    node.<span class="built_in">get_logger</span>().<span class="built_in">error</span>(<span class="string">"Service call failed %r"</span> % (e,))</span><br></pre></td></tr></tbody></table></figure> 需要使用try-except结构处理返回的response。 ##### C++ * 定义Client <figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto client = <span class="keyword">node</span><span class="title">-&gt;create_client</span><span class="tag">&lt;example_interfaces::srv::AddTwoInts&gt;</span>(<span class="string">"add_two_ints"</span>);</span><br></pre></td></tr></tbody></table></figure> 使用<strong>create_client</strong>函数定义client，需要指定数据类型，仅需要传入一个参数，即Service的名字。client根据名字与server进行通信。 * 等待Server Ready <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!client-&gt;wait<span class="constructor">_for_service(<span class="params">std</span>::<span class="params">chrono</span>::<span class="params">seconds</span>(1)</span>))</span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_WARN(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"Waiting for server to be ready..."</span>);</span><br><span class="line">}</span><br><span class="line"><span class="constructor">RCLCPP_INFO(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"AddTwoInts server is ready."</span>);</span><br></pre></td></tr></tbody></table></figure> 使用<strong>wait_for_service</strong>函数等待server ready。与python接口类似，当server ready时，<strong>wait_for_service</strong>函数返回true，否则返回false；入参为等待时间。 * 请求Server <figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auto request = std::make_shared&lt;example_interfaces::srv::AddTwoInts::Request&gt;();</span><br><span class="line">request<span class="punctuation">-&gt;</span>a = <span class="number">34</span>;</span><br><span class="line">request<span class="punctuation">-&gt;</span>b = <span class="number">56</span>;</span><br><span class="line">auto future = client<span class="punctuation">-&gt;</span><span class="title function_ invoke__">async_send_request</span>(request);</span><br></pre></td></tr></tbody></table></figure> 使用异步接口发送请求，入参为<strong>request</strong>，返回值为<strong>future</strong>。 * 处理Response <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(rclcpp::spin<span class="constructor">_until_future_complete(<span class="params">node</span>, <span class="params">future</span>)</span><span class="operator"> == </span>rclcpp::FutureReturnCode::SUCCESS)</span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_INFO(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"%ld+%ld=%ld"</span>, request-&gt;a, request-&gt;b, future.get<span class="literal">()</span>-&gt;sum);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_ERROR(<span class="params">node</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"Error while calling add_two_ints service"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> 使用<strong>spin_until_future_complete</strong>函数等待future完成，并校验完成状态。状态为成功，则处理返回值；失败，则打印失败信息。 上述方法是使用<strong>no_oop</strong>的方法实现，直接在main函数中利用ros提供的<strong>spin_until_future_complete</strong>接口实现异步请求的阻塞。对于<strong>oop</strong>的方式，在类中无法使用上述接口，需要直接使用<strong>future.get</strong>接口实现阻塞，为了能保证初始化函数完成，需要将请求放在多线程中实现。 <figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;std::thread&gt; threads_;</span><br><span class="line">threads_.push<span class="constructor">_back(<span class="params">std</span>::<span class="params">thread</span>(<span class="params">std</span>::<span class="params">bind</span>(&amp;AddTwoIntsClientNode::<span class="params">callAddTwoIntsService</span>, <span class="params">this</span>, 89, 12)</span>));</span><br><span class="line"><span class="comment">// parse response</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">{</span><br><span class="line">    auto response = future.get<span class="literal">()</span>;</span><br><span class="line">    <span class="constructor">RCLCPP_INFO(<span class="params">this</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"%d+%d=%ld"</span>, a, b, response-&gt;sum);</span><br><span class="line">}</span><br><span class="line">catch(const std::<span class="keyword">exception</span>&amp; e)</span><br><span class="line">{</span><br><span class="line">    <span class="constructor">RCLCPP_ERROR(<span class="params">this</span>-&gt;<span class="params">get_logger</span>()</span>, <span class="string">"Service call failed: %s"</span>, e.what<span class="literal">()</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure> ### Interfaces 在<strong>topic</strong>和<strong>service</strong>中均须提供消息类型，在ros中这部分统一放在<strong>interfaces</strong>中。 #### Common Interfaces 为了便于开发和使用，<strong>ROS</strong>针对机器人领域常用的功能，提供了一份官方的<strong>msg</strong>和<strong>srv</strong>，统一放在<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces">common interfaces</a> * geometry_msgs 定义了几何本原相关的消息类型，例如点、向量、姿态等。具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/geometry_msgs">https://github.com/ros2/common_interfaces/tree/rolling/geometry_msgs</a> * nav_msgs 定义了机器人导航相关的消息和服务类型，例如地图、里程计和轨迹等。具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/nav_msgs">https://github.com/ros2/common_interfaces/tree/rolling/nav_msgs</a> * sensor_msgs 定义了与传感器设备相关的消息和服务类型，例如图像、IMU、点云、手柄等。具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/sensor_msgs">https://github.com/ros2/common_interfaces/tree/rolling/sensor_msgs</a> * shape_msgs 定义了三维形状，例如平面、刚体等。具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/shape_msgs">https://github.com/ros2/common_interfaces/tree/rolling/shape_msgs</a> * std_msgs 定义了基础数据类型的消息，例如bool、string、int、float等。具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/std_msgs">https://github.com/ros2/common_interfaces/tree/rolling/std_msgs</a> * std_srvs 定义了基础数据类型的服务，例如bool、string、int、float等。具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/std_srvs">https://github.com/ros2/common_interfaces/tree/rolling/std_srvs</a> * stereo_msgs 定义了视差图像相关的消息，具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/stereo_msgs">https://github.com/ros2/common_interfaces/tree/rolling/stereo_msgs</a> * trajectory_msgs 定义了机器人关节轨迹相关的消息，具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/trajectory_msgs">https://github.com/ros2/common_interfaces/tree/rolling/trajectory_msgs</a> * visualization_msgs 定义了3D可视化相关的消息和服务类型，例如在rviz中使用的。具体见：<a target="_blank" rel="noopener" href="https://github.com/ros2/common_interfaces/tree/rolling/visualization_msgs">https://github.com/ros2/common_interfaces/tree/rolling/visualization_msgs</a><p></p>
<h4 id="custom-interfaces">Custom Interfaces</h4>
<p>除了<strong>ROS</strong>提供的消息和服务类型，我们还可以自己定义消息和服务类型。 ##### Create Interface Package 自定义<strong>interfaces</strong>一般统一放在一个package中，因此需要创建一个package。 </p><figure class="highlight gauss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 pkg <span class="keyword">create</span> my_robot_interfaces</span><br></pre></td></tr></tbody></table></figure> <strong>interfaces</strong>的包不需要指定<strong>build-type</strong>和<strong>dependencies</strong>参数。默认创建的是一个cpp语言的包，但是<strong>interfaces</strong>不需要<strong>include</strong>和<strong>src</strong>文件夹，因此用以下指令删除。 <figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> my_robot_interfaces</span><br><span class="line"><span class="keyword">rm</span> -rf <span class="keyword">include</span></span><br><span class="line"><span class="keyword">rm</span> -rf src</span><br></pre></td></tr></tbody></table></figure> <strong>interfaces</strong>一般包括支持<strong>topic</strong>的消息和支持<strong>service</strong>的服务，因此分别创建两个文件夹。 <figure class="highlight arduino"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir msg</span><br><span class="line">mkdir srv</span><br></pre></td></tr></tbody></table></figure> ##### Setup Configuration * package.xml <strong>interfaces</strong>的包与其他包的配置不一样，需要单独配置。首先在<strong>package.xml</strong>中添加以下配置： <figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>rosidl_default_generators<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>rosidl_default_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">member_of_group</span>&gt;</span>rosidl_interface_packages<span class="tag">&lt;/<span class="name">member_of_group</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> * CMakeLists.txt <figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">find_package</span><span class="params">(rosidl_default_generators REQUIRED)</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rosidl_generate_interfaces</span>(${PROJECT_NAME}</span><br><span class="line">  <span class="string">"msg/HardwareStatus.msg"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">ament_export_dependencies</span><span class="params">(rosidl_default_runtime)</span></span></span><br></pre></td></tr></tbody></table></figure> ##### topic消息 一个topic消息为一个后缀为<strong>msg</strong>的文件，统一放在<strong>msg/</strong>文件夹下面。 <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> msg</span><br><span class="line">create HardwareStatus.msg</span><br></pre></td></tr></tbody></table></figure> 创建文件之后，在<strong>CMakeLists.txt</strong>中的<strong>rosidl_generate_interfaces</strong>添加文件路径。 使用基础类型定义消息，如下所示： <figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int64</span> temperature</span><br><span class="line"><span class="built_in">bool</span> are_motors_ready</span><br><span class="line"><span class="built_in">string</span> debug_message</span><br></pre></td></tr></tbody></table></figure> 以上消息定义了三个变量，分别为int64类型的temperature，bool类型的are_motors_ready和string类型的debug_message ##### 编译 使用以下指令编译interfaces包。 <figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon <span class="keyword">build</span> --packages-<span class="keyword">select</span> my_robot_interfaces </span><br></pre></td></tr></tbody></table></figure> 编译完需要source一下。 ##### 使用 根其他包一样，编译好的包会统一放在工作空间的<strong>install</strong>文件夹下面。 使用方法根使用ros提供的common interfaces一样，但是需要在vscode中配置auto complete的支持。 * python auto complete 在<strong>setting.json</strong>中的<strong>python.autoComplete.extraPaths</strong>和<strong>python.analysis.extraPaths</strong>配置中将编译好的路径添加进去，如下所示 <figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"/home/robot/ros2_ws/install/my_robot_interfaces/local/lib/python3.10/dist-packages"</span></span><br></pre></td></tr></tbody></table></figure> * cpp auto complete 在<strong>c_cpp_properties.json</strong>中将编译好的<strong>interfaces</strong>包路径添加进去。 <figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"/home/robot/ros2_ws/install/my_robot_interfaces/include/**"</span></span><br></pre></td></tr></tbody></table></figure> ##### service服务 一个Service服务为一个后缀为<strong>srv</strong>的文件，统一放在<strong>srv/</strong>文件夹下面。<p></p>
<h3 id="parameters">Parameters</h3>
<p><strong>Parameters</strong>模块可以在节点运行时提供参数配置。 #### Declare Parameters * Python </p><figure class="highlight lasso"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">self</span>.declare_parameter(<span class="string">"test123"</span>, <span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure> <strong>declare_parameter</strong>的python接口需要传入两个参数，一个是parameter的名称，另外一个是parameter的默认值。 * C++ <figure class="highlight lisp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this-&gt;declare_parameter(<span class="string">"test123"</span>, rclcpp:<span class="symbol">:ParameterType</span>:<span class="symbol">:PARAMETER_STRING</span>)<span class="comment">;</span></span><br></pre></td></tr></tbody></table></figure> <strong>declare_parameter</strong>的C++接口调用方式多样，除了parameter名称，还可以指定参数的类型。 #### Use Parameters * Python <figure class="highlight ruby"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.number_ = <span class="variable language_">self</span>.get_parameter(<span class="string">"number_to_publish"</span>).value</span><br></pre></td></tr></tbody></table></figure> <strong>get_parameter</strong>接口可以获取声明好的参数，用*value<strong>取出对应的值。 * C++ <figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">number_</span> = this-&gt;get_parameter(<span class="string">"number_to_publish"</span>).as_int()<span class="comment">;</span></span><br></pre></td></tr></tbody></table></figure> </strong>get_parameter**接口需要显示返回指定类型的数据。<p></p>
<h3 id="launch-file">Launch File</h3>
<p><strong>Launch File</strong>用于配置多个节点的运行信息，可以很方便的管理每个节点的的名称、入参等信息。 #### Create Launch Package 跟<strong>interfaces</strong>类似，<strong>launch file</strong>也单独放在一个package中进行管理。因此，首先使用以下命令创建package。 </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/ros2_ws/src</span><br><span class="line">ros2 pkg create my_robot_bringup</span><br></pre></td></tr></tbody></table></figure> 创建package不需要指定<strong>build-type</strong>和<strong>dependencies</strong>。默认创建的package文件夹是cpp结构的，将不需要的文件夹删除。 <figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rm</span> -rf <span class="keyword">include</span></span><br><span class="line"><span class="keyword">rm</span> -rf src</span><br></pre></td></tr></tbody></table></figure> 创建<strong>launch</strong>文件夹 <figure class="highlight applescript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="built_in">launch</span></span><br></pre></td></tr></tbody></table></figure> 在<strong>CMakeLists.txt</strong>中配置编译后的安装目录。 <figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(DIRECTORY</span><br><span class="line">  launch</span><br><span class="line">  DESTINATION share/<span class="variable">${PROJECT_NAME}</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure> 上述配置将在/home/robot/ros2_ws/install/my_robot_bringup/share/my_robot_bringup/文件夹下面创建<strong>launch</strong>文件夹，所有的launch file都在这个文件夹中。<p></p>
<h4 id="create-launch-file">Create Launch File</h4>
<p>在<strong>launch</strong>文件夹下面，创建后缀为.launch.py的文件，并使其变成可执行文件。 </p><figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch number_app<span class="selector-class">.launch</span><span class="selector-class">.py</span></span><br><span class="line">chmod +x number_app<span class="selector-class">.launch</span><span class="selector-class">.py</span></span><br><span class="line"><span class="selector-tag">code</span> number_app<span class="selector-class">.launch</span>.py</span><br></pre></td></tr></tbody></table></figure> <strong>launch file</strong>为一个特殊的python文件，具体如下所示： <figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> launch import LaunchDescription</span><br><span class="line"><span class="keyword">from</span> launch_ros.actions import Node</span><br><span class="line"></span><br><span class="line">def generate_launch_description():</span><br><span class="line">    ld = LaunchDescription()</span><br><span class="line">    remap_number_topic = (<span class="string">"number"</span>, <span class="string">"my_number"</span>)</span><br><span class="line">    number_publisher_node = Node(</span><br><span class="line">        <span class="attribute">package</span>=<span class="string">"test_py_pkg"</span>,</span><br><span class="line">        <span class="attribute">executable</span>=<span class="string">"number_publisher"</span>,</span><br><span class="line">        <span class="attribute">name</span>=<span class="string">"my_number_publisher"</span>,</span><br><span class="line">        remappings=[</span><br><span class="line">            remap_number_topic</span><br><span class="line">        ],</span><br><span class="line">        parameters=[</span><br><span class="line">            {<span class="string">"number_to_publish"</span>: 4}</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">    number_counter_node = Node(</span><br><span class="line">        <span class="attribute">package</span>=<span class="string">"test_cpp_pkg"</span>,</span><br><span class="line">        <span class="attribute">executable</span>=<span class="string">"number_counter"</span>,</span><br><span class="line">        <span class="attribute">name</span>=<span class="string">"my_number_counter"</span>,</span><br><span class="line">        remappings=[</span><br><span class="line">            remap_number_topic,</span><br><span class="line">            (<span class="string">"number_count"</span>, <span class="string">"my_number_count"</span>)</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ld.add_action(number_publisher_node)</span><br><span class="line">    ld.add_action(number_counter_node)</span><br><span class="line">    return ld</span><br></pre></td></tr></tbody></table></figure> 从<strong>launch</strong>中引入<strong>LaunchDescription</strong>，从<strong>launch_ros.actions</strong>中引入<strong>Node</strong>。在python文件中创建固定名为<strong>generate_launch_description</strong>的函数，所有的launch description都在该函数中。 使用<strong>Node</strong>创建启动节点的配置，具体具体如下所示。 <figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">number_publisher_node = Node(</span><br><span class="line">    <span class="attribute">package</span>=<span class="string">"test_py_pkg"</span>,</span><br><span class="line">    <span class="attribute">executable</span>=<span class="string">"number_publisher"</span>,</span><br><span class="line">    <span class="attribute">name</span>=<span class="string">"my_number_publisher"</span>,</span><br><span class="line">    remappings=[</span><br><span class="line">        remap_number_topic</span><br><span class="line">    ],</span><br><span class="line">    parameters=[</span><br><span class="line">        {<span class="string">"number_to_publish"</span>: 4}</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure> <strong>package</strong>参数指定运行节点的包名称； <strong>executable</strong>指定节点的可执行文件名称； <strong>name</strong>指定节点的名称，不提供该参数，则使用节点的默认名；提供该参数，则等同于使用remap参数重命名节点名称； <strong>remappings</strong>对topic名称进行重命名，通过tuple进行remap，例如("old_name", "new_name")； <strong>parameters</strong>对节点内定义的parameters进行赋值，传入的是一个map，key是parameters的名称，value是parameter值。<p></p>
<p>创建完节点的launch description之后，需要在<strong>package.xml</strong>中添加依赖，具体如下所示： </p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>test_py_pkg<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>test_cpp_pkg<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure> 因为是运行节点的配置，所以添加<strong>exec_depend</strong>即可。<p></p>
<h4 id="编译launch-file">编译launch file</h4>
<p>使用<strong>colcon build</strong>命令编译包 </p><figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon <span class="keyword">build</span> --packages-<span class="keyword">select</span> my_robot_bringup</span><br></pre></td></tr></tbody></table></figure> 编译并source配置之后，即可使用命令行运行。 <figure class="highlight applescript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="built_in">launch</span> my_robot_bringup number_app.<span class="built_in">launch</span>.py</span><br></pre></td></tr></tbody></table></figure> ### Data Bag <strong>bag</strong>命令用于记录ros的topic数据。 <figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 bag record <span class="selector-attr">[topic_name1]</span> <span class="selector-attr">[topic_name2]</span> <span class="attr">--output</span> <span class="selector-attr">[record name]</span></span><br></pre></td></tr></tbody></table></figure> 上述指令用于记录指定<strong>topics</strong>的数据，并将其记录在指定文件夹中。<p></p>
<figure class="highlight pgsql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 bag <span class="keyword">info</span> [<span class="type">record</span> <span class="type">name</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>上述指令用于查看记录的<strong>record</strong>信息。</p>
<figure class="highlight delphi"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 bag play [<span class="keyword">record</span> <span class="keyword">name</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>上述指令用于重新播放<strong>record</strong>的数据。</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 bag record <span class="attr">--all</span> <span class="attr">--output</span> <span class="selector-attr">[record name]</span></span><br></pre></td></tr></tbody></table></figure>
<p>上述指令用于记录所有的<strong>topic</strong>数据。</p>
<h3 id="函数接口">函数接口</h3>
<h4 id="日志接口">日志接口</h4>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.get_logger().<span class="built_in">info</span>(<span class="string">"Hello World"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="基本指令">基本指令</h2>
<h3 id="运行节点">运行节点</h3>
<figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 run [package name] [<span class="keyword">node</span> <span class="title">name</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>示例： </p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> demo_nodes_cpp talker</span><br></pre></td></tr></tbody></table></figure> 上述指令会运行<strong>demo_nodes_cpp</strong>包下面的<strong>talker</strong>节点。<p></p>
<figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="keyword">run</span> my_cpp_pkg cpp_node --ros-<span class="keyword">args</span> --<span class="keyword">remap</span> __node:=abs</span><br></pre></td></tr></tbody></table></figure>
<p>上述指令运行节点并且将节点重命名为<strong>abs</strong>.</p>
<figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="keyword">run</span> my_cpp_pkg robot_news_station --ros-<span class="keyword">args</span> --<span class="keyword">remap</span> __node:=my_station --<span class="keyword">remap</span> robot_news:=my_news</span><br><span class="line">ros2 <span class="keyword">run</span> my_cpp_pkg smartphone --ros-<span class="keyword">args</span> -<span class="keyword">remap</span> robot_news:=my_news</span><br></pre></td></tr></tbody></table></figure>
<p><strong>remap</strong>指令除了可以将节点重命名，还可以将topic命名。</p>
<h3 id="查看节点graph">查看节点graph</h3>
<figure class="highlight ebnf"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rqt_graph</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以以graph的形式中展示了所有运行的节点，以及节点之间的关系。 <strong>注意：rqt_graph不能查看Services</strong> ### 查看节点 * 列举正在运行的所有node </p><figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="keyword">node</span> <span class="title">list</span></span><br></pre></td></tr></tbody></table></figure> * 查看指定node的信息 <figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="keyword">node</span> <span class="title">info</span> [<span class="keyword">node</span> <span class="title">name</span>]</span><br></pre></td></tr></tbody></table></figure> ### 查看服务 * 列举正在运行的所有服务 <figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 service <span class="type">list</span></span><br></pre></td></tr></tbody></table></figure> * 查看指定service的类型信息 <figure class="highlight ada"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 service <span class="keyword">type</span> <span class="type">[<span class="keyword">type</span> </span>name]</span><br></pre></td></tr></tbody></table></figure> * 调用指定的service <figure class="highlight pgsql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 service <span class="keyword">call</span> [<span class="keyword">type</span> <span class="type">name</span>] [<span class="keyword">type</span>] [<span class="keyword">values</span>]</span><br><span class="line">ros2 service <span class="keyword">call</span> /add_two_ints example_interfaces/srv/AddTwoInts "{'a':1, 'b':2}"</span><br></pre></td></tr></tbody></table></figure> 传入的values是json格式的数据。<p></p>
<h3 id="turtlesim-package">turtlesim package</h3>
<p>运行turtlesim 仿真环境 </p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> turtlesim turtlesim_node</span><br></pre></td></tr></tbody></table></figure> 运行键盘控制节点 <figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="built_in">run</span> turtlesim turtle_teleop_key</span><br></pre></td></tr></tbody></table></figure> ### 查看topic <strong>topic</strong>用于ros节点之间通信，<strong>publisher</strong>向<strong>topic</strong>发送信息，<strong>subscriber</strong>从<strong>topic</strong>接收信息。<strong>topic</strong>保证了ros节点之间是独立运行的。<p></p>
<p><strong>topic</strong>一般由三部分组成：topic类型、发布者、监听者。</p>
<p><strong>topic</strong>是匿名的，<strong>subscriber</strong>可以通过名字订阅<strong>topic</strong>，但是并不知道是哪个<strong>publisher</strong>发布的。 </p><figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 topic <span class="type">list</span></span><br></pre></td></tr></tbody></table></figure> 上述指令可以列举正在运行的topic。 <figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 topic <span class="built_in">info</span> [topic name]</span><br><span class="line">ros2 topic <span class="built_in">info</span> /chatter</span><br></pre></td></tr></tbody></table></figure> 上述指令查看指定topic的详细信息，包括topic的数据类型，publisher的数量和subscriber的数量。 <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 topic <span class="built_in">echo</span> [topic name]</span><br><span class="line">ros2 topic <span class="built_in">echo</span> /chatter</span><br></pre></td></tr></tbody></table></figure> 上述指令可以打印指定topic的内容。 <figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 topic hz [topic name]</span><br><span class="line">ros2 topic hz <span class="regexp">/turtle1/</span>pose</span><br></pre></td></tr></tbody></table></figure> 上述指令可以监听指定topic的周期。 <figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 topic bw [topic name]</span><br><span class="line">ros2 topic bw <span class="regexp">/turtle1/</span>pose</span><br></pre></td></tr></tbody></table></figure> 上述指令可以监听指定topic的消息的带宽。 <figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 topic pub -r <span class="number">10</span> <span class="regexp">/robot_news  example_interfaces/m</span>sg/String <span class="string">"{data: 'This is a test.'}"</span></span><br><span class="line">ros2 topic pub <span class="regexp">/cmd_vel geometry_msgs/m</span>sg/Twist <span class="string">"{linear: {x: 0.1, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 1.0}}"</span></span><br></pre></td></tr></tbody></table></figure> 上述指令可以向指定topic发送消息。<p></p>
<h3 id="查看接口定义">查看接口定义</h3>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="keyword">interface</span> <span class="symbol">show</span> [<span class="symbol">Object</span>]</span><br><span class="line"><span class="symbol">ros2</span> <span class="symbol">interface</span> <span class="symbol">show</span> <span class="symbol">std_msgs</span>/<span class="symbol">msg</span>/<span class="symbol">String</span></span><br></pre></td></tr></tbody></table></figure>
<p>使用上述指令可以查看制定内容的接口信息。例如可以查看数据类型的详细定义。</p>
<figure class="highlight angelscript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="keyword">interface</span> <span class="symbol">list</span></span><br></pre></td></tr></tbody></table></figure>
<p>展示所有的<strong>msg</strong>和<strong>srv</strong>，包括ros官方定义的和自定义的。</p>
<figure class="highlight ada"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="keyword">interface</span> <span class="keyword">package</span> <span class="title">geometry_msgs</span></span><br></pre></td></tr></tbody></table></figure>
<p>展示指定package下面的所有<strong>msg</strong>和<strong>srv</strong>。</p>
<h3 id="parameter">Parameter</h3>
<ul>
<li>查看节点的所有参数 <figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="built_in">param</span> list</span><br></pre></td></tr></tbody></table></figure> 可以列举所有节点的所有参数。</li>
<li>查看指定节点指定参数的值 <figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 <span class="built_in">param</span> <span class="built_in">get</span> [node_name] [param_name]</span><br><span class="line">ros2 <span class="built_in">param</span> <span class="built_in">get</span> /number_publisher test123</span><br></pre></td></tr></tbody></table></figure></li>
<li>运行节点，提供参数值 <figure class="highlight dsconfig"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ros2</span> <span class="string">run</span> <span class="string">test_cpp_pkg</span>  <span class="string">number_publisher</span> <span class="built_in">--ros-args</span> <span class="built_in">--param</span> <span class="string">test123</span>:=<span class="string">"Hello"</span></span><br><span class="line"><span class="string">ros2</span> <span class="string">run</span> <span class="string">my_cpp_pkg</span> <span class="string">led_panel</span> <span class="built_in">--ros-args</span> <span class="built_in">--param</span> <span class="string">led_states</span>:=<span class="string">"[3,4,5]"</span></span><br></pre></td></tr></tbody></table></figure> 第一条指令传入了“Hello”字符串给<strong>test123</strong>，第二条指令传入了{3,4,5}的int类型的array给<strong>led_states</strong>。</li>
</ul>
</body></html>
    </div>

    
    
    
        <div class="reward-container">
  <div>Please buy me a cup of coffee if this article helps you.</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="Dr. Zhao WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Dr. Zhao Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Dr. Zhao
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="http://blog.zhaoyongsheng.com/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/" title="ROS2 Learning Notes - ROS2 Humble For Beginners">http://blog.zhaoyongsheng.com/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/ROS/" rel="tag"><i class="fa fa-tag"></i> ROS</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/05/08/Using-scipy-in-Django/" rel="prev" title="Using scipy and numpy in Django">
      <i class="fa fa-chevron-left"></i> Using scipy and numpy in Django
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/12/24/ROS2-Learning-Notes-RViz-Gazebo/" rel="next" title="ROS2 Learning Notes RViz & Gazebo">
      ROS2 Learning Notes RViz & Gazebo <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="comments"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BApackage"><span class="nav-number">1.</span> <span class="nav-text">创建Package</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#import-rclpy"><span class="nav-number">1.0.0.1.</span> <span class="nav-text">import rclpy</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%A7%E6%89%BFnode%E5%88%9B%E5%BB%BA%E8%8A%82%E7%82%B9%E7%B1%BB"><span class="nav-number">1.0.0.2.</span> <span class="nav-text">继承Node创建节点类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85node"><span class="nav-number">1.0.0.3.</span> <span class="nav-text">安装node</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-package"><span class="nav-number">1.1.</span> <span class="nav-text">C++ Package</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#include-rclcpp"><span class="nav-number">1.1.1.</span> <span class="nav-text">include rclcpp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89main%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.2.</span> <span class="nav-text">定义main函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#topic"><span class="nav-number">1.2.</span> <span class="nav-text">Topic</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#c"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">C++</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#publisher"><span class="nav-number">1.2.1.</span> <span class="nav-text">publisher</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#python"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">Python</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#c-1"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">C++</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#service"><span class="nav-number">1.3.</span> <span class="nav-text">Service</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#custom-interfaces"><span class="nav-number">1.3.1.</span> <span class="nav-text">Custom Interfaces</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#parameters"><span class="nav-number">1.4.</span> <span class="nav-text">Parameters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#launch-file"><span class="nav-number">1.5.</span> <span class="nav-text">Launch File</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#create-launch-file"><span class="nav-number">1.5.1.</span> <span class="nav-text">Create Launch File</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91launch-file"><span class="nav-number">1.5.2.</span> <span class="nav-text">编译launch file</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.6.</span> <span class="nav-text">函数接口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.6.1.</span> <span class="nav-text">日志接口</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">基本指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E8%8A%82%E7%82%B9"><span class="nav-number">2.1.</span> <span class="nav-text">运行节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9graph"><span class="nav-number">2.2.</span> <span class="nav-text">查看节点graph</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#turtlesim-package"><span class="nav-number">2.3.</span> <span class="nav-text">turtlesim package</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89"><span class="nav-number">2.4.</span> <span class="nav-text">查看接口定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#parameter"><span class="nav-number">2.5.</span> <span class="nav-text">Parameter</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Dr. Zhao"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Dr. Zhao</p>
  <div class="site-description" itemprop="description">A technical blog for sharing articles related to Computer Vision, Robotics & Deep Learning.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">76</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/YoungsonZhao" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;YoungsonZhao" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhaoyongsheng@zju.edu.cn" title="E-Mail → mailto:zhaoyongsheng@zju.edu.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.linkedin.com/in/yongshengzhao" title="Linkedin → https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;yongshengzhao" rel="noopener" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/yourname" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:swardman@126.com?add" title="Skype → skype:swardman@126.com?add" rel="noopener" target="_blank"><i class="fa fa-fw fa-skype"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i></a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备2023003977号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heartbeat"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dr. Zhao</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">280k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">4:14</span>
</div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5de3d9a492e22c4b" async="async"></script>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-nest@1/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.9.0/lozad.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>














  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout: 3000,
        priority: true,
        ignores: [uri => uri.includes('#'),uri => uri == 'http://blog.zhaoyongsheng.com/2023/12/09/ROS2-Learning-Notes-ROS2-Humble-For-Beginners/',]
      });
      });
  </script>


<script>
NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'n9rtSD8wdvwav5LXeOerMH5C-gzGzoHsz',
    appKey: 'xcMirBCoS6Ecbog1fFmXEwhu',
    placeholder: "You are welcome to leave a comment.",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script>

</body>
</html>
